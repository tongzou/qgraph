{"version":3,"sources":["webpack://qgraph/webpack/universalModuleDefinition","webpack://qgraph/webpack/bootstrap","webpack://qgraph/./src/geometry/Point.js","webpack://qgraph/external {\"root\":\"_\",\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"lodash\"}","webpack://qgraph/./src/geometry/Rectangle.js","webpack://qgraph/./src/util/Utils.js","webpack://qgraph/./lib/bean.js","webpack://qgraph/./src/geometry/Shape.js","webpack://qgraph/./src/util/base64.js","webpack://qgraph/./src/util/Cache.js","webpack://qgraph/./src/util/dom-utils.js","webpack://qgraph/./src/util/string-buffer.js","webpack://qgraph/./src/geometry/Line.js","webpack://qgraph/./src/geometry/Ellipse.js","webpack://qgraph/./src/geometry/Rhombus.js","webpack://qgraph/./src/geometry/Link.js","webpack://qgraph/./src/event/key-utils.js","webpack://qgraph/./src/event/event-dispatcher.js","webpack://qgraph/./src/view/Label.js","webpack://qgraph/./src/graph/Cell.js","webpack://qgraph/./src/graph/Node.js","webpack://qgraph/./src/graph/Edge.js","webpack://qgraph/./src/view/Marker.js","webpack://qgraph/./src/graph/Graph.js","webpack://qgraph/./src/layout/Layout.js","webpack://qgraph/./src/layout/FlowLayout.js","webpack://qgraph/./src/behavior/Behavior.js","webpack://qgraph/./src/behavior/GraphBehavior.js","webpack://qgraph/./src/behavior/SelectionBehavior.js","webpack://qgraph/./src/view/Renderer.js","webpack://qgraph/./src/view/SVGRenderer.js","webpack://qgraph/./src/index.js"],"names":["root","factory","exports","module","require","define","amd","window","this","__WEBPACK_EXTERNAL_MODULE__1__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Point","x","y","_classCallCheck","aPt","Math","sqrt","p2","scale","dist","distance","angle","cos","PI","sin","clone","rotate","rect","vertical","W","N","S","E","NE","NW","SE","SW","__webpack_exports__","Rectangle","_Shape__WEBPACK_IMPORTED_MODULE_2__","el","w","width","h","height","left","right","top","bottom","pt","contains","_Point__WEBPACK_IMPORTED_MODULE_1__","pt1","pt2","horizontal","contains1","contains2","outPt","orthogonal","arguments","length","undefined","dx","dy","alpha","atan2","pi","beta","tan","point","direction","getDirection","pts","margin","lodash__WEBPACK_IMPORTED_MODULE_0___default","a","isArray","min","max","abs","rects","minx","miny","maxx","Infinity","maxy","each","_debugging","_debugAll","typeRegistry","splice","Array","type","namespace","Map","set","createType","props","defaultType","extend","extends","_extend","_possibleConstructorReturn","_getPrototypeOf","apply","_inherits","config","assign","typeName","log","buildTypes","types","_this","remove","defaultsDeep","forEach","child","parent","protoProps","staticProps","Surrogate","constructor","superclass","initConfig","obj","cArr","super","DEFAULTS","prop","getConstructor","jsClass","defaultClass","isString","eval","debug","moduleName","push","message","substring","console","info","getRelativePosition","bounds","geometry","offsetPosition","pos","anchorX","offsetX","anchorY","offsetY","unscale","_geometry_Rectangle__WEBPACK_IMPORTED_MODULE_2__","_geometry_Point__WEBPACK_IMPORTED_MODULE_1__","getProperty","has","isFunction","context","definition","__WEBPACK_AMD_DEFINE_RESULT__","__WEBPACK_AMD_DEFINE_FACTORY__","selectorEngine","win","old","namespaceRegex","nameRegex","addEvent","doc","document","nav","navigator","documentElement","W3C_MODEL","eventSupport","ONE","slice","str2arr","split","nativeEvents","hash","events","customEvents","isAncestor","element","container","compareDocumentPosition","nodeType","parentNode","check","event","related","relatedTarget","prefix","test","toString","mouseenter","base","condition","mouseleave","mousewheel","userAgent","Event","commonProps","mouseProps","concat","mouseWheelProps","keyProps","textProps","touchProps","messageProps","stateProps","overOutRegex","typeFixers","reg","fix","newEvent","keyCode","which","rightClick","button","pageX","pageY","clientX","clientY","body","scrollLeft","scrollTop","typeFixerMap","isNative","ownerDocument","parentWindow","originalEvent","isBean","fixer","target","srcElement","preventDefault","returnValue","stopPropagation","cancelBubble","stop","stopped","stopImmediatePropagation","isImmediatePropagationStopped","currentTarget","ne","targetElement","RegEntry","wrappedHandler","fn","args","eargs","findTarget","eventElement","__beanDel","ft","handler","original","namespaces","customType","once","removeListener","eventType","inNamespaces","checkNamespaces","j","matches","checkElement","checkOriginal","checkHandler","registry","map","forAll","pfx","list","all","charAt","substr","entries","entry","put","del","removed","setSelectorEngine","e","querySelectorAll","Error","rootListener","propertyName","listeners","listener","add","custom","attachEvent","detachEvent","rm","originalFn","orgType","replace","handlers","fireListener","evt","createEvent","dispatchEvent","fireEvent","createEventObject","off","typeSpec","k","isTypeStr","indexOf","on","selector","first","_typeof","array","match","delegate","bean","delfn","one","from","beanDel","fire","names","noConflict","cleanup","CollectGarbage","Shape","defaults","refPt","getPerimeter","view","template","getTemplate","_Rectangle__WEBPACK_IMPORTED_MODULE_2__","Base64","_keyStr","encode","input","chr1","chr2","chr3","enc1","enc2","enc3","enc4","output","_utf8_encode","charCodeAt","isNaN","decode","String","fromCharCode","_utf8_decode","string","utftext","c1","c2","c3","base64","caches","util_Cache","getCache","clear","inBrowser","dom_utils","isIE","sAgent","Idx","parseInt","isFireFox","InstallTrigger","isChrome","raw","isMac","platform","toUpperCase","isWindows","appVersion","isLinux","createElement","tag","attribs","styles","html","setElement","innerHTML","createElementByString","str","childNodes","external_root_commonjs_lodash_commonjs2_lodash_amd_lodash_default","setAttribute","style","testElement","node","method","getAncestorBy","getPosition","elRect","getBoundingClientRect","contextRect","getCenterPosition","move","getSize","offsetWidth","offsetHeight","resize","preloadImages","loaded","img","that","Image","onload","index","src","getImageInfo","downloadFile","data","mime","atob","decodeURI","GetBlob","msSaveBlob","link","href","download","display","appendChild","click","removeChild","contentType","sliceSize","byteArrays","offset","byteNumbers","byteArray","Uint8Array","Blob","openImage","image","myDocument","open","eventFromInput","tagName","waitForElement","id","Promise","resolve","getElementById","interval","setInterval","clearInterval","string_buffer_StringBuffer","StringBuffer","buffer","stuff","pop","sep","join","Line_Line","Line","start","end","Line_classCallCheck","cosa","geometry_Point","dotProduct","x0","y0","x1","y1","x2","y2","x3","y3","denom","ua","ub","intersectionX","intersectionY","Ellipse_Ellipse","b","cx","cy","px","py","f","g","det","xout1","xout2","yout1","yout2","xout","yout","pow","dir","geometry_Rectangle","Rhombus_Rhombus","tx","ty","intersection","defaultConfig","showGauge","defaultGeometry","linkTypes","Link_Link","Link","terminalVisual","shapeConfig","startMarker","endMarker","Link_classCallCheck","startNormal","endNormal","renderLink","isNumber","points","translate","getScaled","Utils","LinkClass","DirectLink","Link_BezierLink","ctrlpts","controlPts","p1","p3","p4","Link_EntityRelations","source","Port","getBounds","edge","isSourceLeft","isTargetLeft","result","getCenterY","xe","ye","seg","segment","dep","arr","midY","Link_Manhattan","Manhattan","MIN_BUFFER","autoRoute","randomNoise","step","maxChannelWidth","Link_possibleConstructorReturn","Link_getPrototypeOf","boxes","startBox","endBox","side","side2","box","intersect","channel","channel2","endPadding","_getChannel","_getFirstIntersection","_getRouteTendency","_hasIntersection","_moveSegment","breakPt","_getRouteDirection","getCenter","box2","box1","getLeft","getRight","getBottom","getTop","startPadding","getTranslated","route","_mergeSegments","getCommonAncestor","getDescendants","excludeFromRouting","range","randomNumber","floor","random","sign","startBufferNormal","endBufferNormal","startBuffer","endBuffer","prunePts","detectIntersection","savedIndex","savedSide","h1","equals","geometry_Link","getKeyData","ctrl","alt","shift","meta","buf","append","addEventHandler","event_dispatcher_doc","event_dispatcher_EventDispatcher","EventDispatcher","zoomScale","event_dispatcher_classCallCheck","rootNS","getAttribute","dragging","handleEvent","started","enterStack","bean_default","startKeys","stopKeys","stack","isRoot","startsWith","rootTarget","nsTarget","prepend","targetStack","_this2","isKeyEvent","KeyboardEvent","ctrlKey","altKey","shiftKey","metaKey","getKeyEvent","getEventInfo","wheelDelta","dragPos","dragObject","mouse","mousemove","currentPos","dispatch","mouseup","simulateEnterLeave","last","_this3","clearEnterStack","getNS","val","item","nsType","regexp","callback","lastPosition","_this4","registerKey","code","_this5","unregisterKey","zIndex","_this6","register","RegExp","registeredType","changedTouches","svg","ownerSVGElement","createSVGPoint","matrixTransform","getScreenCTM","inverse","clientLeft","clientTop","FONT_BOLD","FONT_ITALIC","FONT_UNDERLINE","FONT_SHADOW","Label_defaultConfig","fontSize","fontFamily","fontStyle","fontColor","padding","linePadding","align","rotation","Label","measureDiv","baselineDiv","stringMeasureEl","getStringSize","memoize","bold","isUndefined","position","visibility","contentWindow","write","close","fontWeight","strut","firstChild","baselineHeight","offsetTop","baseline","wrap","maxWidth","spaceSize","space","lineHeight","lines","words","line","currentWidth","wordWidth","newLine","word","_getLabelBox","label","labelConfig","wrappedLabel","anchor","setAnchorX","pivot","maxBounds","_label","underline","italic","shadow","getLabelBox","containerWidth","containerHeight","getLabelBoxForLink","render","renderLabel","editor","refEl","textEl","singleLine","unselectable","overflow","border","font-family","font-size","font-weight","focus","select","cancel","Cell_Cell","Cell","graph","uniqueId","Cell_classCallCheck","decorators","createDecorators","views","viewProps","Type","shape","getShape","className","computedClassName","viewProp","role","getView","currentRoot","destroyed","_computedClassName","getPrototypeOf","Node_Node","Node","Node_classCallCheck","Node_possibleConstructorReturn","Node_getPrototypeOf","inEdges","outEdges","ports","edges","children","portName","endPt","graph_Node","Edge_Edge","Edge","Edge_classCallCheck","Edge_possibleConstructorReturn","Edge_getPrototypeOf","setSource","sourcePos","setTarget","targetPos","setTerminal","setEdgeAt","removeEdge","addOutEdge","addInEdge","center","refPts","getReferencePoints","terminals","getBound","getPort","getLink","getTerminalVisual","_get","graph_Edge","view_Marker","size","marker","viewBox","ref","fill","color","getMarker","nodeDefaults","draggable","selectable","editable","resizable","sourceable","targetable","visible","edgeDefaults","Graph_Graph","Graph","markerConfig","model","Graph_classCallCheck","nodes","selection","nodeTypes","edgeTypes","markers","loadModel","getJSClass","addChild","to","addNode","addEdge","without","allowDanglingEdges","multiConnect","readOnly","viewOnly","graph_Graph","Layout_Layout","Layout","Layout_classCallCheck","orientation","HORIZONTAL","VERTICAL","layout_Layout","FlowLayout","items","_","getLinkedNodes","owner","hgap","vgap","_flPos","moveTo","trigger","layout_FlowLayout","Behavior","renderer","Behavior_classCallCheck","behavior_GraphBehavior","GraphBehavior","GraphBehavior_classCallCheck","GraphBehavior_possibleConstructorReturn","GraphBehavior_getPrototypeOf","dispatcher","handleDrag","GraphBehavior_assertThisInitialized","handleZoom","transform","behavior_SelectionBehavior","SelectionBehavior","SelectionBehavior_classCallCheck","SelectionBehavior_possibleConstructorReturn","SelectionBehavior_getPrototypeOf","selectCell","SelectionBehavior_assertThisInitialized","unselectCell","handleMultiSelect","selectedNodes","selectedLinks","attachedLinks","classed","selectedVertices","getShapes","getAttachedEdges","selectedEdges","cell","toggle","isSelected","_firstSelection","d3","dataTarget","moveToFront","setSelection","util","startPt","getBoundingRectangle","rubberband","appendNode","getCellLayer","cells","getCurrentRoot","filter","attr","SelectionBehavior_get","Renderer_Renderer","Renderer","Renderer_classCallCheck","tabindex","layout","LayoutClass","_translate","_scale","graphBehavior","selectionBehavior","nodeBehavior","edgeBehavior","connectionBehavior","scaled","viewport","isNull","vp","refresh","_graph","initializeBehaviors","renderMarkers","JsClass","_delayEdit","delay","preprocessor","TEMPLATES","parts","part","trim","camelCase","interpolate","gridSize","gBounds","vBounds","parseFloat","defaultClickMode","hideOutline","singleSelect","gridEnabled","guidesEnabled","maxZoom","minZoom","zoomFactor","maskOpacity","view_Renderer","SVGElement","createElementNS","defineProperties","outerHTML","configurable","$node","$temp","cloneNode","ropen","nodeName","rclose","markup","lastChild","firstElementChild","toDataURL","options","_svg","msg","base64dataURLencode","b64","btoa","keepNonSafe","keepOutsideViewport","svgDataurl","exportSVG","canvg","canvas","jsCanvas","xcanvas","bbox","getBBox","SVGRenderer_SVGRenderer","compile","imageDataurl","exportImageCanvg","ctx","getContext","svgImg","svgXml","drawImage","onerror","exportImage","SVGRenderer_get","SVGRenderer_getPrototypeOf","SVGRenderer","renderDefs","querySelector","str1","str2","renderShape","round","newPts","next","d1","d2","corner","prev","getPathData","content","temp","$root","$edge","Ellipse","Triangle","Rhombus","Hexagon","Polygon","removeLast","Marker","Grid","variable","view_SVGRenderer","addShape","Cache","DomUtils"],"mappings":"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","file":"qgraph.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"qgraph\", [\"lodash\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"qgraph\"] = factory(require(\"lodash\"));\n\telse\n\t\troot[\"qgraph\"] = factory(root[\"_\"]);\n})((typeof window !== 'undefined' ? window : this), function(__WEBPACK_EXTERNAL_MODULE__1__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","class Point {\n  constructor (x, y) {\n    this.x = x\n    this.y = y\n  }\n\n  /**\n   * Make a clone of this point\n   */\n  clone () {\n    return new Point(this.x, this.y)\n  }\n\n  /**\n   * Calculate the distance from this pt to the other pt.\n   * @param aPt\n   * @returns {number}\n   */\n  distance (aPt) {\n    return Math.sqrt((this.x - aPt.x) * (this.x - aPt.x) + (this.y - aPt.y) * (this.y - aPt.y))\n  }\n\n  /**\n   * Translate this point\n   */\n  translate (p2) {\n    this.x += p2.x\n    this.y += p2.y\n    return this\n  }\n\n  /**\n   * Scale this vector\n   */\n  scale (scale) {\n    this.x *= scale\n    this.y *= scale\n    return this\n  }\n\n  getScaled (scale) {\n    return new Point(this.x * scale, this.y * scale)\n  }\n\n  getTranslated (p2) {\n    return new Point(this.x + p2.x, this.y + p2.y)\n  }\n\n  /**\n   * Get the direction vector from this point to p2.\n   * @param p2\n   * @returns {Point}\n   */\n  getDirection (p2) {\n    var dist = this.distance(p2)\n    return new Point((p2.x - this.x) / dist, (p2.y - this.y) / dist)\n  }\n\n  /**\n   * rotate the point about the origin. With the specified angle.\n   * @param angle the angle to rotate\n   */\n  rotate (angle) {\n    var cos = Math.cos(angle * Math.PI / 180)\n    var sin = Math.sin(angle * Math.PI / 180)\n    var x = this.x; var y = this.y\n    this.x = x * cos - y * sin\n    this.y = x * sin + y * cos\n    return this\n  }\n\n  getRotated (angle) {\n    return this.clone().rotate(angle)\n  }\n\n  /**\n   * Calculate the dot product, treating this and p2 as vectors.\n   */\n  dotProduct (p2) {\n    return this.x * p2.x + this.y * p2.y\n  }\n\n  /**\n   * Get the mid point between this and p2.\n   */\n  getMidPoint (p2) {\n    return new Point((this.x + p2.x) / 2, (this.y + p2.y) / 2)\n  }\n\n  reverse () {\n    this.x = -this.x\n    this.y = -this.y\n    return this\n  }\n\n  equals (p2) {\n    if (!p2 || !(p2 instanceof Point)) return false\n\n    return (this.x === p2.x && this.y === p2.y)\n  }\n\n  /**\n   * Reflect this point w.r.t. the rectangle.\n   * If vertical is true, it will reflect the point cross the vertical\n   * central line of the rectangle, otherwise reflect cross the horizontal\n   * central line.\n   *\n   * @param rect the rectangle\n   * @param vertical whether is vertical reflection or horizontal reflection.\n   */\n  reflect (rect, vertical) {\n    if (vertical) {\n      this.x = 2 * rect.x - this.x\n    } else {\n      this.y = 2 * rect.y - this.y\n    }\n    return this\n  }\n\n  toString () {\n    return this.x + ',' + this.y\n  }\n}\n\nPoint.W = new Point(-1, 0)\nPoint.N = new Point(0, -1)\nPoint.S = new Point(0, 1)\nPoint.E = new Point(1, 0)\nPoint.NE = new Point(1, -1)\nPoint.NW = new Point(-1, -1)\nPoint.SE = new Point(1, 1)\nPoint.SW = new Point(-1, 1)\n\nexport default Point\n","module.exports = __WEBPACK_EXTERNAL_MODULE__1__;","import _ from 'lodash'\nimport Point from './Point'\nimport Shape from './Shape'\n\nexport default class Rectangle extends Shape {\n  /**\n   * Checks whether this rectangle contains a given point of a given rectangle\n   */\n  contains (el) {\n    let w = el.width || 0\n    let h = el.height || 0\n    let left = el.x - w / 2\n    let right = el.x + w / 2\n    let top = el.y - h / 2\n    let bottom = el.y + h / 2\n    return (right <= this.right) && (left >= this.left) &&\n      (top >= this.top) && (bottom <= this.bottom)\n  }\n\n  /**\n   * Calcualte the distance to a point. 0 if this rectangle contains the point.\n   */\n  distance (pt) {\n    if (this.contains(pt)) return 0\n\n    if (pt.x < this.left) {\n      if (pt.y < this.top) {\n        return pt.distance(new Point(this.left, this.top))\n      }\n      if (pt.y <= this.bottom) return this.left - pt.x\n      return pt.distance(new Point(this.left, this.bottom))\n    }\n    if (pt.x <= this.right) {\n      if (pt.y <= this.top) return this.top - pt.y\n      return pt.y - this.bottom\n    }\n    if (pt.y < this.top) {\n      return pt.distance(new Point(this.right, this.top))\n    }\n    if (pt.y <= this.bottom) return pt.x - this.right\n    return pt.distance(new Point(this.right, this.bottom))\n  }\n\n  /**\n   * Given two points, we want to detect whether the line joining the pts intersect\n   * with the rectangle or not. We assume only horizontal or vertical line segments.\n   *\n   * @return int the side of the intersection: -1: no intersection, 0: left, 1: top, 2: right, 3: bottom, 4: containment.\n   */\n  detectIntersection (pt1, pt2) {\n    let horizontal = pt1.y === pt2.y\n    let contains1 = this.contains(pt1)\n    let contains2 = this.contains(pt2)\n    if (contains1 && contains2) return 4\n    if (!contains1 && !contains2) {\n      if (horizontal && (pt1.y >= this.top && pt1.y <= this.bottom)) {\n        if (pt1.x < this.left && pt2.x > this.right) return 0\n        if (pt1.x > this.right && pt2.x < this.left) return 2\n      }\n      if (!horizontal && (pt1.x >= this.left && pt1.x <= this.right)) {\n        if (pt1.y < this.top && pt2.y > this.bottom) return 1\n        if (pt1.y > this.bottom && pt2.y < this.top) return 3\n      }\n      return -1\n    }\n\n    let outPt = contains1 ? pt2 : pt1\n    if (horizontal) {\n      if (outPt.x > this.right) return 2\n      return 0\n    } else {\n      if (outPt.y < this.top) return 1\n      return 3\n    }\n  }\n\n  toString () {\n    return 'Rectangle:{x=' + this.x + ';y=' + this.y + ';width=' + this.width + ';height=' + this.height + '}'\n  }\n\n  static getPerimeter (rect, pt, orthogonal = false) {\n    let x = rect.x\n    let y = rect.y\n    let dx = pt.x - x\n    let dy = pt.y - y\n    let alpha = Math.atan2(dy, dx)\n    let p = new Point(0, 0)\n    let pi = Math.PI\n    let pi2 = Math.PI / 2\n    let beta = pi2 - alpha\n    let t = Math.atan2(rect.height, rect.width)\n\n    if (alpha < -pi + t || alpha > pi - t) {\n      // Left edge\n      p.x = rect.left\n      p.y = y - rect.width * Math.tan(alpha) / 2\n    } else if (alpha < -t) {\n      // Top Edge\n      p.y = rect.top\n      p.x = x - rect.height * Math.tan(beta) / 2\n    } else if (alpha < t) {\n      // Right Edge\n      p.x = rect.right\n      p.y = y + rect.width * Math.tan(alpha) / 2\n    } else {\n      // Bottom Edge\n      p.y = rect.bottom\n      p.x = x + rect.height * Math.tan(beta) / 2\n    }\n\n    if (orthogonal) {\n      if (alpha < -pi + t || alpha > pi - t) {\n        // Left edge\n        p.x = rect.left\n        p.y = y\n      } else if (alpha < -t) {\n        // Top Edge\n        p.y = rect.top\n        p.x = x\n      } else if (alpha < t) {\n        // Right Edge\n        p.x = rect.right\n        p.y = y\n      } else {\n        // Bottom Edge\n        p.y = rect.bottom\n        p.x = x\n      }\n    }\n\n    let dir = Rectangle.getDirection(rect, p, orthogonal)\n    return { point: p, direction: dir }\n  }\n\n  /**\n   * Return the bounding rectangle that contains p1 and p2\n   */\n  static getBoundingRectangle (pts, margin) {\n    if (!pts || pts.length === 0) return null\n    margin = margin || [0, 0, 0, 0]\n    if (!_.isArray(margin)) {\n      margin = [margin, margin, margin, margin]\n    }\n    let min = [pts[0].x, pts[0].y]\n    let max = [pts[0].x, pts[0].y]\n    for (let i = 1; i < pts.length; i++) {\n      let p = pts[i]\n      if (p.x < min[0]) {\n        min[0] = p.x\n      }\n      if (p.y < min[1]) {\n        min[1] = p.y\n      }\n      if (p.x > max[0]) {\n        max[0] = p.x\n      }\n      if (p.y > max[1]) {\n        max[1] = p.y\n      }\n    }\n    min[0] = min[0] - margin[0]\n    min[1] = min[1] - margin[1]\n    max[0] = max[0] + margin[2]\n    max[1] = max[1] + margin[3]\n    let w = Math.abs(max[0] - min[0])\n    let h = Math.abs(max[1] - min[1])\n    return new Rectangle(min[0] + w / 2, min[1] + h / 2, w, h)\n  }\n\n  /**\n   * Create a union of all the rectangles.\n   * @param rects\n   */\n  static union (rects) {\n    let minx = null; let miny = null; let maxx = -Infinity; let maxy = -Infinity\n    _.each(rects, function (rect) {\n      minx = minx || rect.x\n      miny = miny || rect.y\n      minx = Math.min(minx, rect.x)\n      miny = Math.min(miny, rect.y)\n      maxx = Math.max(maxx, rect.right())\n      maxy = Math.max(maxy, rect.bottom())\n    })\n    minx = minx || 0\n    miny = miny || 0\n    return new Rectangle(minx, miny, maxx - minx, maxy - miny)\n  }\n\n  /**\n   * Returns the direction the point <i>p</i> is in relation to the given rectangle.\n   * Possible values are WEST (-1,0), EAST (1,0), NORTH (0,-1) and SOUTH (0,1) if orthogonal is true, otherwise return\n   * the direction connection the center of r and p.\n   * @param r\n   * @param p\n   * @param orthogonal\n   * @returns {Point|*}\n   */\n  static getDirection (r, p, orthogonal = false) {\n    if (!orthogonal) {\n      return new Point(r.x, r.y).getDirection(new Point(p.x, p.y))\n    }\n\n    let i; let distance = Math.abs(r.left - p.x); let direction = Point.W\n\n    i = Math.abs(r.top - p.y)\n    if (i <= distance) {\n      distance = i\n      direction = Point.N\n    }\n\n    i = Math.abs(r.bottom - p.y)\n    if (i <= distance) {\n      distance = i\n      direction = Point.S\n    }\n\n    i = Math.abs(r.right - p.x)\n    if (i < distance) {\n      direction = Point.E\n    }\n\n    return direction\n  }\n}\n","import _ from 'lodash'\nimport Point from '../geometry/Point'\nimport Rectangle from '../geometry/Rectangle'\n\n// util variables\nlet _debugging = []; let _debugAll = false; let typeRegistry = {}; let splice = Array.splice\n\n/**\n * Utility functions\n */\nexport default {\n  type: function (namespace, name, type) {\n    if (!typeRegistry[namespace]) { typeRegistry[namespace] = new Map() }\n    if (!name) { return typeRegistry[namespace] }\n    if (!type) { return typeRegistry[namespace].get(name) }\n    typeRegistry[namespace].set(name, type)\n  },\n\n  createType: function (namespace, props, defaultType) {\n    let name = props.name\n\n    // first check if type exists\n    let type = this.type(namespace, name)\n    if (!type) {\n      let extend = props.extends ? this.type(namespace, props.extends) : null\n      if (!extend && defaultType) { extend = defaultType }\n      if (extend) {\n        type = class extends extend {\n        }\n      } else {\n        type = class {\n          constructor (config) {\n            _.assign(this, config)\n          }\n        }\n      }\n      delete props.name\n      delete props.extends\n      _.assign(type.prototype, props)\n      type.typeName = name\n      this.type(namespace, name, type)\n      this.log('Utils', 'Utils.createType - ' + namespace + '.' + name)\n    }\n    return type\n  },\n\n  buildTypes: function (types, namespace, defaultType) {\n    this.log('Utils', 'Utils.buildTypes - ' + namespace)\n\n    if (!types && defaultType) {\n      this.createType(namespace, defaultType)\n      this.log('Utils', 'Utils.buildTypes end')\n      return\n    }\n    if (defaultType) {\n      let type = _.remove(types, { name: defaultType.name })\n      type = type.length > 0 ? type[0] : null\n      if (type) { defaultType = this.createType(namespace, _.defaultsDeep(type, defaultType)) } else { defaultType = this.createType(namespace, defaultType) }\n    }\n\n    _.forEach(types, (type) => {\n      this.createType(namespace, type, defaultType)\n    })\n    this.log('Utils', 'Utils.buildTypes end')\n  },\n\n  // Helper function to correctly set up the prototype chain, for subclasses.\n  // Similar to `goog.inherits`, but uses a hash of prototype properties and\n  // class properties to be extended.\n  extend: function (child, parent, protoProps, staticProps) {\n    // Add static properties to the constructor function, if supplied.\n    _.extend(child, parent, staticProps)\n\n    // Set the prototype chain to inherit from `parent`, without calling\n    // `parent`'s constructor function.\n    var Surrogate = function () {\n      this.constructor = child\n    }\n    Surrogate.prototype = parent.prototype\n    child.prototype = new Surrogate()\n\n    // Add prototype properties (instance properties) to the subclass,\n    // if supplied.\n    if (protoProps) _.extend(child.prototype, protoProps)\n\n    // Set a convenience property in case the parent's prototype is needed later.\n    child.superclass = parent.prototype\n\n    return child\n  },\n\n  initConfig: function (obj, config) {\n    let props = {}; let c = obj.constructor; let cArr = [c]\n    while (c) {\n      if (c.super) {\n        c = c.super.constructor\n        splice.apply(cArr, [0, 0, c])\n      } else { c = null }\n    }\n\n    for (let i = 0; i < cArr.length; i++) {\n      c = cArr[i]\n      if (c.DEFAULTS) { _.assign(props, c.DEFAULTS) }\n    }\n    obj.props = _.assign(props, config)\n    c.prototype.prop = function (name, value) {\n      if (!value) { return this.props[name] }\n      this.props[name] = value\n    }\n  },\n\n  /**\n   * Gets the JS class constructor.\n   * @param {Object} jsClass\n   * @param {Object} defaultClass\n   */\n  getConstructor: function (jsClass, defaultClass) {\n    if (!jsClass) { jsClass = defaultClass }\n\n    if (_.isString(jsClass)) {\n      jsClass = eval(jsClass) // eslint-disable-line no-eval\n    }\n    return jsClass\n  },\n\n  debug: function (moduleName) {\n    if (moduleName) {\n      _debugging.push(moduleName)\n    } else {\n      _debugAll = true\n    }\n  },\n\n  log: function (name, message) {\n    var debug = _debugAll\n    if (!_debugAll) {\n      debug = false\n      for (var i = 0; i < _debugging.length; i++) {\n        if (_debugging[i] === name) debug = true\n      }\n    }\n    if (!debug) {\n      return\n    }\n    while (name.length < 10) {\n      name = name + ' '\n    }\n    name = name.substring(0, 10) + ' - '\n    console.info(name, message)\n  },\n\n  /**\n   * Get the relative position of sub shapes within a parent share.\n   * @param bounds\n   * @param geometry The geometry information, the format of Geometry is:\n   * {\n   *      x: \"x coordinate of ref point, if less than 1, will be treated as the percentage of the parent width.\",\n   *      y: \"y coordinate of ref point.\",\n   *      anchorX: \"x pos of child relative to the ref point\",\n   *      anchorY: \"y pos of child relative to the ref point\",\n   *      offsetX: \"the offset in the x direction.\",\n   *      offsetY: \"the offset in the y direction.\",\n   *      width: \"the width of the child element\",\n   *      height: \"the height of the child element\"\n   * }\n   * @returns {*[]}\n   */\n  getRelativePosition: function (bounds, geometry) {\n    let x = Math.abs(geometry.x) <= 1 ? bounds.width * geometry.x : geometry.x\n    let y = Math.abs(geometry.y) <= 1 ? bounds.height * geometry.y : geometry.y\n    return this.offsetPosition([x, y], geometry)\n  },\n\n  offsetPosition: function (pos, geometry) {\n    return [pos[0] + geometry.width * geometry.anchorX + geometry.offsetX, pos[1] + geometry.height * geometry.anchorY + geometry.offsetY]\n  },\n\n  /**\n   * Get the position relative to the graph that's unscaled, i.e., absolute position without considering translation and scale.\n   * @param t the current translate\n   * @param scale the current scale\n   * @param o can be either a Point or a Rectangle or a Point array.\n   */\n  unscale: function (t, scale, o) {\n    if (o instanceof Rectangle) { return new Rectangle(o.x * scale + t[0], o.y * scale + t[1], o.width * scale, o.height * scale) } else if (o instanceof Point) { return new Point(o.x * scale + t[0], o.y * scale + t[1]) } else { return [o[0] * scale + t[0], o[1] * scale + t[1]] }\n  },\n\n  /**\n   * Get the position relative to the graph that's scaled, i.e., relative position considering translation and scale.\n   * @param t the current translation\n   * @param scale the current scale\n   * @param o can be either a Point or a Rectangle or a Point array.\n   */\n  scale: function (t, scale, o) {\n    if (o instanceof Rectangle) { return new Rectangle((o.x - t[0]) / scale, (o.y - t[1]) / scale, o.width / scale, o.height / scale) } else if (o instanceof Point) { return new Point((o.x - t[0]) / scale, (o.y - t[1]) / scale) } else { return [(o[0] - t[0]) / scale, (o[1] - t[1]) / scale] }\n  },\n\n  /**\n   * Convenience method.\n   */\n  getProperty: function (obj, prop) {\n    if (!obj) { return null }\n    if (_.has(obj, prop)) { return obj[prop] }\n    if (obj.prop && _.isFunction(obj.prop)) { return obj.prop(prop) }\n    return null\n  }\n}\n","/*!\n  * Bean - copyright (c) Jacob Thornton 2011-2012\n  * https://github.com/fat/bean\n  * MIT license\n  */\n(function (name, context, definition) {\n  if (typeof module != 'undefined' && module.exports) module.exports = definition()\n  else if (typeof define == 'function' && define.amd) define(definition)\n  else context[name] = definition()\n})('bean', this, function (name, context) {\n  name    = name    || 'bean'\n  context = context || this\n\n  var win            = typeof window !== 'undefined' ? window : this\n    , old            = context[name]\n    , namespaceRegex = /[^\\.]*(?=\\..*)\\.|.*/\n    , nameRegex      = /\\..*/\n    , addEvent       = 'addEventListener'\n    , removeEvent    = 'removeEventListener'\n    , doc            = typeof document !== 'undefined' ? document : {}\n    , nav            = typeof navigator !== 'undefined' ? navigator : {}\n    , root           = doc.documentElement || {}\n    , W3C_MODEL      = root[addEvent]\n    , eventSupport   = W3C_MODEL ? addEvent : 'attachEvent'\n    , ONE            = {} // singleton for quick matching making add() do one()\n\n    , slice          = Array.prototype.slice\n    , str2arr        = function (s, d) { return s.split(d || ' ') }\n    , isString       = function (o) { return typeof o == 'string' }\n    , isFunction     = function (o) { return typeof o == 'function' }\n\n      // events that we consider to be 'native', anything not in this list will\n      // be treated as a custom event\n    , standardNativeEvents =\n        'click dblclick mouseup mousedown contextmenu '                  + // mouse buttons\n        'mousewheel mousemultiwheel DOMMouseScroll '                     + // mouse wheel\n        'mouseover mouseout mousemove selectstart selectend '            + // mouse movement\n        'keydown keypress keyup '                                        + // keyboard\n        'orientationchange '                                             + // mobile\n        'focus blur change reset select submit '                         + // form elements\n        'load unload beforeunload resize move DOMContentLoaded '         + // window\n        'readystatechange message '                                      + // window\n        'error abort scroll '                                              // misc\n      // element.fireEvent('onXYZ'... is not forgiving if we try to fire an event\n      // that doesn't actually exist, so make sure we only do these on newer browsers\n    , w3cNativeEvents =\n        'show '                                                          + // mouse buttons\n        'input invalid '                                                 + // form elements\n        'touchstart touchmove touchend touchcancel '                     + // touch\n        'gesturestart gesturechange gestureend '                         + // gesture\n        'textinput '                                                     + // TextEvent\n        'readystatechange pageshow pagehide popstate '                   + // window\n        'hashchange offline online '                                     + // window\n        'afterprint beforeprint '                                        + // printing\n        'dragstart dragenter dragover dragleave drag drop dragend '      + // dnd\n        'loadstart progress suspend emptied stalled loadmetadata '       + // media\n        'loadeddata canplay canplaythrough playing waiting seeking '     + // media\n        'seeked ended durationchange timeupdate play pause ratechange '  + // media\n        'volumechange cuechange '                                        + // media\n        'checking noupdate downloading cached updateready obsolete '       // appcache\n\n      // convert to a hash for quick lookups\n    , nativeEvents = (function (hash, events, i) {\n        for (i = 0; i < events.length; i++) events[i] && (hash[events[i]] = 1)\n        return hash\n      }({}, str2arr(standardNativeEvents + (W3C_MODEL ? w3cNativeEvents : ''))))\n\n      // custom events are events that we *fake*, they are not provided natively but\n      // we can use native events to generate them\n    , customEvents = (function () {\n        var isAncestor = 'compareDocumentPosition' in root\n              ? function (element, container) {\n                  return container.compareDocumentPosition && (container.compareDocumentPosition(element) & 16) === 16\n                }\n              : 'contains' in root\n                ? function (element, container) {\n                    container = container.nodeType === 9 || container === window ? root : container\n                    return container !== element && container.contains(element)\n                  }\n                : function (element, container) {\n                    while (element = element.parentNode) if (element === container) return 1\n                    return 0\n                  }\n          , check = function (event) {\n              var related = event.relatedTarget\n              return !related\n                ? related == null\n                : (related !== this && related.prefix !== 'xul' && !/document/.test(this.toString())\n                    && !isAncestor(related, this))\n            }\n\n        return {\n            mouseenter: { base: 'mouseover', condition: check }\n          , mouseleave: { base: 'mouseout', condition: check }\n          , mousewheel: { base: /Firefox/.test(nav.userAgent) ? 'DOMMouseScroll' : 'mousewheel' }\n        }\n      }())\n\n      // we provide a consistent Event object across browsers by taking the actual DOM\n      // event object and generating a new one from its properties.\n    , Event = (function () {\n            // a whitelist of properties (for different event types) tells us what to check for and copy\n        var commonProps  = str2arr('altKey attrChange attrName bubbles cancelable ctrlKey currentTarget ' +\n              'detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey '  +\n              'srcElement target timeStamp type view which propertyName')\n          , mouseProps   = commonProps.concat(str2arr('button buttons clientX clientY dataTransfer '      +\n              'fromElement offsetX offsetY pageX pageY screenX screenY toElement'))\n          , mouseWheelProps = mouseProps.concat(str2arr('wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ ' +\n              'axis')) // 'axis' is FF specific\n          , keyProps     = commonProps.concat(str2arr('char charCode key keyCode keyIdentifier '          +\n              'keyLocation location'))\n          , textProps    = commonProps.concat(str2arr('data'))\n          , touchProps   = commonProps.concat(str2arr('touches targetTouches changedTouches scale rotation'))\n          , messageProps = commonProps.concat(str2arr('data origin source'))\n          , stateProps   = commonProps.concat(str2arr('state'))\n          , overOutRegex = /over|out/\n            // some event types need special handling and some need special properties, do that all here\n          , typeFixers   = [\n                { // key events\n                    reg: /key/i\n                  , fix: function (event, newEvent) {\n                      newEvent.keyCode = event.keyCode || event.which\n                      return keyProps\n                    }\n                }\n              , { // mouse events\n                    reg: /click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i\n                  , fix: function (event, newEvent, type) {\n                      newEvent.rightClick = event.which === 3 || event.button === 2\n                      newEvent.pos = { x: 0, y: 0 }\n                      if (event.pageX || event.pageY) {\n                        newEvent.clientX = event.pageX\n                        newEvent.clientY = event.pageY\n                      } else if (event.clientX || event.clientY) {\n                        newEvent.clientX = event.clientX + doc.body.scrollLeft + root.scrollLeft\n                        newEvent.clientY = event.clientY + doc.body.scrollTop + root.scrollTop\n                      }\n                      if (overOutRegex.test(type)) {\n                        newEvent.relatedTarget = event.relatedTarget\n                          || event[(type == 'mouseover' ? 'from' : 'to') + 'Element']\n                      }\n                      return mouseProps\n                    }\n                }\n              , { // mouse wheel events\n                    reg: /mouse.*(wheel|scroll)/i\n                  , fix: function () { return mouseWheelProps }\n                }\n              , { // TextEvent\n                    reg: /^text/i\n                  , fix: function () { return textProps }\n                }\n              , { // touch and gesture events\n                    reg: /^touch|^gesture/i\n                  , fix: function () { return touchProps }\n                }\n              , { // message events\n                    reg: /^message$/i\n                  , fix: function () { return messageProps }\n                }\n              , { // popstate events\n                    reg: /^popstate$/i\n                  , fix: function () { return stateProps }\n                }\n              , { // everything else\n                    reg: /.*/\n                  , fix: function () { return commonProps }\n                }\n            ]\n          , typeFixerMap = {} // used to map event types to fixer functions (above), a basic cache mechanism\n\n          , Event = function (event, element, isNative) {\n              if (!arguments.length) return\n              event = event || ((element.ownerDocument || element.document || element).parentWindow || win).event\n              this.originalEvent = event\n              this.isNative       = isNative\n              this.isBean         = true\n\n              if (!event) return\n\n              var type   = event.type\n                , target = event.target || event.srcElement\n                , i, l, p, props, fixer\n\n              this.target = target && target.nodeType === 3 ? target.parentNode : target\n\n              if (isNative) { // we only need basic augmentation on custom events, the rest expensive & pointless\n                fixer = typeFixerMap[type]\n                if (!fixer) { // haven't encountered this event type before, map a fixer function for it\n                  for (i = 0, l = typeFixers.length; i < l; i++) {\n                    if (typeFixers[i].reg.test(type)) { // guaranteed to match at least one, last is .*\n                      typeFixerMap[type] = fixer = typeFixers[i].fix\n                      break\n                    }\n                  }\n                }\n\n                props = fixer(event, this, type)\n                for (i = props.length; i--;) {\n                  if (!((p = props[i]) in this) && p in event) this[p] = event[p]\n                }\n              }\n            }\n\n        // preventDefault() and stopPropagation() are a consistent interface to those functions\n        // on the DOM, stop() is an alias for both of them together\n        Event.prototype.preventDefault = function () {\n          if (this.originalEvent.preventDefault) this.originalEvent.preventDefault()\n          else this.originalEvent.returnValue = false\n        }\n        Event.prototype.stopPropagation = function () {\n          if (this.originalEvent.stopPropagation) this.originalEvent.stopPropagation()\n          else this.originalEvent.cancelBubble = true\n        }\n        Event.prototype.stop = function () {\n          this.preventDefault()\n          this.stopPropagation()\n          this.stopped = true\n        }\n        // stopImmediatePropagation() has to be handled internally because we manage the event list for\n        // each element\n        // note that originalElement may be a Bean#Event object in some situations\n        Event.prototype.stopImmediatePropagation = function () {\n          if (this.originalEvent.stopImmediatePropagation) this.originalEvent.stopImmediatePropagation()\n          this.isImmediatePropagationStopped = function () { return true }\n        }\n        Event.prototype.isImmediatePropagationStopped = function () {\n          return this.originalEvent.isImmediatePropagationStopped && this.originalEvent.isImmediatePropagationStopped()\n        }\n        Event.prototype.clone = function (currentTarget) {\n          //TODO: this is ripe for optimisation, new events are *expensive*\n          // improving this will speed up delegated events\n          var ne = new Event(this, this.element, this.isNative)\n          ne.currentTarget = currentTarget\n          return ne\n        }\n\n        return Event\n      }())\n\n      // if we're in old IE we can't do onpropertychange on doc or win so we use doc.documentElement for both\n    , targetElement = function (element, isNative) {\n        return !W3C_MODEL && !isNative && (element === doc || element === win) ? root : element\n      }\n\n      /**\n        * Bean maintains an internal registry for event listeners. We don't touch elements, objects\n        * or functions to identify them, instead we store everything in the registry.\n        * Each event listener has a RegEntry object, we have one 'registry' for the whole instance.\n        */\n    , RegEntry = (function () {\n        // each handler is wrapped so we can handle delegation and custom events\n        var wrappedHandler = function (element, fn, condition, args) {\n            var call = function (event, eargs) {\n                  return fn.apply(element, args ? slice.call(eargs, event ? 0 : 1).concat(args) : eargs)\n                }\n              , findTarget = function (event, eventElement) {\n                  return fn.__beanDel ? fn.__beanDel.ft(event.target, element) : eventElement\n                }\n              , handler = condition\n                  ? function (event) {\n                      var target = findTarget(event, this) // deleated event\n                      if (condition.apply(target, arguments)) {\n                        if (event) event.currentTarget = target\n                        return call(event, arguments)\n                      }\n                    }\n                  : function (event) {\n                      if (fn.__beanDel) event = event.clone(findTarget(event)) // delegated event, fix the fix\n                      return call(event, arguments)\n                    }\n            handler.__beanDel = fn.__beanDel\n            return handler\n          }\n\n        , RegEntry = function (element, type, handler, original, namespaces, args, root) {\n            var customType     = customEvents[type]\n              , isNative\n\n            if (type == 'unload') {\n              // self clean-up\n              handler = once(removeListener, element, type, handler, original)\n            }\n\n            if (customType) {\n              if (customType.condition) {\n                handler = wrappedHandler(element, handler, customType.condition, args)\n              }\n              type = customType.base || type\n            }\n\n            this.isNative      = isNative = nativeEvents[type] && !!element[eventSupport]\n            this.customType    = !W3C_MODEL && !isNative && type\n            this.element       = element\n            this.type          = type\n            this.original      = original\n            this.namespaces    = namespaces\n            this.eventType     = W3C_MODEL || isNative ? type : 'propertychange'\n            this.target        = targetElement(element, isNative)\n            this[eventSupport] = !!this.target[eventSupport]\n            this.root          = root\n            this.handler       = wrappedHandler(element, handler, null, args)\n          }\n\n        // given a list of namespaces, is our entry in any of them?\n        RegEntry.prototype.inNamespaces = function (checkNamespaces) {\n          var i, j, c = 0\n          if (!checkNamespaces) return true\n          if (!this.namespaces) return false\n          for (i = checkNamespaces.length; i--;) {\n            for (j = this.namespaces.length; j--;) {\n              if (checkNamespaces[i] == this.namespaces[j]) c++\n            }\n          }\n          return checkNamespaces.length === c\n        }\n\n        // match by element, original fn (opt), handler fn (opt)\n        RegEntry.prototype.matches = function (checkElement, checkOriginal, checkHandler) {\n          return this.element === checkElement &&\n            (!checkOriginal || this.original === checkOriginal) &&\n            (!checkHandler || this.handler === checkHandler)\n        }\n\n        return RegEntry\n      }())\n\n    , registry = (function () {\n        // our map stores arrays by event type, just because it's better than storing\n        // everything in a single array.\n        // uses '$' as a prefix for the keys for safety and 'r' as a special prefix for\n        // rootListeners so we can look them up fast\n        var map = {}\n\n          // generic functional search of our registry for matching listeners,\n          // `fn` returns false to break out of the loop\n          , forAll = function (element, type, original, handler, root, fn) {\n              var pfx = root ? 'r' : '$'\n              if (!type || type == '*') {\n                // search the whole registry\n                for (var t in map) {\n                  if (t.charAt(0) == pfx) {\n                    forAll(element, t.substr(1), original, handler, root, fn)\n                  }\n                }\n              } else {\n                var i = 0, l, list = map[pfx + type], all = element == '*'\n                if (!list) return\n                for (l = list.length; i < l; i++) {\n                  if ((all || list[i].matches(element, original, handler)) && !fn(list[i], list, i, type)) return\n                }\n              }\n            }\n\n          , has = function (element, type, original, root) {\n              // we're not using forAll here simply because it's a bit slower and this\n              // needs to be fast\n              var i, list = map[(root ? 'r' : '$') + type]\n              if (list) {\n                for (i = list.length; i--;) {\n                  if (!list[i].root && list[i].matches(element, original, null)) return true\n                }\n              }\n              return false\n            }\n\n          , get = function (element, type, original, root) {\n              var entries = []\n              forAll(element, type, original, null, root, function (entry) {\n                return entries.push(entry)\n              })\n              return entries\n            }\n\n          , put = function (entry) {\n              var has = !entry.root && !this.has(entry.element, entry.type, null, false)\n                , key = (entry.root ? 'r' : '$') + entry.type\n              ;(map[key] || (map[key] = [])).push(entry)\n              return has\n            }\n\n          , del = function (entry) {\n              forAll(entry.element, entry.type, null, entry.handler, entry.root, function (entry, list, i) {\n                list.splice(i, 1)\n                entry.removed = true\n                if (list.length === 0) delete map[(entry.root ? 'r' : '$') + entry.type]\n                return false\n              })\n            }\n\n            // dump all entries, used for onunload\n          , entries = function () {\n              var t, entries = []\n              for (t in map) {\n                if (t.charAt(0) == '$') entries = entries.concat(map[t])\n              }\n              return entries\n            }\n\n        return { has: has, get: get, put: put, del: del, entries: entries }\n      }())\n\n      // we need a selector engine for delegated events, use querySelectorAll if it exists\n      // but for older browsers we need Qwery, Sizzle or similar\n    , selectorEngine\n    , setSelectorEngine = function (e) {\n        if (!arguments.length) {\n          selectorEngine = doc.querySelectorAll\n            ? function (s, r) {\n                return r.querySelectorAll(s)\n              }\n            : function () {\n                throw new Error('Bean: No selector engine installed') // eeek\n              }\n        } else {\n          selectorEngine = e\n        }\n      }\n\n      // we attach this listener to each DOM event that we need to listen to, only once\n      // per event type per DOM element\n    , rootListener = function (event, type) {\n        if (!W3C_MODEL && type && event && event.propertyName != '_on' + type) return\n\n        var listeners = registry.get(this, type || event.type, null, false)\n          , l = listeners.length\n          , i = 0\n\n        event = new Event(event, this, true)\n        if (type) event.type = type\n\n        // iterate through all handlers registered for this type, calling them unless they have\n        // been removed by a previous handler or stopImmediatePropagation() has been called\n        for (; i < l && !event.isImmediatePropagationStopped(); i++) {\n          if (!listeners[i].removed) listeners[i].handler.call(this, event)\n        }\n      }\n\n      // add and remove listeners to DOM elements\n    , listener = W3C_MODEL\n        ? function (element, type, add) {\n            // new browsers\n            element[add ? addEvent : removeEvent](type, rootListener, false)\n          }\n        : function (element, type, add, custom) {\n            // IE8 and below, use attachEvent/detachEvent and we have to piggy-back propertychange events\n            // to simulate event bubbling etc.\n            var entry\n            if (add) {\n              registry.put(entry = new RegEntry(\n                  element\n                , custom || type\n                , function (event) { // handler\n                    rootListener.call(element, event, custom)\n                  }\n                , rootListener\n                , null\n                , null\n                , true // is root\n              ))\n              if (custom && element['_on' + custom] == null) element['_on' + custom] = 0\n              entry.target.attachEvent('on' + entry.eventType, entry.handler)\n            } else {\n              entry = registry.get(element, custom || type, rootListener, true)[0]\n              if (entry) {\n                entry.target.detachEvent('on' + entry.eventType, entry.handler)\n                registry.del(entry)\n              }\n            }\n          }\n\n    , once = function (rm, element, type, fn, originalFn) {\n        // wrap the handler in a handler that does a remove as well\n        return function () {\n          fn.apply(this, arguments)\n          rm(element, type, originalFn)\n        }\n      }\n\n    , removeListener = function (element, orgType, handler, namespaces) {\n        var type     = orgType && orgType.replace(nameRegex, '')\n          , handlers = registry.get(element, type, null, false)\n          , removed  = {}\n          , i, l\n\n        for (i = 0, l = handlers.length; i < l; i++) {\n          if ((!handler || handlers[i].original === handler) && handlers[i].inNamespaces(namespaces)) {\n            // TODO: this is problematic, we have a registry.get() and registry.del() that\n            // both do registry searches so we waste cycles doing this. Needs to be rolled into\n            // a single registry.forAll(fn) that removes while finding, but the catch is that\n            // we'll be splicing the arrays that we're iterating over. Needs extra tests to\n            // make sure we don't screw it up. @rvagg\n            registry.del(handlers[i])\n            if (!removed[handlers[i].eventType] && handlers[i][eventSupport])\n              removed[handlers[i].eventType] = { t: handlers[i].eventType, c: handlers[i].type }\n          }\n        }\n        // check each type/element for removed listeners and remove the rootListener where it's no longer needed\n        for (i in removed) {\n          if (!registry.has(element, removed[i].t, null, false)) {\n            // last listener of this type, remove the rootListener\n            listener(element, removed[i].t, false, removed[i].c)\n          }\n        }\n      }\n\n      // set up a delegate helper using the given selector, wrap the handler function\n    , delegate = function (selector, fn) {\n        //TODO: findTarget (therefore $) is called twice, once for match and once for\n        // setting e.currentTarget, fix this so it's only needed once\n        var findTarget = function (target, root) {\n              var i, array = isString(selector) ? selectorEngine(selector, root) : selector\n              for (; target && target !== root; target = target.parentNode) {\n                for (i = array.length; i--;) {\n                  if (array[i] === target) return target\n                }\n              }\n            }\n          , handler = function (e) {\n              var match = findTarget(e.target, this)\n              if (match) fn.apply(match, arguments)\n            }\n\n        // __beanDel isn't pleasant but it's a private function, not exposed outside of Bean\n        handler.__beanDel = {\n            ft       : findTarget // attach it here for customEvents to use too\n          , selector : selector\n        }\n        return handler\n      }\n\n    , fireListener = W3C_MODEL ? function (isNative, type, element) {\n        // modern browsers, do a proper dispatchEvent()\n        var evt = doc.createEvent(isNative ? 'HTMLEvents' : 'UIEvents')\n        evt[isNative ? 'initEvent' : 'initUIEvent'](type, true, true, win, 1)\n        element.dispatchEvent(evt)\n      } : function (isNative, type, element) {\n        // old browser use onpropertychange, just increment a custom property to trigger the event\n        element = targetElement(element, isNative)\n        isNative ? element.fireEvent('on' + type, doc.createEventObject()) : element['_on' + type]++\n      }\n\n      /**\n        * Public API: off(), on(), add(), (remove()), one(), fire(), clone()\n        */\n\n      /**\n        * off(element[, eventType(s)[, handler ]])\n        */\n    , off = function (element, typeSpec, fn) {\n        var isTypeStr = isString(typeSpec)\n          , k, type, namespaces, i\n\n        if (isTypeStr && typeSpec.indexOf(' ') > 0) {\n          // off(el, 't1 t2 t3', fn) or off(el, 't1 t2 t3')\n          typeSpec = str2arr(typeSpec)\n          for (i = typeSpec.length; i--;)\n            off(element, typeSpec[i], fn)\n          return element\n        }\n\n        type = isTypeStr && typeSpec.replace(nameRegex, '')\n        if (type && customEvents[type]) type = customEvents[type].base\n\n        if (!typeSpec || isTypeStr) {\n          // off(el) or off(el, t1.ns) or off(el, .ns) or off(el, .ns1.ns2.ns3)\n          if (namespaces = isTypeStr && typeSpec.replace(namespaceRegex, '')) namespaces = str2arr(namespaces, '.')\n          removeListener(element, type, fn, namespaces)\n        } else if (isFunction(typeSpec)) {\n          // off(el, fn)\n          removeListener(element, null, typeSpec)\n        } else {\n          // off(el, { t1: fn1, t2, fn2 })\n          for (k in typeSpec) {\n            if (typeSpec.hasOwnProperty(k)) off(element, k, typeSpec[k])\n          }\n        }\n\n        return element\n      }\n\n      /**\n        * on(element, eventType(s)[, selector], handler[, args ])\n        */\n    , on = function(element, events, selector, fn) {\n        var originalFn, type, types, i, args, entry, first\n\n        //TODO: the undefined check means you can't pass an 'args' argument, fix this perhaps?\n        if (selector === undefined && typeof events == 'object') {\n          //TODO: this can't handle delegated events\n          for (type in events) {\n            if (events.hasOwnProperty(type)) {\n              on.call(this, element, type, events[type])\n            }\n          }\n          return\n        }\n\n        if (!isFunction(selector)) {\n          // delegated event\n          originalFn = fn\n          args       = slice.call(arguments, 4)\n          fn         = delegate(selector, originalFn, selectorEngine)\n        } else {\n          args       = slice.call(arguments, 3)\n          fn         = originalFn = selector\n        }\n\n        types = str2arr(events)\n\n        // special case for one(), wrap in a self-removing handler\n        if (this === ONE) {\n          fn = once(off, element, events, fn, originalFn)\n        }\n\n        for (i = types.length; i--;) {\n          // add new handler to the registry and check if it's the first for this element/type\n          first = registry.put(entry = new RegEntry(\n              element\n            , types[i].replace(nameRegex, '') // event type\n            , fn\n            , originalFn\n            , str2arr(types[i].replace(namespaceRegex, ''), '.') // namespaces\n            , args\n            , false // not root\n          ))\n          if (entry[eventSupport] && first) {\n            // first event of this type on this element, add root listener\n            listener(element, entry.eventType, true, entry.customType)\n          }\n        }\n\n        return element\n      }\n\n      /**\n        * add(element[, selector], eventType(s), handler[, args ])\n        *\n        * Deprecated: kept (for now) for backward-compatibility\n        */\n    , add = function (element, events, fn, delfn) {\n        return on.apply(\n            null\n          , !isString(fn)\n              ? slice.call(arguments)\n              : [ element, fn, events, delfn ].concat(arguments.length > 3 ? slice.call(arguments, 5) : [])\n        )\n      }\n\n      /**\n        * one(element, eventType(s)[, selector], handler[, args ])\n        */\n    , one = function () {\n        return on.apply(ONE, arguments)\n      }\n\n      /**\n        * fire(element, eventType(s)[, args ])\n        *\n        * The optional 'args' argument must be an array, if no 'args' argument is provided\n        * then we can use the browser's DOM event system, otherwise we trigger handlers manually\n        */\n    , fire = function (element, type, args) {\n        var types = str2arr(type)\n          , i, j, l, names, handlers\n\n        for (i = types.length; i--;) {\n          type = types[i].replace(nameRegex, '')\n          if (names = types[i].replace(namespaceRegex, '')) names = str2arr(names, '.')\n          if (!names && !args && element[eventSupport]) {\n            fireListener(nativeEvents[type], type, element)\n          } else {\n            // non-native event, either because of a namespace, arguments or a non DOM element\n            // iterate over all listeners and manually 'fire'\n            handlers = registry.get(element, type, null, false)\n            args = [false].concat(args)\n            for (j = 0, l = handlers.length; j < l; j++) {\n              if (handlers[j].inNamespaces(names)) {\n                handlers[j].handler.apply(element, args)\n              }\n            }\n          }\n        }\n        return element\n      }\n\n      /**\n        * clone(dstElement, srcElement[, eventType ])\n        *\n        * TODO: perhaps for consistency we should allow the same flexibility in type specifiers?\n        */\n    , clone = function (element, from, type) {\n        var handlers = registry.get(from, type, null, false)\n          , l = handlers.length\n          , i = 0\n          , args, beanDel\n\n        for (; i < l; i++) {\n          if (handlers[i].original) {\n            args = [ element, handlers[i].type ]\n            if (beanDel = handlers[i].handler.__beanDel) args.push(beanDel.selector)\n            args.push(handlers[i].original)\n            on.apply(null, args)\n          }\n        }\n        return element\n      }\n\n    , bean = {\n          'on'                : on\n        , 'add'               : add\n        , 'one'               : one\n        , 'off'               : off\n        , 'remove'            : off\n        , 'clone'             : clone\n        , 'fire'              : fire\n        , 'Event'             : Event\n        , 'setSelectorEngine' : setSelectorEngine\n        , 'noConflict'        : function () {\n            context[name] = old\n            return this\n          }\n      }\n\n  // for IE, clean up on unload to avoid leaks\n  if (win.attachEvent) {\n    var cleanup = function () {\n      var i, entries = registry.entries()\n      for (i in entries) {\n        if (entries[i].type && entries[i].type !== 'unload') off(entries[i].element, entries[i].type)\n      }\n      win.detachEvent('onunload', cleanup)\n      win.CollectGarbage && win.CollectGarbage()\n    }\n    win.attachEvent('onunload', cleanup)\n  }\n\n  // initialize selector engine to internal default (qSA or throw Error)\n  setSelectorEngine()\n\n  return bean\n});\n","import _ from 'lodash'\nimport Point from './Point'\nimport Rectangle from './Rectangle'\n\nlet registry = {}\n\nclass Shape {\n  constructor (x, y, width, height, config) {\n    this.x = x\n    this.y = y\n    this.width = width\n    this.height = height\n    _.defaults(this, config, { x: 0, y: 0, width: 0, height: 0 })\n  }\n\n  /**\n   * Return the y-coord of the top side of this rectangle\n   */\n  get top () { return this.y - this.height / 2 }\n\n  /**\n   * Returns the y-coordinate of the bottom of this Rectangle.\n   */\n  get bottom () { return this.y + this.height / 2 }\n\n  /**\n   * Return the x-coord of left side of this rectangle\n   */\n  get left () { return this.x - this.width / 2 }\n\n  /**\n   * Returns the x-coordinate of the right side of this Rectangle.\n   */\n  get right () { return this.x + this.width / 2 }\n\n  get center () { return new Point(this.x, this.y) }\n\n  get bounds () { return new Rectangle(this.x, this.y, this.width, this.height) }\n\n  contains (el) { return false }\n\n  /**\n   * This will generate n ports on the shape.\n   */\n  getRegularPoints (n) {\n    return null\n  }\n\n  /**\n   * Get the intersection between boundary of this shape and the line connecting (x,y) with the refPt.\n   * @param refPt\n   * @param orthogonal\n   * @returns {*|{point, direction}}\n   */\n  getPerimeter (refPt, orthogonal = false) {\n    return this.constructor.getPerimeter(this, refPt, orthogonal)\n  }\n\n  render (view) {\n    let template = _.template(view.getTemplate(this.name, this))\n    return template(this)\n  }\n\n  static getShape (name) {\n    return registry[name]\n  }\n\n  static addShape (name, c) {\n    registry[name] = c\n  }\n\n  static removeShape (name) {\n    delete registry[name]\n  }\n}\n\nexport default Shape\n","// http://www.webtoolkit.info/javascript-base64.html\n\nvar Base64 = {\n\n  // private property\n  _keyStr: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',\n\n  // public method for encoding\n  encode: function (input) {\n    var output = ''\n    var chr1, chr2, chr3, enc1, enc2, enc3, enc4\n    var i = 0\n\n    input = Base64._utf8_encode(input)\n\n    while (i < input.length) {\n      chr1 = input.charCodeAt(i++)\n      chr2 = input.charCodeAt(i++)\n      chr3 = input.charCodeAt(i++)\n\n      enc1 = chr1 >> 2\n      enc2 = ((chr1 & 3) << 4) | (chr2 >> 4)\n      enc3 = ((chr2 & 15) << 2) | (chr3 >> 6)\n      enc4 = chr3 & 63\n\n      if (isNaN(chr2)) {\n        enc3 = enc4 = 64\n      } else if (isNaN(chr3)) {\n        enc4 = 64\n      }\n\n      output = output +\n\t\t\tthis._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) +\n\t\t\tthis._keyStr.charAt(enc3) + this._keyStr.charAt(enc4)\n    }\n\n    return output\n  },\n\n  // public method for decoding\n  decode: function (input) {\n    var output = ''\n    var chr1, chr2, chr3\n    var enc1, enc2, enc3, enc4\n    var i = 0\n\n    input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, '')\n\n    while (i < input.length) {\n      enc1 = this._keyStr.indexOf(input.charAt(i++))\n      enc2 = this._keyStr.indexOf(input.charAt(i++))\n      enc3 = this._keyStr.indexOf(input.charAt(i++))\n      enc4 = this._keyStr.indexOf(input.charAt(i++))\n\n      chr1 = (enc1 << 2) | (enc2 >> 4)\n      chr2 = ((enc2 & 15) << 4) | (enc3 >> 2)\n      chr3 = ((enc3 & 3) << 6) | enc4\n\n      output = output + String.fromCharCode(chr1)\n\n      if (enc3 != 64) {\n        output = output + String.fromCharCode(chr2)\n      }\n      if (enc4 != 64) {\n        output = output + String.fromCharCode(chr3)\n      }\n    }\n\n    output = Base64._utf8_decode(output)\n\n    return output\n  },\n\n  // private method for UTF-8 encoding\n  _utf8_encode: function (string) {\n    string = string.replace(/\\r\\n/g, '\\n')\n    var utftext = ''\n\n    for (var n = 0; n < string.length; n++) {\n      var c = string.charCodeAt(n)\n\n      if (c < 128) {\n        utftext += String.fromCharCode(c)\n      } else if ((c > 127) && (c < 2048)) {\n        utftext += String.fromCharCode((c >> 6) | 192)\n        utftext += String.fromCharCode((c & 63) | 128)\n      } else {\n        utftext += String.fromCharCode((c >> 12) | 224)\n        utftext += String.fromCharCode(((c >> 6) & 63) | 128)\n        utftext += String.fromCharCode((c & 63) | 128)\n      }\n    }\n\n    return utftext\n  },\n\n  // private method for UTF-8 decoding\n  _utf8_decode: function (utftext) {\n    var string = ''\n    var i = 0\n    var c = c1 = c2 = 0\n\n    while (i < utftext.length) {\n      c = utftext.charCodeAt(i)\n\n      if (c < 128) {\n        string += String.fromCharCode(c)\n        i++\n      } else if ((c > 191) && (c < 224)) {\n        c2 = utftext.charCodeAt(i + 1)\n        string += String.fromCharCode(((c & 31) << 6) | (c2 & 63))\n        i += 2\n      } else {\n        c2 = utftext.charCodeAt(i + 1)\n        c3 = utftext.charCodeAt(i + 2)\n        string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63))\n        i += 3\n      }\n    }\n\n    return string\n  }\n\n}\n\nexport default Base64\n","/**\n * Created by tong on 6/7/2016.\n */\n\nlet caches = {}\n\nlet Cache = {\n  get: function (key, namespace) {\n    return this.getCache(namespace)[key]\n  },\n\n  set: function (key, value, namespace) {\n    this.getCache(namespace)[key] = value\n  },\n\n  contains: function (key, namespace) {\n    return key in this.getCache(namespace)\n  },\n\n  remove: function (key, namespace) {\n    delete this.getCache(namespace)[key]\n  },\n\n  clear: function (namespace) {\n    if (!namespace) { caches = {} } else if (caches[namespace]) { caches[namespace] = {} }\n  },\n\n  getCache: function (namespace = 'default') {\n    if (!caches[namespace]) { caches[namespace] = {} }\n    return caches[namespace]\n  }\n}\n\nexport default Cache\n","import _ from 'lodash'\n\nconst inBrowser = () => {\n  return typeof window !== 'undefined' && window.navigator && typeof navigator !== 'undefined'\n}\n\n/**\n * dom Utility functions\n */\nexport default {\n  isIE: (function () {\n    if (!inBrowser()) return false\n    var sAgent = window.navigator.userAgent\n    var Idx = sAgent.indexOf('MSIE')\n\n    if (Idx > 0) {\n      // If IE, return version number.\n      return parseInt(sAgent.substring(Idx + 5, sAgent.indexOf('.', Idx)))\n    } else if (navigator.userAgent.match(/Trident\\/7\\./)) { // If IE 11 then look for Updated user agent string.\n      return 11\n    } else if (navigator.userAgent.match(/Edge\\//)) {\n      return 'Edge'\n    } else {\n      return false\n    }\n  })(),\n\n  isFireFox: (function () {\n    // InstallTrigger: Firefox's API to install add-ons\n    return typeof InstallTrigger !== 'undefined'\n  })(),\n\n  isChrome: (function () {\n    if (!inBrowser() || navigator.userAgent.indexOf('Edge') >= 0) return false\n    var raw = navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./)\n    return raw ? parseInt(raw[2], 10) : false\n  })(),\n\n  isMac: (function () {\n    if (!inBrowser()) return false\n    return navigator.platform.toUpperCase().indexOf('MAC') >= 0\n  })(),\n\n  isWindows: (function () {\n    if (!inBrowser()) return false\n    return navigator.appVersion.indexOf('Windows') >= 0\n  })(),\n\n  isLinux: (function () {\n    if (!inBrowser()) return false\n    return navigator.appVersion.indexOf('Linux') >= 0\n  })(),\n\n  createElement: function (tag, attribs, styles, html) {\n    let el = document.createElement(tag)\n    this.setElement(el, attribs, styles)\n    if (html) { el.innerHTML = html }\n    return el\n  },\n\n  createElementByString: function (str) {\n    let temp = this.createElement('div', null, null, str)\n    return temp.childNodes\n  },\n\n  setElement: function (el, attribs, styles) {\n    if (attribs) {\n      _.forEach(attribs, function (value, key) {\n        el.setAttribute(key, value)\n      })\n    }\n    if (styles) {\n      _.forEach(styles, function (value, key) {\n        el.style[key] = value\n      })\n    }\n  },\n\n  testElement: function (node, method) {\n    return node && node.nodeType === 1 && (!method || method(node))\n  },\n\n  getAncestorBy: function (node, method) {\n    while ((node = node.parentNode) !== null) {\n      if (this.testElement(node, method)) { return node }\n    }\n\n    return null\n  },\n\n  /**\n   * Get the position of element relative to the context.\n   * @param el the element\n   * @param context\n   * @returns {*[]}\n   */\n  getPosition (el, context) {\n    if (!context) context = document.body\n    let elRect = el.getBoundingClientRect()\n    let contextRect = context.getBoundingClientRect()\n\n    return [elRect.left - contextRect.left, elRect.top - contextRect.top]\n  },\n\n  getCenterPosition (el, context) {\n    if (!context) context = document.body\n    let elRect = el.getBoundingClientRect()\n    let contextRect = context.getBoundingClientRect()\n    let w = elRect.right - elRect.left\n    let h = elRect.bottom - elRect.top\n\n    return [elRect.left - contextRect.left + w / 2, elRect.top - contextRect.top + h / 2]\n  },\n\n  move: function (el, x, y) {\n    if (x) el.style.left = x + 'px'\n    if (y) el.style.top = y + 'px'\n  },\n\n  getSize: function (el) {\n    var w = parseInt(el.style.offsetWidth, 10)\n    var h = parseInt(el.style.offsetHeight, 10)\n    return [w, h]\n  },\n\n  resize: function (el, w, h) {\n    if (w) el.style.width = w + 'px'\n    if (h) el.style.height = h + 'px'\n  },\n\n  preloadImages: function (array) {\n    if (!this.preloadImages.list) this.preloadImages.list = []\n    if (!this.preloadImages.loaded) this.preloadImages.loaded = {}\n\n    var list = this.preloadImages.list\n    var img; var that = this\n    for (var i = 0; i < array.length; i++) {\n      img = new Image()\n      img.onload = function () {\n        var index = list.indexOf(this)\n        if (index !== -1) {\n          that.preloadImages.loaded[this.name] = { width: this.width, height: this.height }\n          // remove image from the array once it's loaded\n          // for memory consumption reasons\n          list.splice(index, 1)\n        }\n      }\n      list.push(img)\n      img.src = array[i]\n      img.name = array[i]\n    }\n  },\n\n  /**\n   * Get's the image's information given the url. Must be preloaded by calling the preloadImage function.\n   * @param src\n   */\n  getImageInfo: function (src) {\n    if (this.preloadImages.loaded) {\n      return this.preloadImages.loaded[src]\n    }\n    return null\n  },\n\n  downloadFile: function (name, data) {\n    if (!data) return\n    let mime = data.match(/^data:([^;,]*)/)[1]\n    if (name.indexOf('.') < 0) {\n      if (!mime) mime = 'text/plain'\n      if (mime === 'text/plain') { name = name + '.txt' } else {\n        let type = mime.split('/')[1]\n        if (type.indexOf('+') > 0) type = type.split('+')[0]\n        name = name + '.' + type\n      }\n    }\n    if (this.isIE) {\n      let encoded = data.indexOf(';base64') >= 0\n      if (encoded) { data = atob(data.replace('data:' + mime + ';base64,', '')) } else { data = decodeURI(data.replace('data:' + mime + ',', '')) }\n      data = this.GetBlob(data, mime)\n      navigator.msSaveBlob(data, name)\n    } else {\n      let link = this.createElement('a', { href: data, download: name }, { display: 'none' })\n      document.body.appendChild(link)\n      link.click()\n      link.parentNode.removeChild(link)\n    }\n  },\n\n  /**\n   * Convert b54 to blob. IE only\n   */\n  GetBlob: function (data, contentType, sliceSize) {\n    contentType = contentType || ''\n    sliceSize = sliceSize || 512\n\n    var byteArrays = []\n\n    for (var offset = 0; offset < data.length; offset += sliceSize) {\n      var slice = data.slice(offset, offset + sliceSize)\n\n      var byteNumbers = new Array(slice.length)\n      for (var i = 0; i < slice.length; i++) {\n        byteNumbers[i] = slice.charCodeAt(i)\n      }\n      var byteArray = new Uint8Array(byteNumbers)\n      byteArrays.push(byteArray)\n    }\n    return new Blob(byteArrays, { type: contentType })\n  },\n\n  openImage: function (name, image) {\n    if (!inBrowser()) return\n    var myWindow = window.open('', '_blank', 'toolbar=yes, scrollbars=yes, resizable=yes, width=500, height=500')\n    var myDocument = myWindow.document\n    var img = myDocument.createElement('img')\n    this.setElement(img, { src: image, name: name })\n    myDocument.body.appendChild(img)\n  },\n\n  /**\n   * Check whether the key event is from input, textarea or select.\n   * @param e  input event\n   */\n  eventFromInput: function (e) {\n    var tagName = e.target.tagName\n    return (tagName === 'INPUT' || tagName === 'TEXTAREA' || tagName === 'SELECT')\n  },\n\n  /**\n   * Wait for the element with the specified id to come into existence. Returns a promise\n   * @param {*} id The id of the element to wait for\n   */\n  waitForElement (id) {\n    return new Promise(resolve => {\n      const el = document.getElementById(id)\n      if (!el) {\n        const interval = setInterval(() => {\n          const el = document.getElementById(id)\n          if (el) {\n            clearInterval(interval)\n            return resolve(el)\n          }\n        }, 200)\n      } else {\n        return resolve(el)\n      }\n    })\n  }\n}\n","import _ from 'lodash'\n\n/**\n * A string buffer for fast string manipulation\n */\nexport default class StringBuffer {\n  constructor (str) {\n    this.buffer = []\n    if (str) { this.buffer.push(str) }\n  }\n\n  append (stuff) {\n    if (_.isString(stuff)) { this.buffer.push(stuff) } else if (_.isArray(stuff)) { this.buffer = this.buffer.concat(stuff) } else { this.buffer.push('' + stuff) }\n    return this\n  }\n\n  prepend (stuff) {\n    if (_.isString(stuff)) { this.buffer.splice(0, 0, stuff) } else if (_.isArray(stuff)) { this.buffer = stuff.concat(this.buffer) } else { this.buffer.splice(0, 0, '' + stuff) }\n    return this\n  }\n\n  clear () {\n    this.buffer = []\n  }\n\n  removeLast () {\n    this.buffer.pop()\n    return this\n  }\n\n  toString (sep) {\n    if (!sep) sep = ''\n    return this.buffer.join(sep)\n  }\n}\n","import Point from './Point'\n\nexport default class Line {\n  constructor (start, end) {\n    this.start = start\n    this.end = end\n  }\n\n  /**\n   * Calculate the length of this line\n   */\n  length () {\n    return this.start.distance(this.end)\n  }\n\n  /**\n   * Calculate the distance of this line to the point.\n   */\n  distance (pt) {\n    const x = this.start.distance(pt)\n    if (x === 0) return 0\n\n    const l = this.length()\n    const cosa = new Point((this.end.x - this.start.x) / l, (this.end.y - this.start.y) / l).dotProduct(\n      new Point(pt.x / x, pt.y / x))\n\n    return x * Math.sqrt(1 - cosa * cosa)\n  }\n\n  /**\n   * Function: intersection\n   *\n   * Returns the intersection of two lines as an <mxPoint>.\n   *\n   * Parameters:\n   *\n   * x0 - X-coordinate of the first line's startpoint.\n   * y0 - X-coordinate of the first line's startpoint.\n   * x1 - X-coordinate of the first line's endpoint.\n   * y1 - Y-coordinate of the first line's endpoint.\n   * x2 - X-coordinate of the second line's startpoint.\n   * y2 - Y-coordinate of the second line's startpoint.\n   * x3 - X-coordinate of the second line's endpoint.\n   * y3 - Y-coordinate of the second line's endpoint.\n   */\n  static intersection (x0, y0, x1, y1, x2, y2, x3, y3) {\n    const denom = ((y3 - y2) * (x1 - x0)) - ((x3 - x2) * (y1 - y0))\n    const numeA = ((x3 - x2) * (y0 - y2)) - ((y3 - y2) * (x0 - x2))\n    const numeB = ((x1 - x0) * (y0 - y2)) - ((y1 - y0) * (x0 - x2))\n\n    const ua = numeA / denom\n    const ub = numeB / denom\n\n    if (ua >= 0.0 && ua <= 1.0 && ub >= 0.0 && ub <= 1.0) {\n      // Get the intersection point\n      var intersectionX = x0 + ua * (x1 - x0)\n      var intersectionY = y0 + ua * (y1 - y0)\n\n      return new Point(intersectionX, intersectionY)\n    }\n\n    // No intersection\n    return null\n  }\n\n  toString () {\n    return 'Line:{start=' + this.start + ';end=' + this.end + '}'\n  }\n}\n","import Shape from './Shape'\nimport Point from './Point'\nimport Rectangle from './Rectangle'\n\nexport default class Ellipse extends Shape {\n  toString () {\n    return 'Ellipse:{x=' + this.x + ';y=' + this.y + ';width=' + this.width + ';height=' + this.height + '}'\n  }\n\n  static getPerimeter (rect, pt, orthogonal = false) {\n    let a = rect.width / 2\n    let b = rect.height / 2\n    let cx = rect.x\n    let cy = rect.y\n    let px = pt.x\n    let py = pt.y\n\n    // Calculates straight line equation through\n    // point and ellipse center y = d * x + h\n    let dx = parseInt(px - cx)\n    let dy = parseInt(py - cy)\n\n    if (dx === 0 && dy !== 0) {\n      return new Point(cx, cy + b * dy / Math.abs(dy))\n    } else if (dx === 0 && dy === 0) {\n      return new Point(px, py)\n    }\n\n    // Calculates intersection\n    let d = dy / dx\n    let h = cy - d * cx\n    let e = a * a * d * d + b * b\n    let f = -2 * cx * e\n    let g = a * a * d * d * cx * cx + b * b * cx * cx - a * a * b * b\n    let det = Math.sqrt(f * f - 4 * e * g)\n\n    // Two solutions (perimeter points)\n    let xout1 = (-f + det) / (2 * e)\n    let xout2 = (-f - det) / (2 * e)\n    let yout1 = d * xout1 + h\n    let yout2 = d * xout2 + h\n    let dist1 = Math.sqrt(Math.pow((xout1 - px), 2) + Math.pow((yout1 - py), 2))\n    let dist2 = Math.sqrt(Math.pow((xout2 - px), 2) + Math.pow((yout2 - py), 2))\n\n    // Correct solution\n    let xout = 0\n    let yout = 0\n\n    if (dist1 < dist2) {\n      xout = xout1\n      yout = yout1\n    } else {\n      xout = xout2\n      yout = yout2\n    }\n\n    let p = new Point(xout, yout)\n    let dir = Rectangle.getDirection(rect, p, orthogonal)\n    if (orthogonal) {\n      if (dir.x === -1) {\n        return { point: new Point(cx - a, cy), direction: dir }\n      }\n      if (dir.x === 1) {\n        return { point: new Point(cx + a, cy), direction: dir }\n      }\n      if (dir.y === -1) {\n        return { point: new Point(cx, cy - b), direction: dir }\n      }\n      if (dir.y === 1) {\n        return { point: new Point(cx, cy + b), direction: dir }\n      }\n    }\n    return { point: p, direction: dir }\n  }\n}\n","import Shape from './Shape'\nimport Point from './Point'\nimport Line from './Line'\n\nexport default class Rhombus extends Shape {\n  toString () {\n    return 'Rhombus:{x=' + this.x + ';y=' + this.y + ';width=' + this.width + ';height=' + this.height + '}'\n  }\n\n  static getPerimeter (rect, pt, orthogonal = false) {\n    let w = rect.width\n    let h = rect.height\n    let cx = rect.x\n    let cy = rect.y\n    let x = cx - w / 2\n    let y = cy - h / 2\n\n    let px = pt.x\n    let py = pt.y\n\n    // Special case for intersecting the diamond's corners\n    if (cx === px) {\n      if (cy > py) {\n        return { point: new Point(cx, y), direction: Point.S }\n        // top\n      } else {\n        return { point: new Point(cx, y + h), direction: Point.N }\n        // bottom\n      }\n    } else if (cy === py) {\n      if (cx > px) {\n        return { point: new Point(x, cy), direction: Point.E }\n        // left\n      } else {\n        return { point: new Point(x + w, cy), direction: Point.W }\n        // right\n      }\n    }\n\n    let tx = cx\n    let ty = cy\n\n    if (orthogonal) {\n      if (px >= x && px <= x + w) {\n        tx = px\n      } else if (py >= y && py <= y + h) {\n        ty = py\n      }\n    }\n\n    let p, dir\n    // TODO direction calculation is not quite right.\n    // In which quadrant will the intersection be?\n    // set the slope and offset of the border line accordingly\n    if (px < cx) {\n      if (py < cy) {\n        p = Line.intersection(px, py, tx, ty, cx, y, x, cy)\n        dir = Point.S\n      } else {\n        p = Line.intersection(px, py, tx, ty, cx, y + h, x, cy)\n        dir = Point.N\n      }\n    } else if (py < cy) {\n      p = Line.intersection(px, py, tx, ty, cx, y, x + w, cy)\n      dir = Point.E\n    } else {\n      p = Line.intersection(px, py, tx, ty, cx, y + h, x + w, cy)\n      dir = Point.W\n    }\n    return { point: p, direction: dir }\n  }\n}\n","import _ from 'lodash'\nimport Point from './Point'\nimport Utils from '../util/Utils'\n\nlet defaultConfig = {\n  type: 'direct',\n  showGauge: true,\n  orthogonal: false\n}\n\nlet defaultGeometry = {\n  width: 0,\n  height: 0,\n  anchorX: 0,\n  anchorY: 0,\n  offsetX: 0,\n  offsetY: 0\n}\n\nlet linkTypes = {}\n\nclass Link {\n  constructor (terminalVisual, shapeConfig = {}, startMarker = null, endMarker = null) {\n    this.start = terminalVisual[0].point\n    this.end = terminalVisual[1].point\n    this.startNormal = terminalVisual[0].direction\n    this.endNormal = terminalVisual[1].direction\n    this.startMarker = startMarker\n    this.endMarker = endMarker\n    Object.assign(this, shapeConfig)\n  }\n\n  render (view) {\n    return view.renderLink(this)\n  }\n\n  get points () { return null }\n  get controlPts () { return null }\n  get length () {\n    let points = this.points\n    let i\n    let l = 0\n    for (i = 0; i < points.length - 1; i++) {\n      l += points[i].distance(points[i + 1])\n    }\n    return l\n  }\n\n  /**\n   * Calculate the position where to put decorators or label..\n   *\n   * @param geometry: defines how far along the edge should the point be placed.\n   * @return *[] the relative position.\n   */\n  getRelativePosition (geometry) {\n    if (_.isNumber(geometry)) {\n      geometry = { x: geometry }\n    }\n    geometry = _.defaults(geometry, defaultGeometry)\n    let p = geometry.x\n    let l = this.length\n    if (Math.abs(p) <= 1) p *= l\n    if (p < 0) p = l + p\n    if (p > l) p = l\n\n    let points = this.points\n    let d\n    let point\n    let dir\n    for (let i = 0; i < points.length - 1; i++) {\n      d = points[i].distance(points[i + 1])\n      if (p <= d) {\n        // we've located the line segment.\n        point = points[i].clone()\n        dir = point.getDirection(points[i + 1])\n        point.translate(dir.getScaled(p))\n        break\n      }\n      p -= d\n    }\n\n    // return the last point.\n    if (!point) {\n      point = points[points.length - 1]\n    }\n    return Utils.offsetPosition([point.x, point.y], geometry)\n  }\n\n  toString () {\n    return 'Link'\n  }\n\n  static getLink (terminalVisual, shapeConfig = {}, startMarker = null, endMarker = null) {\n    shapeConfig = _.defaultsDeep(shapeConfig, defaultConfig)\n    let LinkClass = linkTypes[shapeConfig.type]\n    if (LinkClass) {\n      return new LinkClass(terminalVisual, shapeConfig, startMarker, endMarker)\n    }\n    console.log('link type not supported: ' + shapeConfig.type)\n    return null\n  }\n}\n\nclass DirectLink extends Link {\n  get points () {\n    return [this.start, this.end]\n  }\n}\n\nclass BezierLink extends Link {\n  get points () {\n    return [this.start, this.end]\n  }\n\n  get controlPts () {\n    let s = this.points[0]; let e = this.points[1]\n    let pts = []\n    pts[0] = null\n    pts[1] = []\n    if (this.startNormal.x === 0) {\n      pts[1][0] = new Point(s.x, (s.y + e.y) / 2)\n    } else {\n      pts[1][0] = new Point((s.x + e.x) / 2, s.y)\n    }\n    if (this.endNormal.x === 0) {\n      pts[1][1] = new Point(e.x, (s.y + e.y) / 2)\n    } else {\n      pts[1][1] = new Point((s.x + e.x) / 2, e.y)\n    }\n    return pts\n  }\n\n  getRelativePosition (geometry) {\n    if (_.isNumber(geometry)) {\n      geometry = { x: geometry }\n    }\n    geometry = _.defaults(geometry, defaultGeometry)\n    let p = geometry.x\n    let l = this.length\n    if (Math.abs(p) > 1) p /= l\n    if (p < 0) p++\n    if (p > 1) p--\n\n    let pts = this.points\n    let ctrlpts = this.controlPts\n    let p1 = pts[0]\n    let p2 = ctrlpts[1][0]\n    let p3 = ctrlpts[1][1]\n    let p4 = pts[1]\n\n    let point = [(1 - p) * (1 - p) * (1 - p) * p1.x + 3 * p * (1 - p) * (1 - p) * p2.x + 3 * p * p * (1 - p) * p3.x + p * p * p * p4.x, (1 - p) * (1 - p) * (1 - p) * p1.y + 3 * p * (1 - p) * (1 - p) * p2.y + 3 * p * p * (1 - p) * p3.y + p * p * p * p4.y]\n    return Utils.offsetPosition([point.x, point.y], geometry)\n  }\n}\n\nclass EntityRelations extends Link {\n  get points () {\n    let source = Port.getBounds(edge, true)\n    let target = Port.getBounds(edge, false)\n    let isSourceLeft = target.right() < source.x\n    let isTargetLeft = source.right() < target.x\n    let result = []\n\n    let x0 = (isSourceLeft) ? source.x : source.x + source.width\n    let y0 = source.getCenterY()\n    result.push(new Point(x0, y0))\n\n    let xe = (isTargetLeft) ? target.x : target.x + target.width\n    let ye = target.getCenterY()\n\n    let seg = this.segment\n\n    let dx = (isSourceLeft) ? -seg : seg\n    let dep = new Point(x0 + dx, y0)\n\n    dx = (isTargetLeft) ? -seg : seg\n    let arr = new Point(xe + dx, ye)\n\n    // Adds intermediate points if both go out on same side\n    if (isSourceLeft === isTargetLeft) {\n      let x = (isSourceLeft) ? Math.min(x0, xe) - seg : Math.max(x0, xe) + seg\n\n      result.push(new Point(x, y0))\n      result.push(new Point(x, ye))\n    } else if ((dep.x < arr.x) === isSourceLeft) {\n      let midY = y0 + (ye - y0) / 2\n\n      result.push(dep)\n      result.push(new Point(dep.x, midY))\n      result.push(new Point(arr.x, midY))\n      result.push(arr)\n    } else {\n      result.push(dep)\n      result.push(arr)\n    }\n\n    result.push(new Point(xe, ye))\n    return result\n  }\n}\n\nclass Manhattan extends Link {\n  constructor (terminalVisual, shapeConfig, startMarker, endMarker) {\n    shapeConfig = _.defaults(shapeConfig, {\n      MIN_BUFFER: 10,\n      autoRoute: false,\n      randomNoise: 0,\n      step: 1,\n      maxChannelWidth: 100\n    })\n    super(terminalVisual, shapeConfig, startMarker, endMarker)\n  }\n\n  get points () {\n    let pos = Manhattan.route(this.start, this.end, this.startNormal, this.endNormal, this.MIN_BUFFER)\n    if (this.autoRoute) {\n      this._mergeSegments(pos)\n      let boxes = []\n      let node\n      let startBox\n      let endBox\n      let container = edge.source.getCommonAncestor(edge.target)\n      let childNodes = container.getDescendants()\n      let index = 0\n      for (let i = 0; i < childNodes.length; i++) {\n        node = childNodes[i]\n        // Do not include source or target ancestors in routing.\n        if (node.excludeFromRouting(edge) || node.isAncestor(edge.source) || node.isAncestor(edge.target)) continue\n        if (node === edge.source) {\n          startBox = index\n        }\n        if (node === edge.target) {\n          endBox = index\n        }\n        boxes.push(node.getBounds(document))\n        index++\n      }\n      if (boxes.length > 1) {\n        this.autoRoute(pos, container.getBounds(document), boxes, startBox, endBox)\n      }\n    }\n\n    Manhattan._mergeSegments(pos)\n    if (this.randomNoise && pos.length > 3) {\n      for (let i = 1; i < pos.length - 2; i++) {\n        let range = this.randomNoise / this.step\n        let randomNumber = Math.floor(Math.random() * range * 2 - range + 1) * this.step\n\n        let noise\n        if (this.randomNoise && pos.length == 4) {\n          if (this.startNormal.x != 0 && this.startNormal.x != this.endNormal.x) {\n            if (this.randomNoise <= Math.abs(pos[1].x - pos[0].x - this.startNormal.x * this.MIN_BUFFER)) {\n              noise = this.randomNoise\n            } else {\n              noise = Math.abs(pos[1].x - pos[0].x - this.startNormal.x * this.MIN_BUFFER)\n            }\n          } else if (this.startNormal.y != 0 && this.startNormal.y != this.endNormal.y) {\n            if (this.randomNoise <= Math.abs(pos[1].y - pos[0].y - this.startNormal.y * this.MIN_BUFFER)) {\n              noise = this.randomNoise\n            } else {\n              noise = Math.abs(pos[1].y - pos[0].y - this.startNormal.y * this.MIN_BUFFER)\n            }\n          } else {\n            noise = this.randomNoise\n          }\n          let range = noise / this.step\n          let randomNumber\n          if (this.startNormal.x !== this.endNormal.x || this.startNormal.y !== this.endNormal.y) {\n            randomNumber = Math.floor(Math.random() * range * 2 - range + 1) * this.step\n          } else {\n            randomNumber = Math.sign(this.startNormal.x !== 0 ? this.startNormal.x : this.startNormal.y) * Math.floor(Math.random() * range + 1) * this.step\n          }\n          this._moveSegment(pos, 1, randomNumber, 1, 1)\n        }\n        if (this.randomNoise && pos.length > 4) {\n          for (let i = 1; i < pos.length - 2; i++) {\n            range = this.randomNoise / this.step\n            if (i == 1) {\n              randomNumber = Math.sign(this.startNormal.x !== 0 ? this.startNormal.x : this.startNormal.y) * Math.floor(Math.random() * range + 1) * this.step\n            } else if (i == pos.length - 3) {\n              randomNumber = Math.sign(this.endNormal.x !== 0 ? this.endNormal.x : this.endNormal.y) * Math.floor(Math.random() * range + 1) * this.step\n            } else {\n              randomNumber = Math.floor(Math.random() * range * 2 - range + 1) * this.step\n            }\n            this._moveSegment(pos, i, randomNumber, 1, 1)\n          }\n        }\n      }\n    }\n    return pos\n  }\n\n  // New function for finding route\n  static route (start, end, startNormal, endNormal, buffer) {\n    let startBuffer = new Point(start.x + startNormal.x * buffer, start.y + startNormal.y * buffer)\n    let endBuffer = new Point(end.x + endNormal.x * buffer, end.y + endNormal.y * buffer)\n    let startBufferNormal, endBufferNormal\n    let pts\n    if (startNormal.x !== 0) {\n      if ((endBuffer.x - startBuffer.x) / startNormal.x > 0) {\n        startBufferNormal = startNormal\n      } else {\n        startBufferNormal = new Point(0, (endBuffer.y >= startBuffer.y) ? 1 : -1)\n      }\n    } else {\n      if ((endBuffer.y - startBuffer.y) / startNormal.y > 0) {\n        startBufferNormal = startNormal\n      } else {\n        startBufferNormal = new Point((endBuffer.x >= startBuffer.x) ? 1 : -1, 0)\n      }\n    }\n    if (endNormal.x !== 0) {\n      if ((startBuffer.x - endBuffer.x) / endNormal.x > 0) {\n        endBufferNormal = endNormal\n      } else {\n        endBufferNormal = new Point(0, (startBuffer.y >= endBuffer.y) ? 1 : -1)\n      }\n    } else {\n      if ((startBuffer.y - endBuffer.y) / endNormal.y > 0) {\n        endBufferNormal = endNormal\n      } else {\n        endBufferNormal = new Point((startBuffer.x >= endBuffer.x) ? 1 : -1, 0)\n      }\n    }\n\n    if (startBufferNormal.dotProduct(endBufferNormal) === 0) {\n      let middle = (startBufferNormal.x === 0) ? new Point(startBuffer.x, endBuffer.y) : new Point(endBuffer.x, startBuffer.y)\n      pts = [start, startBuffer, middle, endBuffer, end]\n    } else if (startBufferNormal.dotProduct(endBufferNormal) < 0) {\n      if (startBufferNormal.x === 0) {\n        pts = [start, startBuffer, new Point(startBuffer.x, (start.y + end.y) / 2), new Point(endBuffer.x, (start.y + end.y) / 2), endBuffer, end]\n      } else {\n        pts = [start, startBuffer, new Point((start.x + end.x) / 2, startBuffer.y), new Point((start.x + end.x) / 2, endBuffer.y), endBuffer, end]\n      }\n    } else {\n      pts = [start, startBuffer, new Point(startBuffer.x + startBufferNormal.x * buffer, startBuffer.y + startBufferNormal.y * buffer), new Point(endBuffer.x + endBufferNormal.x * buffer, endBuffer.y + endBufferNormal.y * buffer), endBuffer, end]\n    }\n\n    let prunePts = []\n    prunePts[0] = pts[0]\n    for (let i = 1; i < pts.length - 1; i++) {\n      if ((pts[i].x === pts[i - 1].x && pts[i].x === pts[i + 1].x) || (pts[i].y === pts[i - 1].y && pts[i].y === pts[i + 1].y)) {\n        continue\n      }\n      prunePts.push(pts[i])\n    }\n    prunePts.push(pts[pts.length - 1])\n    return prunePts\n  }\n\n  /**\n  * Automatically route the connection to avoid intersections with other vertices.\n  */\n  autoRoute (pts, container, boxes, startBox, endBox) {\n    let side, side2, d, box, intersect, j\n    let channel, channel2, pt, dir\n\n    let startPadding = 0; let endPadding\n    // first get the start and end channel\n    box = boxes[endBox]\n    pt = pts[pts.length - 2]\n    if (pt.y < box.y) {\n      side = 1\n    } else if (pt.y > box.y + box.height) {\n      side = 3\n    } else if (pt.x < box.x) {\n      side = 0\n    } else {\n      side = 2\n    }\n    channel = _getChannel(container, endBox, boxes, side)\n    endPadding = channel.horizontal ? (channel.right - channel.left) / 2 : (channel.bottom - channel.top) / 2\n\n    for (let i = 0; i < pts.length - 1; i++) {\n      if (pts[i + 1].x === pts[i].x && pts[i + 1].y === pts[i].y) continue\n      intersect = _getFirstIntersection(pts, i, boxes, startBox, endBox)\n      if (!intersect) continue\n      j = intersect[0]\n      side = intersect[1]\n      box = boxes[j]\n      channel = _getChannel(container, j, boxes, side)\n      switch (side) {\n        case 0:\n        case 2:\n          pt = new Point((channel.right + channel.left) / 2, pts[i].y)\n          dir = _getRouteTendency(pts, i, pt, box, side)\n          side2 = dir < 0 ? 1 : 3\n          channel2 = _getChannel(container, j, boxes, side2)\n          // if the previous point is in the channel2, use that point instead of center of the channel.\n          if (i > 1 && (pts[i - 2].y === pts[i - 1].y) && (pts[i - 1].y > channel2.top && pts[i - 1].y < channel2.bottom)) {\n            d = pts[i - 1].y - pt.y\n          } else if (i < pts.length - 3 && (pts[i + 2].y === pts[i + 3].y) && (pts[i + 2].y > channel2.top && pts[i + 2].y < channel2.bottom)) {\n            d = pts[i + 2].y - pt.y\n          } else {\n            d = (channel2.bottom + channel2.top) / 2 - pt.y\n          }\n          // check if we need this pt.\n          if ((side === 0 && pt.x <= pts[i].x) || (side === 2 && pt.x >= pts[i].x)) {\n            pt = null\n          } else if (i > 0) {\n            // see if we can push the line out to where we started.\n            if (!_hasIntersection([new Point(pts[i].x, pts[i].y), new Point(pts[i].x, pts[i].y + d), new Point(pt.x, pt.y + d)], boxes)) {\n              pt = null\n            }\n          }\n          break\n        case 1:\n        case 3:\n          pt = new Point(pts[i].x, (channel.bottom + channel.top) / 2)\n          dir = _getRouteTendency(pts, i, pt, box, side)\n          side2 = dir < 0 ? 0 : 2\n          channel2 = _getChannel(container, j, boxes, side2)\n          // if the previous point is in the channel2, use that point instead of center of the channel.\n          if (i > 1 && (pts[i - 2].x === pts[i - 1].x) && (pts[i - 1].x > channel2.left && pts[i - 1].x < channel2.right)) {\n            d = pts[i - 1].x - pt.x\n          } else if (i < pts.length - 3 && (pts[i + 2].x === pts[i + 3].x) && (pts[i + 2].x > channel2.left && pts[i + 2].x < channel2.right)) {\n            d = pts[i + 2].x - pt.x\n          } else {\n            d = (channel2.right + channel2.left) / 2 - pt.x\n          }\n          // check if we need this pt.\n          if ((side === 1 && pt.y <= pts[i].y) || (side === 3 && pt.y >= pts[i].y)) {\n            pt = null\n          } else if (i > 0) {\n            // see if we can push the line out to where we started.\n            if (!_hasIntersection([new Point(pts[i].x, pts[i].y), new Point(pts[i].x + d, pts[i].y), new Point(pt.x + d, pt.y)], boxes)) {\n              pt = null\n            }\n          }\n          break\n        case 4:\n          continue\n      }\n      // max points.\n      if (i > 20) return\n      if (pt && (pt.x !== pts[i].x || pt.y !== pts[i].y)) {\n        pts.splice(i + 1, 0, pt)\n        _moveSegment(pts, i + 1, d, startPadding, endPadding)\n        i++\n      } else {\n        _moveSegment(pts, i, d, startPadding, endPadding)\n      }\n    }\n  }\n\n  static _hasIntersection (pts, boxes) {\n    for (let i = 0; i < pts.length - 1; i++) {\n      for (let j = 0; j < boxes.length; j++) {\n        if (boxes[j].detectIntersection(pts[i], pts[i + 1]) >= 0) {\n          return true\n        }\n      }\n    }\n    return false\n  }\n\n  static _getFirstIntersection (pts, i, boxes, startBox, endBox) {\n    let box\n    let side\n    let savedIndex = null\n    let savedSide = null\n    for (let j = 0; j < boxes.length; j++) {\n      if ((i === 0 && j === startBox) || (i === pts.length - 2 && j === endBox)) {\n        continue\n      }\n      box = boxes[j]\n      side = box.detectIntersection(pts[i], pts[i + 1])\n      if (side >= 0) {\n        if (savedIndex == null) {\n          savedIndex = j\n          savedSide = side\n        } else {\n          if (boxes[savedIndex].distance(pts[i]) > box.distance(pts[i])) {\n            savedIndex = j\n            savedSide = side\n          }\n        }\n      }\n    }\n    if (savedIndex != null) {\n      return [savedIndex, savedSide]\n    }\n    return null\n  }\n\n  _getRouteTendency (pts, i, breakPt, box, side) {\n    let dir\n    let p\n    switch (side) {\n      case 0:\n      case 2:\n        p = 'y'\n        break\n      case 1:\n      case 3:\n        p = 'x'\n        break\n    }\n    // first try the breakpt.\n    dir = _getRouteDirection(breakPt, pts[pts.length - 1])[p]\n    if (dir === 0) {\n      dir = -_getRouteDirection(pts[0], pts[pts.length - 1])[p]\n      if (dir === 0) {\n        if (breakPt[p] < box.getCenter()[p]) {\n          dir = -1\n        } else {\n          dir = 1\n        }\n      }\n    }\n    return dir\n  }\n\n  static _getRouteDirection (pt1, pt2) {\n    if (pt1.x === pt2.x) {\n      if (pt1.y < pt2.y) return Point.S\n      return Point.N\n    } else if (pt1.y === pt2.y) {\n      if (pt1.x < pt2.x) return Point.E\n      return Point.W\n    } else if (pt1.x < pt2.x) {\n      if (pt1.y < pt2.y) return Point.SE\n      return Point.NE\n    } else {\n      if (pt1.y < pt2.y) return Point.SW\n      return Point.NW\n    }\n  }\n\n  _getChannel (container, index, boxes, side) {\n    let maxChannelWidth = this.maxChannelWidth\n    let box1 = boxes[index]; let box2\n    let pt, i\n    let channel = {}; let l; let t; let b; let r\n    switch (side) {\n      case 0:\n        pt = box1.getLeft()\n        channel.right = pt.x\n        channel.horizontal = false\n        for (i = 0; i < boxes.length; i++) {\n          if (i === index) continue\n          r = boxes[i].getRight().x\n          if (r >= pt.x) continue\n          if (!channel.left || channel.left < r) {\n            channel.left = r\n          }\n        }\n        if (!channel.left) {\n          channel.left = container.getLeft().x\n          if (channel.right - channel.left > maxChannelWidth) {\n            channel.left = channel.right - maxChannelWidth\n          }\n        }\n        for (i = 0; i < boxes.length; i++) {\n          if (i === index) continue\n          box2 = boxes[i]\n          b = box2.getBottom().y\n          t = box2.getTop().y\n          if (b < pt.y && (box2.getRight() > channel.left && box2.getLeft() < channel.right)) {\n            if (!channel.top || channel.top < b) {\n              channel.top = b\n            }\n          }\n          if (t > pt.y && (box2.getRight() > channel.left && box2.getLeft() < channel.right)) {\n            if (!channel.bottom || channel.bottom > t) {\n              channel.bottom = t\n            }\n          }\n        }\n        if (!channel.top) channel.top = container.getTop().y\n        if (!channel.bottom) channel.bottom = container.getBottom().y\n        break\n      case 1:\n        pt = box1.getTop()\n        channel.horizontal = true\n        channel.bottom = pt.y\n        for (i = 0; i < boxes.length; i++) {\n          if (i === index) continue\n          b = boxes[i].getBottom().y\n          if (b >= pt.y) continue\n          if (!channel.top || channel.top < b) {\n            channel.top = b\n          }\n        }\n        if (!channel.top) {\n          channel.top = container.getTop().y\n          if (channel.bottom - channel.top > maxChannelWidth) {\n            channel.top = channel.bottom - maxChannelWidth\n          }\n        }\n        for (i = 0; i < boxes.length; i++) {\n          if (i === index) continue\n          box2 = boxes[i]\n          l = box2.getLeft().x\n          r = box2.getRight().x\n          if (r < pt.x && (box2.getBottom() > channel.top && box2.getTop() < channel.bottom)) {\n            if (!channel.left || channel.left < r) {\n              channel.left = r\n            }\n          }\n          if (l > pt.x && (box2.getBottom() > channel.top && box2.getTop() < channel.bottom)) {\n            if (!channel.right || channel.right > l) {\n              channel.right = l\n            }\n          }\n        }\n        if (!channel.left) channel.left = container.getLeft().x\n        if (!channel.right) channel.right = container.getRight().x\n\n        break\n      case 2:\n        pt = box1.getRight()\n        channel.horizontal = false\n        channel.left = pt.x\n        for (i = 0; i < boxes.length; i++) {\n          if (i === index) continue\n          l = boxes[i].getLeft().x\n          if (l <= pt.x) continue\n          if (!channel.right || channel.right > l) {\n            channel.right = l\n          }\n        }\n        if (!channel.right) {\n          channel.right = container.getRight().x\n          if (channel.right - channel.left > maxChannelWidth) {\n            channel.right = channel.left + maxChannelWidth\n          }\n        }\n        for (i = 0; i < boxes.length; i++) {\n          if (i === index) continue\n          box2 = boxes[i]\n          b = box2.getBottom().y\n          t = box2.getTop().y\n          if (b < pt.y && (box2.getRight() > channel.left && box2.getLeft() < channel.right)) {\n            if (!channel.top || channel.top < b) {\n              channel.top = b\n            }\n          }\n          if (t > pt.y && (box2.getRight() > channel.left && box2.getLeft() < channel.right)) {\n            if (!channel.bottom || channel.bottom > t) {\n              channel.bottom = t\n            }\n          }\n        }\n        if (!channel.top) channel.top = container.getTop().y\n        if (!channel.bottom) channel.bottom = container.getBottom().y\n        break\n      case 3:\n        pt = box1.getBottom()\n        channel.horizontal = true\n        channel.top = pt.y\n        for (i = 0; i < boxes.length; i++) {\n          if (i === index) continue\n          box2 = boxes[i]\n          if (box2.getTop().y <= pt.y) continue\n          if (!channel.bottom || channel.bottom > box2.getTop().y) {\n            channel.bottom = box2.getTop().y\n          }\n        }\n        if (!channel.bottom) {\n          channel.bottom = container.getBottom().y\n          if (channel.bottom - channel.top > maxChannelWidth) {\n            channel.bottom = channel.top + maxChannelWidth\n          }\n        }\n        for (i = 0; i < boxes.length; i++) {\n          if (i === index) continue\n          box2 = boxes[i]\n          l = box2.getLeft().x\n          r = box2.getRight().x\n          if (r < pt.x && (box2.getBottom() > channel.top && box2.getTop() < channel.bottom)) {\n            if (!channel.left || channel.left < r) {\n              channel.left = r\n            }\n          }\n          if (l > pt.x && (box2.getBottom() > channel.top && box2.getTop() < channel.bottom)) {\n            if (!channel.right || channel.right > l) {\n              channel.right = l\n            }\n          }\n        }\n        if (!channel.left) channel.left = container.getLeft().x\n        if (!channel.right) channel.right = container.getRight().x\n        break\n    }\n    return channel\n  }\n\n  /**\n  * Move a line segment by a specified distance.\n  *\n  * @param pts the list of points.\n  * @param i the index of the segment.\n  * @param d the distance to move.\n  * @param startPadding\n  * @param endPadding\n  */\n  _moveSegment (pts, i, d, startPadding, endPadding) {\n    // first check if we need to add new line segments.\n    let dir, l, pt\n    if (i === 0) {\n      // we need to break off the segment, since we can't change the starting point.\n      dir = pts[0].getDirection(pts[1])\n      if (!startPadding) {\n        startPadding = this.MIN_BUFFER\n      }\n      l = Math.min(startPadding, pts[0].distance(pts[1]) / 2)\n      pt = pts[0].getTranslated(dir.scale(l))\n      pts.splice(1, 0, pt)\n      this._moveSegment(pts, i + 1, d)\n      return\n    }\n    if (i === pts.length - 2) {\n      // we need to break off the segment, since we can't change the end point.\n      dir = pts[pts.length - 1].getDirection(pts[pts.length - 2])\n      if (!endPadding) {\n        endPadding = this.MIN_BUFFER\n      }\n      l = Math.min(endPadding, pts[pts.length - 1].distance(pts[pts.length - 2]) / 2)\n      pt = pts[pts.length - 1].getTranslated(dir.scale(l))\n      pts.splice(pts.length - 1, 0, pt)\n      this._moveSegment(pts, i, d)\n      return\n    }\n\n    if (pts[i].y === pts[i + 1].y) {\n      if (i > 0 && pts[i - 1].y === pts[i].y) {\n        pts.splice(i + 1, 0, pts[i].clone())\n        i++\n      }\n      if (i < pts.length - 2 && pts[i + 1].y === pts[i + 2].y) {\n        pts.splice(i + 1, 0, pts[i + 1].clone())\n      }\n      pts[i].y += d\n      pts[i + 1].y += d\n    } else {\n      if (i > 0 && pts[i - 1].x === pts[i].x) {\n        pts.splice(i + 1, 0, pts[i].clone())\n        i++\n      }\n      if (i < pts.length - 2 && pts[i + 1].x === pts[i + 2].x) {\n        pts.splice(i + 1, 0, pts[i + 1].clone())\n      }\n      pts[i].x += d\n      pts[i + 1].x += d\n    }\n  }\n\n  /**\n  * This method will merge the redundant segments.\n  */\n  static _mergeSegments (pts) {\n    let h1 = pts[pts.length - 1].y === pts[pts.length - 2].y\n    let h2\n    for (let i = pts.length - 2; i >= 1; i--) {\n      h2 = pts[i].y === pts[i - 1].y\n      if (h2 === h1 || (pts[i].equals(pts[i - 1]))) {\n        pts.splice(i, 1)\n      } else {\n        h1 = !h1\n      }\n    }\n  }\n}\n\nlinkTypes['direct'] = DirectLink\nlinkTypes['bezier'] = BezierLink\nlinkTypes['entityRelations'] = EntityRelations\nlinkTypes['manhattan'] = Manhattan\n\nexport default Link\n","\n// The Key Utility CLass for the Event Dispatcher\nimport StringBuffer from '../util/string-buffer'\n\n/**\n * KEY constant\n */\nexport const KEY = {\n  ALT: 18,\n  BACK_SPACE: 8,\n  CAPS_LOCK: 20,\n  CONTROL: 17,\n  DELETE: 46,\n  DOWN: 40,\n  END: 35,\n  ENTER: 13,\n  ESCAPE: 220,\n  HOME: 36,\n  LEFT: 37,\n  META: 224,\n  NUM_LOCK: 144,\n  PAGE_DOWN: 34,\n  PAGE_UP: 33,\n  PAUSE: 19,\n  PRINTSCREEN: 44,\n  RIGHT: 39,\n  SCROLL_LOCK: 145,\n  SHIFT: 16,\n  SPACE: 32,\n  TAB: 9,\n  UP: 38\n  // ADD          : DomUtils.isFireFox ? 61  : 187,\n  // SUBTRACT     : DomUtils.isFireFox ? 173 : 189\n}\n\nexport function getKeyEvent (event) {\n  if (!event || !(event instanceof KeyboardEvent)) {\n    return null\n  }\n\n  var key = event.keyCode || event.which\n\n  // Need to find a way to avoid this\n  if (key >= 16 && key <= 18) {\n    key = null\n  }\n\n  return getKeyData(event.ctrlKey, event.altKey, event.shiftKey, event.metaKey, key)\n}\n\nexport function getKeyData (ctrl, alt, shift, meta, key) {\n  var buf = new StringBuffer()\n\n  if (ctrl) buf.append('CTRL')\n  if (alt) buf.append('ALT')\n  if (shift) buf.append('SHIFT')\n  if (meta) buf.append('META')\n  if (key) buf.append(key)\n\n  return buf.toString('.')\n}\n","import _ from 'lodash'\nimport Events from '../../lib/bean'\nimport * as KeyUtils from './key-utils'\nimport DomUtils from '../util/dom-utils'\nimport StringBuffer from '../util/string-buffer'\n\nconst DEFAULTS = {\n  stopPropagation: false\n}\n\nconst win = typeof window !== 'undefined' ? window : { addEventHandler: function () {} }\nconst doc = typeof document !== 'undefined' ? document : {}\n\n/**\n * The EventDispatcher is the central event management. It will monitor all events and translate it into the a higher\n * level events for consumption.\n */\nexport default class EventDispatcher {\n  /**\n   * Constructor\n   * @param root the root element that the manager will listen to.\n   * @param zoomScale\n   * @param config the configuraton for the event dispatcher.\n   */\n  constructor (root, zoomScale = [0, Infinity], config = {}) {\n    this.root = root\n    this.rootNS = root.getAttribute('ns') || 'root'\n    this.zoomScale = zoomScale\n    Object.assign(this, DEFAULTS, config)\n    this.scale = 1.0\n    this.listeners = {}\n    this.dragging = false\n    this.handler = (event) => { this.handleEvent(event) }\n    this.started = false\n\n    // Simulate mouseenter/mouseleave events\n    this.enterStack = []\n  }\n\n  /**\n   * Start listening for events.\n   */\n  start () {\n    if (this.started) return\n    Events.on(this.root, 'mousedown mouseover mouseout mouseenter mouseleave dblclick click contextmenu mousewheel', this.handler)\n    this.startKeys()\n    this.started = true\n  }\n\n  /**\n   * Stop listening for events.\n   */\n  stop () {\n    if (!this.started) return\n    Events.off(this.root, 'mousedown mouseover mouseout mouseenter mouseleave dblclick click contextmenu mousewheel', this.handler)\n    this.stopKeys()\n    this.started = false\n  }\n\n  startKeys () {\n    Events.on(doc, 'keydown keyup', this.handler)\n  }\n\n  stopKeys () {\n    Events.off(doc, 'keydown keyup', this.handler)\n  }\n\n  zoomIn () {\n    this.scale *= 1.25\n    this.scale = Math.max(Math.min(this.zoomScale[1], this.scale), this.zoomScale[0])\n    return this.scale\n  }\n\n  zoomOut () {\n    this.scale *= 0.8\n    this.scale = Math.max(Math.min(this.zoomScale[1], this.scale), this.zoomScale[0])\n    return this.scale\n  }\n\n  getEventInfo (event) {\n    let target = event.target\n    const buf = new StringBuffer()\n    let ns\n    const stack = []\n    let isRoot = false\n    while (!isRoot && target && target !== doc) {\n      ns = target.getAttribute('ns')\n      if (ns) {\n        isRoot = ns.startsWith('root.')\n        if (isRoot) {\n          ns = ns.substring(5)\n          event.rootTarget = target\n        }\n        if (!event.nsTarget) event.nsTarget = target\n        stack.splice(0, 0, target)\n        buf.prepend(ns)\n      }\n      target = target.parentNode\n    }\n    if (!isRoot) {\n      event.rootTarget = event.nsTarget\n    }\n\n    // target stack is a stack of all the ns targets up to the one with the data binding.\n    event.targetStack = stack\n    ns = buf.toString('.')\n    if (ns === '') ns = this.rootNS\n    return { data: event.rootTarget, ns: ns }\n  }\n\n  /**\n   * The main event handler method, it processes event and generate relevant events to dispatch.\n   */\n  handleEvent (event) {\n    let type = event.type\n\n    // Do not dispatch other events if we are dragging.\n    if (this.dragging || DomUtils.eventFromInput(event)) return\n\n    let data\n    let ns\n    const pos = this.getPosition(event)\n    let info\n    const isKeyEvent = (type === 'keydown' || type === 'keyup')\n    if (isKeyEvent) {\n      data = this.root\n      ns = KeyUtils.getKeyEvent(event)\n    } else {\n      info = this.getEventInfo(event)\n      if (!info) return\n      data = info.data\n      ns = info.ns\n    }\n\n    // Utils.log('EventDispatcher', \"handleEvent - \" + type + ';ns=' + ns)\n\n    if (type === 'mousewheel') {\n      this.scale *= Math.pow(2, event.wheelDelta * 0.002)\n      this.scale = Math.max(Math.min(this.zoomScale[1], this.scale), this.zoomScale[0])\n      event.scale = this.scale\n      type = 'zoom'\n    }\n\n    // See if we should create drag events\n    if (type === 'mousedown' && event.button === 0 /* only drag on left click */) {\n      // Create drag object.\n      const dragObject = { data: data, pos: ns === 'root' ? EventDispatcher.mouse(this.root, event) : pos }\n      this.dragging = false\n      // Start listening for mouse move.\n      let dragPos\n\n      const mousemove = (event) => {\n        let currentPos = this.getPosition(event)\n        if (!this.dragging) {\n          // check if the mouse has moved. IE always fire mousemove after mousedown even if the mouse hasn't moved yet.\n          if (dragObject.pos[0] === currentPos[0] && dragObject.pos[1] === currentPos[1]) return\n\n          // start dragging\n          this.dragging = true\n          event.rootTarget = dragObject.data\n          this.dispatch(event, 'dragstart', ns, dragObject.data, dragObject.pos)\n        }\n        if (ns === 'root') {\n          dragPos = EventDispatcher.mouse(this.root, event)\n        } else {\n          dragPos = currentPos\n        }\n        this.getEventInfo(event)\n        this.dispatch(event, 'drag', ns, dragObject.data, dragPos)\n      }\n      const mouseup = (event) => {\n        if (ns === 'root') {\n          dragPos = EventDispatcher.mouse(this.root, event)\n        } else {\n          dragPos = this.getPosition(event)\n        }\n\n        let info = this.getEventInfo(event)\n        if (this.dragging) {\n          this.dragging = false\n          this.dispatch(event, 'dragend', ns, dragObject.data, dragPos)\n        } else {\n          this.dispatch(event, 'mouseup', ns, info.data, dragPos)\n        }\n\n        Events.off(win, 'mousemove', mousemove)\n        Events.off(win, 'mouseup', mouseup)\n      }\n      event.preventDefault()\n      Events.on(win, 'mousemove', mousemove)\n      Events.on(win, 'mouseup', mouseup)\n    }\n\n    if (!isKeyEvent) {\n      this.simulateEnterLeave(event, type, ns, data, pos)\n    }\n    this.dispatch(event, type, ns, data, pos)\n\n    // disable the default context menu\n    // if (type == 'contextmenu')\n    // event.preventDefault()\n  }\n\n  /**\n   * try to simulate mouseenter/mouseleave events.\n   */\n  simulateEnterLeave (event, type, ns, data, pos) {\n    let last, stack\n    const clearEnterStack = (k) => {\n      k = k || 0\n      // Clear off the enter stack.\n      while (this.enterStack.length >= k + 1) {\n        last = this.enterStack.pop()\n        this.dispatch(event, 'mouseleave', last.ns, last.data, pos)\n      }\n    }\n    const getNS = function (index) {\n      let buf = new StringBuffer()\n      for (let i = 0; i <= index; i++) {\n        let val = stack[i].getAttribute('ns')\n        if (val.startsWith('root.')) {\n          val = val.substring(5)\n        }\n        buf.append(val)\n      }\n      return buf.toString('.')\n    }\n\n    if (ns && ns !== this.rootNS) {\n      if (type === 'mouseover') {\n        stack = event.targetStack\n        let item\n        for (let i = 0; i < stack.length; i++) {\n          if (i < this.enterStack.length) {\n            if (this.enterStack[i].target !== stack[i]) {\n              clearEnterStack(i)\n            } else {\n              continue\n            }\n          }\n          item = { data: data, ns: getNS(i), target: stack[i] }\n          this.enterStack.push(item)\n          this.dispatch(event, 'mouseenter', item.ns, data, pos)\n        }\n        if (stack.length < this.enterStack.length) {\n          clearEnterStack(stack.length)\n        }\n      }\n    }\n    if (ns === this.rootNS && this.enterStack.length > 0) {\n      clearEnterStack()\n    }\n  }\n\n  dispatch (event, type, ns, data, pos) {\n    // if (type != 'mouseover' && type != 'mouseout')\n    // Utils.log('EventDispatcher', \"dispatch - \" + type + '.' + ns + ';' + pos + ';rootTarget=' + event.rootTarget + ';data=' + data);\n    if (!this.started) return\n    const nsType = ns ? type + '.' + ns : type\n    _.forEach(this.listeners, (listeners, key) => {\n      if (EventDispatcher.match(nsType, listeners.regexp ? listeners.regexp : key)) {\n        _.forEach(listeners, (listener) => {\n          if (!listener.context) {\n            listener.callback.apply(window, [type, ns, data, pos, event])\n          } else {\n            listener.callback.apply(listener.context, [type, ns, data, pos, event])\n          }\n        })\n      }\n    })\n\n    // after dispatching, do not propagate.\n    if (this.stopPropagation && event.stopPropagation) {\n      event.stopPropagation()\n    }\n  }\n\n  getPosition (event) {\n    const pos = EventDispatcher.mouse(this.root, event)\n    if (!_.isNaN(pos[0]) && !_.isNaN(pos[1])) {\n      this.lastPosition = pos\n    }\n    return this.lastPosition\n  }\n\n  /**\n   * Registers a key event handler\n   * // Key is object {ctrl, alt, shift, meta, code}\n   */\n  registerKey (type, key, callback, context) {\n    if (Array.isArray(key)) {\n      key.forEach(k => {\n        this.registerKey(type, k, callback, context)\n      })\n      return\n    }\n    key = KeyUtils.getKeyData(key.ctrl, key.alt, key.shift, key.meta, key.code)\n    if (!key.length) return\n    key = new StringBuffer(type).append(key).toString('.')\n\n    const listener = { callback: callback, context: context }\n    this.listeners[key] || (this.listeners[key] = [])\n    this.listeners[key].push(listener)\n  }\n\n  unregisterKey (type, key, callback, context) {\n    if (Array.isArray(key)) {\n      key.forEach(k => {\n        this.unregisterKey(type, k, callback, context)\n      })\n      return\n    }\n    key = KeyUtils.getKeyData(key.ctrl, key.alt, key.shift, key.meta, key.code)\n    if (!key.length) return\n    key = new StringBuffer(type).append(key).toString('.')\n\n    let listeners = this.listeners[key]; let listener\n    if (!listeners) return\n    for (let i = 0; i < listeners.length; i++) {\n      listener = listeners[i]\n      if (listener.callback === callback && (!context || context === listener.context)) {\n        listeners.splice(i, 1)\n        return\n      }\n    }\n  }\n\n  /**\n   * Registers an event handler\n   */\n  register (type, callback, context, zIndex) {\n    if (Array.isArray(type)) {\n      type.forEach(t => {\n        this.register(t, callback, context, zIndex)\n      })\n      return\n    }\n    const listener = { callback: callback, context: context, zIndex: zIndex }\n    let regexp = null\n    if (type instanceof RegExp) {\n      regexp = type\n      type = type + ''\n    }\n    this.listeners[type] || (this.listeners[type] = [])\n    if (regexp && !this.listeners[type].regexp) {\n      this.listeners[type].regexp = regexp\n    }\n    this.listeners[type].push(listener)\n  }\n\n  unregister (type, callback, context) {\n    if (type instanceof RegExp) {\n      type = type + ''\n    }\n    let listeners = this.listeners[type]; let listener\n    if (!listeners) return\n    for (let i = 0; i < listeners.length; i++) {\n      listener = listeners[i]\n      if (listener.callback === callback && (!context || context === listener.context)) {\n        listeners.splice(i, 1)\n        return\n      }\n    }\n  }\n\n  destroy () {\n    this.stop()\n    delete this.root\n    delete this.listeners\n    delete this.enterStack\n  }\n\n  /**\n   * Check if the registered event type matches the real event type. \"*\" is allowed as a wild card.\n   */\n  static match (nsType, registeredType) {\n    if (registeredType instanceof RegExp) {\n      return nsType.match(registeredType)\n    }\n\n    return nsType === registeredType\n    /* const arr = registeredType.split('*');\n    if (arr.length == 1)\n      return nsType == registeredType;\n\n    let substr, index = 0;\n    for (let i = 0; i < arr.length; i++) {\n      if (arr[i].length == 0) continue;\n      substr = nsType.slice(index);\n      index = substr.indexOf(arr[i]);\n      if (index < 0)\n        return false;\n      index += arr[i].length;\n    }\n    return true; */\n  }\n\n  static mouse (container, e) {\n    if (e.changedTouches) e = e.changedTouches[0]\n    let svg = container.ownerSVGElement || container\n    if (svg.createSVGPoint) {\n      let point = svg.createSVGPoint()\n      point.x = e.clientX; point.y = e.clientY\n      point = point.matrixTransform(container.getScreenCTM().inverse())\n      return [point.x, point.y]\n    }\n    let rect = container.getBoundingClientRect()\n    return [e.clientX - rect.left - container.clientLeft, e.clientY - rect.top - container.clientTop]\n  }\n}\n","import _ from 'lodash'\nimport Events from '../../lib/bean'\nimport Utils from '../util/Utils'\nimport DomUtils from '../util/dom-utils'\nimport StringBuffer from '../util/string-buffer'\nimport Rectangle from '../geometry/Rectangle'\n\nconst FONT_BOLD = 1; const FONT_ITALIC = 2; const FONT_UNDERLINE = 4; const FONT_SHADOW = 8\n\nlet defaultConfig = {\n  fontSize: 11,\n  fontFamily: 'Arial',\n  fontStyle: 0,\n  fontColor: 'black',\n  padding: 0,\n  linePadding: 0,\n  align: 'left',\n  width: 0,\n  height: 0,\n  rotation: null,\n  geometry: { x: 0, y: 0, anchorY: 0, offsetX: 0, offsetY: 0 }\n}\n\n/**\n * The label object handles label sizing/positioning\n */\nexport default (function () {\n  let stringMeasureEl = null; let measureDiv; let baselineDiv\n\n  /**\n   * Calculate the size of the string.\n   */\n  let getStringSize = _.memoize(function (str, fontSize, fontFamily, bold) {\n    fontSize = fontSize || 11\n    fontFamily = fontFamily || 'Arial,Helvetica'\n    bold = !_.isUndefined(bold) ? bold : false\n\n    // first check if there is a string-measuring div available, if not, create now.\n    if (!stringMeasureEl) {\n      stringMeasureEl = DomUtils.createElement('iframe', { id: '_ComputeStylesIframe' }, { position: 'absolute', visibility: 'hidden', width: 'auto' })\n      document.body.appendChild(stringMeasureEl)\n      let doc = stringMeasureEl.contentWindow.document\n      doc.open()\n      doc.write(\n        `<html><body>\n        <div id=\"baselineDiv\" style=\"height:100px;\"><span style=\"line-height:0\">T</span><span style=\"height:100%;display:inline-block;\"></span></div>\n        <div id=\"measureDiv\" style=\"position:absolute;width:auto;height:auto;padding:0;white-space:nowrap;display:inline-block;\"></div>\n        </body></html>`)\n      doc.close()\n      measureDiv = doc.getElementById('measureDiv')\n      baselineDiv = doc.getElementById('baselineDiv')\n    }\n    baselineDiv.style.fontSize = measureDiv.style.fontSize = fontSize\n    baselineDiv.style.fontFamily = measureDiv.style.fontFamily = fontFamily\n    baselineDiv.style.fontWeight = measureDiv.style.fontWeight = bold ? 'bold' : 'normal'\n    measureDiv.innerHTML = str\n\n    let strut = baselineDiv.firstChild\n    let baselineHeight = strut.offsetTop + strut.offsetHeight - baselineDiv.offsetHeight - baselineDiv.offsetTop\n\n    return { width: measureDiv.offsetWidth, height: measureDiv.offsetHeight, baseline: baselineHeight }\n  }, function (str, fontSize, fontFamily, bold) { return str + ';' + fontSize + ';' + fontFamily + ';' + bold })\n\n  /**\n   * Create a wrapped text.\n   * @param {String} string the string to wrap.\n   * @param {maxWidth} the maximum width this string can take.\n   * @param {fontSize}\n   * @param {fontFamily}\n   * @param {bold}\n   */\n  let wrap = _.memoize(function (string, maxWidth, fontSize, fontFamily, bold) {\n    maxWidth = maxWidth || 0\n    fontSize = fontSize || 11\n    fontFamily = fontFamily || 'Arial,Helvetica'\n    bold = !_.isUndefined(bold) ? bold : false\n\n    let arr = []\n    let spaceSize = getStringSize('&nbsp;', fontSize, fontFamily, bold); let space = spaceSize.width\n    arr.lineHeight = spaceSize.height\n    arr.baseline = spaceSize.baseline\n\n    if (!maxWidth || !string || string === '') {\n      arr.push(string)\n      arr.width = (!string || string === '') ? space : getStringSize(string, fontSize, fontFamily, bold).width\n      arr.height = arr.lineHeight\n      return arr\n    }\n\n    let width = 0\n    // split the text by lines\n    let lines = string.split('\\n')\n\n    let buf = new StringBuffer()\n\n    for (let j = 0; j < lines.length; j++) {\n      // split each line by word\n      let words = lines[j].split(/\\s/)\n      let line = ''; let currentWidth = 0; let wordWidth = 0; let newLine = true; let word\n\n      for (let i = 0; i < words.length; i++) {\n        word = words[i]\n        wordWidth = getStringSize(word, fontSize, fontFamily, bold).width\n\n        if ((newLine ? wordWidth : currentWidth + space + wordWidth) > maxWidth) {\n          if (newLine) {\n            buf.append(word)\n            width = Math.max(width, wordWidth)\n            if (i < words.length - 1) {\n              arr.push(buf.toString())\n              buf.clear()\n            }\n          } else {\n            arr.push(buf.append(line).toString())\n            width = Math.max(width, currentWidth + space + wordWidth)\n            buf.clear()\n          }\n          line = ''\n          currentWidth = 0\n          if (!newLine) { i-- } // move back one word.\n          newLine = true\n        } else {\n          line = newLine ? word : line + ' ' + word\n          currentWidth = newLine ? wordWidth : currentWidth + space + wordWidth\n          width = Math.max(width, currentWidth)\n          newLine = false\n        }\n      }\n      if (line !== '') { buf.append(line) }\n      if (j < lines.length - 1) {\n        arr.push(buf.toString())\n        buf.clear()\n      }\n    }\n\n    arr.push(buf.toString())\n    arr.width = width\n    arr.height = arr.lineHeight * arr.length\n    return arr\n  }, function (str, maxWidth, fontSize, fontFamily, bold) { return str + ';' + maxWidth + ';' + fontSize + ';' + fontFamily + ';' + bold })\n\n  /**\n   *  Get the view information for how to display the label.\n   * @param label The string that needs to be displayed\n   * @param containerWidth The width of the parent container.\n   * @param containerHeight The height of the parent container.\n   * @param labelConfig The configuration on how to display label. It should be an object with the following parameters:\n   * {\n   *      fontSize, fontFamily, fontStyle, padding,\n   *      align: can be either \"left\", \"center\" or \"right\",\n   *      width: the maximum width of the label. if less than 1, then is treated as percentage. If 0, no wrapping will occur,\n   *      height,\n   *      geometry\n   * }\n   * @returns {*}\n   */\n  function getLabelBox (label, labelConfig, containerWidth, containerHeight) {\n    return _getLabelBox.call(this, label, labelConfig, { width: containerWidth, height: containerHeight })\n  }\n\n  function getLabelBoxForLink (label, labelConfig, link) {\n    return _getLabelBox.call(this, label, labelConfig, link)\n  }\n\n  function _getLabelBox (label, labelConfig = {}, context) {\n    labelConfig = _.defaultsDeep(labelConfig, defaultConfig)\n    let fontSize = labelConfig.fontSize\n    let fontFamily = labelConfig.fontFamily\n    let fontStyle = labelConfig.fontStyle\n    let bold = (fontStyle & FONT_BOLD) === FONT_BOLD\n    let padding = labelConfig.padding\n    let linePadding = labelConfig.linePadding\n    let align = labelConfig.align\n\n    let w = labelConfig.width; let h = labelConfig.height\n    if (context.width) {\n      w = w <= 5 ? context.width * w : w\n      h = h <= 5 ? context.height * h : h\n    }\n    w -= 2 * padding\n    h -= 2 * padding\n    w = Math.max(0, w)\n    h = Math.max(0, h)\n\n    let geometry = _.clone(labelConfig.geometry)\n    let wrappedLabel = this.wrap(label, w, fontSize, fontFamily, bold)\n    geometry.width = wrappedLabel.width + 2 * padding\n    geometry.height = wrappedLabel.height + 2 * padding + (wrappedLabel.length - 1) * linePadding\n    let anchor = 'start'; let dx = 0; let setAnchorX = !_.has(geometry, 'anchorX')\n    switch (align) {\n      case 'center':\n        anchor = 'middle'\n        if (setAnchorX) geometry.anchorX = 0\n        break\n      case 'right':\n        anchor = 'end'\n        dx = wrappedLabel.width / 2\n        if (setAnchorX) geometry.anchorX = -0.5\n        break\n      case 'left':\n        dx = -wrappedLabel.width / 2\n        if (setAnchorX) geometry.anchorX = 0.5\n        break\n    }\n    let pos\n    if (context.getRelativePosition) { pos = context.getRelativePosition(geometry) } else { pos = Utils.getRelativePosition({ width: context.width, height: context.height }, geometry) }\n\n    let bounds = new Rectangle(pos[0], pos[1], geometry.width, geometry.height)\n    // the pivot is the center of rotation when the label has a rotation specified.\n    let pivot = align === 'center' ? [0, 0] : (align === 'left' ? [-wrappedLabel.width / 2, 0] : [wrappedLabel.width / 2, 0])\n\n    // the maximum bounds for the label, used to position inline editor\n    geometry.width = Math.max(w + 2 * padding, geometry.width)\n    geometry.height = Math.max(h + 2 * padding, geometry.height)\n\n    if (context.getRelativePosition) { pos = context.getRelativePosition(geometry) } else { pos = Utils.getRelativePosition({ width: context.width, height: context.height }, geometry) }\n\n    let maxBounds = new Rectangle(pos[0], pos[1], geometry.width, geometry.height)\n    return {\n      config: labelConfig,\n      label: wrappedLabel,\n      _label: label,\n      bold,\n      underline: fontStyle & FONT_UNDERLINE,\n      italic: fontStyle & FONT_ITALIC,\n      shadow: fontStyle & FONT_SHADOW,\n      dx,\n      dy: -geometry.height / 2 + padding + wrappedLabel.lineHeight - wrappedLabel.baseline,\n      anchor,\n      lineHeight: wrappedLabel.lineHeight + linePadding,\n      pivot,\n      bounds,\n      maxBounds\n    }\n  }\n\n  function render (view, box) {\n    return view.renderLabel(box)\n  }\n\n  // This is the inline editor for editing label text in place.\n  let editor = {\n    start: function (key, container, box, refEl, textEl, scale = 1.0, singleLine = true) {\n      if (this.input) {\n        if (this.key !== key) {\n          // need to close the existing editor first\n          this.stop()\n        } else { return }\n      }\n      let tag = singleLine ? 'input' : 'textarea'\n      this.input = DomUtils.createElement(tag, { id: 'inlineEditor', unselectable: 'off' }, { position: 'absolute', overflow: 'hidden', padding: '0px', margin: '0px', border: 'transparent' })\n      if (singleLine) {\n        Events.on(this.input, 'keydown keyup', (event) => {\n          if (event.keyCode === 13) {\n            Events.off(this.input, 'keydown keyup')\n            this.stop()\n          }\n        })\n      }\n      container.appendChild(this.input)\n\n      this.key = key\n      this.box = box\n      this.refEl = refEl\n      this.textEl = textEl\n\n      let labelConfig = box.config\n      let maxBounds = new Rectangle(box.maxBounds.x, box.maxBounds.y, box.maxBounds.width * scale, box.maxBounds.height * scale)\n      let pos = DomUtils.getCenterPosition(refEl, container)\n      pos = [pos[0] + maxBounds.left, pos[1] + maxBounds.top]\n\n      if (textEl) { textEl.style.visibility = 'hidden' }\n\n      DomUtils.setElement(this.input, null, {\n        visibility: 'visible',\n        left: pos[0] + 'px',\n        top: pos[1] + 'px',\n        width: maxBounds.width + 'px',\n        height: maxBounds.height + 'px',\n        'font-family': labelConfig.fontFamily,\n        'font-size': (labelConfig.fontSize * scale) + 'px',\n        'font-weight': (labelConfig.fontStyle & FONT_BOLD) === FONT_BOLD ? 'bold' : 'normal'\n        /* \"color\": labelConfig.fontColor */\n      })\n\n      this.input.value = box._label\n      this.input.focus()\n      this.input.select()\n      Events.fire(this, 'editor.start', [this.key])\n    },\n\n    stop: function (cancel) {\n      if (!this.input) return\n\n      cancel = cancel || false\n      if (this.textEl) { this.textEl.style.visibility = null }\n\n      // remove the input\n      this.input.parentNode.removeChild(this.input)\n\n      if (!cancel) { Events.fire(this, 'editor.update', [this.key, this.input.value]) }\n\n      Events.fire(this, 'editor.stop', [this.key])\n\n      delete this.input\n      delete this.key\n      delete this.box\n      delete this.refEl\n      delete this.textEl\n    }\n  }\n\n  return {\n    FONT_BOLD,\n    FONT_ITALIC,\n    FONT_UNDERLINE,\n    FONT_SHADOW,\n    getStringSize,\n    wrap,\n    getLabelBox,\n    getLabelBoxForLink,\n    render,\n    editor\n  }\n})()\n","import _ from 'lodash'\nimport Utils from '../util/Utils'\nimport Cache from '../util/Cache'\nimport StringBuffer from '../util/string-buffer'\nimport Shape from '../geometry/Shape'\nimport Label from '../view/Label'\n\n/**\n * The Cell is the common parent for Node and Edge.\n */\nexport default class Cell {\n  constructor (graph, config = { id: _.uniqueId() }) {\n    this.graph = graph\n    this.id = config.id\n    delete config.id\n\n    // Initialize decorators\n    if (config.decorators) {\n      this.createDecorators(config.decorators)\n      delete config.decorators\n    }\n\n    // Initialize View Properties\n    if (config.views) {\n      this.viewProps = config.views\n      delete config.views\n    }\n\n    // Initialize type\n    var Type = config.type || 'Default'\n    Type = Utils.type(this.constructor.namespace, Type)\n    if (!Type) { throw new Error('Type not found ' + config.type) }\n    delete config.type\n    this.props = new Type(config)\n  }\n\n  prop (name, value) {\n    if (_.isUndefined(value)) { return this.props[name] }\n    this.props[name] = value\n  }\n\n  /**\n   * Get/Set property stored by views.\n   * @param key\n   * @param name\n   * @param value\n   * @returns {*}\n   */\n  viewProp (key = 'default', name, value) {\n    if (_.isUndefined(value)) {\n      if (key === 'default') { return this.prop(name, value) }\n      return this.viewProps[key][name]\n    }\n    if (key === 'default') {\n      this.prop(name, value)\n    } else {\n      if (!this.viewProps[key]) { this.viewProps[key] = {} }\n      this.viewProps[key][name] = value\n    }\n  }\n\n  createDecorators (decorators) {}\n\n  /**\n   * Get properties needed for rendering this element\n   * @returns {{key: (string|*), className: *, namespace: *, bounds: *}}\n   */\n  getView (key) {\n    let shape = this.getShape(key)\n    return _.assign({\n      id: this.id,\n      key: key,\n      className: this.computedClassName,\n      style: this.viewProp(key, 'style'),\n      namespace: this.namespace\n    }, shape)\n  }\n\n  getShape (key) {\n    let shape = Cache.get(this.id + '.shape', key)\n    if (shape) return shape\n\n    let shapeConfig = this.viewProp(key, 'shape')\n    let ShapeClass = shapeConfig ? Shape.getShape(shapeConfig.name) : Shape.getShape('Rectangle')\n    let x = this.viewProp(key, 'x')\n    let y = this.viewProp(key, 'y')\n    let width = this.viewProp(key, 'width')\n    let height = this.viewProp(key, 'height')\n    shape = new ShapeClass(x, y, width, height, shapeConfig)\n    Cache.set(this.id + '.shape', shape, key)\n    return shape\n  }\n\n  render (view) {\n    let template = Cache.get(this.id + '.template', view.id)\n    if (!template) {\n      // create the template\n      let role = this.prop('role')\n      template = view.getTemplate('$' + role, null, this)\n      if (_.isString(template)) { template = _.template(template) }\n      Cache.set(this.id + '.template', template, view.id)\n    }\n    return template(this.getView(view.id))\n  }\n\n  renderShape (view) {\n    let shape = this.getShape(view.id)\n    if (shape) { return shape.render(view) }\n    return ''\n  }\n\n  renderLabel (view) {\n    if (this === this.graph.currentRoot) { return null }\n    let box = this.getLabelBox(view.id)\n    if (box) { return view.renderLabel(box) }\n    return ''\n  }\n\n  getLabelBox (key) {\n    let box = Cache.get(this.id + '.labelBox', key)\n    if (box) return box\n    let shape = this.getShape(key)\n    // Just get the config will have a positive performance boost for IE11 and IE10.\n    box = Label.getLabelBox(this.prop('label'), this.viewProp(key, 'labelConfig'), shape.width, shape.height)\n    Cache.set(this.id + '.labelBox', box, key)\n    return box\n  }\n\n  get computedClassName () {\n    if (!this._computedClassName) {\n      var buf = new StringBuffer(this.prop('role'))\n      let props = this.props\n      if (props.hasOwnProperty('className')) { buf.append(props['className']) }\n      props = props.constructor.prototype\n      while (props) {\n        if (props.hasOwnProperty('className')) { buf.append(props['className']) }\n        props = Object.getPrototypeOf(props)\n      }\n      this._computedClassName = buf.toString(' ')\n    }\n    return this._computedClassName\n  }\n\n  get namespace () {\n    if (this === this.graph.currentRoot) return ''\n    return 'root.' + this.prop('role')\n  }\n\n  destroy () {\n    delete this.graph\n    delete this.decorators\n    delete this.props\n    delete this.viewProps\n    this.destroyed = true\n  }\n}\n\n/*\n\nCell.prototype.move = function(x, y) {\n  this.setProperty(\"x\", Math.round(x));\n  this.setProperty(\"y\", Math.round(y));\n  delete this.bounds;\n};\n\nCell.prototype.resize = function(w, h) {\n  this.setProperty(\"width\", w);\n  this.setProperty(\"height\", h);\n  delete this.bounds;\n};\n\nCell.prototype.canEdit = function() {\n  return (this.graph ? this.graph.canEdit() : true) && this.getProperty(\"editable\");\n};\n\nCell.prototype.canSelect = function() {\n  return (this.graph ? this.graph.canSelect() : true) && this.getProperty(\"selectable\");\n};\n\nCell.prototype.canMove = function() {\n  return (this.graph ? this.graph.canEdit() : true) && this.getProperty(\"draggable\");\n};\n\nCell.prototype.canResize = function() {\n  return (this.graph ? this.graph.canEdit() : true) && this.getProperty(\"resizable\");\n};\n\nCell.prototype.getTypeFromString = function(typeStr) {\n  return this.graph.getType(typeStr);\n};\n\nCell.prototype.createModifiers = function(modifiers) {\n  this.modifiers = null;\n  var modifierSettings = this.getProperty(\"modifierSettings\");\n  if (modifierSettings) {\n    _.each(modifiers, function(config) {\n      config.type = this.graph.getModifierType(config.className);\n      config.setting = modifierSettings[config.className];\n      if (!config.type || !config.setting) return;\n\n      this.addModifier(config.className, new Modifier(this, config));\n    }, this);\n\n    // Check for showAlways settings\n    _.each(modifierSettings, function(setting, name) {\n      if (setting.showAlways && (!this.modifiers || !this.modifiers[name])) {\n        var config = {type: this.graph.getModifierType(name), setting: setting};\n        if (!config.type) return;\n        this.addModifier(name, new Modifier(this, config));\n      }\n    }, this);\n  }\n};\n\nCell.prototype.addModifier = function(name, modifier) {\n  if (!this.modifiers)\n    this.modifiers = {};\n\n  if (!modifier.hasOwnProperty(\"showHeader\"))\n    modifier.showHeader = true;\n\n  // @hack preferably set it in configurations.\n  if (modifier.name == \"HoverProcessModifier\" || modifier.name == \"HoverResults\")\n    modifier.showHeader = false;\n\n  this.modifiers[name] = modifier;\n};\n\nCell.prototype.getModifiers = function() {\n  if (_.isUndefined(this.modifiers))\n    this.createModifiers();\n  return this.modifiers;\n};\n\nCell.prototype.getModifier = function(name) {\n  var modifiers = this.getModifiers();\n  if (modifiers)\n    return modifiers[name];\n  return null;\n};\n\nCell.prototype.isVisible = function() {\n  return this.getProperty('visible');\n};\n\nCell.prototype.isContainer = function() {\n  return false;\n};\n*/\n","import _ from 'lodash'\nimport StringBuffer from '../util/string-buffer'\nimport Cell from './Cell'\n\n/**\n * A Node represents vertex of the graph.\n */\nclass Node extends Cell {\n  constructor (graph, config = {}) {\n    if (!config.id) config.id = _.uniqueId('N')\n    super(graph, config)\n\n    this.inEdges = []\n    this.outEdges = []\n    this.ports = null\n    this.parent = null\n  }\n\n  isAncestor (n) {\n    // TODO: should we move this to graph class ?\n    let node = n.parent\n    while (node) {\n      if (this === node) { return true }\n      node = node.parent\n    }\n    return false\n  }\n\n  removeEdge (edge) {\n    let edges = edge.source === this ? this.outEdges : this.inEdges\n    for (let i = 0; i < edges.length; i++) {\n      if (edge === edges[i]) {\n        edges.splice(i, 1)\n        break\n      }\n    }\n  }\n\n  // Add a new incoming edge\n  addInEdge (edge, pos) {\n    if (pos == null || pos === undefined) {\n      this.inEdges.push(edge)\n    } else {\n      this.inEdges.splice(pos, 0, edge)\n    }\n  }\n\n  // Add a new outgoing edge\n  addOutEdge (edge, pos) {\n    if (pos == null || pos === undefined || pos > edge.length - 1) {\n      this.outEdges.push(edge)\n    } else {\n      this.outEdges.splice(pos, 0, edge)\n    }\n  }\n\n  renderChildren (view) {\n    if (this.children) {\n      let buf = new StringBuffer()\n      _.forEach(this.children, (child) => {\n        buf.append(child.render(view))\n      })\n      return buf.toString()\n    }\n    return ''\n  }\n\n  getPort (key, portName = 'auto', endPt, orthogonal) {\n    let shape = this.getShape(key)\n    if (portName === 'auto') {\n      return shape.getPerimeter(endPt, orthogonal)\n    }\n    return null\n  }\n\n  toString () {\n    let label = this.prop('label') ? this.prop('label') : 'undefined'\n    if (_.isArray(label)) {\n      label = label[0]\n    }\n    return 'Node:{id:' + this.id + ';label:' + label + ';type:' + this.props.constructor.typeName + '}'\n  }\n}\nNode.namespace = 'Nodes'\n\nexport default Node\n\n/*\n\n/**\n * The DrillDownParent is the parent that displays the vertex when drilled down.\n *\nVertex.prototype.getDrillDownParent = function() {\n  return this.parent;\n};\n\nVertex.prototype.isLocked = function() {\n  let mode = this.getProperty(\"mode\") || 3;\n  return !(mode & Graph.ALLOW_INTERACTIONS);\n};\n\nVertex.prototype.getCrumbText = function() {\n  if (this.isLocked())\n    return '<span><img src=\"webwb/pzreadonly.png\" /></span><span>&nbsp;' + this.getProperty(\"label\") + '</span>';\n  return this.getProperty(\"label\");\n};\n\nVertex.prototype.canEdit = function() {\n  return (!this.parent || !this.parent.isLocked()) && Vertex.superclass.canEdit.call(this);\n};\n\nVertex.prototype.isContainer = function() {\n  return this.getProperty(\"container\");\n};\n\n*/\n","import _ from 'lodash'\nimport Cell from './Cell'\nimport Rectangle from '../geometry/Rectangle'\nimport Link from '../geometry/Link'\nimport Label from '../view/Label'\nimport Cache from '../util/Cache'\n\nclass Edge extends Cell {\n  constructor (graph, config = {}, source, target) {\n    if (!config.id) config.id = _.uniqueId('E')\n    super(graph, config)\n\n    this.source = this.target = null\n    this.setSource(source, config.sourcePos)\n    this.setTarget(target, config.targetPos)\n  }\n\n  setSource (node, pos) {\n    this.setTerminal(node, pos, 'source')\n  }\n\n  setTarget (node, pos) {\n    this.setTerminal(node, pos, 'target')\n  }\n\n  /**\n\t * Internal methods to set either the source or target\n\t */\n\t setTerminal (node, pos, dir) {\n    var end = dir == 'source' ? this.source : this.target\n    if (end == node) {\n      // simply change the position of the edge.\n      if (node) { node.setEdgeAt(this, pos) }\n    } else {\n      if (end) {\n        // first remove the edge from the current end\n        end.removeEdge(this)\n      }\n\n      if (node) {\n        if (dir == 'source') { node.addOutEdge(this, pos) } else { node.addInEdge(this, pos) }\n      }\n      if (dir == 'source') { this.source = node } else { this.target = node }\n      // this.clearPoints();\n    }\n  }\n\n  getLabelBox (key) {\n    var label = this.prop('label')\n    if (label) { return Label.getLabelBoxForLink(label, this.viewProp(key, 'labelConfig'), this.getShape(key)) }\n    return null\n  }\n\n  /**\n\t * Return a pair of points as reference to the calculation of start and end points.\n\t */\n  getReferencePoints (key) {\n    let pts = []\n    if (this.source) { pts.push(this.source.getShape(key).center) } else { pts.push(this.viewProp(key, 'start')) }\n\n    if (this.target) { pts.push(this.target.getShape(key).center) } else { pts.push(this.viewProp(key, 'end')) }\n\n    return pts\n  }\n\n  getTerminalVisual (key, orthogonal) {\n    let refPts = this.getReferencePoints(key)\n    let terminals = []\n\n    let getBound = function (pt) {\n      return new Rectangle(pt.x, pt.y, 3, 3)\n    }\n\n    if (this.source) {\n      terminals.push(this.source.getPort(key, this.prop('sourcePort'), refPts[1], orthogonal))\n    } else { terminals.push({ point: refPts[0], direction: Rectangle.getDirection(getBound(refPts[0]), refPts[1], true) }) }\n\n    if (this.target) {\n      terminals.push(this.target.getPort(key, this.prop('targetPort'), refPts[0], orthogonal))\n    } else { terminals.push({ point: refPts[1], direction: Rectangle.getDirection(getBound(refPts[1]), refPts[0], true) }) }\n    return terminals\n  }\n\n  getShape (key) {\n    let shape = Cache.get(this.id + '.shape', key)\n    if (shape) return shape\n\n    let config = this.viewProp(key, 'shape')\n    shape = Link.getLink(this.getTerminalVisual(key, config.orthogonal), config, this.prop('startMarker'), this.prop('endMarker'))\n    Cache.set(this.id + '.shape', shape, key)\n    return shape\n  }\n\n  toString () {\n    return 'Edge:{' + (!this.source ? 'null' : this.source.id) + '--' + (!this.target ? 'null' : this.target.id) + '}'\n  }\n\n  destroy () {\n    super.destroy()\n    this.setSource(null)\n    this.setTarget(null)\n  }\n}\nEdge.namespace = 'Edges'\n\nexport default Edge\n\n/*\n\nEdge.prototype.isVisible = function() {\n\tif (this.graph.getProperty(\"allowDanglingEdges\")) {\n\t\treturn (this.source ? this.source.isVisible() : true) && (this.target ? this.target.isVisible() : true) && this.getProperty(\"visible\");\n\t} else\n\t\treturn this.source && this.target && this.getProperty('visible') && this.source.isVisible() && this.target.isVisible();\n};\n\n*/\n","import Rectangle from '../geometry/Rectangle'\n\nlet registry = {}\n\nlet Marker = (function () {\n  /** Begin Standard Marker Type **/\n  function arrow (size, source, styles) {\n    let sign = source ? -1 : 1\n    let marker = {\n      viewBox: new Rectangle(-5, -5, 10, 10),\n      size: size,\n      ref: [4 * sign, 0],\n      fill: styles.color\n    }\n    marker.shape = {\n      name: 'Polygon',\n      points: [[-2 * sign, 0], [-4 * sign, 4], [4 * sign, 0], [-4 * sign, -4]]\n    }\n    return marker\n  }\n\n  function triangle (size, source, styles) {\n    let sign = source ? -1 : 1\n    let marker = {\n      viewBox: new Rectangle(-5, -5, 10, 10),\n      size: size,\n      ref: [4 * sign, 0],\n      fill: styles.color\n    }\n    marker.shape = {\n      name: 'Polygon',\n      points: [[-5 * sign, -5], [-5 * sign, 5], [4 * sign, 0]]\n    }\n    return marker\n  }\n\n  function oval (size, source, styles) {\n    let r = size / 2\n    let marker = {\n      viewBox: new Rectangle(-r, -r, size, size),\n      size: size,\n      ref: [0, 0],\n      fill: styles.color\n    }\n    marker.shape = '<ellipse cx=\"0\" cy=\"0\" rx=\"' + r + '\" ry=\"' + r + '\"></ellipse>'\n    return marker\n  }\n\n  function diamond (size, source, styles) {\n    let sign = source ? -1 : 1\n    let marker = {\n      viewBox: new Rectangle(-5, -5, 10, 10),\n      size: size,\n      ref: [4 * sign, 0],\n      fill: styles.color\n    }\n    marker.shape = {\n      name: 'Polygon',\n      points: [[-4, 0], [0, 4], [4, 0], [0, -4]]\n    }\n    return marker\n  }\n  /** End Standard Marker Type **/\n  function getMarker (config, source) {\n    let factory = registry[config.type]\n    let marker = factory(config.size, source, config)\n    marker.id = config.id\n    return marker\n  }\n\n  registry['arrow'] = arrow\n  registry['triangle'] = triangle\n  registry['oval'] = oval\n  registry['diamond'] = diamond\n\n  return {\n    registry: registry,\n    getMarker: getMarker\n  }\n})()\n\nexport default Marker\n","import _ from 'lodash'\nimport Utils from '../util/Utils'\nimport Node from './Node'\nimport Edge from './Edge'\nimport Marker from '../view/Marker'\n\nconst nodeDefaults = {\n  name: 'Default',\n  role: 'node',\n  draggable: true,\n  selectable: true,\n  editable: true,\n  resizable: false,\n  sourceable: true,\n  targetable: true,\n  visible: true\n}\n\nconst edgeDefaults = {\n  name: 'Default',\n  role: 'edge',\n  selectable: true,\n  visible: true,\n  startMarker: null,\n  endMarker: {\n    id: 'Default_EndMarker',\n    type: 'arrow',\n    size: 10,\n    color: '#0ea117'\n  },\n  /* start and end is only used if the edge is not connected to a node */\n  start: [0, 0],\n  end: [400, 200]\n}\n\nclass Graph {\n  constructor (id = _.uniqueId('G'), config = {}, model) {\n    this.id = id\n\n    this.nodes = {}\n    this.edges = {}\n\n    this.selection = null\n    this.destroyed = false\n\n    Utils.buildTypes(config.nodeTypes, 'Nodes', nodeDefaults)\n    Utils.buildTypes(config.edgeTypes, 'Edges', edgeDefaults)\n    // check for markers.\n    this.markers = []\n    let edgeTypes = Utils.type(Edge.namespace); let marker; let markerConfig\n    edgeTypes.forEach(function (type) {\n      markerConfig = type.prototype.startMarker\n      if (markerConfig) {\n        marker = Marker.getMarker(markerConfig, true)\n        this.markers.push(marker)\n      }\n      markerConfig = type.prototype.endMarker\n      if (markerConfig) {\n        marker = Marker.getMarker(markerConfig, false)\n        this.markers.push(marker)\n      }\n    }, this)\n\n    delete config.nodeTypes\n    delete config.edgeTypes\n    Utils.initConfig(this, config)\n    this.root = null\n    if (model) { this.loadModel(model) }\n  }\n\n  static getJSClass (config, defaultClass) {\n    let jsClass = null\n    if (config && config.type) {\n      // See if we can get the js class from config.\n      let type = Utils.type(defaultClass.namespace, config.type)\n      if (type) { jsClass = type.jsClass }\n    }\n\n    return Utils.getConstructor(jsClass, defaultClass)\n  }\n\n  /**\n\t * Create a new Node\n\t * @param config\n\t * @param parent\n\t * @param pos\n\t * @returns {*}\n\t */\n  addNode (config, parent = this.currentRoot, pos) {\n    let NodeClass = Graph.getJSClass(config, Node)\n    let node = new NodeClass(this, config)\n\n    if (parent) { Graph.addChild(parent, node, pos) } else {\n      this.root = node\n      this.root.prop('role', 'root')\n    }\n\n    this.nodes[node.id] = node\n    return node\n  }\n\n  /**\n\t * Create a new Edge\n\t * @param config\n\t * @param parent\n\t * @param from\n\t * @param to\n\t * @returns {*}\n\t */\n  addEdge (config, parent = this.currentRoot, from, to) {\n    let EdgeClass = Graph.getJSClass(config, Edge)\n    let edge = new EdgeClass(this, config, from, to)\n\n    Graph.addChild(parent, edge)\n    this.edges[edge.id] = edge\n    return edge\n  }\n\n  /**\n\t * Added a new child to the parent. The parent has to be a node.\n\t * @param parent\n\t * @param child\n\t */\n  static addChild (parent, child) {\n    if (!parent.children) { parent.children = [] }\n\n    if (child.parent != parent) {\n      parent.children.push(child)\n\n      if (child.parent && child.parent.children) { child.parent.children = _.without(child.parent.children, child) }\n    }\n    child.parent = parent\n  }\n\n  loadModel (model, parent = this.currentRoot) {\n    let nodes = model.nodes\n    let edges = model.edges\n    delete model.nodes\n    delete model.edges\n\n    let node = this.addNode(model, parent)\n    if (nodes) {\n      _.forEach(nodes, (child) => {\n        this.loadModel(child, node)\n      })\n    }\n    if (edges) {\n      _.forEach(edges, (edge) => {\n        let from, to\n        if (edge.from) { from = this.nodes[edge.from] }\n        if (edge.to) { to = this.nodes[edge.to] }\n        this.addEdge(edge, node, from, to)\n      })\n    }\n  }\n\n  get currentRoot () {\n    return this.root\n  }\n\n  reset () {}\n  destroy () {}\n}\n\nGraph.DEFAULTS = {\n  allowDanglingEdges: true,\n  multiConnect: false,\n  readOnly: false,\n  viewOnly: false\n}\n\nexport default Graph\n","import _ from 'lodash'\nimport Utils from '../util/Utils'\n\nclass Layout {\n  constructor (config = {}) {\n    if (config.hasOwnProperty('orientation') && _.isString(config.orientation)) {\n      if (config.orientation.toUpperCase() == 'HORIZONTAL') { config.orientation = Layout.HORIZONTAL } else { delete config.orientation }\n    }\n    Utils.initConfig(this, config)\n  }\n\n  layout (root, bounds) {}\n  reset () {}\n  destroy () {}\n}\nLayout.VERTICAL = 0\nLayout.HORIZONTAL = 1\n\nLayout.DEFAULTS = {\n  orientation: Layout.VERTICAL\n}\n\nexport default Layout\n","import Layout from './Layout'\n\nclass FlowLayout extends Layout {\n  layout (root, bounds) {\n    var items\n    if (!root) { items = this.owner.childNodes } else if (_.isArray(root)) { items = root } else { items = root.getLinkedNodes('target') }\n    if (!items || items.length == 0) return\n\n    var x = 0; var y = 0; var h = 0; var node\n    var p1 = 0; var p2 = 0\n    for (var i = 0; i < items.length; i++) {\n      node = items[i]\n      if (x > 0 && x + this.hgap + node.getProperty('width') > bounds.width) {\n        // create new line\n        y += h + this.vgap\n        x = 0; h = 0; p1 = 0; p2++\n      }\n      node._flPos = [p1, p2]\n      node.moveTo([bounds.x + x, bounds.y + y])\n      x += this.hgap + node.getProperty('width')\n      p1++\n      h = h < node.getProperty('height') ? node.getProperty('height') : h\n    }\n    this.trigger(new Rectangle(bounds.x, bounds.y, bounds.width, y + h))\n  }\n}\n\nFlowLayout.DEFAULTS = {\n  hgap: 10,\n  vgap: 10\n}\n\nexport default FlowLayout\n","export default class Behavior {\n  constructor (renderer) {\n    this.renderer = renderer\n  }\n\n  destroy () {\n    delete this.renderer\n  }\n}\n","/**\n * Created by tong on 6/28/2016.\n */\nimport Behavior from './Behavior'\n\n/**\n * Graph handler handles Panning and Zoom and rubber band selection\n */\nclass GraphBehavior extends Behavior {\n  constructor (renderer) {\n    super(renderer)\n    let dispatcher = renderer.dispatcher\n    // TODO:\n    // let f = function(type, ns, graph, pos, event) {\n    // \t//Cursor.updateCursor(type, ns, graph, event);\n    // };\n    dispatcher.register(/^drag.*\\.graph$/, this.handleDrag, this)\n    dispatcher.register(/^zoom/, this.handleZoom, this)\n    // dispatcher.register(['mousedown.graph', 'mouseenter.graph', 'mouseleave.graph'], f);\n    this.offset = null\n  }\n\n  handleZoom (type, ns, graph, pos, event) {\n    this.renderer.transform(null, null, event.scale)\n  }\n\n  handleDrag (type, ns, graph, pos, event) {\n    if (type == 'dragstart') {\n      let pan = (this.renderer.prop('defaultClickMode') == 'pan') ^ (event.ctrlKey || event.shiftKey)\n      if (!pan) return\n      let t = this.renderer.translate\n      this.offset = [t[0] - pos[0], t[1] - pos[1]]\n      return\n    }\n    if (!this.offset) return\n    this.renderer.transform(pos[0] + this.offset[0], pos[1] + this.offset[1])\n    if (type == 'dragend') {\n      // Cursor.updateCursor('mouseup', ns, graph, event);\n      delete this.offset\n    }\n  }\n}\n\nexport default GraphBehavior\n","import Rectangle from '../geometry/Rectangle'\nimport Cell from '../graph/Cell'\nimport Behavior from './Behavior'\n\nclass SelectionBehavior extends Behavior {\n  constructor (renderer) {\n    super(renderer)\n    let dispatcher = renderer.dispatcher\n    dispatcher.register('mousedown.*', this.selectCell, this)\n    dispatcher.register('mouseup.*', this.unselectCell, this)\n    dispatcher.register('drag*.graph', this.handleMultiSelect, this)\n    // graph.on(Graph.EVENT_TYPES.SELECTION_CHANGE, this.updateSelections, this)\n    this.selectedNodes = null\n    this.selectedLinks = null\n    this.attachedLinks = null\n  }\n\n  updateSelections () {\n    if (this.selectedNodes) {\n      this.selectedNodes.classed('selected', false)\n    }\n    if (this.selectedLinks) {\n      this.selectedLinks.classed('selected', false)\n    }\n\n    this.selectedNodes = null\n    this.selectedLinks = null\n    this.attachedLinks = null\n\n    if (this.graph.selectedVertices && this.graph.selectedVertices.length > 0) {\n      this.selectedNodes = this.graph.renderer.getShapes(this.graph.selectedVertices)\n      this.attachedLinks = this.graph.renderer.getShapes(this.graph.getAttachedEdges())\n      this.selectedNodes.classed('selected', true)\n    }\n\n    if (this.graph.selectedEdges && this.graph.selectedEdges.length > 0) {\n      this.selectedLinks = this.graph.renderer.getShapes(this.graph.selectedEdges)\n      this.selectedLinks.classed('selected', true)\n    }\n  }\n\n  selectCell (type, ns, data, pos, event) {\n    var cell = data === this.graph ? null : data\n    if (cell && !(cell instanceof Cell)) return\n    var toggle = event.ctrlKey || event.shiftKey\n    if (cell && (cell instanceof Cell)) {\n      if (!this.graph.isSelected(cell)) {\n        delete cell._firstSelection\n      } else {\n        cell._firstSelection = true\n      }\n\n      d3.select(event.dataTarget).moveToFront()\n      this.graph.setSelection(cell, toggle)\n    }\n  }\n\n  unselectCell (type, ns, data, pos, event) {\n    var cell = data === this.graph ? null : data\n    if (cell && !(cell instanceof Cell)) return\n    var ctrlKey = event.ctrlKey || event.shiftKey\n    if (!cell) {\n      this.graph.setSelection(cell, ctrlKey)\n    }\n  }\n\n  handleMultiSelect (type, ns, data, pos, event) {\n    pos = util.scale(this.graph, pos)\n\n    if (type === 'dragstart') {\n      var select = (this.graph.getProperty('defaultClickMode') == 'select') ^ (event.ctrlKey || event.shiftKey)\n      if (!select) return\n      this.startPt = new Point(pos[0], pos[1])\n      return\n    }\n    if (!this.startPt) return\n    var rect = Rectangle.getBoundingRectangle([new Point(pos[0], pos[1]), this.startPt])\n    var renderer = this.graph.renderer\n    if (!this.rubberband) {\n      this.rubberband = d3.select(renderer.appendNode(renderer.getCellLayer(), {\n        template: _.template('<g><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" stroke=\"#000000\" fill=\"none\" stroke-dasharray=\"3 3\"/></g>')\n      }, false))\n    }\n    if (type == 'dragend') {\n      var cells = this.graph.getCurrentRoot().children\n      // TODO: Define if we want to select vertexes / edges or both\n      cells = _.filter(cells, function (cell) {\n        var box = cell.getBounds()\n        if (rect.contains(box)) {\n          return true\n        }\n        return false\n      })\n      // TODO: Set selection\n      this.graph.setSelection(cells, event.ctrlKey)\n\n      this.rubberband.remove()\n      delete this.startPt\n      delete this.rubberband\n      return\n    }\n    this.rubberband.select('rect').attr({ x: rect.x, y: rect.y, width: rect.width, height: rect.height })\n  }\n\n  destroy () {\n    super.destroy()\n    delete this.selectedNodes\n    delete this.selectedLinks\n    delete this.attachedLinks\n  }\n}\n\nexport default SelectionBehavior\n","import _ from 'lodash'\nimport Events from '../../lib/bean'\nimport Utils from '../util/Utils'\nimport DomUtils from '../util/dom-utils'\nimport Layout from '../layout/Layout'\nimport Rectangle from '../geometry/Rectangle'\nimport EventDispatcher from '../event/event-dispatcher'\nimport GraphBehavior from '../behavior/GraphBehavior'\nimport SelectionBehavior from '../behavior/SelectionBehavior'\nimport Label from './Label'\n\nclass Renderer {\n  constructor (id, container, config = {}, graph = null) {\n    this.id = id\n    this.box = DomUtils.createElement('div', { id: this.id, tabindex: 0, ns: 'graph' }, { overflow: 'hidden', width: '100%', height: '100%', position: 'relative' })\n    container.appendChild(this.box)\n    if (config.layout) {\n      let LayoutClass = Utils.getConstructor(config.layout.jsClass, Layout)\n      this.layout = new LayoutClass(config.layout.config)\n      delete config.layout\n    }\n    this.clear = true\n    this._translate = [0, 0]\n    this._scale = 1.0\n    this.graph = graph\n    this.dispatcher = null\n    this.graphBehavior = null\n    this.selectionBehavior = null\n    this.nodeBehavior = null\n    this.edgeBehavior = null\n    this.connectionBehavior = null\n    Utils.initConfig(this, config)\n\n    Events.on(Label.editor, 'editor.update.*', (key, value) => {\n      // this.graph.nodes[key].prop('label', value);\n      // this.render();\n      console.log(key + '=' + value)\n    })\n  }\n\n  get graph () {\n    return this._graph\n  }\n\n  set graph (graph) {\n    this._graph = graph\n    let root = graph.currentRoot\n    if (root) {\n      this._translate = [root.viewProp(this.id, 'x') || 0, root.viewProp(this.id, 'y') || 0]\n      this._scale = root.viewProp(this.id, 'scale') || 1.0\n    }\n  }\n\n  viewport (scaled, viewport) {\n    if (_.isUndefined(scaled) || _.isNull(scaled)) scaled = false\n    if (!viewport) {\n      let vp = new Rectangle(0, 0, this.box.offsetWidth, this.box.offsetHeight)\n      if (scaled) { return Utils.scale(this.translate, this.scale, vp) }\n      return vp\n    }\n    if (!scaled) viewport = Utils.scale(this.translate, this.scale, viewport)\n    let w = this.box.offsetWidth\n    let scale = w / viewport.width\n    this.transform(-viewport.x * scale, -viewport.y * scale, scale)\n  }\n\n  get translate () { return this._translate }\n  set translate (t) { this.transform(t[0], t[1]) }\n  get scale () { return this._scale }\n  set scale (k) {\n    switch (k) {\n      case 'in':\n        k = this.scale * this.prop('zoomFactor')\n        break\n      case 'out':\n        k = this.scale / this.prop('zoomFactor')\n        break\n      case 'actual':\n        k = 1.0\n        break\n      case 'fit':\n        let gridSize = this.prop('gridSize') * 2\n\n        let gBounds = this.getBounds()\n        let vBounds = this.viewport()\n\n        vBounds.width -= gridSize\n        vBounds.height -= gridSize\n\n        /* Do not zoom more than actual if graph already fits into the bounds */\n        k = Math.min((vBounds.width / gBounds.width), (vBounds.height / gBounds.height), 1.0)\n\n        // TODO: Add centering code here or trigger an event for that\n        break\n      default:\n        if (_.isString(k)) k = parseFloat(k)\n        break\n    }\n    this.transform(null, null, k)\n  }\n\n  transform (x = null, y = null, scale = null) {\n    let graph = this.graph\n    let root = graph ? graph.currentRoot : null\n    if (!_.isNull(x)) {\n      this._translate[0] = x\n      if (root) { root.viewProp(this.id, 'x', x) }\n    }\n    if (!_.isNull(y)) {\n      this._translate[1] = y\n      if (root) { root.viewProp(this.id, 'y', y) }\n    }\n    if (!_.isNull(scale)) {\n      this._scale = scale\n      if (root) { root.viewProp(this.id, 'scale', scale) }\n      // sync the scale between the dispatcher and the graph\n      let s = this.dispatcher.scale\n      if (s !== scale) { this.dispatcher.scale = scale }\n    }\n    this.refresh()\n  }\n\n  render () {\n    if (!this._graph) return false\n    if (this.layout) { this.layout.layout(this._graph.currentRoot, this.viewport()) }\n\n    this.initializeBehaviors()\n    return true\n  }\n\n  renderLabel (box) {\n    return this.constructor.renderLabel(box)\n  }\n\n  renderLink (shape) {\n    return this.constructor.renderLink(shape)\n  }\n\n  renderMarkers (markers) {\n    return this.constructor.renderMarkers(markers)\n  }\n\n  initializeBehaviors () {\n    // create the event dispatcher if necessary.\n    if (!this.dispatcher) {\n      this.dispatcher = new EventDispatcher(this.box, [this.prop('minZoom'), this.prop('maxZoom')])\n      let JsClass\n      if (this.prop('graphBehavior')) {\n        JsClass = Utils.getConstructor(this.prop('graphBehavior'))\n        this.graphBehavior = new JsClass(this)\n      }\n      if (this.prop('selectionBehavior')) {\n        JsClass = Utils.getConstructor(this.prop('selectionBehavior'))\n        this.selectionBehavior = new JsClass(this)\n      }\n      this.dispatcher.register('mouseup.node.label', function (type, ns, target, pos, event) {\n        let node = this._graph.nodes[target.getAttribute('id')]\n        if (!this.dispatcher.dragging && !node._firstSelection) {\n          Label._delayEdit = _.delay(() => {\n            if (Label._delayEdit) {\n              delete Label._delayEdit\n              Label.editor.start(node.id, this.box, node.getLabelBox(this.id), target, event.nsTarget, this.scale)\n            }\n          }, 250)\n        }\n      }, this)\n      this.dispatcher.register([/^mousedown/, /^zoom/], function (type, ns, target, pos, event) {\n        if (!DomUtils.eventFromInput(event)) {\n          Label.editor.stop()\n        }\n      }, this)\n    }\n    this.dispatcher.start()\n  }\n\n  refresh () {}\n\n  /**\n   * Get the template for the specified key.\n   * @param key\n   * @param config if the template is a function, this config will be passed as the argument.\n   * @param preprocessor if the template contains preprossing elements, such as #{shape}, the preprocessor will be\n   * used to render them.\n   * @returns {*}\n   */\n  getTemplate (key, config, preprocessor) {\n    let t = this.constructor.TEMPLATES[key]\n    if (t && _.isFunction(t)) {\n      t = t(config)\n    }\n    // check if there are any preprocessing tags.\n    if (preprocessor) {\n      let parts = t.match(/(#{[^#]*})/g)\n      let obj = {}\n      for (let part in parts) {\n        part = parts[part]\n        part = part.substring(2, part.length - 1).trim()\n        obj[part] = preprocessor[_.camelCase('render ' + part)](this)\n      }\n      t = _.template(t, { interpolate: /#{([\\s\\S]+?)}/g })(obj)\n    }\n    return t\n  }\n\n  reset () {}\n\n  destroy () {\n    delete this._graph\n    delete this.layout\n    if (this.dispatcher) {\n      this.dispatcher.stop()\n      delete this.dispatcher\n    }\n    this.box.innerHTML = ''\n  }\n}\nRenderer.DEFAULTS = {\n  defaultClickMode: 'pan',\n  hideOutline: false,\n  singleSelect: true,\n  draggable: true,\n  gridEnabled: false,\n  guidesEnabled: true,\n  gridSize: 30,\n  maxZoom: 4.0,\n  minZoom: 0.2,\n  zoomFactor: 1.2,\n  maskOpacity: 0.5,\n  graphBehavior: GraphBehavior,\n  selectionBehavior: SelectionBehavior\n}\n\nexport default Renderer\n","import _ from 'lodash'\nimport Base64 from '../util/base64'\nimport DomUtils from '../util/dom-utils'\nimport Renderer from './Renderer'\nimport StringBuffer from '../util/string-buffer'\n\nconst NS = 'http://www.w3.org/2000/svg'\nif (typeof (SVGElement) !== 'undefined') {\n  var svg = document.createElementNS(NS, 'svg')\n  svg.innerHTML = '<circle/>'\n  if (svg.firstChild !== '[object SVGCircleElement]') {\n    Object.defineProperties(SVGElement.prototype, {\n      'outerHTML': {\n        enumerable: false,\n        configurable: true,\n        get: function () {\n          var $node, $temp\n          $temp = document.createElement('div')\n          $node = this.cloneNode(true)\n          $temp.appendChild($node)\n          return $temp.innerHTML\n        }\n      },\n      'innerHTML': {\n        enumerable: false,\n        configurable: true,\n        get: function () {\n          var s = this.outerHTML\n          var ropen = new RegExp('<' + this.nodeName + '\\\\b(?:([\"\\'])[^\"]*?(\\\\1)|[^>])*>', 'i')\n          var rclose = new RegExp('</' + this.nodeName + '>$', 'i')\n          return s.replace(ropen, '').replace(rclose, '')\n        },\n        set: function (markup) {\n          // empty el first.\n          let child\n          while ((child = this.lastChild) !== null) { this.removeChild(child) }\n          let buf = new StringBuffer()\n          buf.append('<svg>').append(markup).append('</svg')\n          let $temp = DomUtils.createElement('div', null, null, buf.toString()).firstElementChild\n          while ($temp.firstChild) { this.appendChild($temp.firstChild) }\n        }\n      }\n    })\n  }\n  // Define the toDataURL for SVG\n  SVGElement.prototype.toDataURL = function (type, options = {}) {\n    let _svg = this\n\n    let debug = function (msg) {}\n\n    if (options['debug'] === true && typeof (console) !== 'undefined') { debug = function (msg) { console.log('SVG.toDataURL:', msg) } }\n\n    function exportSVG () {\n      var svgXml = _svg.outerHTML\n      var svgDataurl = base64dataURLencode(svgXml)\n      debug(type + ' length: ' + svgDataurl.length)\n\n      // NOTE double data carrier\n      if (options.callback) options.callback(svgDataurl)\n      return svgDataurl\n    }\n\n    function base64dataURLencode (s) {\n      var b64 = 'data:image/svg+xml;base64,'\n\n      // https://developer.mozilla.org/en/DOM/window.btoa\n      if (window && window.btoa) {\n        debug('using window.btoa for base64 encoding')\n        b64 += btoa(s)\n      } else {\n        debug('using custom base64 encoder')\n        b64 += Base64.encode(s)\n      }\n\n      return b64\n    }\n\n    // Native export doesn't work very well. should use canvg instead.\n    function exportImage (type) {\n      var canvas = document.createElement('canvas')\n      var ctx = canvas.getContext('2d')\n\n      // TODO: if (options.keepOutsideViewport), do some translation magic?\n\n      var svgImg = new Image()\n      var svgXml = _svg.outerHTML\n      svgImg.src = base64dataURLencode(svgXml)\n\n      svgImg.onload = function () {\n        debug('exported image size: ' + [svgImg.width, svgImg.height])\n        canvas.width = svgImg.width\n        canvas.height = svgImg.height\n        ctx.drawImage(svgImg, 0, 0)\n\n        // SECURITY_ERR WILL HAPPEN NOW\n        var imageDataurl = canvas.toDataURL(type)\n        debug(type + ' length: ' + imageDataurl.length)\n\n        if (options.callback) options.callback(imageDataurl)\n        else debug('WARNING: no callback set, so nothing happens.')\n      }\n\n      svgImg.onerror = function () {\n        debug(\n          \"Can't export! Maybe your browser doesn't support \" +\n          'SVG in img element or SVG input for Canvas drawImage?\\n' +\n          'http://en.wikipedia.org/wiki/SVG#Native_support'\n        )\n      }\n\n      // NOTE: will not return anything\n    }\n\n    function exportImageCanvg (type) {\n      if (typeof canvg === 'undefined') return null\n      let canvas = DomUtils.createElement('canvas', null, { display: 'none' })\n      document.body.appendChild(canvas)\n      if (type === 'javascript' && typeof jsCanvas !== 'undefined') {\n        var xcanvas = new jsCanvas('jscanvastest') // eslint-disable-line new-cap\n        xcanvas.canvas.style.display = 'none'\n        // xcanvas.canvas = canvas;\n      }\n\n      if (!options.keepOutsideViewport) {\n        canvg(canvas, _svg.outerHTML)\n      } else {\n        let padding = options.padding || 0\n        let scale = 1.0\n        let translate = [0, 0]\n        let bbox = _svg.getBBox()\n        debug('detected svg dimensions ' + [bbox.x, bbox.y, bbox.width, bbox.height])\n        let transform = _svg.firstElementChild.getAttribute('transform')\n        if (transform) {\n          debug('detected svg transform ' + transform)\n          transform = SVGRenderer.transform(transform)\n          translate = transform.translate\n          scale = transform.scale\n        }\n        let buf = new StringBuffer()\n        buf.append('<svg width=\"').append(bbox.width + 2 * padding).append('px\" height=\"').append(bbox.height + 2 * padding).append('px\"><g transform=\"translate(')\n          .append(-bbox.x + translate[0] + padding).append(',').append(-bbox.y + translate[1] + padding).append(')scale(').append(scale).append(')\">')\n          .append(_svg.firstElementChild.innerHTML).append('</g></svg>')\n        if (type === 'javascript') {\n          xcanvas.compile(buf.toString(), function () {\n            if (options.callback) options.callback(xcanvas.toString())\n          })\n          return\n        } else { canvg(canvas, buf.toString()) }\n      }\n      var imageDataurl = canvas.toDataURL(type)\n      if (options.callback) options.callback(imageDataurl)\n      canvas.parentNode.removeChild(canvas)\n      return imageDataurl\n    }\n\n    if (!type) type = 'image/svg+xml'\n\n    if (options.keepNonSafe) debug('NOTE: keepNonSafe is NOT supported and will be ignored!')\n    if (options.keepOutsideViewport) debug('NOTE: keepOutsideViewport is only supported with canvg exporter.')\n\n    switch (type) {\n      case 'image/svg+xml':\n        return exportSVG()\n      case 'image/png':\n      case 'image/jpeg':\n      case 'javascript':\n        if (!options.renderer) {\n          if (window && window.canvg) options.renderer = 'canvg'\n          else options.renderer = 'native'\n        }\n        switch (options.renderer) {\n          case 'canvg':\n            debug('using canvg renderer for ' + type + ' image export')\n            return exportImageCanvg(type)\n          case 'native':\n            debug('using native renderer for ' + type + ' export. THIS MIGHT FAIL.')\n            return exportImage(type)\n          default:\n            debug('unknown image renderer given, doing noting (' + options.renderer + ')')\n        }\n        break\n      default:\n        debug(\"Sorry! Exporting as '\" + type + \"' is not supported!\")\n    }\n    return null\n  }\n}\n\nclass SVGRenderer extends Renderer {\n  render () {\n    let result = super.render()\n    if (result) {\n      let root = this.graph.currentRoot\n      let buf = new StringBuffer('<svg width=\"100%\" height=\"100%\" xmlns=\"http://www.w3.org/2000/svg\">')\n      let t = this.translate\n      buf.append('<g transform=\"translate(').append(t[0]).append(',').append(t[1]).append(')scale(').append(this.scale).append(')\">')\n      buf.append(this.renderDefs())\n      buf.append(root.render(this))\n      buf.append('</g></svg>')\n      this.box.innerHTML = buf.toString()\n      this.svg = this.box.firstElementChild\n    }\n  }\n\n  renderDefs () {\n    let buf = new StringBuffer('<defs>')\n    buf.append(this.getTemplate('Grid', this.prop('gridSize')))\n    let markers = this.graph.markers\n    if (markers.length > 0) { buf.append(SVGRenderer.renderMarkers(markers)) }\n    buf.append('</defs>')\n    return buf.toString()\n  }\n\n  refresh () {\n    if (!this.svg) return\n    let g = this.svg.querySelector('g')\n    let t = this.translate\n    g.setAttribute('transform', 'translate(' + t[0] + ',' + t[1] + ')scale(' + this.scale + ')')\n  }\n\n  static renderMarkers (markers) {\n    let buf = new StringBuffer(); let str1; let str2\n    markers.forEach(function (marker) {\n      str1 = this.TEMPLATES['Marker'](marker)\n      str2 = marker.shape\n      if (!_.isString(str2)) { str2 = this.renderShape(str2) }\n      str1 = str1.replace(/#\\{shape\\}/, str2)\n      buf.append(str1)\n    }, this)\n    return buf.toString()\n  }\n\n  static renderLabel (box) {\n    return this.TEMPLATES['Label'](box)\n  }\n\n  static renderShape (shape) {\n    let template = this.TEMPLATES[shape.name]\n    if (_.isString(template)) { template = _.template(template) }\n    return template(shape)\n  }\n\n  static getPathData (shape) {\n    let points = shape.points\n    let controlPts = shape.controlPts\n    if (!points || points.length === 0) return ''\n\n    if (!controlPts && shape.round) {\n      // render rounded line joins.\n      let newPts = []\n      controlPts = []\n      let prev = points[0]; let next; let d1; let d2; let corner\n      newPts.push(prev)\n      for (let i = 1; i < points.length - 1; i++) {\n        next = points[i]\n        // set the control point first.\n        controlPts[2 * i] = [next, next]\n        // check the size of the corner.\n        d1 = prev.distance(next)\n        d2 = next.distance(points[i + 1])\n        corner = Math.min(shape.round, d1 / 2, d2 / 2)\n        // split the point into two.\n        newPts.push(next.getDirection(prev).scale(corner).translate(next))\n        newPts.push(next.getDirection(points[i + 1]).scale(corner).translate(next))\n        prev = next\n      }\n      newPts.push(points[points.length - 1])\n      points = newPts\n    }\n    let buf = new StringBuffer('M'); let point\n    for (let i = 0; i < points.length; i++) {\n      point = points[i]\n      if (i === 0) { buf.append(point) } else {\n        if (controlPts && controlPts[i]) {\n          buf.append(' C ')\n          for (let j = 0; j < controlPts[i].length; j++) { buf.append(controlPts[i][j]).append(' ') }\n          buf.append(point)\n        } else { buf.append(' L ').append(point) }\n      }\n    }\n    return buf.toString()\n  }\n\n  static renderLink (shape) {\n    let buf = new StringBuffer()\n    let d = SVGRenderer.getPathData(shape)\n    if (shape.showGauge) {\n      buf.append('<path style=\"stroke: white; stroke-width: 9; visibility: hidden; pointer-events: stroke;\" d=\"')\n        .append(d).append('\"/>')\n    }\n    buf.append('<path d=\"').append(d).append('\"')\n    if (shape.startMarker || shape.endMarker) {\n      buf.append(' style=\"')\n      if (shape.startMarker) { buf.append('marker-start: url(#').append(_.isString(shape.startMarker) ? shape.startMarker : shape.startMarker.id).append(');') }\n      if (shape.endMarker) { buf.append('marker-end: url(#').append(_.isString(shape.endMarker) ? shape.endMarker : shape.endMarker.id).append(');') }\n      buf.append('\"')\n    }\n    buf.append('/>')\n    return buf.toString()\n  }\n\n  static appendContent (el, content) {\n    let buf = new StringBuffer()\n    buf.append('<svg>').append(content).append('</svg')\n    let temp = DomUtils.createElement('div', null, null, buf.toString()).firstElementChild\n\n    while (temp.firstChild) { el.appendChild(temp.firstChild) }\n    return el\n  }\n\n  static transform (transform) {\n    let translate = [0, 0]; let scale = 1.0\n    //\n    let parts = transform.match(/translate\\(\\s*([^)]+)/)\n    if (parts) {\n      let m = parts[1].trim().match(/([\\d.-]+)[ ,]([\\d.-]+)/)\n      if (m) {\n        translate[0] = parseFloat(m[1]) || 0\n        translate[1] = parseFloat(m[2]) || 0\n      } else { translate[0] = translate[1] = parseFloat(parts[1]) }\n    }\n    parts = transform.match(/scale\\(\\s*([^)]+)/)\n    if (parts) { scale = parseFloat(parts[1]) || 1.0 }\n\n    return { translate, scale }\n  }\n}\n/* eslint-disable no-template-curly-in-string */\nSVGRenderer.TEMPLATES = {\n  $root: '<g id=\"${id}\" class=\"${className}\">#{children}</g>',\n  $node: '<g id=\"${id}\" class=\"${className}\" style=\"${style}\" ns=\"${namespace}\" transform=\"translate(${x},${y})\">#{shape}#{label}</g>',\n  $edge: '<g id=\"${id}\" class=\"${className}\" style=\"${style}\" ns=\"${namespace}\">#{shape}#{label}</g>',\n  Ellipse: '<ellipse cx=\"0\" cy=\"0\" rx=\"${width/2}\" ry=\"${height/2}\"/>',\n  Rectangle: '<rect x=\"${-width/2}\" y=\"${-height/2}\" width=\"${width}\" height=\"${height}\" rx=\"9\" ry=\"9\"/>',\n  Triangle: '<polygon points=\"${-width/2},${-height/2} ${width/2},${-height/2} 0,${height/2}\"/>',\n  Rhombus: '<polygon points=\"0,${-height/2} ${width/2},0 0,${height/2} ${-width/2},0\"/>',\n  Hexagon: function (config) {\n    var vertical = config.direction === 'north' || config.direction === 'south'\n    if (vertical) { return '<polygon points=\"0,${-height/2} ${width/2},${-height/4} ${width/2},${height/4} 0,${height/2} ${-width/2},${height/4} ${-width/2},${-height/4}\"/>' } else { return '<polygon points=\"${-width/2},0 ${width/4},${-height/2} ${width/4},${-height/2} ${width/2},0 ${width/4},${height/2} ${-width/4},${height/2}\"/>' }\n  },\n  Polygon: function (shape) {\n    let buf = new StringBuffer('<polygon points=\"')\n    shape.points.forEach(function (pt) {\n      buf.append(pt[0]).append(',').append(pt[1]).append(' ')\n    })\n    buf.removeLast()\n    buf.append('\"/>')\n    return buf.toString()\n  },\n  Image: function (config) {\n    return '<image x=\"${-width/2}\" y=\"${-height/2}\" width=\"${width}\" height=\"${height}\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"' + config.image + '\"/>'\n  },\n  Marker: function (marker) {\n    return `\n<marker id=\"${marker.id}\" markerWidth=\"${marker.size}\" markerHeight=\"${marker.size}\" refx=\"${marker.ref[0]}\"\nrefy=\"${marker.ref[1]}\" orient=\"auto\" viewbox=\"${marker.viewBox.x} ${marker.viewBox.y} ${marker.viewBox.width} ${marker.viewBox.height}\"\nmarkerUnits=\"userSpaceOnUse\" ${marker.fill ? `style=\"stroke: ${marker.fill};fill:${marker.fill}\"` : ''}>#{shape}</marker>\n`.trim()\n  },\n  Grid: function (size) {\n    return `\n<pattern id=\"GridPattern\" width=\"${size}\" height=\"${size}\" patternUnits=\"userSpaceOnUse\">\n  <ellipse cx=\"0\" cy=\"0\" rx=\"1\" ry=\"1\" fill=\"#999999\"/>\n  <ellipse cx=\"0\" cy=\"${size}\" rx=\"1\" ry=\"1\" fill=\"#999999\"/>\n  <ellipse cx=\"${size}\" cy=\"0\" rx=\"1\" ry=\"1\" fill=\"#999999\"/>\n  <ellipse cx=\"${size}\" cy=\"${size}\" rx=\"1\" ry=\"1\" fill=\"#999999\"/>\n</pattern>`.trim()\n  },\n  Label: _.template(`\n<% var box = _.has(data, \"dx\") ? data : (data.getLabelBox ? data.getLabelBox() : null);\n   if (box) {%>\n  <g <% if (box.config && box.config.class) {%>class=\"<%=box.config.class%>\"<%}%>\\\n    <% if (box.config && box.config.ns) {%>ns=\"<%=box.config.ns%>\"<%}%>\\\n    <% if (box.config && box.config.inlineStyle) {%>\\\n      font-size=\"<%=box.config.fontSize%>\"\\\n      font-family=\"<%=box.config.fontFamily%>\"\\\n      font-weight=\"<% if (box.bold) {%>bold<%} else {%>normal<%}%>\"\\\n      <% if (box.underline) {%>text-decoration=\"underline\"<%}%>\\\n      <% if (box.italic) {%>font-style=\"italic\"<%}%>\\\n    <%}%>\\\n    text-anchor=\"<%=box.anchor%>\"\\\n    transform=\"translate(<%=box.bounds.x%>,<%=box.bounds.y%>)<% if (box.config && box.config.rotation) {%>rotate(<%=box.config.rotation%> <%=box.pivot[0]%> <%=box.pivot[1]%>)<%}%>\">\n  <% if (box.config.backgroundStyle) {%>\n    <rect x=\"<%=-box.bounds.width/2%>\" y=\"<%=-box.bounds.height/2%>\" width=\"<%=box.bounds.width%>\" height=\"<%=box.bounds.height%>\" style=\"<%=box.config.backgroundStyle%>\"/>\n  <% } if (_.isArray(box.label)) {\n    _.each(box.label, function(value, line) {%>\n      <text <% if (box.config && box.config.textStyle) {%>style=\"<%=box.config.textStyle%>\"<%}%>\\\n        dx=\"<%=box.dx%>\" dy=\"<%=box.dy + box.lineHeight * line%>\"><%=value%></text>\n    <%});} else { %>\n      <text><%=box.label%></text>\n    <%}%>\n    <% if (box.config.title) {%>\n      <title><%=box.config.title%></title>\n    <%}%>\n  </g>\n<%}%>\n`.trim(), { variable: 'data' }) // TODO add more inline text styles.\n}\n\nexport default SVGRenderer\n","import Base64 from './util/base64'\nimport Cache from './util/Cache'\nimport Utils from './util/Utils'\nimport DomUtils from './util/dom-utils'\nimport StringBuffer from './util/string-buffer'\nimport Point from './geometry/Point'\nimport Line from './geometry/Line'\nimport Shape from './geometry/Shape'\nimport Rectangle from './geometry/Rectangle'\nimport Ellipse from './geometry/Ellipse'\nimport Rhombus from './geometry/Rhombus'\nimport Link from './geometry/Link'\nimport EventDispatcher from './event/event-dispatcher'\nimport Graph from './graph/Graph'\nimport Cell from './graph/Cell'\nimport Node from './graph/Node'\nimport Edge from './graph/Edge'\nimport Layout from './layout/Layout'\nimport FlowLayout from './layout/FlowLayout'\nimport Label from './view/Label'\nimport Marker from './view/Marker'\nimport Renderer from './view/Renderer'\nimport SVGRenderer from './view/SVGRenderer'\nimport GraphBehavior from './behavior/GraphBehavior'\n// import SelectionBehavior from './behavior/SelectionBehavior'\n\nShape.addShape('Rectangle', Rectangle)\nShape.addShape('Ellipse', Ellipse)\nShape.addShape('Rhombus', Rhombus)\n\nexport default {\n  Base64,\n  Cache,\n  Utils,\n  DomUtils,\n  StringBuffer,\n  Point,\n  Line,\n  Shape,\n  Rectangle,\n  Ellipse,\n  Link,\n  EventDispatcher,\n  Label,\n  Marker,\n  Graph,\n  Cell,\n  Node,\n  Edge,\n  Layout,\n  FlowLayout,\n  Renderer,\n  SVGRenderer,\n  GraphBehavior\n  // SelectionBehavior\n}\n"],"sourceRoot":""}