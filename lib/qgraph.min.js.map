{"version":3,"sources":["webpack://qgraph/webpack/universalModuleDefinition","webpack://qgraph/webpack/bootstrap","webpack://qgraph/./src/geometry/Point.js","webpack://qgraph/external {\"root\":\"_\",\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"lodash\"}","webpack://qgraph/./src/geometry/Rectangle.js","webpack://qgraph/./src/util/Utils.js","webpack://qgraph/./lib/bean.js","webpack://qgraph/./src/geometry/Shape.js","webpack://qgraph/./src/util/base64.js","webpack://qgraph/./src/util/Cache.js","webpack://qgraph/./src/util/dom-utils.js","webpack://qgraph/./src/util/string-buffer.js","webpack://qgraph/./src/geometry/Line.js","webpack://qgraph/./src/geometry/Ellipse.js","webpack://qgraph/./src/geometry/Rhombus.js","webpack://qgraph/./src/geometry/Link.js","webpack://qgraph/./src/event/key-utils.js","webpack://qgraph/./src/event/event-dispatcher.js","webpack://qgraph/./src/view/Label.js","webpack://qgraph/./src/graph/Cell.js","webpack://qgraph/./src/graph/Node.js","webpack://qgraph/./src/graph/Edge.js","webpack://qgraph/./src/view/Marker.js","webpack://qgraph/./src/graph/Graph.js","webpack://qgraph/./src/layout/Layout.js","webpack://qgraph/./src/layout/FlowLayout.js","webpack://qgraph/./src/behavior/Behavior.js","webpack://qgraph/./src/behavior/GraphBehavior.js","webpack://qgraph/./src/behavior/SelectionBehavior.js","webpack://qgraph/./src/view/Renderer.js","webpack://qgraph/./src/view/SVGRenderer.js","webpack://qgraph/./src/index.js"],"names":["root","factory","exports","module","require","define","amd","window","this","__WEBPACK_EXTERNAL_MODULE__1__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Point","x","y","_classCallCheck","aPt","Math","sqrt","p2","scale","dist","distance","angle","cos","PI","sin","clone","rotate","rect","vertical","W","N","S","E","NE","NW","SE","SW","Rectangle","Shape","pt","orthogonal","arguments","length","undefined","dx","dy","alpha","atan2","pi","beta","height","width","left","tan","top","right","bottom","point","direction","getDirection","pts","margin","_","isArray","min","max","w","abs","h","rects","minx","miny","maxx","Infinity","maxy","each","el","contains","pt1","pt2","horizontal","contains1","contains2","outPt","_debugging","_debugAll","typeRegistry","splice","Array","__webpack_exports__","type","namespace","Map","set","createType","props","defaultType","extend","extends","_extend","_possibleConstructorReturn","_getPrototypeOf","apply","_inherits","config","assign","typeName","log","buildTypes","types","_this","remove","defaultsDeep","forEach","child","parent","protoProps","staticProps","Surrogate","constructor","superclass","initConfig","obj","cArr","super","DEFAULTS","prop","getConstructor","jsClass","defaultClass","isString","eval","debug","moduleName","push","message","substring","console","info","getRelativePosition","bounds","geometry","offsetPosition","pos","anchorX","offsetX","anchorY","offsetY","unscale","getProperty","has","isFunction","definition","context","selectorEngine","map","forAll","isAncestor","check","win","old","namespaceRegex","nameRegex","addEvent","doc","document","nav","navigator","documentElement","W3C_MODEL","eventSupport","ONE","slice","str2arr","split","nativeEvents","hash","events","customEvents","element","container","compareDocumentPosition","nodeType","parentNode","mouseenter","base","condition","event","related","relatedTarget","prefix","test","toString","mouseleave","mousewheel","userAgent","Event","commonProps","mouseProps","concat","mouseWheelProps","keyProps","textProps","touchProps","messageProps","stateProps","overOutRegex","typeFixers","reg","fix","newEvent","keyCode","which","rightClick","button","pageX","pageY","clientX","clientY","body","scrollLeft","scrollTop","typeFixerMap","isNative","ownerDocument","parentWindow","originalEvent","isBean","fixer","target","srcElement","preventDefault","returnValue","stopPropagation","cancelBubble","stop","stopped","stopImmediatePropagation","isImmediatePropagationStopped","currentTarget","ne","targetElement","RegEntry","wrappedHandler","fn","args","eargs","findTarget","eventElement","__beanDel","ft","handler","original","namespaces","customType","once","removeListener","eventType","inNamespaces","checkNamespaces","j","matches","checkElement","checkOriginal","checkHandler","registry","pfx","list","all","charAt","substr","entries","entry","put","del","removed","setSelectorEngine","e","querySelectorAll","Error","rootListener","propertyName","listeners","listener","add","custom","attachEvent","detachEvent","rm","originalFn","orgType","replace","handlers","fireListener","evt","createEvent","dispatchEvent","fireEvent","createEventObject","off","typeSpec","k","isTypeStr","indexOf","on","selector","first","_typeof","array","match","delegate","bean","delfn","one","from","beanDel","fire","names","noConflict","cleanup","CollectGarbage","__WEBPACK_AMD_DEFINE_RESULT__","__WEBPACK_AMD_DEFINE_FACTORY__","defaults","refPt","getPerimeter","view","template","getTemplate","Base64","_keyStr","encode","input","chr1","chr2","chr3","enc1","enc2","enc3","enc4","output","_utf8_encode","charCodeAt","isNaN","decode","String","fromCharCode","_utf8_decode","string","utftext","c1","c2","c3","caches","Cache","getCache","clear","inBrowser","dom_utils","isIE","sAgent","Idx","parseInt","isFireFox","InstallTrigger","isChrome","raw","isMac","platform","toUpperCase","isWindows","appVersion","isLinux","createElement","tag","attribs","styles","html","setElement","innerHTML","createElementByString","str","childNodes","setAttribute","style","testElement","node","method","getAncestorBy","getPosition","elRect","getBoundingClientRect","contextRect","getCenterPosition","move","getSize","offsetWidth","offsetHeight","resize","preloadImages","loaded","img","that","Image","onload","index","src","getImageInfo","downloadFile","data","mime","encoded","atob","decodeURI","GetBlob","msSaveBlob","link","href","download","display","appendChild","click","removeChild","contentType","sliceSize","byteArrays","offset","byteNumbers","byteArray","Uint8Array","Blob","openImage","image","myDocument","open","eventFromInput","tagName","waitForElement","id","Promise","resolve","getElementById","interval","setInterval","clearInterval","StringBuffer","buffer","stuff","pop","sep","join","Line","start","end","Line_classCallCheck","x0","y0","x1","y1","x2","y2","x3","y3","denom","ua","ub","intersectionX","intersectionY","cosa","dotProduct","Ellipse","a","b","cx","cy","px","py","f","g","det","xout1","xout2","yout1","yout2","xout","yout","pow","dir","Rhombus","tx","ty","intersection","defaultConfig","showGauge","defaultGeometry","linkTypes","Link","terminalVisual","shapeConfig","startMarker","endMarker","Link_classCallCheck","startNormal","endNormal","renderLink","isNumber","points","translate","getScaled","Utils","LinkClass","DirectLink","BezierLink","ctrlpts","controlPts","p1","p3","p4","EntityRelations","source","Port","getBounds","edge","isSourceLeft","isTargetLeft","result","getCenterY","xe","ye","seg","segment","dep","arr","midY","Manhattan","MIN_BUFFER","autoRoute","randomNoise","step","maxChannelWidth","Link_possibleConstructorReturn","Link_getPrototypeOf","boxes","startBox","endBox","side","side2","box","intersect","channel","channel2","endPadding","_getChannel","_getFirstIntersection","_getRouteTendency","_hasIntersection","_moveSegment","breakPt","_getRouteDirection","getCenter","box2","box1","getLeft","getRight","getBottom","getTop","startPadding","getTranslated","route","_mergeSegments","getCommonAncestor","getDescendants","excludeFromRouting","range","randomNumber","floor","random","sign","_moveSegment2","startBufferNormal","endBufferNormal","startBuffer","endBuffer","prunePts","detectIntersection","savedIndex","savedSide","h1","equals","getKeyData","ctrl","alt","shift","meta","buf","append","addEventHandler","EventDispatcher","zoomScale","event_dispatcher_classCallCheck","rootNS","getAttribute","dragging","handleEvent","started","enterStack","nsType","registeredType","RegExp","changedTouches","svg","ownerSVGElement","createSVGPoint","matrixTransform","getScreenCTM","inverse","clientLeft","clientTop","Events","startKeys","stopKeys","stack","isRoot","startsWith","rootTarget","nsTarget","prepend","targetStack","_this2","DomUtils","isKeyEvent","ctrlKey","altKey","shiftKey","metaKey","KeyUtils","getEventInfo","wheelDelta","dragPos","dragObject","mouse","mousemove","currentPos","dispatch","mouseup","simulateEnterLeave","last","_this3","clearEnterStack","getNS","val","item","regexp","callback","lastPosition","_this4","registerKey","code","_this5","unregisterKey","zIndex","_this6","register","FONT_BOLD","FONT_ITALIC","FONT_UNDERLINE","FONT_SHADOW","fontSize","fontFamily","fontStyle","fontColor","padding","linePadding","align","rotation","Label","measureDiv","baselineDiv","stringMeasureEl","getStringSize","memoize","bold","isUndefined","position","visibility","contentWindow","write","close","fontWeight","strut","firstChild","baselineHeight","offsetTop","baseline","wrap","maxWidth","spaceSize","space","lineHeight","lines","words","line","currentWidth","wordWidth","newLine","word","_getLabelBox","label","labelConfig","wrappedLabel","anchor","setAnchorX","pivot","maxBounds","_label","underline","italic","shadow","getLabelBox","containerWidth","containerHeight","getLabelBoxForLink","render","renderLabel","editor","refEl","textEl","singleLine","unselectable","overflow","border","font-family","font-size","font-weight","focus","select","cancel","Cell","graph","uniqueId","Cell_classCallCheck","decorators","createDecorators","views","viewProps","Type","shape","getShape","className","computedClassName","viewProp","role","getView","currentRoot","destroyed","_computedClassName","getPrototypeOf","Node","Node_classCallCheck","Node_possibleConstructorReturn","Node_getPrototypeOf","inEdges","outEdges","ports","edges","children","portName","endPt","Edge","Edge_classCallCheck","Edge_possibleConstructorReturn","Edge_getPrototypeOf","setSource","sourcePos","setTarget","targetPos","setTerminal","setEdgeAt","removeEdge","addOutEdge","addInEdge","center","refPts","getReferencePoints","terminals","getBound","getPort","getLink","getTerminalVisual","_get","Marker","size","marker","viewBox","ref","fill","color","getMarker","nodeDefaults","draggable","selectable","editable","resizable","sourceable","targetable","visible","edgeDefaults","Graph","markerConfig","model","Graph_classCallCheck","nodes","selection","nodeTypes","edgeTypes","markers","loadModel","without","getJSClass","addChild","to","addNode","addEdge","allowDanglingEdges","multiConnect","readOnly","viewOnly","Layout","Layout_classCallCheck","orientation","HORIZONTAL","VERTICAL","FlowLayout","items","getLinkedNodes","owner","hgap","vgap","_flPos","moveTo","trigger","Behavior","renderer","Behavior_classCallCheck","GraphBehavior","GraphBehavior_classCallCheck","GraphBehavior_getPrototypeOf","dispatcher","handleDrag","GraphBehavior_assertThisInitialized","handleZoom","transform","SelectionBehavior","SelectionBehavior_classCallCheck","SelectionBehavior_getPrototypeOf","selectCell","SelectionBehavior_assertThisInitialized","unselectCell","handleMultiSelect","selectedNodes","selectedLinks","attachedLinks","classed","selectedVertices","getShapes","getAttachedEdges","selectedEdges","cell","toggle","isSelected","_firstSelection","d3","dataTarget","moveToFront","setSelection","util","startPt","getBoundingRectangle","rubberband","appendNode","getCellLayer","cells","getCurrentRoot","filter","attr","SelectionBehavior_get","Renderer","Renderer_classCallCheck","tabindex","layout","LayoutClass","_translate","_scale","graphBehavior","selectionBehavior","nodeBehavior","edgeBehavior","connectionBehavior","scaled","viewport","isNull","vp","refresh","_graph","initializeBehaviors","renderMarkers","JsClass","_delayEdit","delay","preprocessor","TEMPLATES","parts","part","trim","camelCase","interpolate","gridSize","gBounds","vBounds","parseFloat","defaultClickMode","hideOutline","singleSelect","gridEnabled","guidesEnabled","maxZoom","minZoom","zoomFactor","maskOpacity","SVGElement","createElementNS","defineProperties","outerHTML","configurable","$node","$temp","cloneNode","ropen","nodeName","rclose","markup","lastChild","firstElementChild","toDataURL","svgDataurl","options","_svg","msg","base64dataURLencode","b64","btoa","keepNonSafe","keepOutsideViewport","canvg","canvas","jsCanvas","xcanvas","bbox","getBBox","SVGRenderer","compile","imageDataurl","exportImageCanvg","ctx","getContext","svgImg","svgXml","drawImage","onerror","exportImage","str1","str2","renderShape","round","newPts","next","d1","d2","corner","prev","getPathData","content","temp","SVGRenderer_get","SVGRenderer_getPrototypeOf","renderDefs","querySelector","$root","$edge","Triangle","Hexagon","Polygon","removeLast","Grid","variable","addShape"],"mappings":"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","file":"qgraph.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"qgraph\", [\"lodash\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"qgraph\"] = factory(require(\"lodash\"));\n\telse\n\t\troot[\"qgraph\"] = factory(root[\"_\"]);\n})((typeof window !== 'undefined' ? window : this), function(__WEBPACK_EXTERNAL_MODULE__1__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","class Point {\r\n  constructor (x, y) {\r\n    this.x = x\r\n    this.y = y\r\n  }\r\n\r\n  /**\r\n   * Make a clone of this point\r\n   */\r\n  clone () {\r\n    return new Point(this.x, this.y)\r\n  }\r\n\r\n  /**\r\n   * Calculate the distance from this pt to the other pt.\r\n   * @param aPt\r\n   * @returns {number}\r\n   */\r\n  distance (aPt) {\r\n    return Math.sqrt((this.x - aPt.x) * (this.x - aPt.x) + (this.y - aPt.y) * (this.y - aPt.y))\r\n  }\r\n\r\n  /**\r\n   * Translate this point\r\n   */\r\n  translate (p2) {\r\n    this.x += p2.x\r\n    this.y += p2.y\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * Scale this vector\r\n   */\r\n  scale (scale) {\r\n    this.x *= scale\r\n    this.y *= scale\r\n    return this\r\n  }\r\n\r\n  getScaled (scale) {\r\n    return new Point(this.x * scale, this.y * scale)\r\n  }\r\n\r\n  getTranslated (p2) {\r\n    return new Point(this.x + p2.x, this.y + p2.y)\r\n  }\r\n\r\n  /**\r\n   * Get the direction vector from this point to p2.\r\n   * @param p2\r\n   * @returns {Point}\r\n   */\r\n  getDirection (p2) {\r\n    var dist = this.distance(p2)\r\n    return new Point((p2.x - this.x) / dist, (p2.y - this.y) / dist)\r\n  }\r\n\r\n  /**\r\n   * rotate the point about the origin. With the specified angle.\r\n   * @param angle the angle to rotate\r\n   */\r\n  rotate (angle) {\r\n    var cos = Math.cos(angle * Math.PI / 180)\r\n    var sin = Math.sin(angle * Math.PI / 180)\r\n    var x = this.x; var y = this.y\r\n    this.x = x * cos - y * sin\r\n    this.y = x * sin + y * cos\r\n    return this\r\n  }\r\n\r\n  getRotated (angle) {\r\n    return this.clone().rotate(angle)\r\n  }\r\n\r\n  /**\r\n   * Calculate the dot product, treating this and p2 as vectors.\r\n   */\r\n  dotProduct (p2) {\r\n    return this.x * p2.x + this.y * p2.y\r\n  }\r\n\r\n  /**\r\n   * Get the mid point between this and p2.\r\n   */\r\n  getMidPoint (p2) {\r\n    return new Point((this.x + p2.x) / 2, (this.y + p2.y) / 2)\r\n  }\r\n\r\n  reverse () {\r\n    this.x = -this.x\r\n    this.y = -this.y\r\n    return this\r\n  }\r\n\r\n  equals (p2) {\r\n    if (!p2 || !(p2 instanceof Point)) return false\r\n\r\n    return (this.x === p2.x && this.y === p2.y)\r\n  }\r\n\r\n  /**\r\n   * Reflect this point w.r.t. the rectangle.\r\n   * If vertical is true, it will reflect the point cross the vertical\r\n   * central line of the rectangle, otherwise reflect cross the horizontal\r\n   * central line.\r\n   *\r\n   * @param rect the rectangle\r\n   * @param vertical whether is vertical reflection or horizontal reflection.\r\n   */\r\n  reflect (rect, vertical) {\r\n    if (vertical) {\r\n      this.x = 2 * rect.x - this.x\r\n    } else {\r\n      this.y = 2 * rect.y - this.y\r\n    }\r\n    return this\r\n  }\r\n\r\n  toString () {\r\n    return this.x + ',' + this.y\r\n  }\r\n}\r\n\r\nPoint.W = new Point(-1, 0)\r\nPoint.N = new Point(0, -1)\r\nPoint.S = new Point(0, 1)\r\nPoint.E = new Point(1, 0)\r\nPoint.NE = new Point(1, -1)\r\nPoint.NW = new Point(-1, -1)\r\nPoint.SE = new Point(1, 1)\r\nPoint.SW = new Point(-1, 1)\r\n\r\nexport default Point\r\n","module.exports = __WEBPACK_EXTERNAL_MODULE__1__;","import _ from 'lodash'\r\nimport Point from './Point'\r\nimport Shape from './Shape'\r\n\r\nexport default class Rectangle extends Shape {\r\n  /**\r\n   * Checks whether this rectangle contains a given point of a given rectangle\r\n   */\r\n  contains (el) {\r\n    let w = el.width || 0\r\n    let h = el.height || 0\r\n    let left = el.x - w / 2\r\n    let right = el.x + w / 2\r\n    let top = el.y - h / 2\r\n    let bottom = el.y + h / 2\r\n    return (right <= this.right) && (left >= this.left) &&\r\n      (top >= this.top) && (bottom <= this.bottom)\r\n  }\r\n\r\n  /**\r\n   * Calcualte the distance to a point. 0 if this rectangle contains the point.\r\n   */\r\n  distance (pt) {\r\n    if (this.contains(pt)) return 0\r\n\r\n    if (pt.x < this.left) {\r\n      if (pt.y < this.top) {\r\n        return pt.distance(new Point(this.left, this.top))\r\n      }\r\n      if (pt.y <= this.bottom) return this.left - pt.x\r\n      return pt.distance(new Point(this.left, this.bottom))\r\n    }\r\n    if (pt.x <= this.right) {\r\n      if (pt.y <= this.top) return this.top - pt.y\r\n      return pt.y - this.bottom\r\n    }\r\n    if (pt.y < this.top) {\r\n      return pt.distance(new Point(this.right, this.top))\r\n    }\r\n    if (pt.y <= this.bottom) return pt.x - this.right\r\n    return pt.distance(new Point(this.right, this.bottom))\r\n  }\r\n\r\n  /**\r\n   * Given two points, we want to detect whether the line joining the pts intersect\r\n   * with the rectangle or not. We assume only horizontal or vertical line segments.\r\n   *\r\n   * @return int the side of the intersection: -1: no intersection, 0: left, 1: top, 2: right, 3: bottom, 4: containment.\r\n   */\r\n  detectIntersection (pt1, pt2) {\r\n    let horizontal = pt1.y === pt2.y\r\n    let contains1 = this.contains(pt1)\r\n    let contains2 = this.contains(pt2)\r\n    if (contains1 && contains2) return 4\r\n    if (!contains1 && !contains2) {\r\n      if (horizontal && (pt1.y >= this.top && pt1.y <= this.bottom)) {\r\n        if (pt1.x < this.left && pt2.x > this.right) return 0\r\n        if (pt1.x > this.right && pt2.x < this.left) return 2\r\n      }\r\n      if (!horizontal && (pt1.x >= this.left && pt1.x <= this.right)) {\r\n        if (pt1.y < this.top && pt2.y > this.bottom) return 1\r\n        if (pt1.y > this.bottom && pt2.y < this.top) return 3\r\n      }\r\n      return -1\r\n    }\r\n\r\n    let outPt = contains1 ? pt2 : pt1\r\n    if (horizontal) {\r\n      if (outPt.x > this.right) return 2\r\n      return 0\r\n    } else {\r\n      if (outPt.y < this.top) return 1\r\n      return 3\r\n    }\r\n  }\r\n\r\n  toString () {\r\n    return 'Rectangle:{x=' + this.x + ';y=' + this.y + ';width=' + this.width + ';height=' + this.height + '}'\r\n  }\r\n\r\n  static getPerimeter (rect, pt, orthogonal = false) {\r\n    let x = rect.x\r\n    let y = rect.y\r\n    let dx = pt.x - x\r\n    let dy = pt.y - y\r\n    let alpha = Math.atan2(dy, dx)\r\n    let p = new Point(0, 0)\r\n    let pi = Math.PI\r\n    let pi2 = Math.PI / 2\r\n    let beta = pi2 - alpha\r\n    let t = Math.atan2(rect.height, rect.width)\r\n\r\n    if (alpha < -pi + t || alpha > pi - t) {\r\n      // Left edge\r\n      p.x = rect.left\r\n      p.y = y - rect.width * Math.tan(alpha) / 2\r\n    } else if (alpha < -t) {\r\n      // Top Edge\r\n      p.y = rect.top\r\n      p.x = x - rect.height * Math.tan(beta) / 2\r\n    } else if (alpha < t) {\r\n      // Right Edge\r\n      p.x = rect.right\r\n      p.y = y + rect.width * Math.tan(alpha) / 2\r\n    } else {\r\n      // Bottom Edge\r\n      p.y = rect.bottom\r\n      p.x = x + rect.height * Math.tan(beta) / 2\r\n    }\r\n\r\n    if (orthogonal) {\r\n      if (alpha < -pi + t || alpha > pi - t) {\r\n        // Left edge\r\n        p.x = rect.left\r\n        p.y = y\r\n      } else if (alpha < -t) {\r\n        // Top Edge\r\n        p.y = rect.top\r\n        p.x = x\r\n      } else if (alpha < t) {\r\n        // Right Edge\r\n        p.x = rect.right\r\n        p.y = y\r\n      } else {\r\n        // Bottom Edge\r\n        p.y = rect.bottom\r\n        p.x = x\r\n      }\r\n    }\r\n\r\n    let dir = Rectangle.getDirection(rect, p, orthogonal)\r\n    return { point: p, direction: dir }\r\n  }\r\n\r\n  /**\r\n   * Return the bounding rectangle that contains p1 and p2\r\n   */\r\n  static getBoundingRectangle (pts, margin) {\r\n    if (!pts || pts.length === 0) return null\r\n    margin = margin || [0, 0, 0, 0]\r\n    if (!_.isArray(margin)) {\r\n      margin = [margin, margin, margin, margin]\r\n    }\r\n    let min = [pts[0].x, pts[0].y]\r\n    let max = [pts[0].x, pts[0].y]\r\n    for (let i = 1; i < pts.length; i++) {\r\n      let p = pts[i]\r\n      if (p.x < min[0]) {\r\n        min[0] = p.x\r\n      }\r\n      if (p.y < min[1]) {\r\n        min[1] = p.y\r\n      }\r\n      if (p.x > max[0]) {\r\n        max[0] = p.x\r\n      }\r\n      if (p.y > max[1]) {\r\n        max[1] = p.y\r\n      }\r\n    }\r\n    min[0] = min[0] - margin[0]\r\n    min[1] = min[1] - margin[1]\r\n    max[0] = max[0] + margin[2]\r\n    max[1] = max[1] + margin[3]\r\n    let w = Math.abs(max[0] - min[0])\r\n    let h = Math.abs(max[1] - min[1])\r\n    return new Rectangle(min[0] + w / 2, min[1] + h / 2, w, h)\r\n  }\r\n\r\n  /**\r\n   * Create a union of all the rectangles.\r\n   * @param rects\r\n   */\r\n  static union (rects) {\r\n    let minx = null; let miny = null; let maxx = -Infinity; let maxy = -Infinity\r\n    _.each(rects, function (rect) {\r\n      minx = minx || rect.x\r\n      miny = miny || rect.y\r\n      minx = Math.min(minx, rect.x)\r\n      miny = Math.min(miny, rect.y)\r\n      maxx = Math.max(maxx, rect.right())\r\n      maxy = Math.max(maxy, rect.bottom())\r\n    })\r\n    minx = minx || 0\r\n    miny = miny || 0\r\n    return new Rectangle(minx, miny, maxx - minx, maxy - miny)\r\n  }\r\n\r\n  /**\r\n   * Returns the direction the point <i>p</i> is in relation to the given rectangle.\r\n   * Possible values are WEST (-1,0), EAST (1,0), NORTH (0,-1) and SOUTH (0,1) if orthogonal is true, otherwise return\r\n   * the direction connection the center of r and p.\r\n   * @param r\r\n   * @param p\r\n   * @param orthogonal\r\n   * @returns {Point|*}\r\n   */\r\n  static getDirection (r, p, orthogonal = false) {\r\n    if (!orthogonal) {\r\n      return new Point(r.x, r.y).getDirection(new Point(p.x, p.y))\r\n    }\r\n\r\n    let i; let distance = Math.abs(r.left - p.x); let direction = Point.W\r\n\r\n    i = Math.abs(r.top - p.y)\r\n    if (i <= distance) {\r\n      distance = i\r\n      direction = Point.N\r\n    }\r\n\r\n    i = Math.abs(r.bottom - p.y)\r\n    if (i <= distance) {\r\n      distance = i\r\n      direction = Point.S\r\n    }\r\n\r\n    i = Math.abs(r.right - p.x)\r\n    if (i < distance) {\r\n      direction = Point.E\r\n    }\r\n\r\n    return direction\r\n  }\r\n}\r\n","import _ from 'lodash'\r\nimport Point from '../geometry/Point'\r\nimport Rectangle from '../geometry/Rectangle'\r\n\r\n// util variables\r\nlet _debugging = []; let _debugAll = false; let typeRegistry = {}; let splice = Array.splice\r\n\r\n/**\r\n * Utility functions\r\n */\r\nexport default {\r\n  type: function (namespace, name, type) {\r\n    if (!typeRegistry[namespace]) { typeRegistry[namespace] = new Map() }\r\n    if (!name) { return typeRegistry[namespace] }\r\n    if (!type) { return typeRegistry[namespace].get(name) }\r\n    typeRegistry[namespace].set(name, type)\r\n  },\r\n\r\n  createType: function (namespace, props, defaultType) {\r\n    let name = props.name\r\n\r\n    // first check if type exists\r\n    let type = this.type(namespace, name)\r\n    if (!type) {\r\n      let extend = props.extends ? this.type(namespace, props.extends) : null\r\n      if (!extend && defaultType) { extend = defaultType }\r\n      if (extend) {\r\n        type = class extends extend {\r\n        }\r\n      } else {\r\n        type = class {\r\n          constructor (config) {\r\n            _.assign(this, config)\r\n          }\r\n        }\r\n      }\r\n      delete props.name\r\n      delete props.extends\r\n      _.assign(type.prototype, props)\r\n      type.typeName = name\r\n      this.type(namespace, name, type)\r\n      this.log('Utils', 'Utils.createType - ' + namespace + '.' + name)\r\n    }\r\n    return type\r\n  },\r\n\r\n  buildTypes: function (types, namespace, defaultType) {\r\n    this.log('Utils', 'Utils.buildTypes - ' + namespace)\r\n\r\n    if (!types && defaultType) {\r\n      this.createType(namespace, defaultType)\r\n      this.log('Utils', 'Utils.buildTypes end')\r\n      return\r\n    }\r\n    if (defaultType) {\r\n      let type = _.remove(types, { name: defaultType.name })\r\n      type = type.length > 0 ? type[0] : null\r\n      if (type) { defaultType = this.createType(namespace, _.defaultsDeep(type, defaultType)) } else { defaultType = this.createType(namespace, defaultType) }\r\n    }\r\n\r\n    _.forEach(types, (type) => {\r\n      this.createType(namespace, type, defaultType)\r\n    })\r\n    this.log('Utils', 'Utils.buildTypes end')\r\n  },\r\n\r\n  // Helper function to correctly set up the prototype chain, for subclasses.\r\n  // Similar to `goog.inherits`, but uses a hash of prototype properties and\r\n  // class properties to be extended.\r\n  extend: function (child, parent, protoProps, staticProps) {\r\n    // Add static properties to the constructor function, if supplied.\r\n    _.extend(child, parent, staticProps)\r\n\r\n    // Set the prototype chain to inherit from `parent`, without calling\r\n    // `parent`'s constructor function.\r\n    var Surrogate = function () {\r\n      this.constructor = child\r\n    }\r\n    Surrogate.prototype = parent.prototype\r\n    child.prototype = new Surrogate()\r\n\r\n    // Add prototype properties (instance properties) to the subclass,\r\n    // if supplied.\r\n    if (protoProps) _.extend(child.prototype, protoProps)\r\n\r\n    // Set a convenience property in case the parent's prototype is needed later.\r\n    child.superclass = parent.prototype\r\n\r\n    return child\r\n  },\r\n\r\n  initConfig: function (obj, config) {\r\n    let props = {}; let c = obj.constructor; let cArr = [c]\r\n    while (c) {\r\n      if (c.super) {\r\n        c = c.super.constructor\r\n        splice.apply(cArr, [0, 0, c])\r\n      } else { c = null }\r\n    }\r\n\r\n    for (let i = 0; i < cArr.length; i++) {\r\n      c = cArr[i]\r\n      if (c.DEFAULTS) { _.assign(props, c.DEFAULTS) }\r\n    }\r\n    obj.props = _.assign(props, config)\r\n    c.prototype.prop = function (name, value) {\r\n      if (!value) { return this.props[name] }\r\n      this.props[name] = value\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Gets the JS class constructor.\r\n   * @param {Object} jsClass\r\n   * @param {Object} defaultClass\r\n   */\r\n  getConstructor: function (jsClass, defaultClass) {\r\n    if (!jsClass) { jsClass = defaultClass }\r\n\r\n    if (_.isString(jsClass)) {\r\n      jsClass = eval(jsClass) // eslint-disable-line no-eval\r\n    }\r\n    return jsClass\r\n  },\r\n\r\n  debug: function (moduleName) {\r\n    if (moduleName) {\r\n      _debugging.push(moduleName)\r\n    } else {\r\n      _debugAll = true\r\n    }\r\n  },\r\n\r\n  log: function (name, message) {\r\n    var debug = _debugAll\r\n    if (!_debugAll) {\r\n      debug = false\r\n      for (var i = 0; i < _debugging.length; i++) {\r\n        if (_debugging[i] === name) debug = true\r\n      }\r\n    }\r\n    if (!debug) {\r\n      return\r\n    }\r\n    while (name.length < 10) {\r\n      name = name + ' '\r\n    }\r\n    name = name.substring(0, 10) + ' - '\r\n    console.info(name, message)\r\n  },\r\n\r\n  /**\r\n   * Get the relative position of sub shapes within a parent share.\r\n   * @param bounds\r\n   * @param geometry The geometry information, the format of Geometry is:\r\n   * {\r\n   *      x: \"x coordinate of ref point, if less than 1, will be treated as the percentage of the parent width.\",\r\n   *      y: \"y coordinate of ref point.\",\r\n   *      anchorX: \"x pos of child relative to the ref point\",\r\n   *      anchorY: \"y pos of child relative to the ref point\",\r\n   *      offsetX: \"the offset in the x direction.\",\r\n   *      offsetY: \"the offset in the y direction.\",\r\n   *      width: \"the width of the child element\",\r\n   *      height: \"the height of the child element\"\r\n   * }\r\n   * @returns {*[]}\r\n   */\r\n  getRelativePosition: function (bounds, geometry) {\r\n    let x = Math.abs(geometry.x) <= 1 ? bounds.width * geometry.x : geometry.x\r\n    let y = Math.abs(geometry.y) <= 1 ? bounds.height * geometry.y : geometry.y\r\n    return this.offsetPosition([x, y], geometry)\r\n  },\r\n\r\n  offsetPosition: function (pos, geometry) {\r\n    return [pos[0] + geometry.width * geometry.anchorX + geometry.offsetX, pos[1] + geometry.height * geometry.anchorY + geometry.offsetY]\r\n  },\r\n\r\n  /**\r\n   * Get the position relative to the graph that's unscaled, i.e., absolute position without considering translation and scale.\r\n   * @param t the current translate\r\n   * @param scale the current scale\r\n   * @param o can be either a Point or a Rectangle or a Point array.\r\n   */\r\n  unscale: function (t, scale, o) {\r\n    if (o instanceof Rectangle) { return new Rectangle(o.x * scale + t[0], o.y * scale + t[1], o.width * scale, o.height * scale) } else if (o instanceof Point) { return new Point(o.x * scale + t[0], o.y * scale + t[1]) } else { return [o[0] * scale + t[0], o[1] * scale + t[1]] }\r\n  },\r\n\r\n  /**\r\n   * Get the position relative to the graph that's scaled, i.e., relative position considering translation and scale.\r\n   * @param t the current translation\r\n   * @param scale the current scale\r\n   * @param o can be either a Point or a Rectangle or a Point array.\r\n   */\r\n  scale: function (t, scale, o) {\r\n    if (o instanceof Rectangle) { return new Rectangle((o.x - t[0]) / scale, (o.y - t[1]) / scale, o.width / scale, o.height / scale) } else if (o instanceof Point) { return new Point((o.x - t[0]) / scale, (o.y - t[1]) / scale) } else { return [(o[0] - t[0]) / scale, (o[1] - t[1]) / scale] }\r\n  },\r\n\r\n  /**\r\n   * Convenience method.\r\n   */\r\n  getProperty: function (obj, prop) {\r\n    if (!obj) { return null }\r\n    if (_.has(obj, prop)) { return obj[prop] }\r\n    if (obj.prop && _.isFunction(obj.prop)) { return obj.prop(prop) }\r\n    return null\r\n  }\r\n}\r\n","/*!\r\n  * Bean - copyright (c) Jacob Thornton 2011-2012\r\n  * https://github.com/fat/bean\r\n  * MIT license\r\n  */\r\n(function (name, context, definition) {\r\n  if (typeof module != 'undefined' && module.exports) module.exports = definition()\r\n  else if (typeof define == 'function' && define.amd) define(definition)\r\n  else context[name] = definition()\r\n})('bean', this, function (name, context) {\r\n  name    = name    || 'bean'\r\n  context = context || this\r\n\r\n  var win            = typeof window !== 'undefined' ? window : this\r\n    , old            = context[name]\r\n    , namespaceRegex = /[^\\.]*(?=\\..*)\\.|.*/\r\n    , nameRegex      = /\\..*/\r\n    , addEvent       = 'addEventListener'\r\n    , removeEvent    = 'removeEventListener'\r\n    , doc            = typeof document !== 'undefined' ? document : {}\r\n    , nav            = typeof navigator !== 'undefined' ? navigator : {}\r\n    , root           = doc.documentElement || {}\r\n    , W3C_MODEL      = root[addEvent]\r\n    , eventSupport   = W3C_MODEL ? addEvent : 'attachEvent'\r\n    , ONE            = {} // singleton for quick matching making add() do one()\r\n\r\n    , slice          = Array.prototype.slice\r\n    , str2arr        = function (s, d) { return s.split(d || ' ') }\r\n    , isString       = function (o) { return typeof o == 'string' }\r\n    , isFunction     = function (o) { return typeof o == 'function' }\r\n\r\n      // events that we consider to be 'native', anything not in this list will\r\n      // be treated as a custom event\r\n    , standardNativeEvents =\r\n        'click dblclick mouseup mousedown contextmenu '                  + // mouse buttons\r\n        'mousewheel mousemultiwheel DOMMouseScroll '                     + // mouse wheel\r\n        'mouseover mouseout mousemove selectstart selectend '            + // mouse movement\r\n        'keydown keypress keyup '                                        + // keyboard\r\n        'orientationchange '                                             + // mobile\r\n        'focus blur change reset select submit '                         + // form elements\r\n        'load unload beforeunload resize move DOMContentLoaded '         + // window\r\n        'readystatechange message '                                      + // window\r\n        'error abort scroll '                                              // misc\r\n      // element.fireEvent('onXYZ'... is not forgiving if we try to fire an event\r\n      // that doesn't actually exist, so make sure we only do these on newer browsers\r\n    , w3cNativeEvents =\r\n        'show '                                                          + // mouse buttons\r\n        'input invalid '                                                 + // form elements\r\n        'touchstart touchmove touchend touchcancel '                     + // touch\r\n        'gesturestart gesturechange gestureend '                         + // gesture\r\n        'textinput '                                                     + // TextEvent\r\n        'readystatechange pageshow pagehide popstate '                   + // window\r\n        'hashchange offline online '                                     + // window\r\n        'afterprint beforeprint '                                        + // printing\r\n        'dragstart dragenter dragover dragleave drag drop dragend '      + // dnd\r\n        'loadstart progress suspend emptied stalled loadmetadata '       + // media\r\n        'loadeddata canplay canplaythrough playing waiting seeking '     + // media\r\n        'seeked ended durationchange timeupdate play pause ratechange '  + // media\r\n        'volumechange cuechange '                                        + // media\r\n        'checking noupdate downloading cached updateready obsolete '       // appcache\r\n\r\n      // convert to a hash for quick lookups\r\n    , nativeEvents = (function (hash, events, i) {\r\n        for (i = 0; i < events.length; i++) events[i] && (hash[events[i]] = 1)\r\n        return hash\r\n      }({}, str2arr(standardNativeEvents + (W3C_MODEL ? w3cNativeEvents : ''))))\r\n\r\n      // custom events are events that we *fake*, they are not provided natively but\r\n      // we can use native events to generate them\r\n    , customEvents = (function () {\r\n        var isAncestor = 'compareDocumentPosition' in root\r\n              ? function (element, container) {\r\n                  return container.compareDocumentPosition && (container.compareDocumentPosition(element) & 16) === 16\r\n                }\r\n              : 'contains' in root\r\n                ? function (element, container) {\r\n                    container = container.nodeType === 9 || container === window ? root : container\r\n                    return container !== element && container.contains(element)\r\n                  }\r\n                : function (element, container) {\r\n                    while (element = element.parentNode) if (element === container) return 1\r\n                    return 0\r\n                  }\r\n          , check = function (event) {\r\n              var related = event.relatedTarget\r\n              return !related\r\n                ? related == null\r\n                : (related !== this && related.prefix !== 'xul' && !/document/.test(this.toString())\r\n                    && !isAncestor(related, this))\r\n            }\r\n\r\n        return {\r\n            mouseenter: { base: 'mouseover', condition: check }\r\n          , mouseleave: { base: 'mouseout', condition: check }\r\n          , mousewheel: { base: /Firefox/.test(nav.userAgent) ? 'DOMMouseScroll' : 'mousewheel' }\r\n        }\r\n      }())\r\n\r\n      // we provide a consistent Event object across browsers by taking the actual DOM\r\n      // event object and generating a new one from its properties.\r\n    , Event = (function () {\r\n            // a whitelist of properties (for different event types) tells us what to check for and copy\r\n        var commonProps  = str2arr('altKey attrChange attrName bubbles cancelable ctrlKey currentTarget ' +\r\n              'detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey '  +\r\n              'srcElement target timeStamp type view which propertyName')\r\n          , mouseProps   = commonProps.concat(str2arr('button buttons clientX clientY dataTransfer '      +\r\n              'fromElement offsetX offsetY pageX pageY screenX screenY toElement'))\r\n          , mouseWheelProps = mouseProps.concat(str2arr('wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ ' +\r\n              'axis')) // 'axis' is FF specific\r\n          , keyProps     = commonProps.concat(str2arr('char charCode key keyCode keyIdentifier '          +\r\n              'keyLocation location'))\r\n          , textProps    = commonProps.concat(str2arr('data'))\r\n          , touchProps   = commonProps.concat(str2arr('touches targetTouches changedTouches scale rotation'))\r\n          , messageProps = commonProps.concat(str2arr('data origin source'))\r\n          , stateProps   = commonProps.concat(str2arr('state'))\r\n          , overOutRegex = /over|out/\r\n            // some event types need special handling and some need special properties, do that all here\r\n          , typeFixers   = [\r\n                { // key events\r\n                    reg: /key/i\r\n                  , fix: function (event, newEvent) {\r\n                      newEvent.keyCode = event.keyCode || event.which\r\n                      return keyProps\r\n                    }\r\n                }\r\n              , { // mouse events\r\n                    reg: /click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i\r\n                  , fix: function (event, newEvent, type) {\r\n                      newEvent.rightClick = event.which === 3 || event.button === 2\r\n                      newEvent.pos = { x: 0, y: 0 }\r\n                      if (event.pageX || event.pageY) {\r\n                        newEvent.clientX = event.pageX\r\n                        newEvent.clientY = event.pageY\r\n                      } else if (event.clientX || event.clientY) {\r\n                        newEvent.clientX = event.clientX + doc.body.scrollLeft + root.scrollLeft\r\n                        newEvent.clientY = event.clientY + doc.body.scrollTop + root.scrollTop\r\n                      }\r\n                      if (overOutRegex.test(type)) {\r\n                        newEvent.relatedTarget = event.relatedTarget\r\n                          || event[(type == 'mouseover' ? 'from' : 'to') + 'Element']\r\n                      }\r\n                      return mouseProps\r\n                    }\r\n                }\r\n              , { // mouse wheel events\r\n                    reg: /mouse.*(wheel|scroll)/i\r\n                  , fix: function () { return mouseWheelProps }\r\n                }\r\n              , { // TextEvent\r\n                    reg: /^text/i\r\n                  , fix: function () { return textProps }\r\n                }\r\n              , { // touch and gesture events\r\n                    reg: /^touch|^gesture/i\r\n                  , fix: function () { return touchProps }\r\n                }\r\n              , { // message events\r\n                    reg: /^message$/i\r\n                  , fix: function () { return messageProps }\r\n                }\r\n              , { // popstate events\r\n                    reg: /^popstate$/i\r\n                  , fix: function () { return stateProps }\r\n                }\r\n              , { // everything else\r\n                    reg: /.*/\r\n                  , fix: function () { return commonProps }\r\n                }\r\n            ]\r\n          , typeFixerMap = {} // used to map event types to fixer functions (above), a basic cache mechanism\r\n\r\n          , Event = function (event, element, isNative) {\r\n              if (!arguments.length) return\r\n              event = event || ((element.ownerDocument || element.document || element).parentWindow || win).event\r\n              this.originalEvent = event\r\n              this.isNative       = isNative\r\n              this.isBean         = true\r\n\r\n              if (!event) return\r\n\r\n              var type   = event.type\r\n                , target = event.target || event.srcElement\r\n                , i, l, p, props, fixer\r\n\r\n              this.target = target && target.nodeType === 3 ? target.parentNode : target\r\n\r\n              if (isNative) { // we only need basic augmentation on custom events, the rest expensive & pointless\r\n                fixer = typeFixerMap[type]\r\n                if (!fixer) { // haven't encountered this event type before, map a fixer function for it\r\n                  for (i = 0, l = typeFixers.length; i < l; i++) {\r\n                    if (typeFixers[i].reg.test(type)) { // guaranteed to match at least one, last is .*\r\n                      typeFixerMap[type] = fixer = typeFixers[i].fix\r\n                      break\r\n                    }\r\n                  }\r\n                }\r\n\r\n                props = fixer(event, this, type)\r\n                for (i = props.length; i--;) {\r\n                  if (!((p = props[i]) in this) && p in event) this[p] = event[p]\r\n                }\r\n              }\r\n            }\r\n\r\n        // preventDefault() and stopPropagation() are a consistent interface to those functions\r\n        // on the DOM, stop() is an alias for both of them together\r\n        Event.prototype.preventDefault = function () {\r\n          if (this.originalEvent.preventDefault) this.originalEvent.preventDefault()\r\n          else this.originalEvent.returnValue = false\r\n        }\r\n        Event.prototype.stopPropagation = function () {\r\n          if (this.originalEvent.stopPropagation) this.originalEvent.stopPropagation()\r\n          else this.originalEvent.cancelBubble = true\r\n        }\r\n        Event.prototype.stop = function () {\r\n          this.preventDefault()\r\n          this.stopPropagation()\r\n          this.stopped = true\r\n        }\r\n        // stopImmediatePropagation() has to be handled internally because we manage the event list for\r\n        // each element\r\n        // note that originalElement may be a Bean#Event object in some situations\r\n        Event.prototype.stopImmediatePropagation = function () {\r\n          if (this.originalEvent.stopImmediatePropagation) this.originalEvent.stopImmediatePropagation()\r\n          this.isImmediatePropagationStopped = function () { return true }\r\n        }\r\n        Event.prototype.isImmediatePropagationStopped = function () {\r\n          return this.originalEvent.isImmediatePropagationStopped && this.originalEvent.isImmediatePropagationStopped()\r\n        }\r\n        Event.prototype.clone = function (currentTarget) {\r\n          //TODO: this is ripe for optimisation, new events are *expensive*\r\n          // improving this will speed up delegated events\r\n          var ne = new Event(this, this.element, this.isNative)\r\n          ne.currentTarget = currentTarget\r\n          return ne\r\n        }\r\n\r\n        return Event\r\n      }())\r\n\r\n      // if we're in old IE we can't do onpropertychange on doc or win so we use doc.documentElement for both\r\n    , targetElement = function (element, isNative) {\r\n        return !W3C_MODEL && !isNative && (element === doc || element === win) ? root : element\r\n      }\r\n\r\n      /**\r\n        * Bean maintains an internal registry for event listeners. We don't touch elements, objects\r\n        * or functions to identify them, instead we store everything in the registry.\r\n        * Each event listener has a RegEntry object, we have one 'registry' for the whole instance.\r\n        */\r\n    , RegEntry = (function () {\r\n        // each handler is wrapped so we can handle delegation and custom events\r\n        var wrappedHandler = function (element, fn, condition, args) {\r\n            var call = function (event, eargs) {\r\n                  return fn.apply(element, args ? slice.call(eargs, event ? 0 : 1).concat(args) : eargs)\r\n                }\r\n              , findTarget = function (event, eventElement) {\r\n                  return fn.__beanDel ? fn.__beanDel.ft(event.target, element) : eventElement\r\n                }\r\n              , handler = condition\r\n                  ? function (event) {\r\n                      var target = findTarget(event, this) // deleated event\r\n                      if (condition.apply(target, arguments)) {\r\n                        if (event) event.currentTarget = target\r\n                        return call(event, arguments)\r\n                      }\r\n                    }\r\n                  : function (event) {\r\n                      if (fn.__beanDel) event = event.clone(findTarget(event)) // delegated event, fix the fix\r\n                      return call(event, arguments)\r\n                    }\r\n            handler.__beanDel = fn.__beanDel\r\n            return handler\r\n          }\r\n\r\n        , RegEntry = function (element, type, handler, original, namespaces, args, root) {\r\n            var customType     = customEvents[type]\r\n              , isNative\r\n\r\n            if (type == 'unload') {\r\n              // self clean-up\r\n              handler = once(removeListener, element, type, handler, original)\r\n            }\r\n\r\n            if (customType) {\r\n              if (customType.condition) {\r\n                handler = wrappedHandler(element, handler, customType.condition, args)\r\n              }\r\n              type = customType.base || type\r\n            }\r\n\r\n            this.isNative      = isNative = nativeEvents[type] && !!element[eventSupport]\r\n            this.customType    = !W3C_MODEL && !isNative && type\r\n            this.element       = element\r\n            this.type          = type\r\n            this.original      = original\r\n            this.namespaces    = namespaces\r\n            this.eventType     = W3C_MODEL || isNative ? type : 'propertychange'\r\n            this.target        = targetElement(element, isNative)\r\n            this[eventSupport] = !!this.target[eventSupport]\r\n            this.root          = root\r\n            this.handler       = wrappedHandler(element, handler, null, args)\r\n          }\r\n\r\n        // given a list of namespaces, is our entry in any of them?\r\n        RegEntry.prototype.inNamespaces = function (checkNamespaces) {\r\n          var i, j, c = 0\r\n          if (!checkNamespaces) return true\r\n          if (!this.namespaces) return false\r\n          for (i = checkNamespaces.length; i--;) {\r\n            for (j = this.namespaces.length; j--;) {\r\n              if (checkNamespaces[i] == this.namespaces[j]) c++\r\n            }\r\n          }\r\n          return checkNamespaces.length === c\r\n        }\r\n\r\n        // match by element, original fn (opt), handler fn (opt)\r\n        RegEntry.prototype.matches = function (checkElement, checkOriginal, checkHandler) {\r\n          return this.element === checkElement &&\r\n            (!checkOriginal || this.original === checkOriginal) &&\r\n            (!checkHandler || this.handler === checkHandler)\r\n        }\r\n\r\n        return RegEntry\r\n      }())\r\n\r\n    , registry = (function () {\r\n        // our map stores arrays by event type, just because it's better than storing\r\n        // everything in a single array.\r\n        // uses '$' as a prefix for the keys for safety and 'r' as a special prefix for\r\n        // rootListeners so we can look them up fast\r\n        var map = {}\r\n\r\n          // generic functional search of our registry for matching listeners,\r\n          // `fn` returns false to break out of the loop\r\n          , forAll = function (element, type, original, handler, root, fn) {\r\n              var pfx = root ? 'r' : '$'\r\n              if (!type || type == '*') {\r\n                // search the whole registry\r\n                for (var t in map) {\r\n                  if (t.charAt(0) == pfx) {\r\n                    forAll(element, t.substr(1), original, handler, root, fn)\r\n                  }\r\n                }\r\n              } else {\r\n                var i = 0, l, list = map[pfx + type], all = element == '*'\r\n                if (!list) return\r\n                for (l = list.length; i < l; i++) {\r\n                  if ((all || list[i].matches(element, original, handler)) && !fn(list[i], list, i, type)) return\r\n                }\r\n              }\r\n            }\r\n\r\n          , has = function (element, type, original, root) {\r\n              // we're not using forAll here simply because it's a bit slower and this\r\n              // needs to be fast\r\n              var i, list = map[(root ? 'r' : '$') + type]\r\n              if (list) {\r\n                for (i = list.length; i--;) {\r\n                  if (!list[i].root && list[i].matches(element, original, null)) return true\r\n                }\r\n              }\r\n              return false\r\n            }\r\n\r\n          , get = function (element, type, original, root) {\r\n              var entries = []\r\n              forAll(element, type, original, null, root, function (entry) {\r\n                return entries.push(entry)\r\n              })\r\n              return entries\r\n            }\r\n\r\n          , put = function (entry) {\r\n              var has = !entry.root && !this.has(entry.element, entry.type, null, false)\r\n                , key = (entry.root ? 'r' : '$') + entry.type\r\n              ;(map[key] || (map[key] = [])).push(entry)\r\n              return has\r\n            }\r\n\r\n          , del = function (entry) {\r\n              forAll(entry.element, entry.type, null, entry.handler, entry.root, function (entry, list, i) {\r\n                list.splice(i, 1)\r\n                entry.removed = true\r\n                if (list.length === 0) delete map[(entry.root ? 'r' : '$') + entry.type]\r\n                return false\r\n              })\r\n            }\r\n\r\n            // dump all entries, used for onunload\r\n          , entries = function () {\r\n              var t, entries = []\r\n              for (t in map) {\r\n                if (t.charAt(0) == '$') entries = entries.concat(map[t])\r\n              }\r\n              return entries\r\n            }\r\n\r\n        return { has: has, get: get, put: put, del: del, entries: entries }\r\n      }())\r\n\r\n      // we need a selector engine for delegated events, use querySelectorAll if it exists\r\n      // but for older browsers we need Qwery, Sizzle or similar\r\n    , selectorEngine\r\n    , setSelectorEngine = function (e) {\r\n        if (!arguments.length) {\r\n          selectorEngine = doc.querySelectorAll\r\n            ? function (s, r) {\r\n                return r.querySelectorAll(s)\r\n              }\r\n            : function () {\r\n                throw new Error('Bean: No selector engine installed') // eeek\r\n              }\r\n        } else {\r\n          selectorEngine = e\r\n        }\r\n      }\r\n\r\n      // we attach this listener to each DOM event that we need to listen to, only once\r\n      // per event type per DOM element\r\n    , rootListener = function (event, type) {\r\n        if (!W3C_MODEL && type && event && event.propertyName != '_on' + type) return\r\n\r\n        var listeners = registry.get(this, type || event.type, null, false)\r\n          , l = listeners.length\r\n          , i = 0\r\n\r\n        event = new Event(event, this, true)\r\n        if (type) event.type = type\r\n\r\n        // iterate through all handlers registered for this type, calling them unless they have\r\n        // been removed by a previous handler or stopImmediatePropagation() has been called\r\n        for (; i < l && !event.isImmediatePropagationStopped(); i++) {\r\n          if (!listeners[i].removed) listeners[i].handler.call(this, event)\r\n        }\r\n      }\r\n\r\n      // add and remove listeners to DOM elements\r\n    , listener = W3C_MODEL\r\n        ? function (element, type, add) {\r\n            // new browsers\r\n            element[add ? addEvent : removeEvent](type, rootListener, false)\r\n          }\r\n        : function (element, type, add, custom) {\r\n            // IE8 and below, use attachEvent/detachEvent and we have to piggy-back propertychange events\r\n            // to simulate event bubbling etc.\r\n            var entry\r\n            if (add) {\r\n              registry.put(entry = new RegEntry(\r\n                  element\r\n                , custom || type\r\n                , function (event) { // handler\r\n                    rootListener.call(element, event, custom)\r\n                  }\r\n                , rootListener\r\n                , null\r\n                , null\r\n                , true // is root\r\n              ))\r\n              if (custom && element['_on' + custom] == null) element['_on' + custom] = 0\r\n              entry.target.attachEvent('on' + entry.eventType, entry.handler)\r\n            } else {\r\n              entry = registry.get(element, custom || type, rootListener, true)[0]\r\n              if (entry) {\r\n                entry.target.detachEvent('on' + entry.eventType, entry.handler)\r\n                registry.del(entry)\r\n              }\r\n            }\r\n          }\r\n\r\n    , once = function (rm, element, type, fn, originalFn) {\r\n        // wrap the handler in a handler that does a remove as well\r\n        return function () {\r\n          fn.apply(this, arguments)\r\n          rm(element, type, originalFn)\r\n        }\r\n      }\r\n\r\n    , removeListener = function (element, orgType, handler, namespaces) {\r\n        var type     = orgType && orgType.replace(nameRegex, '')\r\n          , handlers = registry.get(element, type, null, false)\r\n          , removed  = {}\r\n          , i, l\r\n\r\n        for (i = 0, l = handlers.length; i < l; i++) {\r\n          if ((!handler || handlers[i].original === handler) && handlers[i].inNamespaces(namespaces)) {\r\n            // TODO: this is problematic, we have a registry.get() and registry.del() that\r\n            // both do registry searches so we waste cycles doing this. Needs to be rolled into\r\n            // a single registry.forAll(fn) that removes while finding, but the catch is that\r\n            // we'll be splicing the arrays that we're iterating over. Needs extra tests to\r\n            // make sure we don't screw it up. @rvagg\r\n            registry.del(handlers[i])\r\n            if (!removed[handlers[i].eventType] && handlers[i][eventSupport])\r\n              removed[handlers[i].eventType] = { t: handlers[i].eventType, c: handlers[i].type }\r\n          }\r\n        }\r\n        // check each type/element for removed listeners and remove the rootListener where it's no longer needed\r\n        for (i in removed) {\r\n          if (!registry.has(element, removed[i].t, null, false)) {\r\n            // last listener of this type, remove the rootListener\r\n            listener(element, removed[i].t, false, removed[i].c)\r\n          }\r\n        }\r\n      }\r\n\r\n      // set up a delegate helper using the given selector, wrap the handler function\r\n    , delegate = function (selector, fn) {\r\n        //TODO: findTarget (therefore $) is called twice, once for match and once for\r\n        // setting e.currentTarget, fix this so it's only needed once\r\n        var findTarget = function (target, root) {\r\n              var i, array = isString(selector) ? selectorEngine(selector, root) : selector\r\n              for (; target && target !== root; target = target.parentNode) {\r\n                for (i = array.length; i--;) {\r\n                  if (array[i] === target) return target\r\n                }\r\n              }\r\n            }\r\n          , handler = function (e) {\r\n              var match = findTarget(e.target, this)\r\n              if (match) fn.apply(match, arguments)\r\n            }\r\n\r\n        // __beanDel isn't pleasant but it's a private function, not exposed outside of Bean\r\n        handler.__beanDel = {\r\n            ft       : findTarget // attach it here for customEvents to use too\r\n          , selector : selector\r\n        }\r\n        return handler\r\n      }\r\n\r\n    , fireListener = W3C_MODEL ? function (isNative, type, element) {\r\n        // modern browsers, do a proper dispatchEvent()\r\n        var evt = doc.createEvent(isNative ? 'HTMLEvents' : 'UIEvents')\r\n        evt[isNative ? 'initEvent' : 'initUIEvent'](type, true, true, win, 1)\r\n        element.dispatchEvent(evt)\r\n      } : function (isNative, type, element) {\r\n        // old browser use onpropertychange, just increment a custom property to trigger the event\r\n        element = targetElement(element, isNative)\r\n        isNative ? element.fireEvent('on' + type, doc.createEventObject()) : element['_on' + type]++\r\n      }\r\n\r\n      /**\r\n        * Public API: off(), on(), add(), (remove()), one(), fire(), clone()\r\n        */\r\n\r\n      /**\r\n        * off(element[, eventType(s)[, handler ]])\r\n        */\r\n    , off = function (element, typeSpec, fn) {\r\n        var isTypeStr = isString(typeSpec)\r\n          , k, type, namespaces, i\r\n\r\n        if (isTypeStr && typeSpec.indexOf(' ') > 0) {\r\n          // off(el, 't1 t2 t3', fn) or off(el, 't1 t2 t3')\r\n          typeSpec = str2arr(typeSpec)\r\n          for (i = typeSpec.length; i--;)\r\n            off(element, typeSpec[i], fn)\r\n          return element\r\n        }\r\n\r\n        type = isTypeStr && typeSpec.replace(nameRegex, '')\r\n        if (type && customEvents[type]) type = customEvents[type].base\r\n\r\n        if (!typeSpec || isTypeStr) {\r\n          // off(el) or off(el, t1.ns) or off(el, .ns) or off(el, .ns1.ns2.ns3)\r\n          if (namespaces = isTypeStr && typeSpec.replace(namespaceRegex, '')) namespaces = str2arr(namespaces, '.')\r\n          removeListener(element, type, fn, namespaces)\r\n        } else if (isFunction(typeSpec)) {\r\n          // off(el, fn)\r\n          removeListener(element, null, typeSpec)\r\n        } else {\r\n          // off(el, { t1: fn1, t2, fn2 })\r\n          for (k in typeSpec) {\r\n            if (typeSpec.hasOwnProperty(k)) off(element, k, typeSpec[k])\r\n          }\r\n        }\r\n\r\n        return element\r\n      }\r\n\r\n      /**\r\n        * on(element, eventType(s)[, selector], handler[, args ])\r\n        */\r\n    , on = function(element, events, selector, fn) {\r\n        var originalFn, type, types, i, args, entry, first\r\n\r\n        //TODO: the undefined check means you can't pass an 'args' argument, fix this perhaps?\r\n        if (selector === undefined && typeof events == 'object') {\r\n          //TODO: this can't handle delegated events\r\n          for (type in events) {\r\n            if (events.hasOwnProperty(type)) {\r\n              on.call(this, element, type, events[type])\r\n            }\r\n          }\r\n          return\r\n        }\r\n\r\n        if (!isFunction(selector)) {\r\n          // delegated event\r\n          originalFn = fn\r\n          args       = slice.call(arguments, 4)\r\n          fn         = delegate(selector, originalFn, selectorEngine)\r\n        } else {\r\n          args       = slice.call(arguments, 3)\r\n          fn         = originalFn = selector\r\n        }\r\n\r\n        types = str2arr(events)\r\n\r\n        // special case for one(), wrap in a self-removing handler\r\n        if (this === ONE) {\r\n          fn = once(off, element, events, fn, originalFn)\r\n        }\r\n\r\n        for (i = types.length; i--;) {\r\n          // add new handler to the registry and check if it's the first for this element/type\r\n          first = registry.put(entry = new RegEntry(\r\n              element\r\n            , types[i].replace(nameRegex, '') // event type\r\n            , fn\r\n            , originalFn\r\n            , str2arr(types[i].replace(namespaceRegex, ''), '.') // namespaces\r\n            , args\r\n            , false // not root\r\n          ))\r\n          if (entry[eventSupport] && first) {\r\n            // first event of this type on this element, add root listener\r\n            listener(element, entry.eventType, true, entry.customType)\r\n          }\r\n        }\r\n\r\n        return element\r\n      }\r\n\r\n      /**\r\n        * add(element[, selector], eventType(s), handler[, args ])\r\n        *\r\n        * Deprecated: kept (for now) for backward-compatibility\r\n        */\r\n    , add = function (element, events, fn, delfn) {\r\n        return on.apply(\r\n            null\r\n          , !isString(fn)\r\n              ? slice.call(arguments)\r\n              : [ element, fn, events, delfn ].concat(arguments.length > 3 ? slice.call(arguments, 5) : [])\r\n        )\r\n      }\r\n\r\n      /**\r\n        * one(element, eventType(s)[, selector], handler[, args ])\r\n        */\r\n    , one = function () {\r\n        return on.apply(ONE, arguments)\r\n      }\r\n\r\n      /**\r\n        * fire(element, eventType(s)[, args ])\r\n        *\r\n        * The optional 'args' argument must be an array, if no 'args' argument is provided\r\n        * then we can use the browser's DOM event system, otherwise we trigger handlers manually\r\n        */\r\n    , fire = function (element, type, args) {\r\n        var types = str2arr(type)\r\n          , i, j, l, names, handlers\r\n\r\n        for (i = types.length; i--;) {\r\n          type = types[i].replace(nameRegex, '')\r\n          if (names = types[i].replace(namespaceRegex, '')) names = str2arr(names, '.')\r\n          if (!names && !args && element[eventSupport]) {\r\n            fireListener(nativeEvents[type], type, element)\r\n          } else {\r\n            // non-native event, either because of a namespace, arguments or a non DOM element\r\n            // iterate over all listeners and manually 'fire'\r\n            handlers = registry.get(element, type, null, false)\r\n            args = [false].concat(args)\r\n            for (j = 0, l = handlers.length; j < l; j++) {\r\n              if (handlers[j].inNamespaces(names)) {\r\n                handlers[j].handler.apply(element, args)\r\n              }\r\n            }\r\n          }\r\n        }\r\n        return element\r\n      }\r\n\r\n      /**\r\n        * clone(dstElement, srcElement[, eventType ])\r\n        *\r\n        * TODO: perhaps for consistency we should allow the same flexibility in type specifiers?\r\n        */\r\n    , clone = function (element, from, type) {\r\n        var handlers = registry.get(from, type, null, false)\r\n          , l = handlers.length\r\n          , i = 0\r\n          , args, beanDel\r\n\r\n        for (; i < l; i++) {\r\n          if (handlers[i].original) {\r\n            args = [ element, handlers[i].type ]\r\n            if (beanDel = handlers[i].handler.__beanDel) args.push(beanDel.selector)\r\n            args.push(handlers[i].original)\r\n            on.apply(null, args)\r\n          }\r\n        }\r\n        return element\r\n      }\r\n\r\n    , bean = {\r\n          'on'                : on\r\n        , 'add'               : add\r\n        , 'one'               : one\r\n        , 'off'               : off\r\n        , 'remove'            : off\r\n        , 'clone'             : clone\r\n        , 'fire'              : fire\r\n        , 'Event'             : Event\r\n        , 'setSelectorEngine' : setSelectorEngine\r\n        , 'noConflict'        : function () {\r\n            context[name] = old\r\n            return this\r\n          }\r\n      }\r\n\r\n  // for IE, clean up on unload to avoid leaks\r\n  if (win.attachEvent) {\r\n    var cleanup = function () {\r\n      var i, entries = registry.entries()\r\n      for (i in entries) {\r\n        if (entries[i].type && entries[i].type !== 'unload') off(entries[i].element, entries[i].type)\r\n      }\r\n      win.detachEvent('onunload', cleanup)\r\n      win.CollectGarbage && win.CollectGarbage()\r\n    }\r\n    win.attachEvent('onunload', cleanup)\r\n  }\r\n\r\n  // initialize selector engine to internal default (qSA or throw Error)\r\n  setSelectorEngine()\r\n\r\n  return bean\r\n});\r\n","import _ from 'lodash'\r\nimport Point from './Point'\r\nimport Rectangle from './Rectangle'\r\n\r\nlet registry = {}\r\n\r\nclass Shape {\r\n  constructor (x, y, width, height, config) {\r\n    this.x = x\r\n    this.y = y\r\n    this.width = width\r\n    this.height = height\r\n    _.defaults(this, config, { x: 0, y: 0, width: 0, height: 0 })\r\n  }\r\n\r\n  /**\r\n   * Return the y-coord of the top side of this rectangle\r\n   */\r\n  get top () { return this.y - this.height / 2 }\r\n\r\n  /**\r\n   * Returns the y-coordinate of the bottom of this Rectangle.\r\n   */\r\n  get bottom () { return this.y + this.height / 2 }\r\n\r\n  /**\r\n   * Return the x-coord of left side of this rectangle\r\n   */\r\n  get left () { return this.x - this.width / 2 }\r\n\r\n  /**\r\n   * Returns the x-coordinate of the right side of this Rectangle.\r\n   */\r\n  get right () { return this.x + this.width / 2 }\r\n\r\n  get center () { return new Point(this.x, this.y) }\r\n\r\n  get bounds () { return new Rectangle(this.x, this.y, this.width, this.height) }\r\n\r\n  contains (el) { return false }\r\n\r\n  /**\r\n   * This will generate n ports on the shape.\r\n   */\r\n  getRegularPoints (n) {\r\n    return null\r\n  }\r\n\r\n  /**\r\n   * Get the intersection between boundary of this shape and the line connecting (x,y) with the refPt.\r\n   * @param refPt\r\n   * @param orthogonal\r\n   * @returns {*|{point, direction}}\r\n   */\r\n  getPerimeter (refPt, orthogonal = false) {\r\n    return this.constructor.getPerimeter(this, refPt, orthogonal)\r\n  }\r\n\r\n  render (view) {\r\n    let template = _.template(view.getTemplate(this.name, this))\r\n    return template(this)\r\n  }\r\n\r\n  static getShape (name) {\r\n    return registry[name]\r\n  }\r\n\r\n  static addShape (name, c) {\r\n    registry[name] = c\r\n  }\r\n\r\n  static removeShape (name) {\r\n    delete registry[name]\r\n  }\r\n}\r\n\r\nexport default Shape\r\n","// http://www.webtoolkit.info/javascript-base64.html\r\n\r\nvar Base64 = {\r\n\r\n  // private property\r\n  _keyStr: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',\r\n\r\n  // public method for encoding\r\n  encode: function (input) {\r\n    var output = ''\r\n    var chr1, chr2, chr3, enc1, enc2, enc3, enc4\r\n    var i = 0\r\n\r\n    input = Base64._utf8_encode(input)\r\n\r\n    while (i < input.length) {\r\n      chr1 = input.charCodeAt(i++)\r\n      chr2 = input.charCodeAt(i++)\r\n      chr3 = input.charCodeAt(i++)\r\n\r\n      enc1 = chr1 >> 2\r\n      enc2 = ((chr1 & 3) << 4) | (chr2 >> 4)\r\n      enc3 = ((chr2 & 15) << 2) | (chr3 >> 6)\r\n      enc4 = chr3 & 63\r\n\r\n      if (isNaN(chr2)) {\r\n        enc3 = enc4 = 64\r\n      } else if (isNaN(chr3)) {\r\n        enc4 = 64\r\n      }\r\n\r\n      output = output +\r\n\t\t\tthis._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) +\r\n\t\t\tthis._keyStr.charAt(enc3) + this._keyStr.charAt(enc4)\r\n    }\r\n\r\n    return output\r\n  },\r\n\r\n  // public method for decoding\r\n  decode: function (input) {\r\n    var output = ''\r\n    var chr1, chr2, chr3\r\n    var enc1, enc2, enc3, enc4\r\n    var i = 0\r\n\r\n    input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, '')\r\n\r\n    while (i < input.length) {\r\n      enc1 = this._keyStr.indexOf(input.charAt(i++))\r\n      enc2 = this._keyStr.indexOf(input.charAt(i++))\r\n      enc3 = this._keyStr.indexOf(input.charAt(i++))\r\n      enc4 = this._keyStr.indexOf(input.charAt(i++))\r\n\r\n      chr1 = (enc1 << 2) | (enc2 >> 4)\r\n      chr2 = ((enc2 & 15) << 4) | (enc3 >> 2)\r\n      chr3 = ((enc3 & 3) << 6) | enc4\r\n\r\n      output = output + String.fromCharCode(chr1)\r\n\r\n      if (enc3 != 64) {\r\n        output = output + String.fromCharCode(chr2)\r\n      }\r\n      if (enc4 != 64) {\r\n        output = output + String.fromCharCode(chr3)\r\n      }\r\n    }\r\n\r\n    output = Base64._utf8_decode(output)\r\n\r\n    return output\r\n  },\r\n\r\n  // private method for UTF-8 encoding\r\n  _utf8_encode: function (string) {\r\n    string = string.replace(/\\r\\n/g, '\\n')\r\n    var utftext = ''\r\n\r\n    for (var n = 0; n < string.length; n++) {\r\n      var c = string.charCodeAt(n)\r\n\r\n      if (c < 128) {\r\n        utftext += String.fromCharCode(c)\r\n      } else if ((c > 127) && (c < 2048)) {\r\n        utftext += String.fromCharCode((c >> 6) | 192)\r\n        utftext += String.fromCharCode((c & 63) | 128)\r\n      } else {\r\n        utftext += String.fromCharCode((c >> 12) | 224)\r\n        utftext += String.fromCharCode(((c >> 6) & 63) | 128)\r\n        utftext += String.fromCharCode((c & 63) | 128)\r\n      }\r\n    }\r\n\r\n    return utftext\r\n  },\r\n\r\n  // private method for UTF-8 decoding\r\n  _utf8_decode: function (utftext) {\r\n    var string = ''\r\n    var i = 0\r\n    var c = c1 = c2 = 0\r\n\r\n    while (i < utftext.length) {\r\n      c = utftext.charCodeAt(i)\r\n\r\n      if (c < 128) {\r\n        string += String.fromCharCode(c)\r\n        i++\r\n      } else if ((c > 191) && (c < 224)) {\r\n        c2 = utftext.charCodeAt(i + 1)\r\n        string += String.fromCharCode(((c & 31) << 6) | (c2 & 63))\r\n        i += 2\r\n      } else {\r\n        c2 = utftext.charCodeAt(i + 1)\r\n        c3 = utftext.charCodeAt(i + 2)\r\n        string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63))\r\n        i += 3\r\n      }\r\n    }\r\n\r\n    return string\r\n  }\r\n\r\n}\r\n\r\nexport default Base64\r\n","/**\r\n * Created by tong on 6/7/2016.\r\n */\r\n\r\nlet caches = {}\r\n\r\nlet Cache = {\r\n  get: function (key, namespace) {\r\n    return this.getCache(namespace)[key]\r\n  },\r\n\r\n  set: function (key, value, namespace) {\r\n    this.getCache(namespace)[key] = value\r\n  },\r\n\r\n  contains: function (key, namespace) {\r\n    return key in this.getCache(namespace)\r\n  },\r\n\r\n  remove: function (key, namespace) {\r\n    delete this.getCache(namespace)[key]\r\n  },\r\n\r\n  clear: function (namespace) {\r\n    if (!namespace) { caches = {} } else if (caches[namespace]) { caches[namespace] = {} }\r\n  },\r\n\r\n  getCache: function (namespace = 'default') {\r\n    if (!caches[namespace]) { caches[namespace] = {} }\r\n    return caches[namespace]\r\n  }\r\n}\r\n\r\nexport default Cache\r\n","import _ from 'lodash'\r\n\r\nconst inBrowser = () => {\r\n  return typeof window !== 'undefined' && window.navigator && typeof navigator !== 'undefined'\r\n}\r\n\r\n/**\r\n * dom Utility functions\r\n */\r\nexport default {\r\n  isIE: (function () {\r\n    if (!inBrowser()) return false\r\n    var sAgent = window.navigator.userAgent\r\n    var Idx = sAgent.indexOf('MSIE')\r\n\r\n    if (Idx > 0) {\r\n      // If IE, return version number.\r\n      return parseInt(sAgent.substring(Idx + 5, sAgent.indexOf('.', Idx)))\r\n    } else if (navigator.userAgent.match(/Trident\\/7\\./)) { // If IE 11 then look for Updated user agent string.\r\n      return 11\r\n    } else if (navigator.userAgent.match(/Edge\\//)) {\r\n      return 'Edge'\r\n    } else {\r\n      return false\r\n    }\r\n  })(),\r\n\r\n  isFireFox: (function () {\r\n    // InstallTrigger: Firefox's API to install add-ons\r\n    return typeof InstallTrigger !== 'undefined'\r\n  })(),\r\n\r\n  isChrome: (function () {\r\n    if (!inBrowser() || navigator.userAgent.indexOf('Edge') >= 0) return false\r\n    var raw = navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./)\r\n    return raw ? parseInt(raw[2], 10) : false\r\n  })(),\r\n\r\n  isMac: (function () {\r\n    if (!inBrowser()) return false\r\n    return navigator.platform.toUpperCase().indexOf('MAC') >= 0\r\n  })(),\r\n\r\n  isWindows: (function () {\r\n    if (!inBrowser()) return false\r\n    return navigator.appVersion.indexOf('Windows') >= 0\r\n  })(),\r\n\r\n  isLinux: (function () {\r\n    if (!inBrowser()) return false\r\n    return navigator.appVersion.indexOf('Linux') >= 0\r\n  })(),\r\n\r\n  createElement: function (tag, attribs, styles, html) {\r\n    let el = document.createElement(tag)\r\n    this.setElement(el, attribs, styles)\r\n    if (html) { el.innerHTML = html }\r\n    return el\r\n  },\r\n\r\n  createElementByString: function (str) {\r\n    let temp = this.createElement('div', null, null, str)\r\n    return temp.childNodes\r\n  },\r\n\r\n  setElement: function (el, attribs, styles) {\r\n    if (attribs) {\r\n      _.forEach(attribs, function (value, key) {\r\n        el.setAttribute(key, value)\r\n      })\r\n    }\r\n    if (styles) {\r\n      _.forEach(styles, function (value, key) {\r\n        el.style[key] = value\r\n      })\r\n    }\r\n  },\r\n\r\n  testElement: function (node, method) {\r\n    return node && node.nodeType === 1 && (!method || method(node))\r\n  },\r\n\r\n  getAncestorBy: function (node, method) {\r\n    while ((node = node.parentNode) !== null) {\r\n      if (this.testElement(node, method)) { return node }\r\n    }\r\n\r\n    return null\r\n  },\r\n\r\n  /**\r\n   * Get the position of element relative to the context.\r\n   * @param el the element\r\n   * @param context\r\n   * @returns {*[]}\r\n   */\r\n  getPosition (el, context) {\r\n    if (!context) context = document.body\r\n    let elRect = el.getBoundingClientRect()\r\n    let contextRect = context.getBoundingClientRect()\r\n\r\n    return [elRect.left - contextRect.left, elRect.top - contextRect.top]\r\n  },\r\n\r\n  getCenterPosition (el, context) {\r\n    if (!context) context = document.body\r\n    let elRect = el.getBoundingClientRect()\r\n    let contextRect = context.getBoundingClientRect()\r\n    let w = elRect.right - elRect.left\r\n    let h = elRect.bottom - elRect.top\r\n\r\n    return [elRect.left - contextRect.left + w / 2, elRect.top - contextRect.top + h / 2]\r\n  },\r\n\r\n  move: function (el, x, y) {\r\n    if (x) el.style.left = x + 'px'\r\n    if (y) el.style.top = y + 'px'\r\n  },\r\n\r\n  getSize: function (el) {\r\n    var w = parseInt(el.style.offsetWidth, 10)\r\n    var h = parseInt(el.style.offsetHeight, 10)\r\n    return [w, h]\r\n  },\r\n\r\n  resize: function (el, w, h) {\r\n    if (w) el.style.width = w + 'px'\r\n    if (h) el.style.height = h + 'px'\r\n  },\r\n\r\n  preloadImages: function (array) {\r\n    if (!this.preloadImages.list) this.preloadImages.list = []\r\n    if (!this.preloadImages.loaded) this.preloadImages.loaded = {}\r\n\r\n    var list = this.preloadImages.list\r\n    var img; var that = this\r\n    for (var i = 0; i < array.length; i++) {\r\n      img = new Image()\r\n      img.onload = function () {\r\n        var index = list.indexOf(this)\r\n        if (index !== -1) {\r\n          that.preloadImages.loaded[this.name] = { width: this.width, height: this.height }\r\n          // remove image from the array once it's loaded\r\n          // for memory consumption reasons\r\n          list.splice(index, 1)\r\n        }\r\n      }\r\n      list.push(img)\r\n      img.src = array[i]\r\n      img.name = array[i]\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get's the image's information given the url. Must be preloaded by calling the preloadImage function.\r\n   * @param src\r\n   */\r\n  getImageInfo: function (src) {\r\n    if (this.preloadImages.loaded) {\r\n      return this.preloadImages.loaded[src]\r\n    }\r\n    return null\r\n  },\r\n\r\n  downloadFile: function (name, data) {\r\n    if (!data) return\r\n    let mime = data.match(/^data:([^;,]*)/)[1]\r\n    if (name.indexOf('.') < 0) {\r\n      if (!mime) mime = 'text/plain'\r\n      if (mime === 'text/plain') { name = name + '.txt' } else {\r\n        let type = mime.split('/')[1]\r\n        if (type.indexOf('+') > 0) type = type.split('+')[0]\r\n        name = name + '.' + type\r\n      }\r\n    }\r\n    if (this.isIE) {\r\n      let encoded = data.indexOf(';base64') >= 0\r\n      if (encoded) { data = atob(data.replace('data:' + mime + ';base64,', '')) } else { data = decodeURI(data.replace('data:' + mime + ',', '')) }\r\n      data = this.GetBlob(data, mime)\r\n      navigator.msSaveBlob(data, name)\r\n    } else {\r\n      let link = this.createElement('a', { href: data, download: name }, { display: 'none' })\r\n      document.body.appendChild(link)\r\n      link.click()\r\n      link.parentNode.removeChild(link)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Convert b54 to blob. IE only\r\n   */\r\n  GetBlob: function (data, contentType, sliceSize) {\r\n    contentType = contentType || ''\r\n    sliceSize = sliceSize || 512\r\n\r\n    var byteArrays = []\r\n\r\n    for (var offset = 0; offset < data.length; offset += sliceSize) {\r\n      var slice = data.slice(offset, offset + sliceSize)\r\n\r\n      var byteNumbers = new Array(slice.length)\r\n      for (var i = 0; i < slice.length; i++) {\r\n        byteNumbers[i] = slice.charCodeAt(i)\r\n      }\r\n      var byteArray = new Uint8Array(byteNumbers)\r\n      byteArrays.push(byteArray)\r\n    }\r\n    return new Blob(byteArrays, { type: contentType })\r\n  },\r\n\r\n  openImage: function (name, image) {\r\n    if (!inBrowser()) return\r\n    var myWindow = window.open('', '_blank', 'toolbar=yes, scrollbars=yes, resizable=yes, width=500, height=500')\r\n    var myDocument = myWindow.document\r\n    var img = myDocument.createElement('img')\r\n    this.setElement(img, { src: image, name: name })\r\n    myDocument.body.appendChild(img)\r\n  },\r\n\r\n  /**\r\n   * Check whether the key event is from input, textarea or select.\r\n   * @param e  input event\r\n   */\r\n  eventFromInput: function (e) {\r\n    var tagName = e.target.tagName\r\n    return (tagName === 'INPUT' || tagName === 'TEXTAREA' || tagName === 'SELECT')\r\n  },\r\n\r\n  /**\r\n   * Wait for the element with the specified id to come into existence. Returns a promise\r\n   * @param {*} id The id of the element to wait for\r\n   */\r\n  waitForElement (id) {\r\n    return new Promise(resolve => {\r\n      const el = document.getElementById(id)\r\n      if (!el) {\r\n        const interval = setInterval(() => {\r\n          const el = document.getElementById(id)\r\n          if (el) {\r\n            clearInterval(interval)\r\n            return resolve(el)\r\n          }\r\n        }, 200)\r\n      } else {\r\n        return resolve(el)\r\n      }\r\n    })\r\n  }\r\n}\r\n","import _ from 'lodash'\r\n\r\n/**\r\n * A string buffer for fast string manipulation\r\n */\r\nexport default class StringBuffer {\r\n  constructor (str) {\r\n    this.buffer = []\r\n    if (str) { this.buffer.push(str) }\r\n  }\r\n\r\n  append (stuff) {\r\n    if (_.isString(stuff)) { this.buffer.push(stuff) } else if (_.isArray(stuff)) { this.buffer = this.buffer.concat(stuff) } else { this.buffer.push('' + stuff) }\r\n    return this\r\n  }\r\n\r\n  prepend (stuff) {\r\n    if (_.isString(stuff)) { this.buffer.splice(0, 0, stuff) } else if (_.isArray(stuff)) { this.buffer = stuff.concat(this.buffer) } else { this.buffer.splice(0, 0, '' + stuff) }\r\n    return this\r\n  }\r\n\r\n  clear () {\r\n    this.buffer = []\r\n  }\r\n\r\n  removeLast () {\r\n    this.buffer.pop()\r\n    return this\r\n  }\r\n\r\n  toString (sep) {\r\n    if (!sep) sep = ''\r\n    return this.buffer.join(sep)\r\n  }\r\n}\r\n","import Point from './Point'\r\n\r\nexport default class Line {\r\n  constructor (start, end) {\r\n    this.start = start\r\n    this.end = end\r\n  }\r\n\r\n  /**\r\n   * Calculate the length of this line\r\n   */\r\n  length () {\r\n    return this.start.distance(this.end)\r\n  }\r\n\r\n  /**\r\n   * Calculate the distance of this line to the point.\r\n   */\r\n  distance (pt) {\r\n    const x = this.start.distance(pt)\r\n    if (x === 0) return 0\r\n\r\n    const l = this.length()\r\n    const cosa = new Point((this.end.x - this.start.x) / l, (this.end.y - this.start.y) / l).dotProduct(\r\n      new Point(pt.x / x, pt.y / x))\r\n\r\n    return x * Math.sqrt(1 - cosa * cosa)\r\n  }\r\n\r\n  /**\r\n   * Function: intersection\r\n   *\r\n   * Returns the intersection of two lines as an <mxPoint>.\r\n   *\r\n   * Parameters:\r\n   *\r\n   * x0 - X-coordinate of the first line's startpoint.\r\n   * y0 - X-coordinate of the first line's startpoint.\r\n   * x1 - X-coordinate of the first line's endpoint.\r\n   * y1 - Y-coordinate of the first line's endpoint.\r\n   * x2 - X-coordinate of the second line's startpoint.\r\n   * y2 - Y-coordinate of the second line's startpoint.\r\n   * x3 - X-coordinate of the second line's endpoint.\r\n   * y3 - Y-coordinate of the second line's endpoint.\r\n   */\r\n  static intersection (x0, y0, x1, y1, x2, y2, x3, y3) {\r\n    const denom = ((y3 - y2) * (x1 - x0)) - ((x3 - x2) * (y1 - y0))\r\n    const numeA = ((x3 - x2) * (y0 - y2)) - ((y3 - y2) * (x0 - x2))\r\n    const numeB = ((x1 - x0) * (y0 - y2)) - ((y1 - y0) * (x0 - x2))\r\n\r\n    const ua = numeA / denom\r\n    const ub = numeB / denom\r\n\r\n    if (ua >= 0.0 && ua <= 1.0 && ub >= 0.0 && ub <= 1.0) {\r\n      // Get the intersection point\r\n      var intersectionX = x0 + ua * (x1 - x0)\r\n      var intersectionY = y0 + ua * (y1 - y0)\r\n\r\n      return new Point(intersectionX, intersectionY)\r\n    }\r\n\r\n    // No intersection\r\n    return null\r\n  }\r\n\r\n  toString () {\r\n    return 'Line:{start=' + this.start + ';end=' + this.end + '}'\r\n  }\r\n}\r\n","import Shape from './Shape'\r\nimport Point from './Point'\r\nimport Rectangle from './Rectangle'\r\n\r\nexport default class Ellipse extends Shape {\r\n  toString () {\r\n    return 'Ellipse:{x=' + this.x + ';y=' + this.y + ';width=' + this.width + ';height=' + this.height + '}'\r\n  }\r\n\r\n  static getPerimeter (rect, pt, orthogonal = false) {\r\n    let a = rect.width / 2\r\n    let b = rect.height / 2\r\n    let cx = rect.x\r\n    let cy = rect.y\r\n    let px = pt.x\r\n    let py = pt.y\r\n\r\n    // Calculates straight line equation through\r\n    // point and ellipse center y = d * x + h\r\n    let dx = parseInt(px - cx)\r\n    let dy = parseInt(py - cy)\r\n\r\n    if (dx === 0 && dy !== 0) {\r\n      return new Point(cx, cy + b * dy / Math.abs(dy))\r\n    } else if (dx === 0 && dy === 0) {\r\n      return new Point(px, py)\r\n    }\r\n\r\n    // Calculates intersection\r\n    let d = dy / dx\r\n    let h = cy - d * cx\r\n    let e = a * a * d * d + b * b\r\n    let f = -2 * cx * e\r\n    let g = a * a * d * d * cx * cx + b * b * cx * cx - a * a * b * b\r\n    let det = Math.sqrt(f * f - 4 * e * g)\r\n\r\n    // Two solutions (perimeter points)\r\n    let xout1 = (-f + det) / (2 * e)\r\n    let xout2 = (-f - det) / (2 * e)\r\n    let yout1 = d * xout1 + h\r\n    let yout2 = d * xout2 + h\r\n    let dist1 = Math.sqrt(Math.pow((xout1 - px), 2) + Math.pow((yout1 - py), 2))\r\n    let dist2 = Math.sqrt(Math.pow((xout2 - px), 2) + Math.pow((yout2 - py), 2))\r\n\r\n    // Correct solution\r\n    let xout = 0\r\n    let yout = 0\r\n\r\n    if (dist1 < dist2) {\r\n      xout = xout1\r\n      yout = yout1\r\n    } else {\r\n      xout = xout2\r\n      yout = yout2\r\n    }\r\n\r\n    let p = new Point(xout, yout)\r\n    let dir = Rectangle.getDirection(rect, p, orthogonal)\r\n    if (orthogonal) {\r\n      if (dir.x === -1) {\r\n        return { point: new Point(cx - a, cy), direction: dir }\r\n      }\r\n      if (dir.x === 1) {\r\n        return { point: new Point(cx + a, cy), direction: dir }\r\n      }\r\n      if (dir.y === -1) {\r\n        return { point: new Point(cx, cy - b), direction: dir }\r\n      }\r\n      if (dir.y === 1) {\r\n        return { point: new Point(cx, cy + b), direction: dir }\r\n      }\r\n    }\r\n    return { point: p, direction: dir }\r\n  }\r\n}\r\n","import Shape from './Shape'\r\nimport Point from './Point'\r\nimport Line from './Line'\r\n\r\nexport default class Rhombus extends Shape {\r\n  toString () {\r\n    return 'Rhombus:{x=' + this.x + ';y=' + this.y + ';width=' + this.width + ';height=' + this.height + '}'\r\n  }\r\n\r\n  static getPerimeter (rect, pt, orthogonal = false) {\r\n    let w = rect.width\r\n    let h = rect.height\r\n    let cx = rect.x\r\n    let cy = rect.y\r\n    let x = cx - w / 2\r\n    let y = cy - h / 2\r\n\r\n    let px = pt.x\r\n    let py = pt.y\r\n\r\n    // Special case for intersecting the diamond's corners\r\n    if (cx === px) {\r\n      if (cy > py) {\r\n        return { point: new Point(cx, y), direction: Point.S }\r\n        // top\r\n      } else {\r\n        return { point: new Point(cx, y + h), direction: Point.N }\r\n        // bottom\r\n      }\r\n    } else if (cy === py) {\r\n      if (cx > px) {\r\n        return { point: new Point(x, cy), direction: Point.E }\r\n        // left\r\n      } else {\r\n        return { point: new Point(x + w, cy), direction: Point.W }\r\n        // right\r\n      }\r\n    }\r\n\r\n    let tx = cx\r\n    let ty = cy\r\n\r\n    if (orthogonal) {\r\n      if (px >= x && px <= x + w) {\r\n        tx = px\r\n      } else if (py >= y && py <= y + h) {\r\n        ty = py\r\n      }\r\n    }\r\n\r\n    let p, dir\r\n    // TODO direction calculation is not quite right.\r\n    // In which quadrant will the intersection be?\r\n    // set the slope and offset of the border line accordingly\r\n    if (px < cx) {\r\n      if (py < cy) {\r\n        p = Line.intersection(px, py, tx, ty, cx, y, x, cy)\r\n        dir = Point.S\r\n      } else {\r\n        p = Line.intersection(px, py, tx, ty, cx, y + h, x, cy)\r\n        dir = Point.N\r\n      }\r\n    } else if (py < cy) {\r\n      p = Line.intersection(px, py, tx, ty, cx, y, x + w, cy)\r\n      dir = Point.E\r\n    } else {\r\n      p = Line.intersection(px, py, tx, ty, cx, y + h, x + w, cy)\r\n      dir = Point.W\r\n    }\r\n    return { point: p, direction: dir }\r\n  }\r\n}\r\n","import _ from 'lodash'\r\nimport Point from './Point'\r\nimport Utils from '../util/Utils'\r\n\r\nlet defaultConfig = {\r\n  type: 'direct',\r\n  showGauge: true,\r\n  orthogonal: false\r\n}\r\n\r\nlet defaultGeometry = {\r\n  width: 0,\r\n  height: 0,\r\n  anchorX: 0,\r\n  anchorY: 0,\r\n  offsetX: 0,\r\n  offsetY: 0\r\n}\r\n\r\nlet linkTypes = {}\r\n\r\nclass Link {\r\n  constructor (terminalVisual, shapeConfig = {}, startMarker = null, endMarker = null) {\r\n    this.start = terminalVisual[0].point\r\n    this.end = terminalVisual[1].point\r\n    this.startNormal = terminalVisual[0].direction\r\n    this.endNormal = terminalVisual[1].direction\r\n    this.startMarker = startMarker\r\n    this.endMarker = endMarker\r\n    Object.assign(this, shapeConfig)\r\n  }\r\n\r\n  render (view) {\r\n    return view.renderLink(this)\r\n  }\r\n\r\n  get points () { return null }\r\n  get controlPts () { return null }\r\n  get length () {\r\n    let points = this.points\r\n    let i\r\n    let l = 0\r\n    for (i = 0; i < points.length - 1; i++) {\r\n      l += points[i].distance(points[i + 1])\r\n    }\r\n    return l\r\n  }\r\n\r\n  /**\r\n   * Calculate the position where to put decorators or label..\r\n   *\r\n   * @param geometry: defines how far along the edge should the point be placed.\r\n   * @return *[] the relative position.\r\n   */\r\n  getRelativePosition (geometry) {\r\n    if (_.isNumber(geometry)) {\r\n      geometry = { x: geometry }\r\n    }\r\n    geometry = _.defaults(geometry, defaultGeometry)\r\n    let p = geometry.x\r\n    let l = this.length\r\n    if (Math.abs(p) <= 1) p *= l\r\n    if (p < 0) p = l + p\r\n    if (p > l) p = l\r\n\r\n    let points = this.points\r\n    let d\r\n    let point\r\n    let dir\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n      d = points[i].distance(points[i + 1])\r\n      if (p <= d) {\r\n        // we've located the line segment.\r\n        point = points[i].clone()\r\n        dir = point.getDirection(points[i + 1])\r\n        point.translate(dir.getScaled(p))\r\n        break\r\n      }\r\n      p -= d\r\n    }\r\n\r\n    // return the last point.\r\n    if (!point) {\r\n      point = points[points.length - 1]\r\n    }\r\n    return Utils.offsetPosition([point.x, point.y], geometry)\r\n  }\r\n\r\n  toString () {\r\n    return 'Link'\r\n  }\r\n\r\n  static getLink (terminalVisual, shapeConfig = {}, startMarker = null, endMarker = null) {\r\n    shapeConfig = _.defaultsDeep(shapeConfig, defaultConfig)\r\n    let LinkClass = linkTypes[shapeConfig.type]\r\n    if (LinkClass) {\r\n      return new LinkClass(terminalVisual, shapeConfig, startMarker, endMarker)\r\n    }\r\n    console.log('link type not supported: ' + shapeConfig.type)\r\n    return null\r\n  }\r\n}\r\n\r\nclass DirectLink extends Link {\r\n  get points () {\r\n    return [this.start, this.end]\r\n  }\r\n}\r\n\r\nclass BezierLink extends Link {\r\n  get points () {\r\n    return [this.start, this.end]\r\n  }\r\n\r\n  get controlPts () {\r\n    let s = this.points[0]; let e = this.points[1]\r\n    let pts = []\r\n    pts[0] = null\r\n    pts[1] = []\r\n    if (this.startNormal.x === 0) {\r\n      pts[1][0] = new Point(s.x, (s.y + e.y) / 2)\r\n    } else {\r\n      pts[1][0] = new Point((s.x + e.x) / 2, s.y)\r\n    }\r\n    if (this.endNormal.x === 0) {\r\n      pts[1][1] = new Point(e.x, (s.y + e.y) / 2)\r\n    } else {\r\n      pts[1][1] = new Point((s.x + e.x) / 2, e.y)\r\n    }\r\n    return pts\r\n  }\r\n\r\n  getRelativePosition (geometry) {\r\n    if (_.isNumber(geometry)) {\r\n      geometry = { x: geometry }\r\n    }\r\n    geometry = _.defaults(geometry, defaultGeometry)\r\n    let p = geometry.x\r\n    let l = this.length\r\n    if (Math.abs(p) > 1) p /= l\r\n    if (p < 0) p++\r\n    if (p > 1) p--\r\n\r\n    let pts = this.points\r\n    let ctrlpts = this.controlPts\r\n    let p1 = pts[0]\r\n    let p2 = ctrlpts[1][0]\r\n    let p3 = ctrlpts[1][1]\r\n    let p4 = pts[1]\r\n\r\n    let point = [(1 - p) * (1 - p) * (1 - p) * p1.x + 3 * p * (1 - p) * (1 - p) * p2.x + 3 * p * p * (1 - p) * p3.x + p * p * p * p4.x, (1 - p) * (1 - p) * (1 - p) * p1.y + 3 * p * (1 - p) * (1 - p) * p2.y + 3 * p * p * (1 - p) * p3.y + p * p * p * p4.y]\r\n    return Utils.offsetPosition([point.x, point.y], geometry)\r\n  }\r\n}\r\n\r\nclass EntityRelations extends Link {\r\n  get points () {\r\n    let source = Port.getBounds(edge, true)\r\n    let target = Port.getBounds(edge, false)\r\n    let isSourceLeft = target.right() < source.x\r\n    let isTargetLeft = source.right() < target.x\r\n    let result = []\r\n\r\n    let x0 = (isSourceLeft) ? source.x : source.x + source.width\r\n    let y0 = source.getCenterY()\r\n    result.push(new Point(x0, y0))\r\n\r\n    let xe = (isTargetLeft) ? target.x : target.x + target.width\r\n    let ye = target.getCenterY()\r\n\r\n    let seg = this.segment\r\n\r\n    let dx = (isSourceLeft) ? -seg : seg\r\n    let dep = new Point(x0 + dx, y0)\r\n\r\n    dx = (isTargetLeft) ? -seg : seg\r\n    let arr = new Point(xe + dx, ye)\r\n\r\n    // Adds intermediate points if both go out on same side\r\n    if (isSourceLeft === isTargetLeft) {\r\n      let x = (isSourceLeft) ? Math.min(x0, xe) - seg : Math.max(x0, xe) + seg\r\n\r\n      result.push(new Point(x, y0))\r\n      result.push(new Point(x, ye))\r\n    } else if ((dep.x < arr.x) === isSourceLeft) {\r\n      let midY = y0 + (ye - y0) / 2\r\n\r\n      result.push(dep)\r\n      result.push(new Point(dep.x, midY))\r\n      result.push(new Point(arr.x, midY))\r\n      result.push(arr)\r\n    } else {\r\n      result.push(dep)\r\n      result.push(arr)\r\n    }\r\n\r\n    result.push(new Point(xe, ye))\r\n    return result\r\n  }\r\n}\r\n\r\nclass Manhattan extends Link {\r\n  constructor (terminalVisual, shapeConfig, startMarker, endMarker) {\r\n    shapeConfig = _.defaults(shapeConfig, {\r\n      MIN_BUFFER: 10,\r\n      autoRoute: false,\r\n      randomNoise: 0,\r\n      step: 1,\r\n      maxChannelWidth: 100\r\n    })\r\n    super(terminalVisual, shapeConfig, startMarker, endMarker)\r\n  }\r\n\r\n  get points () {\r\n    let pos = Manhattan.route(this.start, this.end, this.startNormal, this.endNormal, this.MIN_BUFFER)\r\n    if (this.autoRoute) {\r\n      this._mergeSegments(pos)\r\n      let boxes = []\r\n      let node\r\n      let startBox\r\n      let endBox\r\n      let container = edge.source.getCommonAncestor(edge.target)\r\n      let childNodes = container.getDescendants()\r\n      let index = 0\r\n      for (let i = 0; i < childNodes.length; i++) {\r\n        node = childNodes[i]\r\n        // Do not include source or target ancestors in routing.\r\n        if (node.excludeFromRouting(edge) || node.isAncestor(edge.source) || node.isAncestor(edge.target)) continue\r\n        if (node === edge.source) {\r\n          startBox = index\r\n        }\r\n        if (node === edge.target) {\r\n          endBox = index\r\n        }\r\n        boxes.push(node.getBounds(document))\r\n        index++\r\n      }\r\n      if (boxes.length > 1) {\r\n        this.autoRoute(pos, container.getBounds(document), boxes, startBox, endBox)\r\n      }\r\n    }\r\n\r\n    Manhattan._mergeSegments(pos)\r\n    if (this.randomNoise && pos.length > 3) {\r\n      for (let j = 1; j < 2; j++) {\r\n        let range = this.randomNoise / this.step\r\n        let randomNumber = Math.floor(Math.random() * range * 2 - range + 1) * this.step\r\n\r\n        let noise\r\n        if (this.randomNoise && pos.length == 4) {\r\n          if (this.startNormal.x != 0 && this.startNormal.x != this.endNormal.x) {\r\n            if (this.randomNoise <= Math.abs(pos[1].x - pos[0].x - this.startNormal.x * this.MIN_BUFFER)) {\r\n              noise = this.randomNoise\r\n            } else {\r\n              noise = Math.abs(pos[1].x - pos[0].x - this.startNormal.x * this.MIN_BUFFER)\r\n            }\r\n          } else if (this.startNormal.y != 0 && this.startNormal.y != this.endNormal.y) {\r\n            if (this.randomNoise <= Math.abs(pos[1].y - pos[0].y - this.startNormal.y * this.MIN_BUFFER)) {\r\n              noise = this.randomNoise\r\n            } else {\r\n              noise = Math.abs(pos[1].y - pos[0].y - this.startNormal.y * this.MIN_BUFFER)\r\n            }\r\n          } else {\r\n            noise = this.randomNoise\r\n          }\r\n          let range = noise / this.step\r\n          let randomNumber\r\n          if (this.startNormal.x !== this.endNormal.x || this.startNormal.y !== this.endNormal.y) {\r\n            randomNumber = Math.floor(Math.random() * range * 2 - range + 1) * this.step\r\n          } else {\r\n            randomNumber = Math.sign(this.startNormal.x !== 0 ? this.startNormal.x : this.startNormal.y) * Math.floor(Math.random() * range + 1) * this.step\r\n          }\r\n          this._moveSegment2(pos, 1, randomNumber, 1, 1)\r\n        }\r\n        if (this.randomNoise && pos.length > 4) {\r\n          for (let i = 1; i < pos.length - 2; i++) {\r\n            range = this.randomNoise / this.step\r\n            if (i == 1) {\r\n              randomNumber = Math.sign(this.startNormal.x !== 0 ? this.startNormal.x : this.startNormal.y) * Math.floor(Math.random() * range + 1) * this.step\r\n            } else if (i == pos.length - 3) {\r\n              randomNumber = Math.sign(this.endNormal.x !== 0 ? this.endNormal.x : this.endNormal.y) * Math.floor(Math.random() * range + 1) * this.step\r\n            } else {\r\n              randomNumber = Math.floor(Math.random() * range * 2 - range + 1) * this.step\r\n            }\r\n            this._moveSegment2(pos, i, randomNumber, 1, 1)\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return pos\r\n  }\r\n\r\n  // New function for finding route\r\n  static route (start, end, startNormal, endNormal, buffer) {\r\n    let startBuffer = new Point(start.x + startNormal.x * buffer, start.y + startNormal.y * buffer)\r\n    let endBuffer = new Point(end.x + endNormal.x * buffer, end.y + endNormal.y * buffer)\r\n    let startBufferNormal, endBufferNormal\r\n    let pts\r\n    if (startNormal.x !== 0) {\r\n      if ((endBuffer.x - startBuffer.x) / startNormal.x > 0) {\r\n        startBufferNormal = startNormal\r\n      } else {\r\n        startBufferNormal = new Point(0, (endBuffer.y >= startBuffer.y) ? 1 : -1)\r\n      }\r\n    } else {\r\n      if ((endBuffer.y - startBuffer.y) / startNormal.y > 0) {\r\n        startBufferNormal = startNormal\r\n      } else {\r\n        startBufferNormal = new Point((endBuffer.x >= startBuffer.x) ? 1 : -1, 0)\r\n      }\r\n    }\r\n    if (endNormal.x !== 0) {\r\n      if ((startBuffer.x - endBuffer.x) / endNormal.x > 0) {\r\n        endBufferNormal = endNormal\r\n      } else {\r\n        endBufferNormal = new Point(0, (startBuffer.y >= endBuffer.y) ? 1 : -1)\r\n      }\r\n    } else {\r\n      if ((startBuffer.y - endBuffer.y) / endNormal.y > 0) {\r\n        endBufferNormal = endNormal\r\n      } else {\r\n        endBufferNormal = new Point((startBuffer.x >= endBuffer.x) ? 1 : -1, 0)\r\n      }\r\n    }\r\n\r\n    if (startBufferNormal.dotProduct(endBufferNormal) === 0) {\r\n      let middle = (startBufferNormal.x === 0) ? new Point(startBuffer.x, endBuffer.y) : new Point(endBuffer.x, startBuffer.y)\r\n      pts = [start, startBuffer, middle, endBuffer, end]\r\n    } else if (startBufferNormal.dotProduct(endBufferNormal) < 0) {\r\n      if (startBufferNormal.x === 0) {\r\n        pts = [start, startBuffer, new Point(startBuffer.x, (start.y + end.y) / 2), new Point(endBuffer.x, (start.y + end.y) / 2), endBuffer, end]\r\n      } else {\r\n        pts = [start, startBuffer, new Point((start.x + end.x) / 2, startBuffer.y), new Point((start.x + end.x) / 2, endBuffer.y), endBuffer, end]\r\n      }\r\n    } else {\r\n      pts = [start, startBuffer, new Point(startBuffer.x + startBufferNormal.x * buffer, startBuffer.y + startBufferNormal.y * buffer), new Point(endBuffer.x + endBufferNormal.x * buffer, endBuffer.y + endBufferNormal.y * buffer), endBuffer, end]\r\n    }\r\n\r\n    let prunePts = []\r\n    prunePts[0] = pts[0]\r\n    for (let i = 1; i < pts.length - 1; i++) {\r\n      if ((pts[i].x === pts[i - 1].x && pts[i].x === pts[i + 1].x) || (pts[i].y === pts[i - 1].y && pts[i].y === pts[i + 1].y)) {\r\n        continue\r\n      }\r\n      prunePts.push(pts[i])\r\n    }\r\n    prunePts.push(pts[pts.length - 1])\r\n    return prunePts\r\n  }\r\n\r\n  /**\r\n  * Automatically route the connection to avoid intersections with other vertices.\r\n  */\r\n  autoRoute (pts, container, boxes, startBox, endBox) {\r\n    let side, side2, d, box, intersect, j\r\n    let channel, channel2, pt, dir\r\n\r\n    let startPadding = 0; let endPadding\r\n    // first get the start and end channel\r\n    box = boxes[endBox]\r\n    pt = pts[pts.length - 2]\r\n    if (pt.y < box.y) {\r\n      side = 1\r\n    } else if (pt.y > box.y + box.height) {\r\n      side = 3\r\n    } else if (pt.x < box.x) {\r\n      side = 0\r\n    } else {\r\n      side = 2\r\n    }\r\n    channel = _getChannel(container, endBox, boxes, side)\r\n    endPadding = channel.horizontal ? (channel.right - channel.left) / 2 : (channel.bottom - channel.top) / 2\r\n\r\n    for (let i = 0; i < pts.length - 1; i++) {\r\n      if (pts[i + 1].x === pts[i].x && pts[i + 1].y === pts[i].y) continue\r\n      intersect = _getFirstIntersection(pts, i, boxes, startBox, endBox)\r\n      if (!intersect) continue\r\n      j = intersect[0]\r\n      side = intersect[1]\r\n      box = boxes[j]\r\n      channel = _getChannel(container, j, boxes, side)\r\n      switch (side) {\r\n        case 0:\r\n        case 2:\r\n          pt = new Point((channel.right + channel.left) / 2, pts[i].y)\r\n          dir = _getRouteTendency(pts, i, pt, box, side)\r\n          side2 = dir < 0 ? 1 : 3\r\n          channel2 = _getChannel(container, j, boxes, side2)\r\n          // if the previous point is in the channel2, use that point instead of center of the channel.\r\n          if (i > 1 && (pts[i - 2].y === pts[i - 1].y) && (pts[i - 1].y > channel2.top && pts[i - 1].y < channel2.bottom)) {\r\n            d = pts[i - 1].y - pt.y\r\n          } else if (i < pts.length - 3 && (pts[i + 2].y === pts[i + 3].y) && (pts[i + 2].y > channel2.top && pts[i + 2].y < channel2.bottom)) {\r\n            d = pts[i + 2].y - pt.y\r\n          } else {\r\n            d = (channel2.bottom + channel2.top) / 2 - pt.y\r\n          }\r\n          // check if we need this pt.\r\n          if ((side === 0 && pt.x <= pts[i].x) || (side === 2 && pt.x >= pts[i].x)) {\r\n            pt = null\r\n          } else if (i > 0) {\r\n            // see if we can push the line out to where we started.\r\n            if (!_hasIntersection([new Point(pts[i].x, pts[i].y), new Point(pts[i].x, pts[i].y + d), new Point(pt.x, pt.y + d)], boxes)) {\r\n              pt = null\r\n            }\r\n          }\r\n          break\r\n        case 1:\r\n        case 3:\r\n          pt = new Point(pts[i].x, (channel.bottom + channel.top) / 2)\r\n          dir = _getRouteTendency(pts, i, pt, box, side)\r\n          side2 = dir < 0 ? 0 : 2\r\n          channel2 = _getChannel(container, j, boxes, side2)\r\n          // if the previous point is in the channel2, use that point instead of center of the channel.\r\n          if (i > 1 && (pts[i - 2].x === pts[i - 1].x) && (pts[i - 1].x > channel2.left && pts[i - 1].x < channel2.right)) {\r\n            d = pts[i - 1].x - pt.x\r\n          } else if (i < pts.length - 3 && (pts[i + 2].x === pts[i + 3].x) && (pts[i + 2].x > channel2.left && pts[i + 2].x < channel2.right)) {\r\n            d = pts[i + 2].x - pt.x\r\n          } else {\r\n            d = (channel2.right + channel2.left) / 2 - pt.x\r\n          }\r\n          // check if we need this pt.\r\n          if ((side === 1 && pt.y <= pts[i].y) || (side === 3 && pt.y >= pts[i].y)) {\r\n            pt = null\r\n          } else if (i > 0) {\r\n            // see if we can push the line out to where we started.\r\n            if (!_hasIntersection([new Point(pts[i].x, pts[i].y), new Point(pts[i].x + d, pts[i].y), new Point(pt.x + d, pt.y)], boxes)) {\r\n              pt = null\r\n            }\r\n          }\r\n          break\r\n        case 4:\r\n          continue\r\n      }\r\n      // max points.\r\n      if (i > 20) return\r\n      if (pt && (pt.x !== pts[i].x || pt.y !== pts[i].y)) {\r\n        pts.splice(i + 1, 0, pt)\r\n        _moveSegment(pts, i + 1, d, startPadding, endPadding)\r\n        i++\r\n      } else {\r\n        _moveSegment(pts, i, d, startPadding, endPadding)\r\n      }\r\n    }\r\n  }\r\n\r\n  static _hasIntersection (pts, boxes) {\r\n    for (let i = 0; i < pts.length - 1; i++) {\r\n      for (let j = 0; j < boxes.length; j++) {\r\n        if (boxes[j].detectIntersection(pts[i], pts[i + 1]) >= 0) {\r\n          return true\r\n        }\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  static _getFirstIntersection (pts, i, boxes, startBox, endBox) {\r\n    let box\r\n    let side\r\n    let savedIndex = null\r\n    let savedSide = null\r\n    for (let j = 0; j < boxes.length; j++) {\r\n      if ((i === 0 && j === startBox) || (i === pts.length - 2 && j === endBox)) {\r\n        continue\r\n      }\r\n      box = boxes[j]\r\n      side = box.detectIntersection(pts[i], pts[i + 1])\r\n      if (side >= 0) {\r\n        if (savedIndex == null) {\r\n          savedIndex = j\r\n          savedSide = side\r\n        } else {\r\n          if (boxes[savedIndex].distance(pts[i]) > box.distance(pts[i])) {\r\n            savedIndex = j\r\n            savedSide = side\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (savedIndex != null) {\r\n      return [savedIndex, savedSide]\r\n    }\r\n    return null\r\n  }\r\n\r\n  _getRouteTendency (pts, i, breakPt, box, side) {\r\n    let dir\r\n    let p\r\n    switch (side) {\r\n      case 0:\r\n      case 2:\r\n        p = 'y'\r\n        break\r\n      case 1:\r\n      case 3:\r\n        p = 'x'\r\n        break\r\n    }\r\n    // first try the breakpt.\r\n    dir = _getRouteDirection(breakPt, pts[pts.length - 1])[p]\r\n    if (dir === 0) {\r\n      dir = -_getRouteDirection(pts[0], pts[pts.length - 1])[p]\r\n      if (dir === 0) {\r\n        if (breakPt[p] < box.getCenter()[p]) {\r\n          dir = -1\r\n        } else {\r\n          dir = 1\r\n        }\r\n      }\r\n    }\r\n    return dir\r\n  }\r\n\r\n  static _getRouteDirection (pt1, pt2) {\r\n    if (pt1.x === pt2.x) {\r\n      if (pt1.y < pt2.y) return Point.S\r\n      return Point.N\r\n    } else if (pt1.y === pt2.y) {\r\n      if (pt1.x < pt2.x) return Point.E\r\n      return Point.W\r\n    } else if (pt1.x < pt2.x) {\r\n      if (pt1.y < pt2.y) return Point.SE\r\n      return Point.NE\r\n    } else {\r\n      if (pt1.y < pt2.y) return Point.SW\r\n      return Point.NW\r\n    }\r\n  }\r\n\r\n  _getChannel (container, index, boxes, side) {\r\n    let maxChannelWidth = this.maxChannelWidth\r\n    let box1 = boxes[index]; let box2\r\n    let pt, i\r\n    let channel = {}; let l; let t; let b; let r\r\n    switch (side) {\r\n      case 0:\r\n        pt = box1.getLeft()\r\n        channel.right = pt.x\r\n        channel.horizontal = false\r\n        for (i = 0; i < boxes.length; i++) {\r\n          if (i === index) continue\r\n          r = boxes[i].getRight().x\r\n          if (r >= pt.x) continue\r\n          if (!channel.left || channel.left < r) {\r\n            channel.left = r\r\n          }\r\n        }\r\n        if (!channel.left) {\r\n          channel.left = container.getLeft().x\r\n          if (channel.right - channel.left > maxChannelWidth) {\r\n            channel.left = channel.right - maxChannelWidth\r\n          }\r\n        }\r\n        for (i = 0; i < boxes.length; i++) {\r\n          if (i === index) continue\r\n          box2 = boxes[i]\r\n          b = box2.getBottom().y\r\n          t = box2.getTop().y\r\n          if (b < pt.y && (box2.getRight() > channel.left && box2.getLeft() < channel.right)) {\r\n            if (!channel.top || channel.top < b) {\r\n              channel.top = b\r\n            }\r\n          }\r\n          if (t > pt.y && (box2.getRight() > channel.left && box2.getLeft() < channel.right)) {\r\n            if (!channel.bottom || channel.bottom > t) {\r\n              channel.bottom = t\r\n            }\r\n          }\r\n        }\r\n        if (!channel.top) channel.top = container.getTop().y\r\n        if (!channel.bottom) channel.bottom = container.getBottom().y\r\n        break\r\n      case 1:\r\n        pt = box1.getTop()\r\n        channel.horizontal = true\r\n        channel.bottom = pt.y\r\n        for (i = 0; i < boxes.length; i++) {\r\n          if (i === index) continue\r\n          b = boxes[i].getBottom().y\r\n          if (b >= pt.y) continue\r\n          if (!channel.top || channel.top < b) {\r\n            channel.top = b\r\n          }\r\n        }\r\n        if (!channel.top) {\r\n          channel.top = container.getTop().y\r\n          if (channel.bottom - channel.top > maxChannelWidth) {\r\n            channel.top = channel.bottom - maxChannelWidth\r\n          }\r\n        }\r\n        for (i = 0; i < boxes.length; i++) {\r\n          if (i === index) continue\r\n          box2 = boxes[i]\r\n          l = box2.getLeft().x\r\n          r = box2.getRight().x\r\n          if (r < pt.x && (box2.getBottom() > channel.top && box2.getTop() < channel.bottom)) {\r\n            if (!channel.left || channel.left < r) {\r\n              channel.left = r\r\n            }\r\n          }\r\n          if (l > pt.x && (box2.getBottom() > channel.top && box2.getTop() < channel.bottom)) {\r\n            if (!channel.right || channel.right > l) {\r\n              channel.right = l\r\n            }\r\n          }\r\n        }\r\n        if (!channel.left) channel.left = container.getLeft().x\r\n        if (!channel.right) channel.right = container.getRight().x\r\n\r\n        break\r\n      case 2:\r\n        pt = box1.getRight()\r\n        channel.horizontal = false\r\n        channel.left = pt.x\r\n        for (i = 0; i < boxes.length; i++) {\r\n          if (i === index) continue\r\n          l = boxes[i].getLeft().x\r\n          if (l <= pt.x) continue\r\n          if (!channel.right || channel.right > l) {\r\n            channel.right = l\r\n          }\r\n        }\r\n        if (!channel.right) {\r\n          channel.right = container.getRight().x\r\n          if (channel.right - channel.left > maxChannelWidth) {\r\n            channel.right = channel.left + maxChannelWidth\r\n          }\r\n        }\r\n        for (i = 0; i < boxes.length; i++) {\r\n          if (i === index) continue\r\n          box2 = boxes[i]\r\n          b = box2.getBottom().y\r\n          t = box2.getTop().y\r\n          if (b < pt.y && (box2.getRight() > channel.left && box2.getLeft() < channel.right)) {\r\n            if (!channel.top || channel.top < b) {\r\n              channel.top = b\r\n            }\r\n          }\r\n          if (t > pt.y && (box2.getRight() > channel.left && box2.getLeft() < channel.right)) {\r\n            if (!channel.bottom || channel.bottom > t) {\r\n              channel.bottom = t\r\n            }\r\n          }\r\n        }\r\n        if (!channel.top) channel.top = container.getTop().y\r\n        if (!channel.bottom) channel.bottom = container.getBottom().y\r\n        break\r\n      case 3:\r\n        pt = box1.getBottom()\r\n        channel.horizontal = true\r\n        channel.top = pt.y\r\n        for (i = 0; i < boxes.length; i++) {\r\n          if (i === index) continue\r\n          box2 = boxes[i]\r\n          if (box2.getTop().y <= pt.y) continue\r\n          if (!channel.bottom || channel.bottom > box2.getTop().y) {\r\n            channel.bottom = box2.getTop().y\r\n          }\r\n        }\r\n        if (!channel.bottom) {\r\n          channel.bottom = container.getBottom().y\r\n          if (channel.bottom - channel.top > maxChannelWidth) {\r\n            channel.bottom = channel.top + maxChannelWidth\r\n          }\r\n        }\r\n        for (i = 0; i < boxes.length; i++) {\r\n          if (i === index) continue\r\n          box2 = boxes[i]\r\n          l = box2.getLeft().x\r\n          r = box2.getRight().x\r\n          if (r < pt.x && (box2.getBottom() > channel.top && box2.getTop() < channel.bottom)) {\r\n            if (!channel.left || channel.left < r) {\r\n              channel.left = r\r\n            }\r\n          }\r\n          if (l > pt.x && (box2.getBottom() > channel.top && box2.getTop() < channel.bottom)) {\r\n            if (!channel.right || channel.right > l) {\r\n              channel.right = l\r\n            }\r\n          }\r\n        }\r\n        if (!channel.left) channel.left = container.getLeft().x\r\n        if (!channel.right) channel.right = container.getRight().x\r\n        break\r\n    }\r\n    return channel\r\n  }\r\n\r\n  /**\r\n  * Move a line segment by a specified distance.\r\n  *\r\n  * @param pts the list of points.\r\n  * @param i the index of the segment.\r\n  * @param d the distance to move.\r\n  * @param startPadding\r\n  * @param endPadding\r\n  */\r\n  _moveSegment (pts, i, d, startPadding, endPadding) {\r\n    // first check if we need to add new line segments.\r\n    let dir, l, pt\r\n    if (i === 0) {\r\n      // we need to break off the segment, since we can't change the starting point.\r\n      dir = pts[0].getDirection(pts[1])\r\n      if (!startPadding) {\r\n        startPadding = this.MIN_BUFFER\r\n      }\r\n      l = Math.min(startPadding, pts[0].distance(pts[1]) / 2)\r\n      pt = pts[0].getTranslated(dir.scale(l))\r\n      pts.splice(1, 0, pt)\r\n      this._moveSegment(pts, i + 1, d)\r\n      return\r\n    }\r\n    if (i === pts.length - 2) {\r\n      // we need to break off the segment, since we can't change the end point.\r\n      dir = pts[pts.length - 1].getDirection(pts[pts.length - 2])\r\n      if (!endPadding) {\r\n        endPadding = this.MIN_BUFFER\r\n      }\r\n      l = Math.min(endPadding, pts[pts.length - 1].distance(pts[pts.length - 2]) / 2)\r\n      pt = pts[pts.length - 1].getTranslated(dir.scale(l))\r\n      pts.splice(pts.length - 1, 0, pt)\r\n      this._moveSegment(pts, i, d)\r\n      return\r\n    }\r\n\r\n    if (pts[i].y === pts[i + 1].y) {\r\n      if (i > 0 && pts[i - 1].y === pts[i].y) {\r\n        pts.splice(i + 1, 0, pts[i].clone())\r\n        i++\r\n      }\r\n      if (i < pts.length - 2 && pts[i + 1].y === pts[i + 2].y) {\r\n        pts.splice(i + 1, 0, pts[i + 1].clone())\r\n      }\r\n      pts[i].y += d\r\n      pts[i + 1].y += d\r\n    } else {\r\n      if (i > 0 && pts[i - 1].x === pts[i].x) {\r\n        pts.splice(i + 1, 0, pts[i].clone())\r\n        i++\r\n      }\r\n      if (i < pts.length - 2 && pts[i + 1].x === pts[i + 2].x) {\r\n        pts.splice(i + 1, 0, pts[i + 1].clone())\r\n      }\r\n      pts[i].x += d\r\n      pts[i + 1].x += d\r\n    }\r\n  }\r\n\r\n  /**\r\n  * Move a line segment by a specified distance.\r\n  *\r\n  * @param pts the list of points.\r\n  * @param i the index of the segment.\r\n  * @param d the distance to move.\r\n  * @param startPadding\r\n  * @param endPadding\r\n  */\r\n  _moveSegment2 (pts, i, d, startPadding, endPadding) {\r\n    if (pts[i].y === pts[i + 1].y) {\r\n      if (i > 0 && pts[i - 1].y === pts[i].y) {\r\n        pts.splice(i + 1, 0, pts[i].clone())\r\n        i++\r\n      }\r\n      if (i < pts.length - 2 && pts[i + 1].y === pts[i + 2].y) {\r\n        pts.splice(i + 1, 0, pts[i + 1].clone())\r\n      }\r\n      if ((i > 0 && pts[i].y + d === pts[i - 1].y) || (i < pts.length - 2 && pts[i + 1].y + d === pts[i + 2].y)) {\r\n        d *= 0.75\r\n      }\r\n      pts[i].y += d\r\n      pts[i + 1].y += d\r\n    } else {\r\n      if (i > 0 && pts[i - 1].x === pts[i].x) {\r\n        pts.splice(i + 1, 0, pts[i].clone())\r\n        i++\r\n      }\r\n      if (i < pts.length - 2 && pts[i + 1].x === pts[i + 2].x) {\r\n        pts.splice(i + 1, 0, pts[i + 1].clone())\r\n      }\r\n      if ((i > 0 && pts[i].x + d === pts[i - 1].x) || (i < pts.length - 2 && pts[i + 1].x + d === pts[i + 2].x)) {\r\n        d *= 0.75\r\n      }\r\n      pts[i].x += d\r\n      pts[i + 1].x += d\r\n    }\r\n  }\r\n\r\n  /**\r\n  * This method will merge the redundant segments.\r\n  */\r\n  static _mergeSegments (pts) {\r\n    let h1 = pts[pts.length - 1].y === pts[pts.length - 2].y\r\n    let h2\r\n    for (let i = pts.length - 2; i >= 1; i--) {\r\n      h2 = pts[i].y === pts[i - 1].y\r\n      if (h2 === h1 || (pts[i].equals(pts[i - 1]))) {\r\n        pts.splice(i, 1)\r\n      } else {\r\n        h1 = !h1\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nlinkTypes['direct'] = DirectLink\r\nlinkTypes['bezier'] = BezierLink\r\nlinkTypes['entityRelations'] = EntityRelations\r\nlinkTypes['manhattan'] = Manhattan\r\n\r\nexport default Link\r\n","\r\n// The Key Utility CLass for the Event Dispatcher\r\nimport StringBuffer from '../util/string-buffer'\r\n\r\n/**\r\n * KEY constant\r\n */\r\nexport const KEY = {\r\n  ALT: 18,\r\n  BACK_SPACE: 8,\r\n  CAPS_LOCK: 20,\r\n  CONTROL: 17,\r\n  DELETE: 46,\r\n  DOWN: 40,\r\n  END: 35,\r\n  ENTER: 13,\r\n  ESCAPE: 220,\r\n  HOME: 36,\r\n  LEFT: 37,\r\n  META: 224,\r\n  NUM_LOCK: 144,\r\n  PAGE_DOWN: 34,\r\n  PAGE_UP: 33,\r\n  PAUSE: 19,\r\n  PRINTSCREEN: 44,\r\n  RIGHT: 39,\r\n  SCROLL_LOCK: 145,\r\n  SHIFT: 16,\r\n  SPACE: 32,\r\n  TAB: 9,\r\n  UP: 38\r\n  // ADD          : DomUtils.isFireFox ? 61  : 187,\r\n  // SUBTRACT     : DomUtils.isFireFox ? 173 : 189\r\n}\r\n\r\nexport function getKeyEvent (event) {\r\n  if (!event) {\r\n    return null\r\n  }\r\n\r\n  let key = event.keyCode || event.which\r\n\r\n  // Need to find a way to avoid this\r\n  if (key >= 16 && key <= 18) {\r\n    key = null\r\n  }\r\n\r\n  return getKeyData(event.ctrlKey, event.altKey, event.shiftKey, event.metaKey, key)\r\n}\r\n\r\nexport function getKeyData (ctrl, alt, shift, meta, key) {\r\n  var buf = new StringBuffer()\r\n\r\n  if (ctrl) buf.append('CTRL')\r\n  if (alt) buf.append('ALT')\r\n  if (shift) buf.append('SHIFT')\r\n  if (meta) buf.append('META')\r\n  if (key) buf.append(key)\r\n\r\n  return buf.toString('.')\r\n}\r\n","import _ from 'lodash'\r\nimport Events from '../../lib/bean'\r\nimport * as KeyUtils from './key-utils'\r\nimport DomUtils from '../util/dom-utils'\r\nimport StringBuffer from '../util/string-buffer'\r\n// import Utils from '../util/Utils'\r\n\r\nconst DEFAULTS = {\r\n  stopPropagation: false\r\n}\r\n\r\nconst win = typeof window !== 'undefined' ? window : { addEventHandler: function () {} }\r\nconst doc = typeof document !== 'undefined' ? document : {}\r\n\r\n/**\r\n * The EventDispatcher is the central event management. It will monitor all events and translate it into the a higher\r\n * level events for consumption.\r\n */\r\nexport default class EventDispatcher {\r\n  /**\r\n   * Constructor\r\n   * @param root the root element that the manager will listen to.\r\n   * @param zoomScale\r\n   * @param config the configuraton for the event dispatcher.\r\n   */\r\n  constructor (root, zoomScale = [0, Infinity], config = {}) {\r\n    this.root = root\r\n    this.rootNS = root.getAttribute('ns') || 'root'\r\n    this.zoomScale = zoomScale\r\n    Object.assign(this, DEFAULTS, config)\r\n    this.scale = 1.0\r\n    this.listeners = {}\r\n    this.dragging = false\r\n    this.handler = (event) => { this.handleEvent(event) }\r\n    this.started = false\r\n\r\n    // Simulate mouseenter/mouseleave events\r\n    this.enterStack = []\r\n  }\r\n\r\n  /**\r\n   * Start listening for events.\r\n   */\r\n  start () {\r\n    if (this.started) return\r\n    Events.on(this.root, 'mousedown mouseover mouseout mouseenter mouseleave dblclick click contextmenu mousewheel', this.handler)\r\n    this.startKeys()\r\n    this.started = true\r\n  }\r\n\r\n  /**\r\n   * Stop listening for events.\r\n   */\r\n  stop () {\r\n    if (!this.started) return\r\n    Events.off(this.root, 'mousedown mouseover mouseout mouseenter mouseleave dblclick click contextmenu mousewheel', this.handler)\r\n    this.stopKeys()\r\n    this.started = false\r\n  }\r\n\r\n  startKeys () {\r\n    Events.on(doc, 'keydown keyup', this.handler)\r\n  }\r\n\r\n  stopKeys () {\r\n    Events.off(doc, 'keydown keyup', this.handler)\r\n  }\r\n\r\n  zoomIn () {\r\n    this.scale *= 1.25\r\n    this.scale = Math.max(Math.min(this.zoomScale[1], this.scale), this.zoomScale[0])\r\n    return this.scale\r\n  }\r\n\r\n  zoomOut () {\r\n    this.scale *= 0.8\r\n    this.scale = Math.max(Math.min(this.zoomScale[1], this.scale), this.zoomScale[0])\r\n    return this.scale\r\n  }\r\n\r\n  getEventInfo (event) {\r\n    let target = event.target\r\n    const buf = new StringBuffer()\r\n    let ns\r\n    const stack = []\r\n    let isRoot = false\r\n    while (!isRoot && target && target !== doc) {\r\n      ns = target.getAttribute('ns')\r\n      if (ns) {\r\n        isRoot = ns.startsWith('root.')\r\n        if (isRoot) {\r\n          ns = ns.substring(5)\r\n          event.rootTarget = target\r\n        }\r\n        if (!event.nsTarget) event.nsTarget = target\r\n        stack.splice(0, 0, target)\r\n        buf.prepend(ns)\r\n      }\r\n      target = target.parentNode\r\n    }\r\n    if (!isRoot) {\r\n      event.rootTarget = event.nsTarget\r\n    }\r\n\r\n    // target stack is a stack of all the ns targets up to the one with the data binding.\r\n    event.targetStack = stack\r\n    ns = buf.toString('.')\r\n    if (ns === '') ns = this.rootNS\r\n    return { data: event.rootTarget, ns: ns }\r\n  }\r\n\r\n  /**\r\n   * The main event handler method, it processes event and generate relevant events to dispatch.\r\n   */\r\n  handleEvent (event) {\r\n    let type = event.type\r\n\r\n    // Do not dispatch other events if we are dragging.\r\n    if (this.dragging || DomUtils.eventFromInput(event)) return\r\n\r\n    let data\r\n    let ns\r\n    const pos = this.getPosition(event)\r\n    let info\r\n    const isKeyEvent = (type === 'keydown' || type === 'keyup')\r\n    if (isKeyEvent) {\r\n      data = this.root\r\n      ns = KeyUtils.getKeyEvent(event)\r\n    } else {\r\n      info = this.getEventInfo(event)\r\n      if (!info) return\r\n      data = info.data\r\n      ns = info.ns\r\n    }\r\n\r\n    // Utils.log('EventDispatcher', \"handleEvent - \" + type + ';ns=' + ns)\r\n\r\n    if (type === 'mousewheel') {\r\n      this.scale *= Math.pow(2, event.wheelDelta * 0.002)\r\n      this.scale = Math.max(Math.min(this.zoomScale[1], this.scale), this.zoomScale[0])\r\n      event.scale = this.scale\r\n      type = 'zoom'\r\n    }\r\n\r\n    // See if we should create drag events\r\n    if (type === 'mousedown' && event.button === 0 /* only drag on left click */) {\r\n      // Create drag object.\r\n      const dragObject = { data: data, pos: ns === 'root' ? EventDispatcher.mouse(this.root, event) : pos }\r\n      this.dragging = false\r\n      // Start listening for mouse move.\r\n      let dragPos\r\n\r\n      const mousemove = (event) => {\r\n        let currentPos = this.getPosition(event)\r\n        if (!this.dragging) {\r\n          // check if the mouse has moved. IE always fire mousemove after mousedown even if the mouse hasn't moved yet.\r\n          if (dragObject.pos[0] === currentPos[0] && dragObject.pos[1] === currentPos[1]) return\r\n\r\n          // start dragging\r\n          this.dragging = true\r\n          event.rootTarget = dragObject.data\r\n          this.dispatch(event, 'dragstart', ns, dragObject.data, dragObject.pos)\r\n        }\r\n        if (ns === 'root') {\r\n          dragPos = EventDispatcher.mouse(this.root, event)\r\n        } else {\r\n          dragPos = currentPos\r\n        }\r\n        this.getEventInfo(event)\r\n        this.dispatch(event, 'drag', ns, dragObject.data, dragPos)\r\n      }\r\n      const mouseup = (event) => {\r\n        if (ns === 'root') {\r\n          dragPos = EventDispatcher.mouse(this.root, event)\r\n        } else {\r\n          dragPos = this.getPosition(event)\r\n        }\r\n\r\n        let info = this.getEventInfo(event)\r\n        if (this.dragging) {\r\n          this.dragging = false\r\n          this.dispatch(event, 'dragend', ns, dragObject.data, dragPos)\r\n        } else {\r\n          this.dispatch(event, 'mouseup', ns, info.data, dragPos)\r\n        }\r\n\r\n        Events.off(win, 'mousemove', mousemove)\r\n        Events.off(win, 'mouseup', mouseup)\r\n      }\r\n      event.preventDefault()\r\n      Events.on(win, 'mousemove', mousemove)\r\n      Events.on(win, 'mouseup', mouseup)\r\n    }\r\n\r\n    if (!isKeyEvent) {\r\n      this.simulateEnterLeave(event, type, ns, data, pos)\r\n    }\r\n    this.dispatch(event, type, ns, data, pos)\r\n\r\n    // disable the default context menu\r\n    // if (type == 'contextmenu')\r\n    // event.preventDefault()\r\n  }\r\n\r\n  /**\r\n   * try to simulate mouseenter/mouseleave events.\r\n   */\r\n  simulateEnterLeave (event, type, ns, data, pos) {\r\n    let last, stack\r\n    const clearEnterStack = (k) => {\r\n      k = k || 0\r\n      // Clear off the enter stack.\r\n      while (this.enterStack.length >= k + 1) {\r\n        last = this.enterStack.pop()\r\n        this.dispatch(event, 'mouseleave', last.ns, last.data, pos)\r\n      }\r\n    }\r\n    const getNS = function (index) {\r\n      let buf = new StringBuffer()\r\n      for (let i = 0; i <= index; i++) {\r\n        let val = stack[i].getAttribute('ns')\r\n        if (val.startsWith('root.')) {\r\n          val = val.substring(5)\r\n        }\r\n        buf.append(val)\r\n      }\r\n      return buf.toString('.')\r\n    }\r\n\r\n    if (ns && ns !== this.rootNS) {\r\n      if (type === 'mouseover') {\r\n        stack = event.targetStack\r\n        let item\r\n        for (let i = 0; i < stack.length; i++) {\r\n          if (i < this.enterStack.length) {\r\n            if (this.enterStack[i].target !== stack[i]) {\r\n              clearEnterStack(i)\r\n            } else {\r\n              continue\r\n            }\r\n          }\r\n          item = { data: data, ns: getNS(i), target: stack[i] }\r\n          this.enterStack.push(item)\r\n          this.dispatch(event, 'mouseenter', item.ns, data, pos)\r\n        }\r\n        if (stack.length < this.enterStack.length) {\r\n          clearEnterStack(stack.length)\r\n        }\r\n      }\r\n    }\r\n    if (ns === this.rootNS && this.enterStack.length > 0) {\r\n      clearEnterStack()\r\n    }\r\n  }\r\n\r\n  dispatch (event, type, ns, data, pos) {\r\n    // if (type !== 'mouseover' && type !== 'mouseout') {\r\n    //   console.log('EventDispatcher', 'dispatch - ' + type + '.' + ns + ';' + pos + ';rootTarget=' + event.rootTarget + ';data=' + data)\r\n    // }\r\n    if (!this.started) return\r\n    const nsType = ns ? type + '.' + ns : type\r\n    _.forEach(this.listeners, (listeners, key) => {\r\n      if (EventDispatcher.match(nsType, listeners.regexp ? listeners.regexp : key)) {\r\n        _.forEach(listeners, (listener) => {\r\n          if (!listener.context) {\r\n            listener.callback.apply(window, [type, ns, data, pos, event])\r\n          } else {\r\n            listener.callback.apply(listener.context, [type, ns, data, pos, event])\r\n          }\r\n        })\r\n      }\r\n    })\r\n\r\n    // after dispatching, do not propagate.\r\n    if (this.stopPropagation && event.stopPropagation) {\r\n      event.stopPropagation()\r\n    }\r\n  }\r\n\r\n  getPosition (event) {\r\n    const pos = EventDispatcher.mouse(this.root, event)\r\n    if (!_.isNaN(pos[0]) && !_.isNaN(pos[1])) {\r\n      this.lastPosition = pos\r\n    }\r\n    return this.lastPosition\r\n  }\r\n\r\n  /**\r\n   * Registers a key event handler\r\n   * // Key is object {ctrl, alt, shift, meta, code}\r\n   */\r\n  registerKey (type, key, callback, context) {\r\n    if (Array.isArray(key)) {\r\n      key.forEach(k => {\r\n        this.registerKey(type, k, callback, context)\r\n      })\r\n      return\r\n    }\r\n    key = KeyUtils.getKeyData(key.ctrl, key.alt, key.shift, key.meta, key.code)\r\n    if (!key.length) return\r\n    key = new StringBuffer(type).append(key).toString('.')\r\n    const listener = { callback, context }\r\n    this.listeners[key] || (this.listeners[key] = [])\r\n    this.listeners[key].push(listener)\r\n  }\r\n\r\n  unregisterKey (type, key, callback, context) {\r\n    if (Array.isArray(key)) {\r\n      key.forEach(k => {\r\n        this.unregisterKey(type, k, callback, context)\r\n      })\r\n      return\r\n    }\r\n    key = KeyUtils.getKeyData(key.ctrl, key.alt, key.shift, key.meta, key.code)\r\n    if (!key.length) return\r\n    key = new StringBuffer(type).append(key).toString('.')\r\n\r\n    let listeners = this.listeners[key]; let listener\r\n    if (!listeners) return\r\n    for (let i = 0; i < listeners.length; i++) {\r\n      listener = listeners[i]\r\n      if (listener.callback === callback && (!context || context === listener.context)) {\r\n        listeners.splice(i, 1)\r\n        return\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Registers an event handler\r\n   */\r\n  register (type, callback, context, zIndex) {\r\n    if (Array.isArray(type)) {\r\n      type.forEach(t => {\r\n        this.register(t, callback, context, zIndex)\r\n      })\r\n      return\r\n    }\r\n    const listener = { callback: callback, context: context, zIndex: zIndex }\r\n    let regexp = null\r\n    if (type instanceof RegExp) {\r\n      regexp = type\r\n      type = type + ''\r\n    }\r\n    this.listeners[type] || (this.listeners[type] = [])\r\n    if (regexp && !this.listeners[type].regexp) {\r\n      this.listeners[type].regexp = regexp\r\n    }\r\n    this.listeners[type].push(listener)\r\n  }\r\n\r\n  unregister (type, callback, context) {\r\n    if (type instanceof RegExp) {\r\n      type = type + ''\r\n    }\r\n    let listeners = this.listeners[type]; let listener\r\n    if (!listeners) return\r\n    for (let i = 0; i < listeners.length; i++) {\r\n      listener = listeners[i]\r\n      if (listener.callback === callback && (!context || context === listener.context)) {\r\n        listeners.splice(i, 1)\r\n        return\r\n      }\r\n    }\r\n  }\r\n\r\n  destroy () {\r\n    this.stop()\r\n    delete this.root\r\n    delete this.listeners\r\n    delete this.enterStack\r\n  }\r\n\r\n  /**\r\n   * Check if the registered event type matches the real event type. \"*\" is allowed as a wild card.\r\n   */\r\n  static match (nsType, registeredType) {\r\n    if (registeredType instanceof RegExp) {\r\n      return nsType.match(registeredType)\r\n    }\r\n\r\n    return nsType === registeredType\r\n    /* const arr = registeredType.split('*');\r\n    if (arr.length == 1)\r\n      return nsType == registeredType;\r\n\r\n    let substr, index = 0;\r\n    for (let i = 0; i < arr.length; i++) {\r\n      if (arr[i].length == 0) continue;\r\n      substr = nsType.slice(index);\r\n      index = substr.indexOf(arr[i]);\r\n      if (index < 0)\r\n        return false;\r\n      index += arr[i].length;\r\n    }\r\n    return true; */\r\n  }\r\n\r\n  static mouse (container, e) {\r\n    if (e.changedTouches) e = e.changedTouches[0]\r\n    let svg = container.ownerSVGElement || container\r\n    if (svg.createSVGPoint) {\r\n      let point = svg.createSVGPoint()\r\n      point.x = e.clientX; point.y = e.clientY\r\n      point = point.matrixTransform(container.getScreenCTM().inverse())\r\n      return [point.x, point.y]\r\n    }\r\n    let rect = container.getBoundingClientRect()\r\n    return [e.clientX - rect.left - container.clientLeft, e.clientY - rect.top - container.clientTop]\r\n  }\r\n}\r\n","import _ from 'lodash'\r\nimport Events from '../../lib/bean'\r\nimport Utils from '../util/Utils'\r\nimport DomUtils from '../util/dom-utils'\r\nimport StringBuffer from '../util/string-buffer'\r\nimport Rectangle from '../geometry/Rectangle'\r\n\r\nconst FONT_BOLD = 1; const FONT_ITALIC = 2; const FONT_UNDERLINE = 4; const FONT_SHADOW = 8\r\n\r\nlet defaultConfig = {\r\n  fontSize: 11,\r\n  fontFamily: 'Arial',\r\n  fontStyle: 0,\r\n  fontColor: 'black',\r\n  padding: 0,\r\n  linePadding: 0,\r\n  align: 'left',\r\n  width: 0,\r\n  height: 0,\r\n  rotation: null,\r\n  geometry: { x: 0, y: 0, anchorY: 0, offsetX: 0, offsetY: 0 }\r\n}\r\n\r\n/**\r\n * The label object handles label sizing/positioning\r\n */\r\nexport default (function () {\r\n  let stringMeasureEl = null; let measureDiv; let baselineDiv\r\n\r\n  /**\r\n   * Calculate the size of the string.\r\n   */\r\n  let getStringSize = _.memoize(function (str, fontSize, fontFamily, bold) {\r\n    fontSize = fontSize || 11\r\n    fontFamily = fontFamily || 'Arial,Helvetica'\r\n    bold = !_.isUndefined(bold) ? bold : false\r\n\r\n    // first check if there is a string-measuring div available, if not, create now.\r\n    if (!stringMeasureEl) {\r\n      stringMeasureEl = DomUtils.createElement('iframe', { id: '_ComputeStylesIframe' }, { position: 'absolute', visibility: 'hidden', width: 'auto' })\r\n      document.body.appendChild(stringMeasureEl)\r\n      let doc = stringMeasureEl.contentWindow.document\r\n      doc.open()\r\n      doc.write(\r\n        `<html><body>\r\n        <div id=\"baselineDiv\" style=\"height:100px;\"><span style=\"line-height:0\">T</span><span style=\"height:100%;display:inline-block;\"></span></div>\r\n        <div id=\"measureDiv\" style=\"position:absolute;width:auto;height:auto;padding:0;white-space:nowrap;display:inline-block;\"></div>\r\n        </body></html>`)\r\n      doc.close()\r\n      measureDiv = doc.getElementById('measureDiv')\r\n      baselineDiv = doc.getElementById('baselineDiv')\r\n    }\r\n    baselineDiv.style.fontSize = measureDiv.style.fontSize = fontSize\r\n    baselineDiv.style.fontFamily = measureDiv.style.fontFamily = fontFamily\r\n    baselineDiv.style.fontWeight = measureDiv.style.fontWeight = bold ? 'bold' : 'normal'\r\n    measureDiv.innerHTML = str\r\n\r\n    let strut = baselineDiv.firstChild\r\n    let baselineHeight = strut.offsetTop + strut.offsetHeight - baselineDiv.offsetHeight - baselineDiv.offsetTop\r\n\r\n    return { width: measureDiv.offsetWidth, height: measureDiv.offsetHeight, baseline: baselineHeight }\r\n  }, function (str, fontSize, fontFamily, bold) { return str + ';' + fontSize + ';' + fontFamily + ';' + bold })\r\n\r\n  /**\r\n   * Create a wrapped text.\r\n   * @param {String} string the string to wrap.\r\n   * @param {maxWidth} the maximum width this string can take.\r\n   * @param {fontSize}\r\n   * @param {fontFamily}\r\n   * @param {bold}\r\n   */\r\n  let wrap = _.memoize(function (string, maxWidth, fontSize, fontFamily, bold) {\r\n    maxWidth = maxWidth || 0\r\n    fontSize = fontSize || 11\r\n    fontFamily = fontFamily || 'Arial,Helvetica'\r\n    bold = !_.isUndefined(bold) ? bold : false\r\n\r\n    let arr = []\r\n    let spaceSize = getStringSize('&nbsp;', fontSize, fontFamily, bold); let space = spaceSize.width\r\n    arr.lineHeight = spaceSize.height\r\n    arr.baseline = spaceSize.baseline\r\n\r\n    if (!maxWidth || !string || string === '') {\r\n      arr.push(string)\r\n      arr.width = (!string || string === '') ? space : getStringSize(string, fontSize, fontFamily, bold).width\r\n      arr.height = arr.lineHeight\r\n      return arr\r\n    }\r\n\r\n    let width = 0\r\n    // split the text by lines\r\n    let lines = string.split('\\n')\r\n\r\n    let buf = new StringBuffer()\r\n\r\n    for (let j = 0; j < lines.length; j++) {\r\n      // split each line by word\r\n      let words = lines[j].split(/\\s/)\r\n      let line = ''; let currentWidth = 0; let wordWidth = 0; let newLine = true; let word\r\n\r\n      for (let i = 0; i < words.length; i++) {\r\n        word = words[i]\r\n        wordWidth = getStringSize(word, fontSize, fontFamily, bold).width\r\n\r\n        if ((newLine ? wordWidth : currentWidth + space + wordWidth) > maxWidth) {\r\n          if (newLine) {\r\n            buf.append(word)\r\n            width = Math.max(width, wordWidth)\r\n            if (i < words.length - 1) {\r\n              arr.push(buf.toString())\r\n              buf.clear()\r\n            }\r\n          } else {\r\n            arr.push(buf.append(line).toString())\r\n            width = Math.max(width, currentWidth + space + wordWidth)\r\n            buf.clear()\r\n          }\r\n          line = ''\r\n          currentWidth = 0\r\n          if (!newLine) { i-- } // move back one word.\r\n          newLine = true\r\n        } else {\r\n          line = newLine ? word : line + ' ' + word\r\n          currentWidth = newLine ? wordWidth : currentWidth + space + wordWidth\r\n          width = Math.max(width, currentWidth)\r\n          newLine = false\r\n        }\r\n      }\r\n      if (line !== '') { buf.append(line) }\r\n      if (j < lines.length - 1) {\r\n        arr.push(buf.toString())\r\n        buf.clear()\r\n      }\r\n    }\r\n\r\n    arr.push(buf.toString())\r\n    arr.width = width\r\n    arr.height = arr.lineHeight * arr.length\r\n    return arr\r\n  }, function (str, maxWidth, fontSize, fontFamily, bold) { return str + ';' + maxWidth + ';' + fontSize + ';' + fontFamily + ';' + bold })\r\n\r\n  /**\r\n   *  Get the view information for how to display the label.\r\n   * @param label The string that needs to be displayed\r\n   * @param containerWidth The width of the parent container.\r\n   * @param containerHeight The height of the parent container.\r\n   * @param labelConfig The configuration on how to display label. It should be an object with the following parameters:\r\n   * {\r\n   *      fontSize, fontFamily, fontStyle, padding,\r\n   *      align: can be either \"left\", \"center\" or \"right\",\r\n   *      width: the maximum width of the label. if less than 1, then is treated as percentage. If 0, no wrapping will occur,\r\n   *      height,\r\n   *      geometry\r\n   * }\r\n   * @returns {*}\r\n   */\r\n  function getLabelBox (label, labelConfig, containerWidth, containerHeight) {\r\n    return _getLabelBox.call(this, label, labelConfig, { width: containerWidth, height: containerHeight })\r\n  }\r\n\r\n  function getLabelBoxForLink (label, labelConfig, link) {\r\n    return _getLabelBox.call(this, label, labelConfig, link)\r\n  }\r\n\r\n  function _getLabelBox (label, labelConfig = {}, context) {\r\n    labelConfig = _.defaultsDeep(labelConfig, defaultConfig)\r\n    let fontSize = labelConfig.fontSize\r\n    let fontFamily = labelConfig.fontFamily\r\n    let fontStyle = labelConfig.fontStyle\r\n    let bold = (fontStyle & FONT_BOLD) === FONT_BOLD\r\n    let padding = labelConfig.padding\r\n    let linePadding = labelConfig.linePadding\r\n    let align = labelConfig.align\r\n\r\n    let w = labelConfig.width; let h = labelConfig.height\r\n    if (context.width) {\r\n      w = w <= 5 ? context.width * w : w\r\n      h = h <= 5 ? context.height * h : h\r\n    }\r\n    w -= 2 * padding\r\n    h -= 2 * padding\r\n    w = Math.max(0, w)\r\n    h = Math.max(0, h)\r\n\r\n    let geometry = _.clone(labelConfig.geometry)\r\n    let wrappedLabel = this.wrap(label, w, fontSize, fontFamily, bold)\r\n    geometry.width = wrappedLabel.width + 2 * padding\r\n    geometry.height = wrappedLabel.height + 2 * padding + (wrappedLabel.length - 1) * linePadding\r\n    let anchor = 'start'; let dx = 0; let setAnchorX = !_.has(geometry, 'anchorX')\r\n    switch (align) {\r\n      case 'center':\r\n        anchor = 'middle'\r\n        if (setAnchorX) geometry.anchorX = 0\r\n        break\r\n      case 'right':\r\n        anchor = 'end'\r\n        dx = wrappedLabel.width / 2\r\n        if (setAnchorX) geometry.anchorX = -0.5\r\n        break\r\n      case 'left':\r\n        dx = -wrappedLabel.width / 2\r\n        if (setAnchorX) geometry.anchorX = 0.5\r\n        break\r\n    }\r\n    let pos\r\n    if (context.getRelativePosition) { pos = context.getRelativePosition(geometry) } else { pos = Utils.getRelativePosition({ width: context.width, height: context.height }, geometry) }\r\n\r\n    let bounds = new Rectangle(pos[0], pos[1], geometry.width, geometry.height)\r\n    // the pivot is the center of rotation when the label has a rotation specified.\r\n    let pivot = align === 'center' ? [0, 0] : (align === 'left' ? [-wrappedLabel.width / 2, 0] : [wrappedLabel.width / 2, 0])\r\n\r\n    // the maximum bounds for the label, used to position inline editor\r\n    geometry.width = Math.max(w + 2 * padding, geometry.width)\r\n    geometry.height = Math.max(h + 2 * padding, geometry.height)\r\n\r\n    if (context.getRelativePosition) { pos = context.getRelativePosition(geometry) } else { pos = Utils.getRelativePosition({ width: context.width, height: context.height }, geometry) }\r\n\r\n    let maxBounds = new Rectangle(pos[0], pos[1], geometry.width, geometry.height)\r\n    return {\r\n      config: labelConfig,\r\n      label: wrappedLabel,\r\n      _label: label,\r\n      bold,\r\n      underline: fontStyle & FONT_UNDERLINE,\r\n      italic: fontStyle & FONT_ITALIC,\r\n      shadow: fontStyle & FONT_SHADOW,\r\n      dx,\r\n      dy: -geometry.height / 2 + padding + wrappedLabel.lineHeight - wrappedLabel.baseline,\r\n      anchor,\r\n      lineHeight: wrappedLabel.lineHeight + linePadding,\r\n      pivot,\r\n      bounds,\r\n      maxBounds\r\n    }\r\n  }\r\n\r\n  function render (view, box) {\r\n    return view.renderLabel(box)\r\n  }\r\n\r\n  // This is the inline editor for editing label text in place.\r\n  let editor = {\r\n    start: function (key, container, box, refEl, textEl, scale = 1.0, singleLine = true) {\r\n      if (this.input) {\r\n        if (this.key !== key) {\r\n          // need to close the existing editor first\r\n          this.stop()\r\n        } else { return }\r\n      }\r\n      let tag = singleLine ? 'input' : 'textarea'\r\n      this.input = DomUtils.createElement(tag, { id: 'inlineEditor', unselectable: 'off' }, { position: 'absolute', overflow: 'hidden', padding: '0px', margin: '0px', border: 'transparent' })\r\n      if (singleLine) {\r\n        Events.on(this.input, 'keydown keyup', (event) => {\r\n          if (event.keyCode === 13) {\r\n            Events.off(this.input, 'keydown keyup')\r\n            this.stop()\r\n          }\r\n        })\r\n      }\r\n      container.appendChild(this.input)\r\n\r\n      this.key = key\r\n      this.box = box\r\n      this.refEl = refEl\r\n      this.textEl = textEl\r\n\r\n      let labelConfig = box.config\r\n      let maxBounds = new Rectangle(box.maxBounds.x, box.maxBounds.y, box.maxBounds.width * scale, box.maxBounds.height * scale)\r\n      let pos = DomUtils.getCenterPosition(refEl, container)\r\n      pos = [pos[0] + maxBounds.left, pos[1] + maxBounds.top]\r\n\r\n      if (textEl) { textEl.style.visibility = 'hidden' }\r\n\r\n      DomUtils.setElement(this.input, null, {\r\n        visibility: 'visible',\r\n        left: pos[0] + 'px',\r\n        top: pos[1] + 'px',\r\n        width: maxBounds.width + 'px',\r\n        height: maxBounds.height + 'px',\r\n        'font-family': labelConfig.fontFamily,\r\n        'font-size': (labelConfig.fontSize * scale) + 'px',\r\n        'font-weight': (labelConfig.fontStyle & FONT_BOLD) === FONT_BOLD ? 'bold' : 'normal'\r\n        /* \"color\": labelConfig.fontColor */\r\n      })\r\n\r\n      this.input.value = box._label\r\n      this.input.focus()\r\n      this.input.select()\r\n      Events.fire(this, 'editor.start', [this.key])\r\n    },\r\n\r\n    stop: function (cancel) {\r\n      if (!this.input) return\r\n\r\n      cancel = cancel || false\r\n      if (this.textEl) { this.textEl.style.visibility = null }\r\n\r\n      // remove the input\r\n      this.input.parentNode.removeChild(this.input)\r\n\r\n      if (!cancel) { Events.fire(this, 'editor.update', [this.key, this.input.value]) }\r\n\r\n      Events.fire(this, 'editor.stop', [this.key])\r\n\r\n      delete this.input\r\n      delete this.key\r\n      delete this.box\r\n      delete this.refEl\r\n      delete this.textEl\r\n    }\r\n  }\r\n\r\n  return {\r\n    FONT_BOLD,\r\n    FONT_ITALIC,\r\n    FONT_UNDERLINE,\r\n    FONT_SHADOW,\r\n    getStringSize,\r\n    wrap,\r\n    getLabelBox,\r\n    getLabelBoxForLink,\r\n    render,\r\n    editor\r\n  }\r\n})()\r\n","import _ from 'lodash'\r\nimport Utils from '../util/Utils'\r\nimport Cache from '../util/Cache'\r\nimport StringBuffer from '../util/string-buffer'\r\nimport Shape from '../geometry/Shape'\r\nimport Label from '../view/Label'\r\n\r\n/**\r\n * The Cell is the common parent for Node and Edge.\r\n */\r\nexport default class Cell {\r\n  constructor (graph, config = { id: _.uniqueId() }) {\r\n    this.graph = graph\r\n    this.id = config.id\r\n    delete config.id\r\n\r\n    // Initialize decorators\r\n    if (config.decorators) {\r\n      this.createDecorators(config.decorators)\r\n      delete config.decorators\r\n    }\r\n\r\n    // Initialize View Properties\r\n    if (config.views) {\r\n      this.viewProps = config.views\r\n      delete config.views\r\n    }\r\n\r\n    // Initialize type\r\n    var Type = config.type || 'Default'\r\n    Type = Utils.type(this.constructor.namespace, Type)\r\n    if (!Type) { throw new Error('Type not found ' + config.type) }\r\n    delete config.type\r\n    this.props = new Type(config)\r\n  }\r\n\r\n  prop (name, value) {\r\n    if (_.isUndefined(value)) { return this.props[name] }\r\n    this.props[name] = value\r\n  }\r\n\r\n  /**\r\n   * Get/Set property stored by views.\r\n   * @param key\r\n   * @param name\r\n   * @param value\r\n   * @returns {*}\r\n   */\r\n  viewProp (key = 'default', name, value) {\r\n    if (_.isUndefined(value)) {\r\n      if (key === 'default') { return this.prop(name, value) }\r\n      return this.viewProps[key][name]\r\n    }\r\n    if (key === 'default') {\r\n      this.prop(name, value)\r\n    } else {\r\n      if (!this.viewProps[key]) { this.viewProps[key] = {} }\r\n      this.viewProps[key][name] = value\r\n    }\r\n  }\r\n\r\n  createDecorators (decorators) {}\r\n\r\n  /**\r\n   * Get properties needed for rendering this element\r\n   * @returns {{key: (string|*), className: *, namespace: *, bounds: *}}\r\n   */\r\n  getView (key) {\r\n    let shape = this.getShape(key)\r\n    return _.assign({\r\n      id: this.id,\r\n      key: key,\r\n      className: this.computedClassName,\r\n      style: this.viewProp(key, 'style'),\r\n      namespace: this.namespace\r\n    }, shape)\r\n  }\r\n\r\n  getShape (key) {\r\n    let shape = Cache.get(this.id + '.shape', key)\r\n    if (shape) return shape\r\n\r\n    let shapeConfig = this.viewProp(key, 'shape')\r\n    let ShapeClass = shapeConfig ? Shape.getShape(shapeConfig.name) : Shape.getShape('Rectangle')\r\n    let x = this.viewProp(key, 'x')\r\n    let y = this.viewProp(key, 'y')\r\n    let width = this.viewProp(key, 'width')\r\n    let height = this.viewProp(key, 'height')\r\n    shape = new ShapeClass(x, y, width, height, shapeConfig)\r\n    Cache.set(this.id + '.shape', shape, key)\r\n    return shape\r\n  }\r\n\r\n  render (view) {\r\n    let template = Cache.get(this.id + '.template', view.id)\r\n    if (!template) {\r\n      // create the template\r\n      let role = this.prop('role')\r\n      template = view.getTemplate('$' + role, null, this)\r\n      if (_.isString(template)) { template = _.template(template) }\r\n      Cache.set(this.id + '.template', template, view.id)\r\n    }\r\n    return template(this.getView(view.id))\r\n  }\r\n\r\n  renderShape (view) {\r\n    let shape = this.getShape(view.id)\r\n    if (shape) { return shape.render(view) }\r\n    return ''\r\n  }\r\n\r\n  renderLabel (view) {\r\n    if (this === this.graph.currentRoot) { return null }\r\n    let box = this.getLabelBox(view.id)\r\n    if (box) { return view.renderLabel(box) }\r\n    return ''\r\n  }\r\n\r\n  getLabelBox (key) {\r\n    let box = Cache.get(this.id + '.labelBox', key)\r\n    if (box) return box\r\n    let shape = this.getShape(key)\r\n    // Just get the config will have a positive performance boost for IE11 and IE10.\r\n    box = Label.getLabelBox(this.prop('label'), this.viewProp(key, 'labelConfig'), shape.width, shape.height)\r\n    Cache.set(this.id + '.labelBox', box, key)\r\n    return box\r\n  }\r\n\r\n  get computedClassName () {\r\n    if (!this._computedClassName) {\r\n      var buf = new StringBuffer(this.prop('role'))\r\n      let props = this.props\r\n      if (props.hasOwnProperty('className')) { buf.append(props['className']) }\r\n      props = props.constructor.prototype\r\n      while (props) {\r\n        if (props.hasOwnProperty('className')) { buf.append(props['className']) }\r\n        props = Object.getPrototypeOf(props)\r\n      }\r\n      this._computedClassName = buf.toString(' ')\r\n    }\r\n    return this._computedClassName\r\n  }\r\n\r\n  get namespace () {\r\n    if (this === this.graph.currentRoot) return ''\r\n    return 'root.' + this.prop('role')\r\n  }\r\n\r\n  destroy () {\r\n    delete this.graph\r\n    delete this.decorators\r\n    delete this.props\r\n    delete this.viewProps\r\n    this.destroyed = true\r\n  }\r\n}\r\n\r\n/*\r\n\r\nCell.prototype.move = function(x, y) {\r\n  this.setProperty(\"x\", Math.round(x));\r\n  this.setProperty(\"y\", Math.round(y));\r\n  delete this.bounds;\r\n};\r\n\r\nCell.prototype.resize = function(w, h) {\r\n  this.setProperty(\"width\", w);\r\n  this.setProperty(\"height\", h);\r\n  delete this.bounds;\r\n};\r\n\r\nCell.prototype.canEdit = function() {\r\n  return (this.graph ? this.graph.canEdit() : true) && this.getProperty(\"editable\");\r\n};\r\n\r\nCell.prototype.canSelect = function() {\r\n  return (this.graph ? this.graph.canSelect() : true) && this.getProperty(\"selectable\");\r\n};\r\n\r\nCell.prototype.canMove = function() {\r\n  return (this.graph ? this.graph.canEdit() : true) && this.getProperty(\"draggable\");\r\n};\r\n\r\nCell.prototype.canResize = function() {\r\n  return (this.graph ? this.graph.canEdit() : true) && this.getProperty(\"resizable\");\r\n};\r\n\r\nCell.prototype.getTypeFromString = function(typeStr) {\r\n  return this.graph.getType(typeStr);\r\n};\r\n\r\nCell.prototype.createModifiers = function(modifiers) {\r\n  this.modifiers = null;\r\n  var modifierSettings = this.getProperty(\"modifierSettings\");\r\n  if (modifierSettings) {\r\n    _.each(modifiers, function(config) {\r\n      config.type = this.graph.getModifierType(config.className);\r\n      config.setting = modifierSettings[config.className];\r\n      if (!config.type || !config.setting) return;\r\n\r\n      this.addModifier(config.className, new Modifier(this, config));\r\n    }, this);\r\n\r\n    // Check for showAlways settings\r\n    _.each(modifierSettings, function(setting, name) {\r\n      if (setting.showAlways && (!this.modifiers || !this.modifiers[name])) {\r\n        var config = {type: this.graph.getModifierType(name), setting: setting};\r\n        if (!config.type) return;\r\n        this.addModifier(name, new Modifier(this, config));\r\n      }\r\n    }, this);\r\n  }\r\n};\r\n\r\nCell.prototype.addModifier = function(name, modifier) {\r\n  if (!this.modifiers)\r\n    this.modifiers = {};\r\n\r\n  if (!modifier.hasOwnProperty(\"showHeader\"))\r\n    modifier.showHeader = true;\r\n\r\n  // @hack preferably set it in configurations.\r\n  if (modifier.name == \"HoverProcessModifier\" || modifier.name == \"HoverResults\")\r\n    modifier.showHeader = false;\r\n\r\n  this.modifiers[name] = modifier;\r\n};\r\n\r\nCell.prototype.getModifiers = function() {\r\n  if (_.isUndefined(this.modifiers))\r\n    this.createModifiers();\r\n  return this.modifiers;\r\n};\r\n\r\nCell.prototype.getModifier = function(name) {\r\n  var modifiers = this.getModifiers();\r\n  if (modifiers)\r\n    return modifiers[name];\r\n  return null;\r\n};\r\n\r\nCell.prototype.isVisible = function() {\r\n  return this.getProperty('visible');\r\n};\r\n\r\nCell.prototype.isContainer = function() {\r\n  return false;\r\n};\r\n*/\r\n","import _ from 'lodash'\r\nimport StringBuffer from '../util/string-buffer'\r\nimport Cell from './Cell'\r\n\r\n/**\r\n * A Node represents vertex of the graph.\r\n */\r\nclass Node extends Cell {\r\n  constructor (graph, config = {}) {\r\n    if (!config.id) config.id = _.uniqueId('N')\r\n    super(graph, config)\r\n\r\n    this.inEdges = []\r\n    this.outEdges = []\r\n    this.ports = null\r\n    this.parent = null\r\n  }\r\n\r\n  isAncestor (n) {\r\n    // TODO: should we move this to graph class ?\r\n    let node = n.parent\r\n    while (node) {\r\n      if (this === node) { return true }\r\n      node = node.parent\r\n    }\r\n    return false\r\n  }\r\n\r\n  removeEdge (edge) {\r\n    let edges = edge.source === this ? this.outEdges : this.inEdges\r\n    for (let i = 0; i < edges.length; i++) {\r\n      if (edge === edges[i]) {\r\n        edges.splice(i, 1)\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  // Add a new incoming edge\r\n  addInEdge (edge, pos) {\r\n    if (pos == null || pos === undefined) {\r\n      this.inEdges.push(edge)\r\n    } else {\r\n      this.inEdges.splice(pos, 0, edge)\r\n    }\r\n  }\r\n\r\n  // Add a new outgoing edge\r\n  addOutEdge (edge, pos) {\r\n    if (pos == null || pos === undefined || pos > edge.length - 1) {\r\n      this.outEdges.push(edge)\r\n    } else {\r\n      this.outEdges.splice(pos, 0, edge)\r\n    }\r\n  }\r\n\r\n  renderChildren (view) {\r\n    if (this.children) {\r\n      let buf = new StringBuffer()\r\n      _.forEach(this.children, (child) => {\r\n        buf.append(child.render(view))\r\n      })\r\n      return buf.toString()\r\n    }\r\n    return ''\r\n  }\r\n\r\n  getPort (key, portName = 'auto', endPt, orthogonal) {\r\n    let shape = this.getShape(key)\r\n    if (portName === 'auto') {\r\n      return shape.getPerimeter(endPt, orthogonal)\r\n    }\r\n    return null\r\n  }\r\n\r\n  toString () {\r\n    let label = this.prop('label') ? this.prop('label') : 'undefined'\r\n    if (_.isArray(label)) {\r\n      label = label[0]\r\n    }\r\n    return 'Node:{id:' + this.id + ';label:' + label + ';type:' + this.props.constructor.typeName + '}'\r\n  }\r\n}\r\nNode.namespace = 'Nodes'\r\n\r\nexport default Node\r\n\r\n/*\r\n\r\n/**\r\n * The DrillDownParent is the parent that displays the vertex when drilled down.\r\n *\r\nVertex.prototype.getDrillDownParent = function() {\r\n  return this.parent;\r\n};\r\n\r\nVertex.prototype.isLocked = function() {\r\n  let mode = this.getProperty(\"mode\") || 3;\r\n  return !(mode & Graph.ALLOW_INTERACTIONS);\r\n};\r\n\r\nVertex.prototype.getCrumbText = function() {\r\n  if (this.isLocked())\r\n    return '<span><img src=\"webwb/pzreadonly.png\" /></span><span>&nbsp;' + this.getProperty(\"label\") + '</span>';\r\n  return this.getProperty(\"label\");\r\n};\r\n\r\nVertex.prototype.canEdit = function() {\r\n  return (!this.parent || !this.parent.isLocked()) && Vertex.superclass.canEdit.call(this);\r\n};\r\n\r\nVertex.prototype.isContainer = function() {\r\n  return this.getProperty(\"container\");\r\n};\r\n\r\n*/\r\n","import _ from 'lodash'\r\nimport Cell from './Cell'\r\nimport Rectangle from '../geometry/Rectangle'\r\nimport Link from '../geometry/Link'\r\nimport Label from '../view/Label'\r\nimport Cache from '../util/Cache'\r\n\r\nclass Edge extends Cell {\r\n  constructor (graph, config = {}, source, target) {\r\n    if (!config.id) config.id = _.uniqueId('E')\r\n    super(graph, config)\r\n\r\n    this.source = this.target = null\r\n    this.setSource(source, config.sourcePos)\r\n    this.setTarget(target, config.targetPos)\r\n  }\r\n\r\n  setSource (node, pos) {\r\n    this.setTerminal(node, pos, 'source')\r\n  }\r\n\r\n  setTarget (node, pos) {\r\n    this.setTerminal(node, pos, 'target')\r\n  }\r\n\r\n  /**\r\n\t * Internal methods to set either the source or target\r\n\t */\r\n\t setTerminal (node, pos, dir) {\r\n    var end = dir == 'source' ? this.source : this.target\r\n    if (end == node) {\r\n      // simply change the position of the edge.\r\n      if (node) { node.setEdgeAt(this, pos) }\r\n    } else {\r\n      if (end) {\r\n        // first remove the edge from the current end\r\n        end.removeEdge(this)\r\n      }\r\n\r\n      if (node) {\r\n        if (dir == 'source') { node.addOutEdge(this, pos) } else { node.addInEdge(this, pos) }\r\n      }\r\n      if (dir == 'source') { this.source = node } else { this.target = node }\r\n      // this.clearPoints();\r\n    }\r\n  }\r\n\r\n  getLabelBox (key) {\r\n    var label = this.prop('label')\r\n    if (label) { return Label.getLabelBoxForLink(label, this.viewProp(key, 'labelConfig'), this.getShape(key)) }\r\n    return null\r\n  }\r\n\r\n  /**\r\n\t * Return a pair of points as reference to the calculation of start and end points.\r\n\t */\r\n  getReferencePoints (key) {\r\n    let pts = []\r\n    if (this.source) { pts.push(this.source.getShape(key).center) } else { pts.push(this.viewProp(key, 'start')) }\r\n\r\n    if (this.target) { pts.push(this.target.getShape(key).center) } else { pts.push(this.viewProp(key, 'end')) }\r\n\r\n    return pts\r\n  }\r\n\r\n  getTerminalVisual (key, orthogonal) {\r\n    let refPts = this.getReferencePoints(key)\r\n    let terminals = []\r\n\r\n    let getBound = function (pt) {\r\n      return new Rectangle(pt.x, pt.y, 3, 3)\r\n    }\r\n\r\n    if (this.source) {\r\n      terminals.push(this.source.getPort(key, this.prop('sourcePort'), refPts[1], orthogonal))\r\n    } else { terminals.push({ point: refPts[0], direction: Rectangle.getDirection(getBound(refPts[0]), refPts[1], true) }) }\r\n\r\n    if (this.target) {\r\n      terminals.push(this.target.getPort(key, this.prop('targetPort'), refPts[0], orthogonal))\r\n    } else { terminals.push({ point: refPts[1], direction: Rectangle.getDirection(getBound(refPts[1]), refPts[0], true) }) }\r\n    return terminals\r\n  }\r\n\r\n  getShape (key) {\r\n    let shape = Cache.get(this.id + '.shape', key)\r\n    if (shape) return shape\r\n\r\n    let config = this.viewProp(key, 'shape')\r\n    shape = Link.getLink(this.getTerminalVisual(key, config.orthogonal), config, this.prop('startMarker'), this.prop('endMarker'))\r\n    Cache.set(this.id + '.shape', shape, key)\r\n    return shape\r\n  }\r\n\r\n  toString () {\r\n    return 'Edge:{' + (!this.source ? 'null' : this.source.id) + '--' + (!this.target ? 'null' : this.target.id) + '}'\r\n  }\r\n\r\n  destroy () {\r\n    super.destroy()\r\n    this.setSource(null)\r\n    this.setTarget(null)\r\n  }\r\n}\r\nEdge.namespace = 'Edges'\r\n\r\nexport default Edge\r\n\r\n/*\r\n\r\nEdge.prototype.isVisible = function() {\r\n\tif (this.graph.getProperty(\"allowDanglingEdges\")) {\r\n\t\treturn (this.source ? this.source.isVisible() : true) && (this.target ? this.target.isVisible() : true) && this.getProperty(\"visible\");\r\n\t} else\r\n\t\treturn this.source && this.target && this.getProperty('visible') && this.source.isVisible() && this.target.isVisible();\r\n};\r\n\r\n*/\r\n","import Rectangle from '../geometry/Rectangle'\r\n\r\nlet registry = {}\r\n\r\nlet Marker = (function () {\r\n  /** Begin Standard Marker Type **/\r\n  function arrow (size, source, styles) {\r\n    let sign = source ? -1 : 1\r\n    let marker = {\r\n      viewBox: new Rectangle(-5, -5, 10, 10),\r\n      size: size,\r\n      ref: [4 * sign, 0],\r\n      fill: styles.color\r\n    }\r\n    marker.shape = {\r\n      name: 'Polygon',\r\n      points: [[-2 * sign, 0], [-4 * sign, 4], [4 * sign, 0], [-4 * sign, -4]]\r\n    }\r\n    return marker\r\n  }\r\n\r\n  function triangle (size, source, styles) {\r\n    let sign = source ? -1 : 1\r\n    let marker = {\r\n      viewBox: new Rectangle(-5, -5, 10, 10),\r\n      size: size,\r\n      ref: [4 * sign, 0],\r\n      fill: styles.color\r\n    }\r\n    marker.shape = {\r\n      name: 'Polygon',\r\n      points: [[-5 * sign, -5], [-5 * sign, 5], [4 * sign, 0]]\r\n    }\r\n    return marker\r\n  }\r\n\r\n  function oval (size, source, styles) {\r\n    let r = size / 2\r\n    let marker = {\r\n      viewBox: new Rectangle(-r, -r, size, size),\r\n      size: size,\r\n      ref: [0, 0],\r\n      fill: styles.color\r\n    }\r\n    marker.shape = '<ellipse cx=\"0\" cy=\"0\" rx=\"' + r + '\" ry=\"' + r + '\"></ellipse>'\r\n    return marker\r\n  }\r\n\r\n  function diamond (size, source, styles) {\r\n    let sign = source ? -1 : 1\r\n    let marker = {\r\n      viewBox: new Rectangle(-5, -5, 10, 10),\r\n      size: size,\r\n      ref: [4 * sign, 0],\r\n      fill: styles.color\r\n    }\r\n    marker.shape = {\r\n      name: 'Polygon',\r\n      points: [[-4, 0], [0, 4], [4, 0], [0, -4]]\r\n    }\r\n    return marker\r\n  }\r\n  /** End Standard Marker Type **/\r\n  function getMarker (config, source) {\r\n    let factory = registry[config.type]\r\n    let marker = factory(config.size, source, config)\r\n    marker.id = config.id\r\n    return marker\r\n  }\r\n\r\n  registry['arrow'] = arrow\r\n  registry['triangle'] = triangle\r\n  registry['oval'] = oval\r\n  registry['diamond'] = diamond\r\n\r\n  return {\r\n    registry: registry,\r\n    getMarker: getMarker\r\n  }\r\n})()\r\n\r\nexport default Marker\r\n","import _ from 'lodash'\r\nimport Utils from '../util/Utils'\r\nimport Node from './Node'\r\nimport Edge from './Edge'\r\nimport Marker from '../view/Marker'\r\n\r\nconst nodeDefaults = {\r\n  name: 'Default',\r\n  role: 'node',\r\n  draggable: true,\r\n  selectable: true,\r\n  editable: true,\r\n  resizable: false,\r\n  sourceable: true,\r\n  targetable: true,\r\n  visible: true\r\n}\r\n\r\nconst edgeDefaults = {\r\n  name: 'Default',\r\n  role: 'edge',\r\n  selectable: true,\r\n  visible: true,\r\n  startMarker: null,\r\n  endMarker: {\r\n    id: 'Default_EndMarker',\r\n    type: 'arrow',\r\n    size: 10,\r\n    color: '#0ea117'\r\n  },\r\n  /* start and end is only used if the edge is not connected to a node */\r\n  start: [0, 0],\r\n  end: [400, 200]\r\n}\r\n\r\nclass Graph {\r\n  constructor (id = _.uniqueId('G'), config = {}, model) {\r\n    this.id = id\r\n\r\n    this.nodes = {}\r\n    this.edges = {}\r\n\r\n    this.selection = null\r\n    this.destroyed = false\r\n\r\n    Utils.buildTypes(config.nodeTypes, 'Nodes', nodeDefaults)\r\n    Utils.buildTypes(config.edgeTypes, 'Edges', edgeDefaults)\r\n    // check for markers.\r\n    this.markers = []\r\n    let edgeTypes = Utils.type(Edge.namespace); let marker; let markerConfig\r\n    edgeTypes.forEach(function (type) {\r\n      markerConfig = type.prototype.startMarker\r\n      if (markerConfig) {\r\n        marker = Marker.getMarker(markerConfig, true)\r\n        this.markers.push(marker)\r\n      }\r\n      markerConfig = type.prototype.endMarker\r\n      if (markerConfig) {\r\n        marker = Marker.getMarker(markerConfig, false)\r\n        this.markers.push(marker)\r\n      }\r\n    }, this)\r\n\r\n    delete config.nodeTypes\r\n    delete config.edgeTypes\r\n    Utils.initConfig(this, config)\r\n    this.root = null\r\n    if (model) { this.loadModel(model) }\r\n  }\r\n\r\n  static getJSClass (config, defaultClass) {\r\n    let jsClass = null\r\n    if (config && config.type) {\r\n      // See if we can get the js class from config.\r\n      let type = Utils.type(defaultClass.namespace, config.type)\r\n      if (type) { jsClass = type.jsClass }\r\n    }\r\n\r\n    return Utils.getConstructor(jsClass, defaultClass)\r\n  }\r\n\r\n  /**\r\n\t * Create a new Node\r\n\t * @param config\r\n\t * @param parent\r\n\t * @param pos\r\n\t * @returns {*}\r\n\t */\r\n  addNode (config, parent = this.currentRoot, pos) {\r\n    let NodeClass = Graph.getJSClass(config, Node)\r\n    let node = new NodeClass(this, config)\r\n\r\n    if (parent) { Graph.addChild(parent, node, pos) } else {\r\n      this.root = node\r\n      this.root.prop('role', 'root')\r\n    }\r\n\r\n    this.nodes[node.id] = node\r\n    return node\r\n  }\r\n\r\n  /**\r\n\t * Create a new Edge\r\n\t * @param config\r\n\t * @param parent\r\n\t * @param from\r\n\t * @param to\r\n\t * @returns {*}\r\n\t */\r\n  addEdge (config, parent = this.currentRoot, from, to) {\r\n    let EdgeClass = Graph.getJSClass(config, Edge)\r\n    let edge = new EdgeClass(this, config, from, to)\r\n\r\n    Graph.addChild(parent, edge)\r\n    this.edges[edge.id] = edge\r\n    return edge\r\n  }\r\n\r\n  /**\r\n\t * Added a new child to the parent. The parent has to be a node.\r\n\t * @param parent\r\n\t * @param child\r\n\t */\r\n  static addChild (parent, child) {\r\n    if (!parent.children) { parent.children = [] }\r\n\r\n    if (child.parent != parent) {\r\n      parent.children.push(child)\r\n\r\n      if (child.parent && child.parent.children) { child.parent.children = _.without(child.parent.children, child) }\r\n    }\r\n    child.parent = parent\r\n  }\r\n\r\n  loadModel (model, parent = this.currentRoot) {\r\n    let nodes = model.nodes\r\n    let edges = model.edges\r\n    delete model.nodes\r\n    delete model.edges\r\n\r\n    let node = this.addNode(model, parent)\r\n    if (nodes) {\r\n      _.forEach(nodes, (child) => {\r\n        this.loadModel(child, node)\r\n      })\r\n    }\r\n    if (edges) {\r\n      _.forEach(edges, (edge) => {\r\n        let from, to\r\n        if (edge.from) { from = this.nodes[edge.from] }\r\n        if (edge.to) { to = this.nodes[edge.to] }\r\n        this.addEdge(edge, node, from, to)\r\n      })\r\n    }\r\n  }\r\n\r\n  get currentRoot () {\r\n    return this.root\r\n  }\r\n\r\n  reset () {}\r\n  destroy () {}\r\n}\r\n\r\nGraph.DEFAULTS = {\r\n  allowDanglingEdges: true,\r\n  multiConnect: false,\r\n  readOnly: false,\r\n  viewOnly: false\r\n}\r\n\r\nexport default Graph\r\n","import _ from 'lodash'\r\nimport Utils from '../util/Utils'\r\n\r\nclass Layout {\r\n  constructor (config = {}) {\r\n    if (config.hasOwnProperty('orientation') && _.isString(config.orientation)) {\r\n      if (config.orientation.toUpperCase() == 'HORIZONTAL') { config.orientation = Layout.HORIZONTAL } else { delete config.orientation }\r\n    }\r\n    Utils.initConfig(this, config)\r\n  }\r\n\r\n  layout (root, bounds) {}\r\n  reset () {}\r\n  destroy () {}\r\n}\r\nLayout.VERTICAL = 0\r\nLayout.HORIZONTAL = 1\r\n\r\nLayout.DEFAULTS = {\r\n  orientation: Layout.VERTICAL\r\n}\r\n\r\nexport default Layout\r\n","import Layout from './Layout'\r\n\r\nclass FlowLayout extends Layout {\r\n  layout (root, bounds) {\r\n    var items\r\n    if (!root) { items = this.owner.childNodes } else if (_.isArray(root)) { items = root } else { items = root.getLinkedNodes('target') }\r\n    if (!items || items.length == 0) return\r\n\r\n    var x = 0; var y = 0; var h = 0; var node\r\n    var p1 = 0; var p2 = 0\r\n    for (var i = 0; i < items.length; i++) {\r\n      node = items[i]\r\n      if (x > 0 && x + this.hgap + node.getProperty('width') > bounds.width) {\r\n        // create new line\r\n        y += h + this.vgap\r\n        x = 0; h = 0; p1 = 0; p2++\r\n      }\r\n      node._flPos = [p1, p2]\r\n      node.moveTo([bounds.x + x, bounds.y + y])\r\n      x += this.hgap + node.getProperty('width')\r\n      p1++\r\n      h = h < node.getProperty('height') ? node.getProperty('height') : h\r\n    }\r\n    this.trigger(new Rectangle(bounds.x, bounds.y, bounds.width, y + h))\r\n  }\r\n}\r\n\r\nFlowLayout.DEFAULTS = {\r\n  hgap: 10,\r\n  vgap: 10\r\n}\r\n\r\nexport default FlowLayout\r\n","export default class Behavior {\r\n  constructor (renderer) {\r\n    this.renderer = renderer\r\n  }\r\n\r\n  destroy () {\r\n    delete this.renderer\r\n  }\r\n}\r\n","/**\r\n * Created by tong on 6/28/2016.\r\n */\r\nimport Behavior from './Behavior'\r\n\r\n/**\r\n * Graph handler handles Panning and Zoom and rubber band selection\r\n */\r\nclass GraphBehavior extends Behavior {\r\n  constructor (renderer) {\r\n    super(renderer)\r\n    let dispatcher = renderer.dispatcher\r\n    // TODO:\r\n    // let f = function(type, ns, graph, pos, event) {\r\n    // \t//Cursor.updateCursor(type, ns, graph, event);\r\n    // };\r\n    dispatcher.register(/^drag.*\\.graph$/, this.handleDrag, this)\r\n    dispatcher.register(/^zoom/, this.handleZoom, this)\r\n    // dispatcher.register(['mousedown.graph', 'mouseenter.graph', 'mouseleave.graph'], f);\r\n    this.offset = null\r\n  }\r\n\r\n  handleZoom (type, ns, graph, pos, event) {\r\n    this.renderer.transform(null, null, event.scale)\r\n  }\r\n\r\n  handleDrag (type, ns, graph, pos, event) {\r\n    if (type == 'dragstart') {\r\n      let pan = (this.renderer.prop('defaultClickMode') == 'pan') ^ (event.ctrlKey || event.shiftKey)\r\n      if (!pan) return\r\n      let t = this.renderer.translate\r\n      this.offset = [t[0] - pos[0], t[1] - pos[1]]\r\n      return\r\n    }\r\n    if (!this.offset) return\r\n    this.renderer.transform(pos[0] + this.offset[0], pos[1] + this.offset[1])\r\n    if (type == 'dragend') {\r\n      // Cursor.updateCursor('mouseup', ns, graph, event);\r\n      delete this.offset\r\n    }\r\n  }\r\n}\r\n\r\nexport default GraphBehavior\r\n","import Rectangle from '../geometry/Rectangle'\r\nimport Cell from '../graph/Cell'\r\nimport Behavior from './Behavior'\r\n\r\nclass SelectionBehavior extends Behavior {\r\n  constructor (renderer) {\r\n    super(renderer)\r\n    let dispatcher = renderer.dispatcher\r\n    dispatcher.register('mousedown.*', this.selectCell, this)\r\n    dispatcher.register('mouseup.*', this.unselectCell, this)\r\n    dispatcher.register('drag*.graph', this.handleMultiSelect, this)\r\n    // graph.on(Graph.EVENT_TYPES.SELECTION_CHANGE, this.updateSelections, this)\r\n    this.selectedNodes = null\r\n    this.selectedLinks = null\r\n    this.attachedLinks = null\r\n  }\r\n\r\n  updateSelections () {\r\n    if (this.selectedNodes) {\r\n      this.selectedNodes.classed('selected', false)\r\n    }\r\n    if (this.selectedLinks) {\r\n      this.selectedLinks.classed('selected', false)\r\n    }\r\n\r\n    this.selectedNodes = null\r\n    this.selectedLinks = null\r\n    this.attachedLinks = null\r\n\r\n    if (this.graph.selectedVertices && this.graph.selectedVertices.length > 0) {\r\n      this.selectedNodes = this.graph.renderer.getShapes(this.graph.selectedVertices)\r\n      this.attachedLinks = this.graph.renderer.getShapes(this.graph.getAttachedEdges())\r\n      this.selectedNodes.classed('selected', true)\r\n    }\r\n\r\n    if (this.graph.selectedEdges && this.graph.selectedEdges.length > 0) {\r\n      this.selectedLinks = this.graph.renderer.getShapes(this.graph.selectedEdges)\r\n      this.selectedLinks.classed('selected', true)\r\n    }\r\n  }\r\n\r\n  selectCell (type, ns, data, pos, event) {\r\n    var cell = data === this.graph ? null : data\r\n    if (cell && !(cell instanceof Cell)) return\r\n    var toggle = event.ctrlKey || event.shiftKey\r\n    if (cell && (cell instanceof Cell)) {\r\n      if (!this.graph.isSelected(cell)) {\r\n        delete cell._firstSelection\r\n      } else {\r\n        cell._firstSelection = true\r\n      }\r\n\r\n      d3.select(event.dataTarget).moveToFront()\r\n      this.graph.setSelection(cell, toggle)\r\n    }\r\n  }\r\n\r\n  unselectCell (type, ns, data, pos, event) {\r\n    var cell = data === this.graph ? null : data\r\n    if (cell && !(cell instanceof Cell)) return\r\n    var ctrlKey = event.ctrlKey || event.shiftKey\r\n    if (!cell) {\r\n      this.graph.setSelection(cell, ctrlKey)\r\n    }\r\n  }\r\n\r\n  handleMultiSelect (type, ns, data, pos, event) {\r\n    pos = util.scale(this.graph, pos)\r\n\r\n    if (type === 'dragstart') {\r\n      var select = (this.graph.getProperty('defaultClickMode') == 'select') ^ (event.ctrlKey || event.shiftKey)\r\n      if (!select) return\r\n      this.startPt = new Point(pos[0], pos[1])\r\n      return\r\n    }\r\n    if (!this.startPt) return\r\n    var rect = Rectangle.getBoundingRectangle([new Point(pos[0], pos[1]), this.startPt])\r\n    var renderer = this.graph.renderer\r\n    if (!this.rubberband) {\r\n      this.rubberband = d3.select(renderer.appendNode(renderer.getCellLayer(), {\r\n        template: _.template('<g><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" stroke=\"#000000\" fill=\"none\" stroke-dasharray=\"3 3\"/></g>')\r\n      }, false))\r\n    }\r\n    if (type == 'dragend') {\r\n      var cells = this.graph.getCurrentRoot().children\r\n      // TODO: Define if we want to select vertexes / edges or both\r\n      cells = _.filter(cells, function (cell) {\r\n        var box = cell.getBounds()\r\n        if (rect.contains(box)) {\r\n          return true\r\n        }\r\n        return false\r\n      })\r\n      // TODO: Set selection\r\n      this.graph.setSelection(cells, event.ctrlKey)\r\n\r\n      this.rubberband.remove()\r\n      delete this.startPt\r\n      delete this.rubberband\r\n      return\r\n    }\r\n    this.rubberband.select('rect').attr({ x: rect.x, y: rect.y, width: rect.width, height: rect.height })\r\n  }\r\n\r\n  destroy () {\r\n    super.destroy()\r\n    delete this.selectedNodes\r\n    delete this.selectedLinks\r\n    delete this.attachedLinks\r\n  }\r\n}\r\n\r\nexport default SelectionBehavior\r\n","import _ from 'lodash'\r\nimport Events from '../../lib/bean'\r\nimport Utils from '../util/Utils'\r\nimport DomUtils from '../util/dom-utils'\r\nimport Layout from '../layout/Layout'\r\nimport Rectangle from '../geometry/Rectangle'\r\nimport EventDispatcher from '../event/event-dispatcher'\r\nimport GraphBehavior from '../behavior/GraphBehavior'\r\nimport SelectionBehavior from '../behavior/SelectionBehavior'\r\nimport Label from './Label'\r\n\r\nclass Renderer {\r\n  constructor (id, container, config = {}, graph = null) {\r\n    this.id = id\r\n    this.box = DomUtils.createElement('div', { id: this.id, tabindex: 0, ns: 'graph' }, { overflow: 'hidden', width: '100%', height: '100%', position: 'relative' })\r\n    container.appendChild(this.box)\r\n    if (config.layout) {\r\n      let LayoutClass = Utils.getConstructor(config.layout.jsClass, Layout)\r\n      this.layout = new LayoutClass(config.layout.config)\r\n      delete config.layout\r\n    }\r\n    this.clear = true\r\n    this._translate = [0, 0]\r\n    this._scale = 1.0\r\n    this.graph = graph\r\n    this.dispatcher = null\r\n    this.graphBehavior = null\r\n    this.selectionBehavior = null\r\n    this.nodeBehavior = null\r\n    this.edgeBehavior = null\r\n    this.connectionBehavior = null\r\n    Utils.initConfig(this, config)\r\n\r\n    Events.on(Label.editor, 'editor.update.*', (key, value) => {\r\n      // this.graph.nodes[key].prop('label', value);\r\n      // this.render();\r\n      console.log(key + '=' + value)\r\n    })\r\n  }\r\n\r\n  get graph () {\r\n    return this._graph\r\n  }\r\n\r\n  set graph (graph) {\r\n    this._graph = graph\r\n    let root = graph.currentRoot\r\n    if (root) {\r\n      this._translate = [root.viewProp(this.id, 'x') || 0, root.viewProp(this.id, 'y') || 0]\r\n      this._scale = root.viewProp(this.id, 'scale') || 1.0\r\n    }\r\n  }\r\n\r\n  viewport (scaled, viewport) {\r\n    if (_.isUndefined(scaled) || _.isNull(scaled)) scaled = false\r\n    if (!viewport) {\r\n      let vp = new Rectangle(0, 0, this.box.offsetWidth, this.box.offsetHeight)\r\n      if (scaled) { return Utils.scale(this.translate, this.scale, vp) }\r\n      return vp\r\n    }\r\n    if (!scaled) viewport = Utils.scale(this.translate, this.scale, viewport)\r\n    let w = this.box.offsetWidth\r\n    let scale = w / viewport.width\r\n    this.transform(-viewport.x * scale, -viewport.y * scale, scale)\r\n  }\r\n\r\n  get translate () { return this._translate }\r\n  set translate (t) { this.transform(t[0], t[1]) }\r\n  get scale () { return this._scale }\r\n  set scale (k) {\r\n    switch (k) {\r\n      case 'in':\r\n        k = this.scale * this.prop('zoomFactor')\r\n        break\r\n      case 'out':\r\n        k = this.scale / this.prop('zoomFactor')\r\n        break\r\n      case 'actual':\r\n        k = 1.0\r\n        break\r\n      case 'fit':\r\n        let gridSize = this.prop('gridSize') * 2\r\n\r\n        let gBounds = this.getBounds()\r\n        let vBounds = this.viewport()\r\n\r\n        vBounds.width -= gridSize\r\n        vBounds.height -= gridSize\r\n\r\n        /* Do not zoom more than actual if graph already fits into the bounds */\r\n        k = Math.min((vBounds.width / gBounds.width), (vBounds.height / gBounds.height), 1.0)\r\n\r\n        // TODO: Add centering code here or trigger an event for that\r\n        break\r\n      default:\r\n        if (_.isString(k)) k = parseFloat(k)\r\n        break\r\n    }\r\n    this.transform(null, null, k)\r\n  }\r\n\r\n  transform (x = null, y = null, scale = null) {\r\n    let graph = this.graph\r\n    let root = graph ? graph.currentRoot : null\r\n    if (!_.isNull(x)) {\r\n      this._translate[0] = x\r\n      if (root) { root.viewProp(this.id, 'x', x) }\r\n    }\r\n    if (!_.isNull(y)) {\r\n      this._translate[1] = y\r\n      if (root) { root.viewProp(this.id, 'y', y) }\r\n    }\r\n    if (!_.isNull(scale)) {\r\n      this._scale = scale\r\n      if (root) { root.viewProp(this.id, 'scale', scale) }\r\n      // sync the scale between the dispatcher and the graph\r\n      let s = this.dispatcher.scale\r\n      if (s !== scale) { this.dispatcher.scale = scale }\r\n    }\r\n    this.refresh()\r\n  }\r\n\r\n  render () {\r\n    if (!this._graph) return false\r\n    if (this.layout) { this.layout.layout(this._graph.currentRoot, this.viewport()) }\r\n\r\n    this.initializeBehaviors()\r\n    return true\r\n  }\r\n\r\n  renderLabel (box) {\r\n    return this.constructor.renderLabel(box)\r\n  }\r\n\r\n  renderLink (shape) {\r\n    return this.constructor.renderLink(shape)\r\n  }\r\n\r\n  renderMarkers (markers) {\r\n    return this.constructor.renderMarkers(markers)\r\n  }\r\n\r\n  initializeBehaviors () {\r\n    // create the event dispatcher if necessary.\r\n    if (!this.dispatcher) {\r\n      this.dispatcher = new EventDispatcher(this.box, [this.prop('minZoom'), this.prop('maxZoom')])\r\n      let JsClass\r\n      if (this.prop('graphBehavior')) {\r\n        JsClass = Utils.getConstructor(this.prop('graphBehavior'))\r\n        this.graphBehavior = new JsClass(this)\r\n      }\r\n      if (this.prop('selectionBehavior')) {\r\n        JsClass = Utils.getConstructor(this.prop('selectionBehavior'))\r\n        this.selectionBehavior = new JsClass(this)\r\n      }\r\n      this.dispatcher.register('mouseup.node.label', function (type, ns, target, pos, event) {\r\n        let node = this._graph.nodes[target.getAttribute('id')]\r\n        if (!this.dispatcher.dragging && !node._firstSelection) {\r\n          Label._delayEdit = _.delay(() => {\r\n            if (Label._delayEdit) {\r\n              delete Label._delayEdit\r\n              Label.editor.start(node.id, this.box, node.getLabelBox(this.id), target, event.nsTarget, this.scale)\r\n            }\r\n          }, 250)\r\n        }\r\n      }, this)\r\n      this.dispatcher.register([/^mousedown/, /^zoom/], function (type, ns, target, pos, event) {\r\n        if (!DomUtils.eventFromInput(event)) {\r\n          Label.editor.stop()\r\n        }\r\n      }, this)\r\n    }\r\n    this.dispatcher.start()\r\n  }\r\n\r\n  refresh () {}\r\n\r\n  /**\r\n   * Get the template for the specified key.\r\n   * @param key\r\n   * @param config if the template is a function, this config will be passed as the argument.\r\n   * @param preprocessor if the template contains preprossing elements, such as #{shape}, the preprocessor will be\r\n   * used to render them.\r\n   * @returns {*}\r\n   */\r\n  getTemplate (key, config, preprocessor) {\r\n    let t = this.constructor.TEMPLATES[key]\r\n    if (t && _.isFunction(t)) {\r\n      t = t(config)\r\n    }\r\n    // check if there are any preprocessing tags.\r\n    if (preprocessor) {\r\n      let parts = t.match(/(#{[^#]*})/g)\r\n      let obj = {}\r\n      for (let part in parts) {\r\n        part = parts[part]\r\n        part = part.substring(2, part.length - 1).trim()\r\n        obj[part] = preprocessor[_.camelCase('render ' + part)](this)\r\n      }\r\n      t = _.template(t, { interpolate: /#{([\\s\\S]+?)}/g })(obj)\r\n    }\r\n    return t\r\n  }\r\n\r\n  reset () {}\r\n\r\n  destroy () {\r\n    delete this._graph\r\n    delete this.layout\r\n    if (this.dispatcher) {\r\n      this.dispatcher.stop()\r\n      delete this.dispatcher\r\n    }\r\n    this.box.innerHTML = ''\r\n  }\r\n}\r\nRenderer.DEFAULTS = {\r\n  defaultClickMode: 'pan',\r\n  hideOutline: false,\r\n  singleSelect: true,\r\n  draggable: true,\r\n  gridEnabled: false,\r\n  guidesEnabled: true,\r\n  gridSize: 30,\r\n  maxZoom: 4.0,\r\n  minZoom: 0.2,\r\n  zoomFactor: 1.2,\r\n  maskOpacity: 0.5,\r\n  graphBehavior: GraphBehavior,\r\n  selectionBehavior: SelectionBehavior\r\n}\r\n\r\nexport default Renderer\r\n","import _ from 'lodash'\r\nimport Base64 from '../util/base64'\r\nimport DomUtils from '../util/dom-utils'\r\nimport Renderer from './Renderer'\r\nimport StringBuffer from '../util/string-buffer'\r\n\r\nconst NS = 'http://www.w3.org/2000/svg'\r\nif (typeof (SVGElement) !== 'undefined') {\r\n  var svg = document.createElementNS(NS, 'svg')\r\n  svg.innerHTML = '<circle/>'\r\n  if (svg.firstChild !== '[object SVGCircleElement]') {\r\n    Object.defineProperties(SVGElement.prototype, {\r\n      'outerHTML': {\r\n        enumerable: false,\r\n        configurable: true,\r\n        get: function () {\r\n          var $node, $temp\r\n          $temp = document.createElement('div')\r\n          $node = this.cloneNode(true)\r\n          $temp.appendChild($node)\r\n          return $temp.innerHTML\r\n        }\r\n      },\r\n      'innerHTML': {\r\n        enumerable: false,\r\n        configurable: true,\r\n        get: function () {\r\n          var s = this.outerHTML\r\n          var ropen = new RegExp('<' + this.nodeName + '\\\\b(?:([\"\\'])[^\"]*?(\\\\1)|[^>])*>', 'i')\r\n          var rclose = new RegExp('</' + this.nodeName + '>$', 'i')\r\n          return s.replace(ropen, '').replace(rclose, '')\r\n        },\r\n        set: function (markup) {\r\n          // empty el first.\r\n          let child\r\n          while ((child = this.lastChild) !== null) { this.removeChild(child) }\r\n          let buf = new StringBuffer()\r\n          buf.append('<svg>').append(markup).append('</svg')\r\n          let $temp = DomUtils.createElement('div', null, null, buf.toString()).firstElementChild\r\n          while ($temp.firstChild) { this.appendChild($temp.firstChild) }\r\n        }\r\n      }\r\n    })\r\n  }\r\n  // Define the toDataURL for SVG\r\n  SVGElement.prototype.toDataURL = function (type, options = {}) {\r\n    let _svg = this\r\n\r\n    let debug = function (msg) {}\r\n\r\n    if (options['debug'] === true && typeof (console) !== 'undefined') { debug = function (msg) { console.log('SVG.toDataURL:', msg) } }\r\n\r\n    function exportSVG () {\r\n      var svgXml = _svg.outerHTML\r\n      var svgDataurl = base64dataURLencode(svgXml)\r\n      debug(type + ' length: ' + svgDataurl.length)\r\n\r\n      // NOTE double data carrier\r\n      if (options.callback) options.callback(svgDataurl)\r\n      return svgDataurl\r\n    }\r\n\r\n    function base64dataURLencode (s) {\r\n      var b64 = 'data:image/svg+xml;base64,'\r\n\r\n      // https://developer.mozilla.org/en/DOM/window.btoa\r\n      if (window && window.btoa) {\r\n        debug('using window.btoa for base64 encoding')\r\n        b64 += btoa(s)\r\n      } else {\r\n        debug('using custom base64 encoder')\r\n        b64 += Base64.encode(s)\r\n      }\r\n\r\n      return b64\r\n    }\r\n\r\n    // Native export doesn't work very well. should use canvg instead.\r\n    function exportImage (type) {\r\n      var canvas = document.createElement('canvas')\r\n      var ctx = canvas.getContext('2d')\r\n\r\n      // TODO: if (options.keepOutsideViewport), do some translation magic?\r\n\r\n      var svgImg = new Image()\r\n      var svgXml = _svg.outerHTML\r\n      svgImg.src = base64dataURLencode(svgXml)\r\n\r\n      svgImg.onload = function () {\r\n        debug('exported image size: ' + [svgImg.width, svgImg.height])\r\n        canvas.width = svgImg.width\r\n        canvas.height = svgImg.height\r\n        ctx.drawImage(svgImg, 0, 0)\r\n\r\n        // SECURITY_ERR WILL HAPPEN NOW\r\n        var imageDataurl = canvas.toDataURL(type)\r\n        debug(type + ' length: ' + imageDataurl.length)\r\n\r\n        if (options.callback) options.callback(imageDataurl)\r\n        else debug('WARNING: no callback set, so nothing happens.')\r\n      }\r\n\r\n      svgImg.onerror = function () {\r\n        debug(\r\n          \"Can't export! Maybe your browser doesn't support \" +\r\n          'SVG in img element or SVG input for Canvas drawImage?\\n' +\r\n          'http://en.wikipedia.org/wiki/SVG#Native_support'\r\n        )\r\n      }\r\n\r\n      // NOTE: will not return anything\r\n    }\r\n\r\n    function exportImageCanvg (type) {\r\n      if (typeof canvg === 'undefined') return null\r\n      let canvas = DomUtils.createElement('canvas', null, { display: 'none' })\r\n      document.body.appendChild(canvas)\r\n      if (type === 'javascript' && typeof jsCanvas !== 'undefined') {\r\n        var xcanvas = new jsCanvas('jscanvastest') // eslint-disable-line new-cap\r\n        xcanvas.canvas.style.display = 'none'\r\n        // xcanvas.canvas = canvas;\r\n      }\r\n\r\n      if (!options.keepOutsideViewport) {\r\n        canvg(canvas, _svg.outerHTML)\r\n      } else {\r\n        let padding = options.padding || 0\r\n        let scale = 1.0\r\n        let translate = [0, 0]\r\n        let bbox = _svg.getBBox()\r\n        debug('detected svg dimensions ' + [bbox.x, bbox.y, bbox.width, bbox.height])\r\n        let transform = _svg.firstElementChild.getAttribute('transform')\r\n        if (transform) {\r\n          debug('detected svg transform ' + transform)\r\n          transform = SVGRenderer.transform(transform)\r\n          translate = transform.translate\r\n          scale = transform.scale\r\n        }\r\n        let buf = new StringBuffer()\r\n        buf.append('<svg width=\"').append(bbox.width + 2 * padding).append('px\" height=\"').append(bbox.height + 2 * padding).append('px\"><g transform=\"translate(')\r\n          .append(-bbox.x + translate[0] + padding).append(',').append(-bbox.y + translate[1] + padding).append(')scale(').append(scale).append(')\">')\r\n          .append(_svg.firstElementChild.innerHTML).append('</g></svg>')\r\n        if (type === 'javascript') {\r\n          xcanvas.compile(buf.toString(), function () {\r\n            if (options.callback) options.callback(xcanvas.toString())\r\n          })\r\n          return\r\n        } else { canvg(canvas, buf.toString()) }\r\n      }\r\n      var imageDataurl = canvas.toDataURL(type)\r\n      if (options.callback) options.callback(imageDataurl)\r\n      canvas.parentNode.removeChild(canvas)\r\n      return imageDataurl\r\n    }\r\n\r\n    if (!type) type = 'image/svg+xml'\r\n\r\n    if (options.keepNonSafe) debug('NOTE: keepNonSafe is NOT supported and will be ignored!')\r\n    if (options.keepOutsideViewport) debug('NOTE: keepOutsideViewport is only supported with canvg exporter.')\r\n\r\n    switch (type) {\r\n      case 'image/svg+xml':\r\n        return exportSVG()\r\n      case 'image/png':\r\n      case 'image/jpeg':\r\n      case 'javascript':\r\n        if (!options.renderer) {\r\n          if (window && window.canvg) options.renderer = 'canvg'\r\n          else options.renderer = 'native'\r\n        }\r\n        switch (options.renderer) {\r\n          case 'canvg':\r\n            debug('using canvg renderer for ' + type + ' image export')\r\n            return exportImageCanvg(type)\r\n          case 'native':\r\n            debug('using native renderer for ' + type + ' export. THIS MIGHT FAIL.')\r\n            return exportImage(type)\r\n          default:\r\n            debug('unknown image renderer given, doing noting (' + options.renderer + ')')\r\n        }\r\n        break\r\n      default:\r\n        debug(\"Sorry! Exporting as '\" + type + \"' is not supported!\")\r\n    }\r\n    return null\r\n  }\r\n}\r\n\r\nclass SVGRenderer extends Renderer {\r\n  render () {\r\n    let result = super.render()\r\n    if (result) {\r\n      let root = this.graph.currentRoot\r\n      let buf = new StringBuffer('<svg width=\"100%\" height=\"100%\" xmlns=\"http://www.w3.org/2000/svg\">')\r\n      let t = this.translate\r\n      buf.append('<g transform=\"translate(').append(t[0]).append(',').append(t[1]).append(')scale(').append(this.scale).append(')\">')\r\n      buf.append(this.renderDefs())\r\n      buf.append(root.render(this))\r\n      buf.append('</g></svg>')\r\n      this.box.innerHTML = buf.toString()\r\n      this.svg = this.box.firstElementChild\r\n    }\r\n  }\r\n\r\n  renderDefs () {\r\n    let buf = new StringBuffer('<defs>')\r\n    buf.append(this.getTemplate('Grid', this.prop('gridSize')))\r\n    let markers = this.graph.markers\r\n    if (markers.length > 0) { buf.append(SVGRenderer.renderMarkers(markers)) }\r\n    buf.append('</defs>')\r\n    return buf.toString()\r\n  }\r\n\r\n  refresh () {\r\n    if (!this.svg) return\r\n    let g = this.svg.querySelector('g')\r\n    let t = this.translate\r\n    g.setAttribute('transform', 'translate(' + t[0] + ',' + t[1] + ')scale(' + this.scale + ')')\r\n  }\r\n\r\n  static renderMarkers (markers) {\r\n    let buf = new StringBuffer(); let str1; let str2\r\n    markers.forEach(function (marker) {\r\n      str1 = this.TEMPLATES['Marker'](marker)\r\n      str2 = marker.shape\r\n      if (!_.isString(str2)) { str2 = this.renderShape(str2) }\r\n      str1 = str1.replace(/#\\{shape\\}/, str2)\r\n      buf.append(str1)\r\n    }, this)\r\n    return buf.toString()\r\n  }\r\n\r\n  static renderLabel (box) {\r\n    return this.TEMPLATES['Label'](box)\r\n  }\r\n\r\n  static renderShape (shape) {\r\n    let template = this.TEMPLATES[shape.name]\r\n    if (_.isString(template)) { template = _.template(template) }\r\n    return template(shape)\r\n  }\r\n\r\n  static getPathData (shape) {\r\n    let points = shape.points\r\n    let controlPts = shape.controlPts\r\n    if (!points || points.length === 0) return ''\r\n\r\n    if (!controlPts && shape.round) {\r\n      // render rounded line joins.\r\n      let newPts = []\r\n      controlPts = []\r\n      let prev = points[0]; let next; let d1; let d2; let corner\r\n      newPts.push(prev)\r\n      for (let i = 1; i < points.length - 1; i++) {\r\n        next = points[i]\r\n        // set the control point first.\r\n        controlPts[2 * i] = [next, next]\r\n        // check the size of the corner.\r\n        d1 = prev.distance(next)\r\n        d2 = next.distance(points[i + 1])\r\n        corner = Math.min(shape.round, d1 / 2, d2 / 2)\r\n        // split the point into two.\r\n        newPts.push(next.getDirection(prev).scale(corner).translate(next))\r\n        newPts.push(next.getDirection(points[i + 1]).scale(corner).translate(next))\r\n        prev = next\r\n      }\r\n      newPts.push(points[points.length - 1])\r\n      points = newPts\r\n    }\r\n    let buf = new StringBuffer('M'); let point\r\n    for (let i = 0; i < points.length; i++) {\r\n      point = points[i]\r\n      if (i === 0) { buf.append(point) } else {\r\n        if (controlPts && controlPts[i]) {\r\n          buf.append(' C ')\r\n          for (let j = 0; j < controlPts[i].length; j++) { buf.append(controlPts[i][j]).append(' ') }\r\n          buf.append(point)\r\n        } else { buf.append(' L ').append(point) }\r\n      }\r\n    }\r\n    return buf.toString()\r\n  }\r\n\r\n  static renderLink (shape) {\r\n    let buf = new StringBuffer()\r\n    let d = SVGRenderer.getPathData(shape)\r\n    if (shape.showGauge) {\r\n      buf.append('<path style=\"stroke: white; stroke-width: 9; visibility: hidden; pointer-events: stroke;\" d=\"')\r\n        .append(d).append('\"/>')\r\n    }\r\n    buf.append('<path d=\"').append(d).append('\"')\r\n    if (shape.startMarker || shape.endMarker) {\r\n      buf.append(' style=\"')\r\n      if (shape.startMarker) { buf.append('marker-start: url(#').append(_.isString(shape.startMarker) ? shape.startMarker : shape.startMarker.id).append(');') }\r\n      if (shape.endMarker) { buf.append('marker-end: url(#').append(_.isString(shape.endMarker) ? shape.endMarker : shape.endMarker.id).append(');') }\r\n      buf.append('\"')\r\n    }\r\n    buf.append('/>')\r\n    return buf.toString()\r\n  }\r\n\r\n  static appendContent (el, content) {\r\n    let buf = new StringBuffer()\r\n    buf.append('<svg>').append(content).append('</svg')\r\n    let temp = DomUtils.createElement('div', null, null, buf.toString()).firstElementChild\r\n\r\n    while (temp.firstChild) { el.appendChild(temp.firstChild) }\r\n    return el\r\n  }\r\n\r\n  static transform (transform) {\r\n    let translate = [0, 0]; let scale = 1.0\r\n    //\r\n    let parts = transform.match(/translate\\(\\s*([^)]+)/)\r\n    if (parts) {\r\n      let m = parts[1].trim().match(/([\\d.-]+)[ ,]([\\d.-]+)/)\r\n      if (m) {\r\n        translate[0] = parseFloat(m[1]) || 0\r\n        translate[1] = parseFloat(m[2]) || 0\r\n      } else { translate[0] = translate[1] = parseFloat(parts[1]) }\r\n    }\r\n    parts = transform.match(/scale\\(\\s*([^)]+)/)\r\n    if (parts) { scale = parseFloat(parts[1]) || 1.0 }\r\n\r\n    return { translate, scale }\r\n  }\r\n}\r\n/* eslint-disable no-template-curly-in-string */\r\nSVGRenderer.TEMPLATES = {\r\n  $root: '<g id=\"${id}\" class=\"${className}\">#{children}</g>',\r\n  $node: '<g id=\"${id}\" class=\"${className}\" style=\"${style}\" ns=\"${namespace}\" transform=\"translate(${x},${y})\">#{shape}#{label}</g>',\r\n  $edge: '<g id=\"${id}\" class=\"${className}\" style=\"${style}\" ns=\"${namespace}\">#{shape}#{label}</g>',\r\n  Ellipse: '<ellipse cx=\"0\" cy=\"0\" rx=\"${width/2}\" ry=\"${height/2}\"/>',\r\n  Rectangle: '<rect x=\"${-width/2}\" y=\"${-height/2}\" width=\"${width}\" height=\"${height}\" rx=\"9\" ry=\"9\"/>',\r\n  Triangle: '<polygon points=\"${-width/2},${-height/2} ${width/2},${-height/2} 0,${height/2}\"/>',\r\n  Rhombus: '<polygon points=\"0,${-height/2} ${width/2},0 0,${height/2} ${-width/2},0\"/>',\r\n  Hexagon: function (config) {\r\n    var vertical = config.direction === 'north' || config.direction === 'south'\r\n    if (vertical) { return '<polygon points=\"0,${-height/2} ${width/2},${-height/4} ${width/2},${height/4} 0,${height/2} ${-width/2},${height/4} ${-width/2},${-height/4}\"/>' } else { return '<polygon points=\"${-width/2},0 ${width/4},${-height/2} ${width/4},${-height/2} ${width/2},0 ${width/4},${height/2} ${-width/4},${height/2}\"/>' }\r\n  },\r\n  Polygon: function (shape) {\r\n    let buf = new StringBuffer('<polygon points=\"')\r\n    shape.points.forEach(function (pt) {\r\n      buf.append(pt[0]).append(',').append(pt[1]).append(' ')\r\n    })\r\n    buf.removeLast()\r\n    buf.append('\"/>')\r\n    return buf.toString()\r\n  },\r\n  Image: function (config) {\r\n    return '<image x=\"${-width/2}\" y=\"${-height/2}\" width=\"${width}\" height=\"${height}\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"' + config.image + '\"/>'\r\n  },\r\n  Marker: function (marker) {\r\n    return `\r\n<marker id=\"${marker.id}\" markerWidth=\"${marker.size}\" markerHeight=\"${marker.size}\" refx=\"${marker.ref[0]}\"\r\nrefy=\"${marker.ref[1]}\" orient=\"auto\" viewbox=\"${marker.viewBox.x} ${marker.viewBox.y} ${marker.viewBox.width} ${marker.viewBox.height}\"\r\nmarkerUnits=\"userSpaceOnUse\" ${marker.fill ? `style=\"stroke: ${marker.fill};fill:${marker.fill}\"` : ''}>#{shape}</marker>\r\n`.trim()\r\n  },\r\n  Grid: function (size) {\r\n    return `\r\n<pattern id=\"GridPattern\" width=\"${size}\" height=\"${size}\" patternUnits=\"userSpaceOnUse\">\r\n  <ellipse cx=\"0\" cy=\"0\" rx=\"1\" ry=\"1\" fill=\"#999999\"/>\r\n  <ellipse cx=\"0\" cy=\"${size}\" rx=\"1\" ry=\"1\" fill=\"#999999\"/>\r\n  <ellipse cx=\"${size}\" cy=\"0\" rx=\"1\" ry=\"1\" fill=\"#999999\"/>\r\n  <ellipse cx=\"${size}\" cy=\"${size}\" rx=\"1\" ry=\"1\" fill=\"#999999\"/>\r\n</pattern>`.trim()\r\n  },\r\n  Label: _.template(`\r\n<% var box = _.has(data, \"dx\") ? data : (data.getLabelBox ? data.getLabelBox() : null);\r\n   if (box) {%>\r\n  <g <% if (box.config && box.config.class) {%>class=\"<%=box.config.class%>\"<%}%>\\\r\n    <% if (box.config && box.config.ns) {%>ns=\"<%=box.config.ns%>\"<%}%>\\\r\n    <% if (box.config && box.config.inlineStyle) {%>\\\r\n      font-size=\"<%=box.config.fontSize%>\"\\\r\n      font-family=\"<%=box.config.fontFamily%>\"\\\r\n      font-weight=\"<% if (box.bold) {%>bold<%} else {%>normal<%}%>\"\\\r\n      <% if (box.underline) {%>text-decoration=\"underline\"<%}%>\\\r\n      <% if (box.italic) {%>font-style=\"italic\"<%}%>\\\r\n    <%}%>\\\r\n    text-anchor=\"<%=box.anchor%>\"\\\r\n    transform=\"translate(<%=box.bounds.x%>,<%=box.bounds.y%>)<% if (box.config && box.config.rotation) {%>rotate(<%=box.config.rotation%> <%=box.pivot[0]%> <%=box.pivot[1]%>)<%}%>\">\r\n  <% if (box.config.backgroundStyle) {%>\r\n    <rect x=\"<%=-box.bounds.width/2%>\" y=\"<%=-box.bounds.height/2%>\" width=\"<%=box.bounds.width%>\" height=\"<%=box.bounds.height%>\" style=\"<%=box.config.backgroundStyle%>\"/>\r\n  <% } if (_.isArray(box.label)) {\r\n    _.each(box.label, function(value, line) {%>\r\n      <text <% if (box.config && box.config.textStyle) {%>style=\"<%=box.config.textStyle%>\"<%}%>\\\r\n        dx=\"<%=box.dx%>\" dy=\"<%=box.dy + box.lineHeight * line%>\"><%=value%></text>\r\n    <%});} else { %>\r\n      <text><%=box.label%></text>\r\n    <%}%>\r\n    <% if (box.config.title) {%>\r\n      <title><%=box.config.title%></title>\r\n    <%}%>\r\n  </g>\r\n<%}%>\r\n`.trim(), { variable: 'data' }) // TODO add more inline text styles.\r\n}\r\n\r\nexport default SVGRenderer\r\n","import Base64 from './util/base64'\r\nimport Cache from './util/Cache'\r\nimport Utils from './util/Utils'\r\nimport DomUtils from './util/dom-utils'\r\nimport StringBuffer from './util/string-buffer'\r\nimport Point from './geometry/Point'\r\nimport Line from './geometry/Line'\r\nimport Shape from './geometry/Shape'\r\nimport Rectangle from './geometry/Rectangle'\r\nimport Ellipse from './geometry/Ellipse'\r\nimport Rhombus from './geometry/Rhombus'\r\nimport Link from './geometry/Link'\r\nimport Events from '../lib/bean'\r\nimport EventDispatcher from './event/event-dispatcher'\r\nimport Graph from './graph/Graph'\r\nimport Cell from './graph/Cell'\r\nimport Node from './graph/Node'\r\nimport Edge from './graph/Edge'\r\nimport Layout from './layout/Layout'\r\nimport FlowLayout from './layout/FlowLayout'\r\nimport Label from './view/Label'\r\nimport Marker from './view/Marker'\r\nimport Renderer from './view/Renderer'\r\nimport SVGRenderer from './view/SVGRenderer'\r\nimport GraphBehavior from './behavior/GraphBehavior'\r\n// import SelectionBehavior from './behavior/SelectionBehavior'\r\n\r\nShape.addShape('Rectangle', Rectangle)\r\nShape.addShape('Ellipse', Ellipse)\r\nShape.addShape('Rhombus', Rhombus)\r\n\r\nexport default {\r\n  Base64,\r\n  Cache,\r\n  Utils,\r\n  DomUtils,\r\n  StringBuffer,\r\n  Point,\r\n  Line,\r\n  Shape,\r\n  Rectangle,\r\n  Ellipse,\r\n  Link,\r\n  Events,\r\n  EventDispatcher,\r\n  Label,\r\n  Marker,\r\n  Graph,\r\n  Cell,\r\n  Node,\r\n  Edge,\r\n  Layout,\r\n  FlowLayout,\r\n  Renderer,\r\n  SVGRenderer,\r\n  GraphBehavior\r\n  // SelectionBehavior\r\n}\r\n"],"sourceRoot":""}