!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("lodash")):"function"==typeof define&&define.amd?define("qgraph",["lodash"],e):"object"==typeof exports?exports.qgraph=e(require("lodash")):t.qgraph=e(t._)}("undefined"!=typeof window?window:this,function(__WEBPACK_EXTERNAL_MODULE__0__){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE__0__},function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var i=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=n}return function(t,e,n){e&&r(t.prototype,e),n&&r(t,n)}(t,[{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"distance",value:function(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}},{key:"translate",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"scale",value:function(t){return this.x*=t,this.y*=t,this}},{key:"getScaled",value:function(e){return new t(this.x*e,this.y*e)}},{key:"getTranslated",value:function(e){return new t(this.x+e.x,this.y+e.y)}},{key:"getDirection",value:function(e){var n=this.distance(e);return new t((e.x-this.x)/n,(e.y-this.y)/n)}},{key:"rotate",value:function(t){var e=Math.cos(t*Math.PI/180),n=Math.sin(t*Math.PI/180),r=this.x,i=this.y;return this.x=r*e-i*n,this.y=r*n+i*e,this}},{key:"getRotated",value:function(t){return this.clone().rotate(t)}},{key:"dotProduct",value:function(t){return this.x*t.x+this.y*t.y}},{key:"getMidPoint",value:function(e){return new t((this.x+e.x)/2,(this.y+e.y)/2)}},{key:"reverse",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"equals",value:function(e){return!!(e&&e instanceof t)&&(this.x===e.x&&this.y===e.y)}},{key:"reflect",value:function(t,e){return e?this.x=2*t.x-this.x:this.y=2*t.y-this.y,this}},{key:"toString",value:function(){return this.x+","+this.y}}]),t}();i.W=new i(-1,0),i.N=new i(0,-1),i.S=new i(0,1),i.E=new i(1,0),i.NE=new i(1,-1),i.NW=new i(-1,-1),i.SE=new i(1,1),i.SW=new i(-1,1),e.a=i},function(t,e,n){"use strict";n.d(e,"a",function(){return f});var r=n(0),i=n.n(r),o=n(1),a=n(4);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function h(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var f=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),h(this,u(e).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,a["a"]),function(t,e,n){e&&l(t.prototype,e),n&&l(t,n)}(e,[{key:"contains",value:function(t){var e=t.width||0,n=t.height||0,r=t.x-e/2,i=t.x+e/2,o=t.y-n/2,a=t.y+n/2;return i<=this.right&&r>=this.left&&o>=this.top&&a<=this.bottom}},{key:"distance",value:function(t){return this.contains(t)?0:t.x<this.left?t.y<this.top?t.distance(new o.a(this.left,this.top)):t.y<=this.bottom?this.left-t.x:t.distance(new o.a(this.left,this.bottom)):t.x<=this.right?t.y<=this.top?this.top-t.y:t.y-this.bottom:t.y<this.top?t.distance(new o.a(this.right,this.top)):t.y<=this.bottom?t.x-this.right:t.distance(new o.a(this.right,this.bottom))}},{key:"detectIntersection",value:function(t,e){var n=t.y===e.y,r=this.contains(t),i=this.contains(e);if(r&&i)return 4;if(!r&&!i){if(n&&t.y>=this.top&&t.y<=this.bottom){if(t.x<this.left&&e.x>this.right)return 0;if(t.x>this.right&&e.x<this.left)return 2}if(!n&&t.x>=this.left&&t.x<=this.right){if(t.y<this.top&&e.y>this.bottom)return 1;if(t.y>this.bottom&&e.y<this.top)return 3}return-1}var o=r?e:t;return n?o.x>this.right?2:0:o.y<this.top?1:3}},{key:"toString",value:function(){return"Rectangle:{x="+this.x+";y="+this.y+";width="+this.width+";height="+this.height+"}"}}],[{key:"getPerimeter",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t.x,a=t.y,s=n.x-i,l=n.y-a,h=Math.atan2(l,s),u=new o.a(0,0),c=Math.PI,f=Math.PI/2-h,p=Math.atan2(t.height,t.width);return h<-c+p||h>c-p?(u.x=t.left,u.y=a-t.width*Math.tan(h)/2):h<-p?(u.y=t.top,u.x=i-t.height*Math.tan(f)/2):h<p?(u.x=t.right,u.y=a+t.width*Math.tan(h)/2):(u.y=t.bottom,u.x=i+t.height*Math.tan(f)/2),r&&(h<-c+p||h>c-p?(u.x=t.left,u.y=a):h<-p?(u.y=t.top,u.x=i):h<p?(u.x=t.right,u.y=a):(u.y=t.bottom,u.x=i)),{point:u,direction:e.getDirection(t,u,r)}}},{key:"getBoundingRectangle",value:function(t,n){if(!t||0===t.length)return null;n=n||[0,0,0,0],i.a.isArray(n)||(n=[n,n,n,n]);for(var r=[t[0].x,t[0].y],o=[t[0].x,t[0].y],a=1;a<t.length;a++){var s=t[a];s.x<r[0]&&(r[0]=s.x),s.y<r[1]&&(r[1]=s.y),s.x>o[0]&&(o[0]=s.x),s.y>o[1]&&(o[1]=s.y)}r[0]=r[0]-n[0],r[1]=r[1]-n[1],o[0]=o[0]+n[2],o[1]=o[1]+n[3];var l=Math.abs(o[0]-r[0]),h=Math.abs(o[1]-r[1]);return new e(r[0]+l/2,r[1]+h/2,l,h)}},{key:"union",value:function(t){var n=null,r=null,o=-1/0,a=-1/0;return i.a.each(t,function(t){n=n||t.x,r=r||t.y,n=Math.min(n,t.x),r=Math.min(r,t.y),o=Math.max(o,t.right()),a=Math.max(a,t.bottom())}),new e(n=n||0,r=r||0,o-n,a-r)}},{key:"getDirection",value:function(t,e){var n;if(!(arguments.length>2&&void 0!==arguments[2]&&arguments[2]))return new o.a(t.x,t.y).getDirection(new o.a(e.x,e.y));var r=Math.abs(t.left-e.x),i=o.a.W;return(n=Math.abs(t.top-e.y))<=r&&(r=n,i=o.a.N),(n=Math.abs(t.bottom-e.y))<=r&&(r=n,i=o.a.S),(n=Math.abs(t.right-e.x))<r&&(i=o.a.E),i}}]),e}()},function(module,__webpack_exports__,__webpack_require__){"use strict";var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),lodash__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__),_geometry_Point__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),_geometry_Rectangle__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2);function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var _debugging=[],_debugAll=!1,typeRegistry={},splice=Array.splice;__webpack_exports__.a={type:function(t,e,n){return typeRegistry[t]||(typeRegistry[t]=new Map),e?n?void typeRegistry[t].set(e,n):typeRegistry[t].get(e):typeRegistry[t]},createType:function(t,e,n){var r=e.name,i=this.type(t,r);if(!i){var o=e.extends?this.type(t,e.extends):null;!o&&n&&(o=n),i=o?function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,o),e}():function t(e){_classCallCheck(this,t),lodash__WEBPACK_IMPORTED_MODULE_0___default.a.assign(this,e)},delete e.name,delete e.extends,lodash__WEBPACK_IMPORTED_MODULE_0___default.a.assign(i.prototype,e),i.typeName=r,this.type(t,r,i),this.log("Utils","Utils.createType - "+t+"."+r)}return i},buildTypes:function(t,e,n){var r=this;if(this.log("Utils","Utils.buildTypes - "+e),!t&&n)return this.createType(e,n),void this.log("Utils","Utils.buildTypes end");if(n){var i=lodash__WEBPACK_IMPORTED_MODULE_0___default.a.remove(t,{name:n.name});i=i.length>0?i[0]:null,n=i?this.createType(e,lodash__WEBPACK_IMPORTED_MODULE_0___default.a.defaultsDeep(i,n)):this.createType(e,n)}lodash__WEBPACK_IMPORTED_MODULE_0___default.a.forEach(t,function(t){r.createType(e,t,n)}),this.log("Utils","Utils.buildTypes end")},extend:function(t,e,n,r){lodash__WEBPACK_IMPORTED_MODULE_0___default.a.extend(t,e,r);var i=function(){this.constructor=t};return i.prototype=e.prototype,t.prototype=new i,n&&lodash__WEBPACK_IMPORTED_MODULE_0___default.a.extend(t.prototype,n),t.superclass=e.prototype,t},initConfig:function(t,e){for(var n={},r=t.constructor,i=[r];r;)r.super?(r=r.super.constructor,splice.apply(i,[0,0,r])):r=null;for(var o=0;o<i.length;o++)(r=i[o]).DEFAULTS&&lodash__WEBPACK_IMPORTED_MODULE_0___default.a.assign(n,r.DEFAULTS);t.props=lodash__WEBPACK_IMPORTED_MODULE_0___default.a.assign(n,e),r.prototype.prop=function(t,e){if(!e)return this.props[t];this.props[t]=e}},getConstructor:function getConstructor(jsClass,defaultClass){return jsClass||(jsClass=defaultClass),lodash__WEBPACK_IMPORTED_MODULE_0___default.a.isString(jsClass)&&(jsClass=eval(jsClass)),jsClass},debug:function(t){t?_debugging.push(t):_debugAll=!0},log:function(t,e){var n=_debugAll;if(!_debugAll){n=!1;for(var r=0;r<_debugging.length;r++)_debugging[r]===t&&(n=!0)}if(n){for(;t.length<10;)t+=" ";t=t.substring(0,10)+" - ",console.info(t,e)}},getRelativePosition:function(t,e){var n=Math.abs(e.x)<=1?t.width*e.x:e.x,r=Math.abs(e.y)<=1?t.height*e.y:e.y;return this.offsetPosition([n,r],e)},offsetPosition:function(t,e){return[t[0]+e.width*e.anchorX+e.offsetX,t[1]+e.height*e.anchorY+e.offsetY]},unscale:function(t,e,n){return n instanceof _geometry_Rectangle__WEBPACK_IMPORTED_MODULE_2__.a?new _geometry_Rectangle__WEBPACK_IMPORTED_MODULE_2__.a(n.x*e+t[0],n.y*e+t[1],n.width*e,n.height*e):n instanceof _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.a?new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.a(n.x*e+t[0],n.y*e+t[1]):[n[0]*e+t[0],n[1]*e+t[1]]},scale:function(t,e,n){return n instanceof _geometry_Rectangle__WEBPACK_IMPORTED_MODULE_2__.a?new _geometry_Rectangle__WEBPACK_IMPORTED_MODULE_2__.a((n.x-t[0])/e,(n.y-t[1])/e,n.width/e,n.height/e):n instanceof _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.a?new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.a((n.x-t[0])/e,(n.y-t[1])/e):[(n[0]-t[0])/e,(n[1]-t[1])/e]},getProperty:function(t,e){return t?lodash__WEBPACK_IMPORTED_MODULE_0___default.a.has(t,e)?t[e]:t.prop&&lodash__WEBPACK_IMPORTED_MODULE_0___default.a.isFunction(t.prop)?t.prop(e):null:null}}},function(t,e,n){"use strict";var r=n(0),i=n.n(r),o=n(1),a=n(2);function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var l={},h=function(){function t(e,n,r,o,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=n,this.width=r,this.height=o,i.a.defaults(this,a,{x:0,y:0,width:0,height:0})}return function(t,e,n){e&&s(t.prototype,e),n&&s(t,n)}(t,[{key:"contains",value:function(t){return!1}},{key:"getRegularPoints",value:function(t){return null}},{key:"getPerimeter",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.constructor.getPerimeter(this,t,e)}},{key:"render",value:function(t){return i.a.template(t.getTemplate(this.name,this))(this)}},{key:"top",get:function(){return this.y-this.height/2}},{key:"bottom",get:function(){return this.y+this.height/2}},{key:"left",get:function(){return this.x-this.width/2}},{key:"right",get:function(){return this.x+this.width/2}},{key:"center",get:function(){return new o.a(this.x,this.y)}},{key:"bounds",get:function(){return new a.a(this.x,this.y,this.width,this.height)}}],[{key:"getShape",value:function(t){return l[t]}},{key:"addShape",value:function(t,e){l[t]=e}},{key:"removeShape",value:function(t){delete l[t]}}]),t}();e.a=h},function(t,e,n){"use strict";n.r(e);var r={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var e,n,i,o,a,s,l,h="",u=0;for(t=r._utf8_encode(t);u<t.length;)o=(e=t.charCodeAt(u++))>>2,a=(3&e)<<4|(n=t.charCodeAt(u++))>>4,s=(15&n)<<2|(i=t.charCodeAt(u++))>>6,l=63&i,isNaN(n)?s=l=64:isNaN(i)&&(l=64),h=h+this._keyStr.charAt(o)+this._keyStr.charAt(a)+this._keyStr.charAt(s)+this._keyStr.charAt(l);return h},decode:function(t){var e,n,i,o,a,s,l="",h=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<t.length;)e=this._keyStr.indexOf(t.charAt(h++))<<2|(o=this._keyStr.indexOf(t.charAt(h++)))>>4,n=(15&o)<<4|(a=this._keyStr.indexOf(t.charAt(h++)))>>2,i=(3&a)<<6|(s=this._keyStr.indexOf(t.charAt(h++))),l+=String.fromCharCode(e),64!=a&&(l+=String.fromCharCode(n)),64!=s&&(l+=String.fromCharCode(i));return l=r._utf8_decode(l)},_utf8_encode:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e+=String.fromCharCode(r):r>127&&r<2048?(e+=String.fromCharCode(r>>6|192),e+=String.fromCharCode(63&r|128)):(e+=String.fromCharCode(r>>12|224),e+=String.fromCharCode(r>>6&63|128),e+=String.fromCharCode(63&r|128))}return e},_utf8_decode:function(t){for(var e="",n=0,r=c1=c2=0;n<t.length;)(r=t.charCodeAt(n))<128?(e+=String.fromCharCode(r),n++):r>191&&r<224?(c2=t.charCodeAt(n+1),e+=String.fromCharCode((31&r)<<6|63&c2),n+=2):(c2=t.charCodeAt(n+1),c3=t.charCodeAt(n+2),e+=String.fromCharCode((15&r)<<12|(63&c2)<<6|63&c3),n+=3);return e}},i=r,o={},a={get:function(t,e){return this.getCache(e)[t]},set:function(t,e,n){this.getCache(n)[t]=e},contains:function(t,e){return t in this.getCache(e)},remove:function(t,e){delete this.getCache(e)[t]},clear:function(t){t?o[t]&&(o[t]={}):o={}},getCache:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return o[t]||(o[t]={}),o[t]}},s=n(3),l=n(0),h=n.n(l),u=function(){return"undefined"!=typeof window&&window.navigator&&"undefined"!=typeof navigator},c={isIE:function(){if(!u())return!1;var t=window.navigator.userAgent,e=t.indexOf("MSIE");return e>0?parseInt(t.substring(e+5,t.indexOf(".",e))):navigator.userAgent.match(/Trident\/7\./)?11:!!navigator.userAgent.match(/Edge\//)&&"Edge"}(),isFireFox:"undefined"!=typeof InstallTrigger,isChrome:function(){if(!u()||navigator.userAgent.indexOf("Edge")>=0)return!1;var t=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return!!t&&parseInt(t[2],10)}(),isMac:!!u()&&navigator.platform.toUpperCase().indexOf("MAC")>=0,isWindows:!!u()&&navigator.appVersion.indexOf("Windows")>=0,isLinux:!!u()&&navigator.appVersion.indexOf("Linux")>=0,createElement:function(t,e,n,r){var i=document.createElement(t);return this.setElement(i,e,n),r&&(i.innerHTML=r),i},createElementByString:function(t){return this.createElement("div",null,null,t).childNodes},setElement:function(t,e,n){e&&h.a.forEach(e,function(e,n){t.setAttribute(n,e)}),n&&h.a.forEach(n,function(e,n){t.style[n]=e})},testElement:function(t,e){return t&&1===t.nodeType&&(!e||e(t))},getAncestorBy:function(t,e){for(;null!==(t=t.parentNode);)if(this.testElement(t,e))return t;return null},getPosition:function(t,e){e||(e=document.body);var n=t.getBoundingClientRect(),r=e.getBoundingClientRect();return[n.left-r.left,n.top-r.top]},getCenterPosition:function(t,e){e||(e=document.body);var n=t.getBoundingClientRect(),r=e.getBoundingClientRect(),i=n.right-n.left,o=n.bottom-n.top;return[n.left-r.left+i/2,n.top-r.top+o/2]},move:function(t,e,n){e&&(t.style.left=e+"px"),n&&(t.style.top=n+"px")},getSize:function(t){return[parseInt(t.style.offsetWidth,10),parseInt(t.style.offsetHeight,10)]},resize:function(t,e,n){e&&(t.style.width=e+"px"),n&&(t.style.height=n+"px")},preloadImages:function(t){this.preloadImages.list||(this.preloadImages.list=[]),this.preloadImages.loaded||(this.preloadImages.loaded={});for(var e,n=this.preloadImages.list,r=this,i=0;i<t.length;i++)(e=new Image).onload=function(){var t=n.indexOf(this);-1!==t&&(r.preloadImages.loaded[this.name]={width:this.width,height:this.height},n.splice(t,1))},n.push(e),e.src=t[i],e.name=t[i]},getImageInfo:function(t){return this.preloadImages.loaded?this.preloadImages.loaded[t]:null},downloadFile:function(t,e){if(e){var n=e.match(/^data:([^;,]*)/)[1];if(t.indexOf(".")<0)if(n||(n="text/plain"),"text/plain"===n)t+=".txt";else{var r=n.split("/")[1];r.indexOf("+")>0&&(r=r.split("+")[0]),t=t+"."+r}if(this.isIE){e=e.indexOf(";base64")>=0?atob(e.replace("data:"+n+";base64,","")):decodeURI(e.replace("data:"+n+",","")),e=this.GetBlob(e,n),navigator.msSaveBlob(e,t)}else{var i=this.createElement("a",{href:e,download:t},{display:"none"});document.body.appendChild(i),i.click(),i.parentNode.removeChild(i)}}},GetBlob:function(t,e,n){e=e||"",n=n||512;for(var r=[],i=0;i<t.length;i+=n){for(var o=t.slice(i,i+n),a=new Array(o.length),s=0;s<o.length;s++)a[s]=o.charCodeAt(s);var l=new Uint8Array(a);r.push(l)}return new Blob(r,{type:e})},openImage:function(t,e){if(u()){var n=window.open("","_blank","toolbar=yes, scrollbars=yes, resizable=yes, width=500, height=500").document,r=n.createElement("img");this.setElement(r,{src:e,name:t}),n.body.appendChild(r)}},eventFromInput:function(t){var e=t.target.tagName;return"INPUT"===e||"TEXTAREA"===e||"SELECT"===e}};function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var p=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.buffer=[],e&&this.buffer.push(e)}return function(t,e,n){e&&f(t.prototype,e),n&&f(t,n)}(t,[{key:"append",value:function(t){return h.a.isString(t)?this.buffer.push(t):h.a.isArray(t)?this.buffer=this.buffer.concat(t):this.buffer.push(""+t),this}},{key:"prepend",value:function(t){return h.a.isString(t)?this.buffer.splice(0,0,t):h.a.isArray(t)?this.buffer=t.concat(this.buffer):this.buffer.splice(0,0,""+t),this}},{key:"clear",value:function(){this.buffer=[]}},{key:"removeLast",value:function(){return this.buffer.pop(),this}},{key:"toString",value:function(t){return t||(t=""),this.buffer.join(t)}}]),t}(),d=n(1);function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var y=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.start=e,this.end=n}return function(t,e,n){e&&g(t.prototype,e),n&&g(t,n)}(t,[{key:"length",value:function(){return this.start.distance(this.end)}},{key:"distance",value:function(t){var e=this.start.distance(t);if(0===e)return 0;var n=this.length(),r=new d.a((this.end.x-this.start.x)/n,(this.end.y-this.start.y)/n).dotProduct(new d.a(t.x/e,t.y/e));return e*Math.sqrt(1-r*r)}},{key:"toString",value:function(){return"Line:{start="+this.start+";end="+this.end+"}"}}],[{key:"intersection",value:function(t,e,n,r,i,o,a,s){var l=(s-o)*(n-t)-(a-i)*(r-e),h=((a-i)*(e-o)-(s-o)*(t-i))/l,u=((n-t)*(e-o)-(r-e)*(t-i))/l;if(h>=0&&h<=1&&u>=0&&u<=1){var c=t+h*(n-t),f=e+h*(r-e);return new d.a(c,f)}return null}}]),t}(),v=n(4),b=n(2);function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function w(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function x(t,e){return!e||"object"!==m(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function E(t,e){return(E=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var S=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),x(this,k(e).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&E(t,e)}(e,v["a"]),function(t,e,n){e&&w(t.prototype,e),n&&w(t,n)}(e,[{key:"toString",value:function(){return"Ellipse:{x="+this.x+";y="+this.y+";width="+this.width+";height="+this.height+"}"}}],[{key:"getPerimeter",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.width/2,i=t.height/2,o=t.x,a=t.y,s=e.x,l=e.y,h=parseInt(s-o),u=parseInt(l-a);if(0===h&&0!==u)return new d.a(o,a+i*u/Math.abs(u));if(0===h&&0===u)return new d.a(s,l);var c=u/h,f=a-c*o,p=r*r*c*c+i*i,g=-2*o*p,y=r*r*c*c*o*o+i*i*o*o-r*r*i*i,v=Math.sqrt(g*g-4*p*y),m=(-g+v)/(2*p),w=(-g-v)/(2*p),x=c*m+f,_=c*w+f,k=0,E=0;Math.sqrt(Math.pow(m-s,2)+Math.pow(x-l,2))<Math.sqrt(Math.pow(w-s,2)+Math.pow(_-l,2))?(k=m,E=x):(k=w,E=_);var S=new d.a(k,E),P=b.a.getDirection(t,S,n);if(n){if(-1===P.x)return{point:new d.a(o-r,a),direction:P};if(1===P.x)return{point:new d.a(o+r,a),direction:P};if(-1===P.y)return{point:new d.a(o,a-i),direction:P};if(1===P.y)return{point:new d.a(o,a+i),direction:P}}return{point:S,direction:P}}}]),e}();function P(t){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function C(t,e){return!e||"object"!==P(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function M(t){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function T(t,e){return(T=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var R=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),C(this,M(e).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&T(t,e)}(e,v["a"]),function(t,e,n){e&&O(t.prototype,e),n&&O(t,n)}(e,[{key:"toString",value:function(){return"Rhombus:{x="+this.x+";y="+this.y+";width="+this.width+";height="+this.height+"}"}}],[{key:"getPerimeter",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.width,i=t.height,o=t.x,a=t.y,s=o-r/2,l=a-i/2,h=e.x,u=e.y;if(o===h)return a>u?{point:new d.a(o,l),direction:d.a.S}:{point:new d.a(o,l+i),direction:d.a.N};if(a===u)return o>h?{point:new d.a(s,a),direction:d.a.E}:{point:new d.a(s+r,a),direction:d.a.W};var c,f,p=o,g=a;return n&&(h>=s&&h<=s+r?p=h:u>=l&&u<=l+i&&(g=u)),h<o?u<a?(c=y.intersection(h,u,p,g,o,l,s,a),f=d.a.S):(c=y.intersection(h,u,p,g,o,l+i,s,a),f=d.a.N):u<a?(c=y.intersection(h,u,p,g,o,l,s+r,a),f=d.a.E):(c=y.intersection(h,u,p,g,o,l+i,s+r,a),f=d.a.W),{point:c,direction:f}}}]),e}();function L(t){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function N(t,e){return!e||"object"!==L(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function j(t){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function B(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&A(t,e)}function A(t,e){return(A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function D(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function U(t,e,n){return e&&I(t.prototype,e),n&&I(t,n),t}var F={type:"direct",showGauge:!0,orthogonal:!1},$={width:0,height:0,anchorX:0,anchorY:0,offsetX:0,offsetY:0},z={},W=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;D(this,t),this.start=e[0].point,this.end=e[1].point,this.startNormal=e[0].direction,this.endNormal=e[1].direction,this.startMarker=r,this.endMarker=i,h.a.assign(this,n)}return U(t,[{key:"render",value:function(t){return t.renderLink(this)}},{key:"getRelativePosition",value:function(t){h.a.isNumber(t)&&(t={x:t});var e=(t=h.a.defaults(t,$)).x,n=this.length;Math.abs(e)<=1&&(e*=n),e<0&&(e=n+e),e>n&&(e=n);for(var r,i,o,a=this.points,l=0;l<a.length-1;l++){if(e<=(r=a[l].distance(a[l+1]))){o=(i=a[l].clone()).getDirection(a[l+1]),i.translate(o.getScaled(e));break}e-=r}return i||(i=a[a.length-1]),s.a.offsetPosition([i.x,i.y],t)}},{key:"toString",value:function(){return"Link"}},{key:"points",get:function(){return null}},{key:"controlPts",get:function(){return null}},{key:"length",get:function(){var t,e=this.points,n=0;for(t=0;t<e.length-1;t++)n+=e[t].distance(e[t+1]);return n}}],[{key:"getLink",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e=h.a.defaultsDeep(e,F);var i=z[e.type];return i?new i(t,e,n,r):(console.log("link type not supported: "+e.type),null)}}]),t}(),K=function(t){function e(){return D(this,e),N(this,j(e).apply(this,arguments))}return B(e,W),U(e,[{key:"points",get:function(){return[this.start,this.end]}}]),e}(),H=function(t){function e(){return D(this,e),N(this,j(e).apply(this,arguments))}return B(e,W),U(e,[{key:"getRelativePosition",value:function(t){h.a.isNumber(t)&&(t={x:t});var e=(t=h.a.defaults(t,$)).x,n=this.length;Math.abs(e)>1&&(e/=n),e<0&&e++,e>1&&e--;var r=this.points,i=this.controlPts,o=r[0],a=i[1][0],l=i[1][1],u=r[1],c=[(1-e)*(1-e)*(1-e)*o.x+3*e*(1-e)*(1-e)*a.x+3*e*e*(1-e)*l.x+e*e*e*u.x,(1-e)*(1-e)*(1-e)*o.y+3*e*(1-e)*(1-e)*a.y+3*e*e*(1-e)*l.y+e*e*e*u.y];return s.a.offsetPosition([c.x,c.y],t)}},{key:"points",get:function(){return[this.start,this.end]}},{key:"controlPts",get:function(){var t=this.points[0],e=this.points[1],n=[];return n[0]=null,n[1]=[],0===this.startNormal.x?n[1][0]=new d.a(t.x,(t.y+e.y)/2):n[1][0]=new d.a((t.x+e.x)/2,t.y),0===this.endNormal.x?n[1][1]=new d.a(e.x,(t.y+e.y)/2):n[1][1]=new d.a((t.x+e.x)/2,e.y),n}}]),e}(),V=function(t){function e(){return D(this,e),N(this,j(e).apply(this,arguments))}return B(e,W),U(e,[{key:"points",get:function(){var t=Port.getBounds(edge,!0),e=Port.getBounds(edge,!1),n=e.right()<t.x,r=t.right()<e.x,i=[],o=n?t.x:t.x+t.width,a=t.getCenterY();i.push(new d.a(o,a));var s=r?e.x:e.x+e.width,l=e.getCenterY(),h=this.segment,u=n?-h:h,c=new d.a(o+u,a);u=r?-h:h;var f=new d.a(s+u,l);if(n===r){var p=n?Math.min(o,s)-h:Math.max(o,s)+h;i.push(new d.a(p,a)),i.push(new d.a(p,l))}else if(c.x<f.x===n){var g=a+(l-a)/2;i.push(c),i.push(new d.a(c.x,g)),i.push(new d.a(f.x,g)),i.push(f)}else i.push(c),i.push(f);return i.push(new d.a(s,l)),i}}]),e}(),G=function(t){function e(t,n,r,i){return D(this,e),n=h.a.defaults(n,{MIN_BUFFER:10,autoRoute:!1,randomNoise:0,step:1,maxChannelWidth:100}),N(this,j(e).call(this,t,n,r,i))}return B(e,W),U(e,[{key:"autoRoute",value:function(t,e,n,r,i){var o,a,s,l,h,u,c,f,p,g;l=n[i],o=(p=t[t.length-2]).y<l.y?1:p.y>l.y+l.height?3:p.x<l.x?0:2,g=(c=_getChannel(e,i,n,o)).horizontal?(c.right-c.left)/2:(c.bottom-c.top)/2;for(var y=0;y<t.length-1;y++)if((t[y+1].x!==t[y].x||t[y+1].y!==t[y].y)&&(h=_getFirstIntersection(t,y,n,r,i))){switch(u=h[0],o=h[1],l=n[u],c=_getChannel(e,u,n,o),o){case 0:case 2:p=new d.a((c.right+c.left)/2,t[y].y),a=_getRouteTendency(t,y,p,l,o)<0?1:3,f=_getChannel(e,u,n,a),s=y>1&&t[y-2].y===t[y-1].y&&t[y-1].y>f.top&&t[y-1].y<f.bottom?t[y-1].y-p.y:y<t.length-3&&t[y+2].y===t[y+3].y&&t[y+2].y>f.top&&t[y+2].y<f.bottom?t[y+2].y-p.y:(f.bottom+f.top)/2-p.y,0===o&&p.x<=t[y].x||2===o&&p.x>=t[y].x?p=null:y>0&&(_hasIntersection([new d.a(t[y].x,t[y].y),new d.a(t[y].x,t[y].y+s),new d.a(p.x,p.y+s)],n)||(p=null));break;case 1:case 3:p=new d.a(t[y].x,(c.bottom+c.top)/2),a=_getRouteTendency(t,y,p,l,o)<0?0:2,f=_getChannel(e,u,n,a),s=y>1&&t[y-2].x===t[y-1].x&&t[y-1].x>f.left&&t[y-1].x<f.right?t[y-1].x-p.x:y<t.length-3&&t[y+2].x===t[y+3].x&&t[y+2].x>f.left&&t[y+2].x<f.right?t[y+2].x-p.x:(f.right+f.left)/2-p.x,1===o&&p.y<=t[y].y||3===o&&p.y>=t[y].y?p=null:y>0&&(_hasIntersection([new d.a(t[y].x,t[y].y),new d.a(t[y].x+s,t[y].y),new d.a(p.x+s,p.y)],n)||(p=null));break;case 4:continue}if(y>20)return;!p||p.x===t[y].x&&p.y===t[y].y?_moveSegment(t,y,s,0,g):(t.splice(y+1,0,p),_moveSegment(t,y+1,s,0,g),y++)}}},{key:"_getRouteTendency",value:function(t,e,n,r,i){var o,a;switch(i){case 0:case 2:a="y";break;case 1:case 3:a="x"}return 0===(o=_getRouteDirection(n,t[t.length-1])[a])&&0===(o=-_getRouteDirection(t[0],t[t.length-1])[a])&&(o=n[a]<r.getCenter()[a]?-1:1),o}},{key:"_getChannel",value:function(t,e,n,r){var i,o,a,s,l,h,u,c=this.maxChannelWidth,f=n[e],p={};switch(r){case 0:for(o=f.getLeft(),p.right=o.x,p.horizontal=!1,a=0;a<n.length;a++)a!==e&&((u=n[a].getRight().x)>=o.x||(!p.left||p.left<u)&&(p.left=u));for(p.left||(p.left=t.getLeft().x,p.right-p.left>c&&(p.left=p.right-c)),a=0;a<n.length;a++)a!==e&&(h=(i=n[a]).getBottom().y,l=i.getTop().y,h<o.y&&i.getRight()>p.left&&i.getLeft()<p.right&&(!p.top||p.top<h)&&(p.top=h),l>o.y&&i.getRight()>p.left&&i.getLeft()<p.right&&(!p.bottom||p.bottom>l)&&(p.bottom=l));p.top||(p.top=t.getTop().y),p.bottom||(p.bottom=t.getBottom().y);break;case 1:for(o=f.getTop(),p.horizontal=!0,p.bottom=o.y,a=0;a<n.length;a++)a!==e&&((h=n[a].getBottom().y)>=o.y||(!p.top||p.top<h)&&(p.top=h));for(p.top||(p.top=t.getTop().y,p.bottom-p.top>c&&(p.top=p.bottom-c)),a=0;a<n.length;a++)a!==e&&(s=(i=n[a]).getLeft().x,(u=i.getRight().x)<o.x&&i.getBottom()>p.top&&i.getTop()<p.bottom&&(!p.left||p.left<u)&&(p.left=u),s>o.x&&i.getBottom()>p.top&&i.getTop()<p.bottom&&(!p.right||p.right>s)&&(p.right=s));p.left||(p.left=t.getLeft().x),p.right||(p.right=t.getRight().x);break;case 2:for(o=f.getRight(),p.horizontal=!1,p.left=o.x,a=0;a<n.length;a++)a!==e&&((s=n[a].getLeft().x)<=o.x||(!p.right||p.right>s)&&(p.right=s));for(p.right||(p.right=t.getRight().x,p.right-p.left>c&&(p.right=p.left+c)),a=0;a<n.length;a++)a!==e&&(h=(i=n[a]).getBottom().y,l=i.getTop().y,h<o.y&&i.getRight()>p.left&&i.getLeft()<p.right&&(!p.top||p.top<h)&&(p.top=h),l>o.y&&i.getRight()>p.left&&i.getLeft()<p.right&&(!p.bottom||p.bottom>l)&&(p.bottom=l));p.top||(p.top=t.getTop().y),p.bottom||(p.bottom=t.getBottom().y);break;case 3:for(o=f.getBottom(),p.horizontal=!0,p.top=o.y,a=0;a<n.length;a++)a!==e&&((i=n[a]).getTop().y<=o.y||(!p.bottom||p.bottom>i.getTop().y)&&(p.bottom=i.getTop().y));for(p.bottom||(p.bottom=t.getBottom().y,p.bottom-p.top>c&&(p.bottom=p.top+c)),a=0;a<n.length;a++)a!==e&&(s=(i=n[a]).getLeft().x,(u=i.getRight().x)<o.x&&i.getBottom()>p.top&&i.getTop()<p.bottom&&(!p.left||p.left<u)&&(p.left=u),s>o.x&&i.getBottom()>p.top&&i.getTop()<p.bottom&&(!p.right||p.right>s)&&(p.right=s));p.left||(p.left=t.getLeft().x),p.right||(p.right=t.getRight().x)}return p}},{key:"_moveSegment",value:function(t,e,n,r,i){var o,a,s;return 0===e?(o=t[0].getDirection(t[1]),r||(r=this.MIN_BUFFER),a=Math.min(r,t[0].distance(t[1])/2),s=t[0].getTranslated(o.scale(a)),t.splice(1,0,s),void this._moveSegment(t,e+1,n)):e===t.length-2?(o=t[t.length-1].getDirection(t[t.length-2]),i||(i=this.MIN_BUFFER),a=Math.min(i,t[t.length-1].distance(t[t.length-2])/2),s=t[t.length-1].getTranslated(o.scale(a)),t.splice(t.length-1,0,s),void this._moveSegment(t,e,n)):void(t[e].y===t[e+1].y?(e>0&&t[e-1].y===t[e].y&&(t.splice(e+1,0,t[e].clone()),e++),e<t.length-2&&t[e+1].y===t[e+2].y&&t.splice(e+1,0,t[e+1].clone()),t[e].y+=n,t[e+1].y+=n):(e>0&&t[e-1].x===t[e].x&&(t.splice(e+1,0,t[e].clone()),e++),e<t.length-2&&t[e+1].x===t[e+2].x&&t.splice(e+1,0,t[e+1].clone()),t[e].x+=n,t[e+1].x+=n))}},{key:"points",get:function(){var t=e.route(this.start,this.end,this.startNormal,this.endNormal,this.MIN_BUFFER);if(this.autoRoute){this._mergeSegments(t);for(var n,r,i,o=[],a=edge.source.getCommonAncestor(edge.target),s=a.getDescendants(),l=0,h=0;h<s.length;h++)(n=s[h]).excludeFromRouting(edge)||n.isAncestor(edge.source)||n.isAncestor(edge.target)||(n===edge.source&&(r=l),n===edge.target&&(i=l),o.push(n.getBounds(document)),l++);o.length>1&&this.autoRoute(t,a.getBounds(document),o,r,i)}if(e._mergeSegments(t),this.randomNoise&&t.length>3)for(var u=1;u<t.length-2;u++){var c=this.randomNoise/this.step,f=Math.floor(Math.random()*c*2-c+1)*this.step;if(this.randomNoise&&4==t.length){var p=(0!=this.startNormal.x&&this.startNormal.x!=this.endNormal.x?this.randomNoise<=Math.abs(t[1].x-t[0].x-this.startNormal.x*this.MIN_BUFFER)?this.randomNoise:Math.abs(t[1].x-t[0].x-this.startNormal.x*this.MIN_BUFFER):0!=this.startNormal.y&&this.startNormal.y!=this.endNormal.y?this.randomNoise<=Math.abs(t[1].y-t[0].y-this.startNormal.y*this.MIN_BUFFER)?this.randomNoise:Math.abs(t[1].y-t[0].y-this.startNormal.y*this.MIN_BUFFER):this.randomNoise)/this.step,d=void 0;d=this.startNormal.x!==this.endNormal.x||this.startNormal.y!==this.endNormal.y?Math.floor(Math.random()*p*2-p+1)*this.step:Math.sign(0!==this.startNormal.x?this.startNormal.x:this.startNormal.y)*Math.floor(Math.random()*p+1)*this.step,this._moveSegment(t,1,d,1,1)}if(this.randomNoise&&t.length>4)for(var g=1;g<t.length-2;g++)c=this.randomNoise/this.step,f=1==g?Math.sign(0!==this.startNormal.x?this.startNormal.x:this.startNormal.y)*Math.floor(Math.random()*c+1)*this.step:g==t.length-3?Math.sign(0!==this.endNormal.x?this.endNormal.x:this.endNormal.y)*Math.floor(Math.random()*c+1)*this.step:Math.floor(Math.random()*c*2-c+1)*this.step,this._moveSegment(t,g,f,1,1)}return t}}],[{key:"route",value:function(t,e,n,r,i){var o,a,s,l=new d.a(t.x+n.x*i,t.y+n.y*i),h=new d.a(e.x+r.x*i,e.y+r.y*i);(o=0!==n.x?(h.x-l.x)/n.x>0?n:new d.a(0,h.y>=l.y?1:-1):(h.y-l.y)/n.y>0?n:new d.a(h.x>=l.x?1:-1,0),a=0!==r.x?(l.x-h.x)/r.x>0?r:new d.a(0,l.y>=h.y?1:-1):(l.y-h.y)/r.y>0?r:new d.a(l.x>=h.x?1:-1,0),0===o.dotProduct(a))?s=[t,l,0===o.x?new d.a(l.x,h.y):new d.a(h.x,l.y),h,e]:s=o.dotProduct(a)<0?0===o.x?[t,l,new d.a(l.x,(t.y+e.y)/2),new d.a(h.x,(t.y+e.y)/2),h,e]:[t,l,new d.a((t.x+e.x)/2,l.y),new d.a((t.x+e.x)/2,h.y),h,e]:[t,l,new d.a(l.x+o.x*i,l.y+o.y*i),new d.a(h.x+a.x*i,h.y+a.y*i),h,e];var u=[];u[0]=s[0];for(var c=1;c<s.length-1;c++)s[c].x===s[c-1].x&&s[c].x===s[c+1].x||s[c].y===s[c-1].y&&s[c].y===s[c+1].y||u.push(s[c]);return u.push(s[s.length-1]),u}},{key:"_hasIntersection",value:function(t,e){for(var n=0;n<t.length-1;n++)for(var r=0;r<e.length;r++)if(e[r].detectIntersection(t[n],t[n+1])>=0)return!0;return!1}},{key:"_getFirstIntersection",value:function(t,e,n,r,i){for(var o,a,s=null,l=null,h=0;h<n.length;h++)0===e&&h===r||e===t.length-2&&h===i||(a=(o=n[h]).detectIntersection(t[e],t[e+1]))>=0&&(null==s?(s=h,l=a):n[s].distance(t[e])>o.distance(t[e])&&(s=h,l=a));return null!=s?[s,l]:null}},{key:"_getRouteDirection",value:function(t,e){return t.x===e.x?t.y<e.y?d.a.S:d.a.N:t.y===e.y?t.x<e.x?d.a.E:d.a.W:t.x<e.x?t.y<e.y?d.a.SE:d.a.NE:t.y<e.y?d.a.SW:d.a.NW}},{key:"_mergeSegments",value:function(t){for(var e=t[t.length-1].y===t[t.length-2].y,n=t.length-2;n>=1;n--)t[n].y===t[n-1].y===e||t[n].equals(t[n-1])?t.splice(n,1):e=!e}}]),e}();z.direct=K,z.bezier=H,z.entityRelations=V,z.manhattan=G;var q=W,X={on:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"!=typeof window?window:null,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;t&&(e=e.indexOf(" ")>0?e.split(" "):[e]).forEach(function(e){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent(e,n)})},off:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"!=typeof window?window:null,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;t&&(e=e.indexOf(" ")>0?e.split(" "):[e]).forEach(function(e){t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent&&t.detachEvent(e,n)})},fire:function(t,e,n){}};function Y(t,e,n,r,i){var o=new p;return t&&o.append("CTRL"),e&&o.append("ALT"),n&&o.append("SHIFT"),r&&o.append("META"),i&&o.append(i),o.toString(".")}function Z(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var J={stopPropagation:!1},Q=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,1/0],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.root=e,this.rootNS=e.getAttribute("ns")||"root",this.zoomScale=n,h.a.assign(this,J,r),this.scale=1,this.listeners={},this.dragging=!1,this.handler=h.a.bind(this.handleEvent,this),this.started=!1,this.enterStack=[]}return function(t,e,n){e&&Z(t.prototype,e),n&&Z(t,n)}(t,[{key:"start",value:function(){this.started||(X.on(this.root,"mousedown mouseover mouseout mouseenter mouseleave dblclick click contextmenu mousewheel",this.handler),this.startKeys(),this.started=!0)}},{key:"stop",value:function(){this.started&&(X.off(this.root,"mousedown mouseover mouseout mouseenter mouseleave dblclick click contextmenu mousewheel",this.handler),this.stopKeys(),this.started=!1)}},{key:"startKeys",value:function(){X.on(document,"keydown keyup",this.handler)}},{key:"stopKeys",value:function(){X.off(document,"keydown keyup",this.handler)}},{key:"zoomIn",value:function(){return this.scale*=1.25,this.scale=Math.max(Math.min(this.zoomScale[1],this.scale),this.zoomScale[0]),this.scale}},{key:"zoomOut",value:function(){return this.scale*=.8,this.scale=Math.max(Math.min(this.zoomScale[1],this.scale),this.zoomScale[0]),this.scale}},{key:"getEventInfo",value:function(t){for(var e,n=t.target,r=new p,i=[],o=!1;!o&&n&&n!==document;)(e=n.getAttribute("ns"))&&((o=h.a.startsWith(e,"root."))&&(e=e.substring(5),t.rootTarget=n),t.nsTarget||(t.nsTarget=n),i.splice(0,0,n),r.prepend(e)),n=n.parentNode;return o||(t.rootTarget=t.nsTarget),t.targetStack=i,""===(e=r.toString("."))&&(e=this.rootNS),{data:t.rootTarget,ns:e}}},{key:"handleEvent",value:function(e){var n=this,r=e.type;if(!this.dragging&&!c.eventFromInput(e)){var i,o,a,s=this.getPosition(e),l="keydown"===r||"keyup"===r;if(l)i=this.root,o=function(t){if(!(t&&t instanceof KeyboardEvent))return null;var e=t.keyCode||t.which;return e>=16&&e<=18&&(e=null),Y(t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,e)}(e);else{if(!(a=this.getEventInfo(e)))return;i=a.data,o=a.ns}if("mousewheel"===r&&(this.scale*=Math.pow(2,.002*e.wheelDelta),this.scale=Math.max(Math.min(this.zoomScale[1],this.scale),this.zoomScale[0]),e.scale=this.scale,r="zoom"),"mousedown"===r&&0===e.button){var h,u={data:i,pos:"root"===o?t.mouse(this.root,e):s};this.dragging=!1;var f=function(e){var r=n.getPosition(e);if(!n.dragging){if(u.pos[0]===r[0]&&u.pos[1]===r[1])return;n.dragging=!0,e.rootTarget=u.data,n.dispatch(e,"dragstart",o,u.data,u.pos)}h="root"===o?t.mouse(n.root,e):r,n.getEventInfo(e),n.dispatch(e,"drag",o,u.data,h)};e.preventDefault(),X.on(null,"mousemove",f),X.on(null,"mouseup",function e(r){h="root"===o?t.mouse(n.root,r):n.getPosition(r);var i=n.getEventInfo(r);n.dragging?(n.dragging=!1,n.dispatch(r,"dragend",o,u.data,h)):n.dispatch(r,"mouseup",o,i.data,h),X.off(null,"mousemove",f),X.off(null,"mouseup",e)})}l||this.simulateEnterLeave(e,r,o,i,s),this.dispatch(e,r,o,i,s)}}},{key:"simulateEnterLeave",value:function(t,e,n,r,i){var o,a,s=this,l=function(e){for(e=e||0;s.enterStack.length>=e+1;)o=s.enterStack.pop(),s.dispatch(t,"mouseleave",o.ns,o.data,i)},u=function(t){for(var e=new p,n=0;n<=t;n++){var r=a[n].getAttribute("ns");h.a.startsWith(r,"root.")&&(r=r.substring(5)),e.append(r)}return e.toString(".")};if(n&&n!==this.rootNS&&"mouseover"===e){var c;a=t.targetStack;for(var f=0;f<a.length;f++){if(f<this.enterStack.length){if(this.enterStack[f].target===a[f])continue;l(f)}c={data:r,ns:u(f),target:a[f]},this.enterStack.push(c),this.dispatch(t,"mouseenter",c.ns,r,i)}a.length<this.enterStack.length&&l(a.length)}n===this.rootNS&&this.enterStack.length>0&&l()}},{key:"dispatch",value:function(e,n,r,i,o){if(this.started){var a=r?n+"."+r:n;h.a.forEach(this.listeners,function(s,l){t.match(a,s.regexp?s.regexp:l)&&h.a.forEach(s,function(t){t.context?t.callback.apply(t.context,[n,r,i,o,e]):t.callback.apply(window,[n,r,i,o,e])})}),this.stopPropagation&&e.stopPropagation&&e.stopPropagation()}}},{key:"getPosition",value:function(e){var n=t.mouse(this.root,e);return h.a.isNaN(n[0])||h.a.isNaN(n[1])||(this.lastPosition=n),this.lastPosition}},{key:"registerKey",value:function(t,e,n,r){var i=this;if(h.a.isArray(e))h.a.forEach(e,function(e){i.registerKey(t,e,n,r)});else if((e=Y(e.ctrl,e.alt,e.shift,e.meta,e.code)).length){e=new p(t).append(e).toString(".");var o={callback:n,context:r};this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(o)}}},{key:"unregisterKey",value:function(t,e,n,r){var i=this;if(h.a.isArray(e))h.a.forEach(e,function(e){i.unregisterKey(t,e,n,r)});else if((e=Y(e.ctrl,e.alt,e.shift,e.meta,e.code)).length){e=new p(t).append(e).toString(".");var o,a=this.listeners[e];if(a)for(var s=0;s<a.length;s++)if((o=a[s]).callback===n&&(!r||r===o.context))return void a.splice(s,1)}}},{key:"register",value:function(t,e,n,r){var i=this;if(h.a.isArray(t))h.a.forEach(t,function(t){i.register(t,e,n,r)});else{var o={callback:e,context:n,zIndex:r},a=null;t instanceof RegExp&&(a=t,t+=""),this.listeners[t]||(this.listeners[t]=[]),a&&!this.listeners[t].regexp&&(this.listeners[t].regexp=a),this.listeners[t].push(o)}}},{key:"unregister",value:function(t,e,n){t instanceof RegExp&&(t+="");var r,i=this.listeners[t];if(i)for(var o=0;o<i.length;o++)if((r=i[o]).callback===e&&(!n||n===r.context))return void i.splice(o,1)}},{key:"destroy",value:function(){this.stop(),delete this.root,delete this.listeners,delete this.enterStack}}],[{key:"match",value:function(t,e){return e instanceof RegExp?t.match(e):t===e}},{key:"mouse",value:function(t,e){e.changedTouches&&(e=e.changedTouches[0]);var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}]),t}(),tt=1,et=2,nt=4,rt=8,it={fontSize:11,fontFamily:"Arial",fontStyle:0,fontColor:"black",padding:0,linePadding:0,align:"left",width:0,height:0,rotation:null,geometry:{x:0,y:0,anchorY:0,offsetX:0,offsetY:0}},ot=function(){var t,e,n=null,r=h.a.memoize(function(r,i,o,a){if(i=i||11,o=o||"Arial,Helvetica",a=!h.a.isUndefined(a)&&a,!n){n=c.createElement("iframe",{id:"_ComputeStylesIframe"},{position:"absolute",visibility:"hidden",width:"auto"}),document.body.appendChild(n);var s=n.contentWindow.document;s.open(),s.write('<html><body>\n        <div id="baselineDiv" style="height:100px;"><span style="line-height:0">T</span><span style="height:100%;display:inline-block;"></span></div>\n        <div id="measureDiv" style="position:absolute;width:auto;height:auto;padding:0;white-space:nowrap;display:inline-block;"></div>\n        </body></html>'),s.close(),t=s.getElementById("measureDiv"),e=s.getElementById("baselineDiv")}e.style.fontSize=t.style.fontSize=i,e.style.fontFamily=t.style.fontFamily=o,e.style.fontWeight=t.style.fontWeight=a?"bold":"normal",t.innerHTML=r;var l=e.firstChild,u=l.offsetTop+l.offsetHeight-e.offsetHeight-e.offsetTop;return{width:t.offsetWidth,height:t.offsetHeight,baseline:u}},function(t,e,n,r){return t+";"+e+";"+n+";"+r}),i=h.a.memoize(function(t,e,n,i,o){e=e||0,n=n||11,i=i||"Arial,Helvetica",o=!h.a.isUndefined(o)&&o;var a=[],s=r("&nbsp;",n,i,o),l=s.width;if(a.lineHeight=s.height,a.baseline=s.baseline,!e||!t||""===t)return a.push(t),a.width=t&&""!==t?r(t,n,i,o).width:l,a.height=a.lineHeight,a;for(var u=0,c=t.split("\n"),f=new p,d=0;d<c.length;d++){for(var g=c[d].split(/\s/),y="",v=0,b=0,m=!0,w=void 0,x=0;x<g.length;x++)w=g[x],b=r(w,n,i,o).width,(m?b:v+l+b)>e?(m?(f.append(w),u=Math.max(u,b),x<g.length-1&&(a.push(f.toString()),f.clear())):(a.push(f.append(y).toString()),u=Math.max(u,v+l+b),f.clear()),y="",v=0,m||x--,m=!0):(y=m?w:y+" "+w,v=m?b:v+l+b,u=Math.max(u,v),m=!1);""!==y&&f.append(y),d<c.length-1&&(a.push(f.toString()),f.clear())}return a.push(f.toString()),a.width=u,a.height=a.lineHeight*a.length,a},function(t,e,n,r,i){return t+";"+e+";"+n+";"+r+";"+i});function o(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=(e=h.a.defaultsDeep(e,it)).fontSize,i=e.fontFamily,o=e.fontStyle,a=(o&tt)===tt,l=e.padding,u=e.linePadding,c=e.align,f=e.width,p=e.height;n.width&&(f=f<=5?n.width*f:f,p=p<=5?n.height*p:p),f-=2*l,p-=2*l,f=Math.max(0,f),p=Math.max(0,p);var d=h.a.clone(e.geometry),g=this.wrap(t,f,r,i,a);d.width=g.width+2*l,d.height=g.height+2*l+(g.length-1)*u;var y,v="start",m=0,w=!h.a.has(d,"anchorX");switch(c){case"center":v="middle",w&&(d.anchorX=0);break;case"right":v="end",m=g.width/2,w&&(d.anchorX=-.5);break;case"left":m=-g.width/2,w&&(d.anchorX=.5)}y=n.getRelativePosition?n.getRelativePosition(d):s.a.getRelativePosition({width:n.width,height:n.height},d);var x=new b.a(y[0],y[1],d.width,d.height),_="center"===c?[0,0]:"left"===c?[-g.width/2,0]:[g.width/2,0];d.width=Math.max(f+2*l,d.width),d.height=Math.max(p+2*l,d.height),y=n.getRelativePosition?n.getRelativePosition(d):s.a.getRelativePosition({width:n.width,height:n.height},d);var k=new b.a(y[0],y[1],d.width,d.height);return{config:e,label:g,_label:t,bold:a,underline:o&nt,italic:o&et,shadow:o&rt,dx:m,dy:-d.height/2+l+g.lineHeight-g.baseline,anchor:v,lineHeight:g.lineHeight+u,pivot:_,bounds:x,maxBounds:k}}return{FONT_BOLD:tt,FONT_ITALIC:et,FONT_UNDERLINE:nt,FONT_SHADOW:rt,getStringSize:r,wrap:i,getLabelBox:function(t,e,n,r){return o.call(this,t,e,{width:n,height:r})},getLabelBoxForLink:function(t,e,n){return o.call(this,t,e,n)},render:function(t,e){return t.renderLabel(e)},editor:{start:function(t,e,n,r,i){var o=this,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(this.input){if(this.key===t)return;this.stop()}var l=s?"input":"textarea";this.input=c.createElement(l,{id:"inlineEditor",unselectable:"off"},{position:"absolute",overflow:"hidden",padding:"0px",margin:"0px",border:"transparent"}),s&&X.on(this.input,"keydown keyup",function(t){13===t.keyCode&&(X.off(o.input,"keydown keyup"),o.stop())}),e.appendChild(this.input),this.key=t,this.box=n,this.refEl=r,this.textEl=i;var h=n.config,u=new b.a(n.maxBounds.x,n.maxBounds.y,n.maxBounds.width*a,n.maxBounds.height*a),f=c.getCenterPosition(r,e);f=[f[0]+u.left,f[1]+u.top],i&&(i.style.visibility="hidden"),c.setElement(this.input,null,{visibility:"visible",left:f[0]+"px",top:f[1]+"px",width:u.width+"px",height:u.height+"px","font-family":h.fontFamily,"font-size":h.fontSize*a+"px","font-weight":(h.fontStyle&tt)===tt?"bold":"normal"}),this.input.value=n._label,this.input.focus(),this.input.select(),X.fire(this,"editor.start",[this.key])},stop:function(t){this.input&&(t=t||!1,this.textEl&&(this.textEl.style.visibility=null),this.input.parentNode.removeChild(this.input),t||X.fire(this,"editor.update",[this.key,this.input.value]),X.fire(this,"editor.stop",[this.key]),delete this.input,delete this.key,delete this.box,delete this.refEl,delete this.textEl)}}}}();function at(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var st=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{id:h.a.uniqueId()};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.graph=e,this.id=n.id,delete n.id,n.decorators&&(this.createDecorators(n.decorators),delete n.decorators),n.views&&(this.viewProps=n.views,delete n.views);var r=n.type||"Default";if(!(r=s.a.type(this.constructor.namespace,r)))throw new Error("Type not found "+n.type);delete n.type,this.props=new r(n)}return function(t,e,n){e&&at(t.prototype,e),n&&at(t,n)}(t,[{key:"prop",value:function(t,e){if(h.a.isUndefined(e))return this.props[t];this.props[t]=e}},{key:"viewProp",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(h.a.isUndefined(n))return"default"===t?this.prop(e,n):this.viewProps[t][e];"default"===t?this.prop(e,n):(this.viewProps[t]||(this.viewProps[t]={}),this.viewProps[t][e]=n)}},{key:"createDecorators",value:function(t){}},{key:"getView",value:function(t){var e=this.getShape(t);return h.a.assign({id:this.id,key:t,className:this.computedClassName,style:this.viewProp(t,"style"),namespace:this.namespace},e)}},{key:"getShape",value:function(t){var e=a.get(this.id+".shape",t);if(e)return e;var n=this.viewProp(t,"shape");return e=new(n?v.a.getShape(n.name):v.a.getShape("Rectangle"))(this.viewProp(t,"x"),this.viewProp(t,"y"),this.viewProp(t,"width"),this.viewProp(t,"height"),n),a.set(this.id+".shape",e,t),e}},{key:"render",value:function(t){var e=a.get(this.id+".template",t.id);if(!e){var n=this.prop("role");e=t.getTemplate("$"+n,null,this),h.a.isString(e)&&(e=h.a.template(e)),a.set(this.id+".template",e,t.id)}return e(this.getView(t.id))}},{key:"renderShape",value:function(t){var e=this.getShape(t.id);return e?e.render(t):""}},{key:"renderLabel",value:function(t){if(this===this.graph.currentRoot)return null;var e=this.getLabelBox(t.id);return e?t.renderLabel(e):""}},{key:"getLabelBox",value:function(t){var e=a.get(this.id+".labelBox",t);if(e)return e;var n=this.getShape(t);return e=ot.getLabelBox(this.prop("label"),this.viewProp(t,"labelConfig"),n.width,n.height),a.set(this.id+".labelBox",e,t),e}},{key:"destroy",value:function(){delete this.graph,delete this.decorators,delete this.props,delete this.viewProps,this.destroyed=!0}},{key:"computedClassName",get:function(){if(!this._computedClassName){var t=new p(this.prop("role")),e=this.props;for(e.hasOwnProperty("className")&&t.append(e.className),e=e.constructor.prototype;e;)e.hasOwnProperty("className")&&t.append(e.className),e=Object.getPrototypeOf(e);this._computedClassName=t.toString(" ")}return this._computedClassName}},{key:"namespace",get:function(){return this===this.graph.currentRoot?"":"root."+this.prop("role")}}]),t}();function lt(t){return(lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ht(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ut(t,e){return!e||"object"!==lt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ct(t){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ft(t,e){return(ft=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var pt=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),r.id||(r.id=h.a.uniqueId("N")),(n=ut(this,ct(e).call(this,t,r))).inEdges=[],n.outEdges=[],n.ports=null,n.parent=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ft(t,e)}(e,st),function(t,e,n){e&&ht(t.prototype,e),n&&ht(t,n)}(e,[{key:"isAncestor",value:function(t){for(var e=t.parent;e;){if(this===e)return!0;e=e.parent}return!1}},{key:"removeEdge",value:function(t){for(var e=t.source===this?this.outEdges:this.inEdges,n=0;n<e.length;n++)if(t===e[n]){e.splice(n,1);break}}},{key:"addInEdge",value:function(t,e){null==e||void 0===e?this.inEdges.push(t):this.inEdges.splice(e,0,t)}},{key:"addOutEdge",value:function(t,e){null==e||void 0===e||e>t.length-1?this.outEdges.push(t):this.outEdges.splice(e,0,t)}},{key:"renderChildren",value:function(t){if(this.children){var e=new p;return h.a.forEach(this.children,function(n){e.append(n.render(t))}),e.toString()}return""}},{key:"getPort",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto",n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=this.getShape(t);return"auto"===e?i.getPerimeter(n,r):null}},{key:"toString",value:function(){var t=this.prop("label")?this.prop("label"):"undefined";return h.a.isArray(t)&&(t=t[0]),"Node:{id:"+this.id+";label:"+t+";type:"+this.props.constructor.typeName+"}"}}]),e}();pt.namespace="Nodes";var dt=pt;function gt(t){return(gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vt(t,e){return!e||"object"!==gt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function bt(t,e,n){return(bt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=mt(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function mt(t){return(mt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function wt(t,e){return(wt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var xt=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),r.id||(r.id=h.a.uniqueId("E")),(n=vt(this,mt(e).call(this,t,r))).source=n.target=null,n.setSource(i,r.sourcePos),n.setTarget(o,r.targetPos),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&wt(t,e)}(e,st),function(t,e,n){e&&yt(t.prototype,e),n&&yt(t,n)}(e,[{key:"setSource",value:function(t,e){this.setTerminal(t,e,"source")}},{key:"setTarget",value:function(t,e){this.setTerminal(t,e,"target")}},{key:"setTerminal",value:function(t,e,n){var r="source"==n?this.source:this.target;r==t?t&&t.setEdgeAt(this,e):(r&&r.removeEdge(this),t&&("source"==n?t.addOutEdge(this,e):t.addInEdge(this,e)),"source"==n?this.source=t:this.target=t)}},{key:"getLabelBox",value:function(t){var e=this.prop("label");return e?ot.getLabelBoxForLink(e,this.viewProp(t,"labelConfig"),this.getShape(t)):null}},{key:"getReferencePoints",value:function(t){var e=[];return this.source?e.push(this.source.getShape(t).center):e.push(this.viewProp(t,"start")),this.target?e.push(this.target.getShape(t).center):e.push(this.viewProp(t,"end")),e}},{key:"getTerminalVisual",value:function(t,e){var n=this.getReferencePoints(t),r=[],i=function(t){return new b.a(t.x,t.y,3,3)};return this.source?r.push(this.source.getPort(t,this.prop("sourcePort"),n[1],e)):r.push({point:n[0],direction:b.a.getDirection(i(n[0]),n[1],!0)}),this.target?r.push(this.target.getPort(t,this.prop("targetPort"),n[0],e)):r.push({point:n[1],direction:b.a.getDirection(i(n[1]),n[0],!0)}),r}},{key:"getShape",value:function(t){var e=a.get(this.id+".shape",t);if(e)return e;var n=this.viewProp(t,"shape");return e=q.getLink(this.getTerminalVisual(t,n.orthogonal),n,this.prop("startMarker"),this.prop("endMarker")),a.set(this.id+".shape",e,t),e}},{key:"toString",value:function(){return"Edge:{"+(this.source?this.source.id:"null")+"--"+(this.target?this.target.id:"null")+"}"}},{key:"destroy",value:function(){bt(mt(e.prototype),"destroy",this).call(this),this.setSource(null),this.setTarget(null)}}]),e}();xt.namespace="Edges";var _t=xt,kt={},Et=function(){return kt.arrow=function(t,e,n){var r=e?-1:1,i={viewBox:new b.a(-5,-5,10,10),size:t,ref:[4*r,0],fill:n.color};return i.shape={name:"Polygon",points:[[-2*r,0],[-4*r,4],[4*r,0],[-4*r,-4]]},i},kt.triangle=function(t,e,n){var r=e?-1:1,i={viewBox:new b.a(-5,-5,10,10),size:t,ref:[4*r,0],fill:n.color};return i.shape={name:"Polygon",points:[[-5*r,-5],[-5*r,5],[4*r,0]]},i},kt.oval=function(t,e,n){var r=t/2,i={viewBox:new b.a(-r,-r,t,t),size:t,ref:[0,0],fill:n.color};return i.shape='<ellipse cx="0" cy="0" rx="'+r+'" ry="'+r+'"></ellipse>',i},kt.diamond=function(t,e,n){var r=e?-1:1,i={viewBox:new b.a(-5,-5,10,10),size:t,ref:[4*r,0],fill:n.color,shape:{name:"Polygon",points:[[-4,0],[0,4],[4,0],[0,-4]]}};return i},{registry:kt,getMarker:function(t,e){var n=(0,kt[t.type])(t.size,e,t);return n.id=t.id,n}}}();function St(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Pt={name:"Default",role:"node",draggable:!0,selectable:!0,editable:!0,resizable:!1,sourceable:!0,targetable:!0,visible:!0},Ot={name:"Default",role:"edge",selectable:!0,visible:!0,startMarker:null,endMarker:{id:"Default_EndMarker",type:"arrow",size:10,color:"#0ea117"},start:[0,0],end:[400,200]},Ct=function(){function t(){var e,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.a.uniqueId("G"),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=r,this.nodes={},this.edges={},this.selection=null,this.destroyed=!1,s.a.buildTypes(i.nodeTypes,"Nodes",Pt),s.a.buildTypes(i.edgeTypes,"Edges",Ot),this.markers=[],s.a.type(_t.namespace).forEach(function(t){(n=t.prototype.startMarker)&&(e=Et.getMarker(n,!0),this.markers.push(e)),(n=t.prototype.endMarker)&&(e=Et.getMarker(n,!1),this.markers.push(e))},this),delete i.nodeTypes,delete i.edgeTypes,s.a.initConfig(this,i),this.root=null,o&&this.loadModel(o)}return function(t,e,n){e&&St(t.prototype,e),n&&St(t,n)}(t,[{key:"addNode",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentRoot,r=arguments.length>2?arguments[2]:void 0,i=new(t.getJSClass(e,dt))(this,e);return n?t.addChild(n,i,r):(this.root=i,this.root.prop("role","root")),this.nodes[i.id]=i,i}},{key:"addEdge",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentRoot,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=new(t.getJSClass(e,_t))(this,e,r,i);return t.addChild(n,o),this.edges[o.id]=o,o}},{key:"loadModel",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentRoot,r=t.nodes,i=t.edges;delete t.nodes,delete t.edges;var o=this.addNode(t,n);r&&h.a.forEach(r,function(t){e.loadModel(t,o)}),i&&h.a.forEach(i,function(t){var n,r;t.from&&(n=e.nodes[t.from]),t.to&&(r=e.nodes[t.to]),e.addEdge(t,o,n,r)})}},{key:"reset",value:function(){}},{key:"destroy",value:function(){}},{key:"currentRoot",get:function(){return this.root}}],[{key:"getJSClass",value:function(t,e){var n=null;if(t&&t.type){var r=s.a.type(e.namespace,t.type);r&&(n=r.jsClass)}return s.a.getConstructor(n,e)}},{key:"addChild",value:function(t,e){t.children||(t.children=[]),e.parent!=t&&(t.children.push(e),e.parent&&e.parent.children&&(e.parent.children=h.a.without(e.parent.children,e))),e.parent=t}}]),t}();Ct.DEFAULTS={allowDanglingEdges:!0,multiConnect:!1,readOnly:!1,viewOnly:!1};var Mt=Ct;function Tt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Rt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e.hasOwnProperty("orientation")&&h.a.isString(e.orientation)&&("HORIZONTAL"==e.orientation.toUpperCase()?e.orientation=t.HORIZONTAL:delete e.orientation),s.a.initConfig(this,e)}return function(t,e,n){e&&Tt(t.prototype,e),n&&Tt(t,n)}(t,[{key:"layout",value:function(t,e){}},{key:"reset",value:function(){}},{key:"destroy",value:function(){}}]),t}();Rt.VERTICAL=0,Rt.HORIZONTAL=1,Rt.DEFAULTS={orientation:Rt.VERTICAL};var Lt=Rt;function Nt(t){return(Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Bt(t,e){return!e||"object"!==Nt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function At(t){return(At=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Dt(t,e){return(Dt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var It=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Bt(this,At(e).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Dt(t,e)}(e,Lt),function(t,e,n){e&&jt(t.prototype,e),n&&jt(t,n)}(e,[{key:"layout",value:function(t,e){var n;if((n=t?_.isArray(t)?t:t.getLinkedNodes("target"):this.owner.childNodes)&&0!=n.length){for(var r,i=0,o=0,a=0,s=0,l=0,h=0;h<n.length;h++)r=n[h],i>0&&i+this.hgap+r.getProperty("width")>e.width&&(o+=a+this.vgap,i=0,a=0,s=0,l++),r._flPos=[s,l],r.moveTo([e.x+i,e.y+o]),i+=this.hgap+r.getProperty("width"),s++,a=a<r.getProperty("height")?r.getProperty("height"):a;this.trigger(new Rectangle(e.x,e.y,e.width,o+a))}}}]),e}();It.DEFAULTS={hgap:10,vgap:10};var Ut=It;function Ft(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var $t=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.renderer=e}return function(t,e,n){e&&Ft(t.prototype,e),n&&Ft(t,n)}(t,[{key:"destroy",value:function(){delete this.renderer}}]),t}();function zt(t){return(zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Kt(t){return(Kt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ht(t,e){return(Ht=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Vt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var Gt=function(t){function e(t){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(t,e){return!e||"object"!==zt(e)&&"function"!=typeof e?Vt(t):e}(this,Kt(e).call(this,t));var r=t.dispatcher;return r.register(/^drag.*\.graph$/,n.handleDrag,Vt(Vt(n))),r.register(/^zoom/,n.handleZoom,Vt(Vt(n))),n.offset=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ht(t,e)}(e,$t),function(t,e,n){e&&Wt(t.prototype,e),n&&Wt(t,n)}(e,[{key:"handleZoom",value:function(t,e,n,r,i){this.renderer.transform(null,null,i.scale)}},{key:"handleDrag",value:function(t,e,n,r,i){if("dragstart"!=t)this.offset&&(this.renderer.transform(r[0]+this.offset[0],r[1]+this.offset[1]),"dragend"==t&&delete this.offset);else{if(!("pan"==this.renderer.prop("defaultClickMode")^(i.ctrlKey||i.shiftKey)))return;var o=this.renderer.translate;this.offset=[o[0]-r[0],o[1]-r[1]]}}}]),e}();function qt(t){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Yt(t,e,n){return(Yt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Zt(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Zt(t){return(Zt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Jt(t,e){return(Jt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Qt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var te=function(t){function e(t){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(t,e){return!e||"object"!==qt(e)&&"function"!=typeof e?Qt(t):e}(this,Zt(e).call(this,t));var r=t.dispatcher;return r.register("mousedown.*",n.selectCell,Qt(Qt(n))),r.register("mouseup.*",n.unselectCell,Qt(Qt(n))),r.register("drag*.graph",n.handleMultiSelect,Qt(Qt(n))),n.selectedNodes=null,n.selectedLinks=null,n.attachedLinks=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Jt(t,e)}(e,$t),function(t,e,n){e&&Xt(t.prototype,e),n&&Xt(t,n)}(e,[{key:"updateSelections",value:function(){this.selectedNodes&&this.selectedNodes.classed("selected",!1),this.selectedLinks&&this.selectedLinks.classed("selected",!1),this.selectedNodes=null,this.selectedLinks=null,this.attachedLinks=null,this.graph.selectedVertices&&this.graph.selectedVertices.length>0&&(this.selectedNodes=this.graph.renderer.getShapes(this.graph.selectedVertices),this.attachedLinks=this.graph.renderer.getShapes(this.graph.getAttachedEdges()),this.selectedNodes.classed("selected",!0)),this.graph.selectedEdges&&this.graph.selectedEdges.length>0&&(this.selectedLinks=this.graph.renderer.getShapes(this.graph.selectedEdges),this.selectedLinks.classed("selected",!0))}},{key:"selectCell",value:function(t,e,n,r,i){var o=n===this.graph?null:n;if(!o||o instanceof st){var a=i.ctrlKey||i.shiftKey;o&&o instanceof st&&(this.graph.isSelected(o)?o._firstSelection=!0:delete o._firstSelection,d3.select(i.dataTarget).moveToFront(),this.graph.setSelection(o,a))}}},{key:"unselectCell",value:function(t,e,n,r,i){var o=n===this.graph?null:n;if(!o||o instanceof st){var a=i.ctrlKey||i.shiftKey;o||this.graph.setSelection(o,a)}}},{key:"handleMultiSelect",value:function(t,e,n,r,i){if(r=util.scale(this.graph,r),"dragstart"!==t){if(this.startPt){var o=b.a.getBoundingRectangle([new Point(r[0],r[1]),this.startPt]),a=this.graph.renderer;if(this.rubberband||(this.rubberband=d3.select(a.appendNode(a.getCellLayer(),{template:_.template('<g><rect x="0" y="0" width="100" height="100" stroke="#000000" fill="none" stroke-dasharray="3 3"/></g>')},!1))),"dragend"==t){var s=this.graph.getCurrentRoot().children;return s=_.filter(s,function(t){var e=t.getBounds();return!!o.contains(e)}),this.graph.setSelection(s,i.ctrlKey),this.rubberband.remove(),delete this.startPt,void delete this.rubberband}this.rubberband.select("rect").attr({x:o.x,y:o.y,width:o.width,height:o.height})}}else{if(!("select"==this.graph.getProperty("defaultClickMode")^(i.ctrlKey||i.shiftKey)))return;this.startPt=new Point(r[0],r[1])}}},{key:"destroy",value:function(){Yt(Zt(e.prototype),"destroy",this).call(this),delete this.selectedNodes,delete this.selectedLinks,delete this.attachedLinks}}]),e}();function ee(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ne=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e,this.box=c.createElement("div",{id:this.id,tabindex:0,ns:"graph"},{overflow:"hidden",width:"100%",height:"100%",position:"relative"}),n.appendChild(this.box),r.layout){var o=s.a.getConstructor(r.layout.jsClass,Lt);this.layout=new o(r.layout.config),delete r.layout}this.clear=!0,this._translate=[0,0],this._scale=1,this.graph=i,this.dispatcher=null,this.graphBehavior=null,this.selectionBehavior=null,this.nodeBehavior=null,this.edgeBehavior=null,this.connectionBehavior=null,s.a.initConfig(this,r),X.on(ot.editor,"editor.update.*",function(t,e){console.log(t+"="+e)})}return function(t,e,n){e&&ee(t.prototype,e),n&&ee(t,n)}(t,[{key:"viewport",value:function(t,e){if((h.a.isUndefined(t)||h.a.isNull(t))&&(t=!1),!e){var n=new b.a(0,0,this.box.offsetWidth,this.box.offsetHeight);return t?s.a.scale(this.translate,this.scale,n):n}t||(e=s.a.scale(this.translate,this.scale,e));var r=this.box.offsetWidth/e.width;this.transform(-e.x*r,-e.y*r,r)}},{key:"transform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=this.graph,i=r?r.currentRoot:null;(h.a.isNull(t)||(this._translate[0]=t,i&&i.viewProp(this.id,"x",t)),h.a.isNull(e)||(this._translate[1]=e,i&&i.viewProp(this.id,"y",e)),h.a.isNull(n))||(this._scale=n,i&&i.viewProp(this.id,"scale",n),this.dispatcher.scale!==n&&(this.dispatcher.scale=n));this.refresh()}},{key:"render",value:function(){return!!this._graph&&(this.layout&&this.layout.layout(this._graph.currentRoot,this.viewport()),this.initializeBehaviors(),!0)}},{key:"renderLabel",value:function(t){return this.constructor.renderLabel(t)}},{key:"renderLink",value:function(t){return this.constructor.renderLink(t)}},{key:"renderMarkers",value:function(t){return this.constructor.renderMarkers(t)}},{key:"initializeBehaviors",value:function(){var t;this.dispatcher||(this.dispatcher=new Q(this.box,[this.prop("minZoom"),this.prop("maxZoom")]),this.prop("graphBehavior")&&(t=s.a.getConstructor(this.prop("graphBehavior")),this.graphBehavior=new t(this)),this.prop("selectionBehavior")&&(t=s.a.getConstructor(this.prop("selectionBehavior")),this.selectionBehavior=new t(this)),this.dispatcher.register("mouseup.node.label",function(t,e,n,r,i){var o=this,a=this._graph.nodes[n.getAttribute("id")];this.dispatcher.dragging||a._firstSelection||(ot._delayEdit=h.a.delay(function(){ot._delayEdit&&(delete ot._delayEdit,ot.editor.start(a.id,o.box,a.getLabelBox(o.id),n,i.nsTarget,o.scale))},250))},this),this.dispatcher.register([/^mousedown/,/^zoom/],function(t,e,n,r,i){c.eventFromInput(i)||ot.editor.stop()},this));this.dispatcher.start()}},{key:"refresh",value:function(){}},{key:"getTemplate",value:function(t,e,n){var r=this.constructor.TEMPLATES[t];if(r&&h.a.isFunction(r)&&(r=r(e)),n){var i=r.match(/(#{[^#]*})/g),o={};for(var a in i)o[a=(a=i[a]).substring(2,a.length-1).trim()]=n[h.a.camelCase("render "+a)](this);r=h.a.template(r,{interpolate:/#{([\s\S]+?)}/g})(o)}return r}},{key:"reset",value:function(){}},{key:"destroy",value:function(){delete this._graph,delete this.layout,this.dispatcher&&(this.dispatcher.stop(),delete this.dispatcher),this.box.innerHTML=""}},{key:"graph",get:function(){return this._graph},set:function(t){this._graph=t;var e=t.currentRoot;e&&(this._translate=[e.viewProp(this.id,"x")||0,e.viewProp(this.id,"y")||0],this._scale=e.viewProp(this.id,"scale")||1)}},{key:"translate",get:function(){return this._translate},set:function(t){this.transform(t[0],t[1])}},{key:"scale",get:function(){return this._scale},set:function(t){switch(t){case"in":t=this.scale*this.prop("zoomFactor");break;case"out":t=this.scale/this.prop("zoomFactor");break;case"actual":t=1;break;case"fit":var e=2*this.prop("gridSize"),n=this.getBounds(),r=this.viewport();r.width-=e,r.height-=e,t=Math.min(r.width/n.width,r.height/n.height,1);break;default:h.a.isString(t)&&(t=parseFloat(t))}this.transform(null,null,t)}}]),t}();ne.DEFAULTS={defaultClickMode:"pan",hideOutline:!1,singleSelect:!0,draggable:!0,gridEnabled:!1,guidesEnabled:!0,gridSize:30,maxZoom:4,minZoom:.2,zoomFactor:1.2,maskOpacity:.5,graphBehavior:Gt,selectionBehavior:te};var re=ne;function ie(t){return(ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function oe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ae(t,e){return!e||"object"!==ie(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function se(t,e,n){return(se="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=le(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function le(t){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function he(t,e){return(he=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}if("undefined"!=typeof SVGElement){var ue=document.createElementNS("http://www.w3.org/2000/svg","svg");ue.innerHTML="<circle/>","[object SVGCircleElement]"!==ue.firstChild&&Object.defineProperties(SVGElement.prototype,{outerHTML:{enumerable:!1,configurable:!0,get:function(){var t,e;return e=document.createElement("div"),t=this.cloneNode(!0),e.appendChild(t),e.innerHTML}},innerHTML:{enumerable:!1,configurable:!0,get:function(){var t=this.outerHTML,e=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i"),n=new RegExp("</"+this.nodeName+">$","i");return t.replace(e,"").replace(n,"")},set:function(t){for(var e;null!==(e=this.lastChild);)this.removeChild(e);var n=new p;n.append("<svg>").append(t).append("</svg");for(var r=c.createElement("div",null,null,n.toString()).firstElementChild;r.firstChild;)this.appendChild(r.firstChild)}}}),SVGElement.prototype.toDataURL=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this,r=function(t){};function o(t){var e="data:image/svg+xml;base64,";return window&&window.btoa?(r("using window.btoa for base64 encoding"),e+=btoa(t)):(r("using custom base64 encoder"),e+=i.encode(t)),e}switch(!0===e.debug&&"undefined"!=typeof console&&(r=function(t){console.log("SVG.toDataURL:",t)}),t||(t="image/svg+xml"),e.keepNonSafe&&r("NOTE: keepNonSafe is NOT supported and will be ignored!"),e.keepOutsideViewport&&r("NOTE: keepOutsideViewport is only supported with canvg exporter."),t){case"image/svg+xml":return function(){var i=o(n.outerHTML);return r(t+" length: "+i.length),e.callback&&e.callback(i),i}();case"image/png":case"image/jpeg":case"javascript":switch(e.renderer||(window&&window.canvg?e.renderer="canvg":e.renderer="native"),e.renderer){case"canvg":return r("using canvg renderer for "+t+" image export"),function(t){if("undefined"==typeof canvg)return null;var i=c.createElement("canvas",null,{display:"none"});if(document.body.appendChild(i),"javascript"===t&&"undefined"!=typeof jsCanvas){var o=new jsCanvas("jscanvastest");o.canvas.style.display="none"}if(e.keepOutsideViewport){var a=e.padding||0,s=1,l=[0,0],h=n.getBBox();r("detected svg dimensions "+[h.x,h.y,h.width,h.height]);var u=n.firstElementChild.getAttribute("transform");u&&(r("detected svg transform "+u),l=(u=ce.transform(u)).translate,s=u.scale);var f=new p;if(f.append('<svg width="').append(h.width+2*a).append('px" height="').append(h.height+2*a).append('px"><g transform="translate(').append(-h.x+l[0]+a).append(",").append(-h.y+l[1]+a).append(")scale(").append(s).append(')">').append(n.firstElementChild.innerHTML).append("</g></svg>"),"javascript"===t)return void o.compile(f.toString(),function(){e.callback&&e.callback(o.toString())});canvg(i,f.toString())}else canvg(i,n.outerHTML);var d=i.toDataURL(t);return e.callback&&e.callback(d),i.parentNode.removeChild(i),d}(t);case"native":return r("using native renderer for "+t+" export. THIS MIGHT FAIL."),function(t){var i=document.createElement("canvas"),a=i.getContext("2d"),s=new Image,l=n.outerHTML;s.src=o(l),s.onload=function(){r("exported image size: "+[s.width,s.height]),i.width=s.width,i.height=s.height,a.drawImage(s,0,0);var n=i.toDataURL(t);r(t+" length: "+n.length),e.callback?e.callback(n):r("WARNING: no callback set, so nothing happens.")},s.onerror=function(){r("Can't export! Maybe your browser doesn't support SVG in img element or SVG input for Canvas drawImage?\nhttp://en.wikipedia.org/wiki/SVG#Native_support")}}(t);default:r("unknown image renderer given, doing noting ("+e.renderer+")")}break;default:r("Sorry! Exporting as '"+t+"' is not supported!")}return null}}var ce=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),ae(this,le(e).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&he(t,e)}(e,re),function(t,e,n){e&&oe(t.prototype,e),n&&oe(t,n)}(e,[{key:"render",value:function(){if(se(le(e.prototype),"render",this).call(this)){var t=this.graph.currentRoot,n=new p('<svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">'),r=this.translate;n.append('<g transform="translate(').append(r[0]).append(",").append(r[1]).append(")scale(").append(this.scale).append(')">'),n.append(this.renderDefs()),n.append(t.render(this)),n.append("</g></svg>"),this.box.innerHTML=n.toString(),this.svg=this.box.firstElementChild}}},{key:"renderDefs",value:function(){var t=new p("<defs>");t.append(this.getTemplate("Grid",this.prop("gridSize")));var n=this.graph.markers;return n.length>0&&t.append(e.renderMarkers(n)),t.append("</defs>"),t.toString()}},{key:"refresh",value:function(){if(this.svg){var t=this.svg.querySelector("g"),e=this.translate;t.setAttribute("transform","translate("+e[0]+","+e[1]+")scale("+this.scale+")")}}}],[{key:"renderMarkers",value:function(t){var e,n,r=new p;return t.forEach(function(t){e=this.TEMPLATES.Marker(t),n=t.shape,h.a.isString(n)||(n=this.renderShape(n)),e=e.replace(/#\{shape\}/,n),r.append(e)},this),r.toString()}},{key:"renderLabel",value:function(t){return this.TEMPLATES.Label(t)}},{key:"renderShape",value:function(t){var e=this.TEMPLATES[t.name];return h.a.isString(e)&&(e=h.a.template(e)),e(t)}},{key:"getPathData",value:function(t){var e=t.points,n=t.controlPts;if(!e||0===e.length)return"";if(!n&&t.round){var r=[];n=[];var i,o,a,s,l=e[0];r.push(l);for(var h=1;h<e.length-1;h++)i=e[h],n[2*h]=[i,i],o=l.distance(i),a=i.distance(e[h+1]),s=Math.min(t.round,o/2,a/2),r.push(i.getDirection(l).scale(s).translate(i)),r.push(i.getDirection(e[h+1]).scale(s).translate(i)),l=i;r.push(e[e.length-1]),e=r}for(var u,c=new p("M"),f=0;f<e.length;f++)if(u=e[f],0===f)c.append(u);else if(n&&n[f]){c.append(" C ");for(var d=0;d<n[f].length;d++)c.append(n[f][d]).append(" ");c.append(u)}else c.append(" L ").append(u);return c.toString()}},{key:"renderLink",value:function(t){var n=new p,r=e.getPathData(t);return t.showGauge&&n.append('<path style="stroke: white; stroke-width: 9; visibility: hidden; pointer-events: stroke;" d="').append(r).append('"/>'),n.append('<path d="').append(r).append('"'),(t.startMarker||t.endMarker)&&(n.append(' style="'),t.startMarker&&n.append("marker-start: url(#").append(h.a.isString(t.startMarker)?t.startMarker:t.startMarker.id).append(");"),t.endMarker&&n.append("marker-end: url(#").append(h.a.isString(t.endMarker)?t.endMarker:t.endMarker.id).append(");"),n.append('"')),n.append("/>"),n.toString()}},{key:"appendContent",value:function(t,e){var n=new p;n.append("<svg>").append(e).append("</svg");for(var r=c.createElement("div",null,null,n.toString()).firstElementChild;r.firstChild;)t.appendChild(r.firstChild);return t}},{key:"transform",value:function(t){var e=[0,0],n=1,r=t.match(/translate\(\s*([^)]+)/);if(r){var i=r[1].trim().match(/([\d.-]+)[ ,]([\d.-]+)/);i?(e[0]=parseFloat(i[1])||0,e[1]=parseFloat(i[2])||0):e[0]=e[1]=parseFloat(r[1])}return(r=t.match(/scale\(\s*([^)]+)/))&&(n=parseFloat(r[1])||1),{translate:e,scale:n}}}]),e}();ce.TEMPLATES={$root:'<g id="${id}" class="${className}">#{children}</g>',$node:'<g id="${id}" class="${className}" style="${style}" ns="${namespace}" transform="translate(${x},${y})">#{shape}#{label}</g>',$edge:'<g id="${id}" class="${className}" style="${style}" ns="${namespace}">#{shape}#{label}</g>',Ellipse:'<ellipse cx="0" cy="0" rx="${width/2}" ry="${height/2}"/>',Rectangle:'<rect x="${-width/2}" y="${-height/2}" width="${width}" height="${height}" rx="9" ry="9"/>',Triangle:'<polygon points="${-width/2},${-height/2} ${width/2},${-height/2} 0,${height/2}"/>',Rhombus:'<polygon points="0,${-height/2} ${width/2},0 0,${height/2} ${-width/2},0"/>',Hexagon:function(t){return"north"===t.direction||"south"===t.direction?'<polygon points="0,${-height/2} ${width/2},${-height/4} ${width/2},${height/4} 0,${height/2} ${-width/2},${height/4} ${-width/2},${-height/4}"/>':'<polygon points="${-width/2},0 ${width/4},${-height/2} ${width/4},${-height/2} ${width/2},0 ${width/4},${height/2} ${-width/4},${height/2}"/>'},Polygon:function(t){var e=new p('<polygon points="');return t.points.forEach(function(t){e.append(t[0]).append(",").append(t[1]).append(" ")}),e.removeLast(),e.append('"/>'),e.toString()},Image:function(t){return'<image x="${-width/2}" y="${-height/2}" width="${width}" height="${height}" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+t.image+'"/>'},Marker:function(t){return'\n<marker id="'.concat(t.id,'" markerWidth="').concat(t.size,'" markerHeight="').concat(t.size,'" refx="').concat(t.ref[0],'"\nrefy="').concat(t.ref[1],'" orient="auto" viewbox="').concat(t.viewBox.x," ").concat(t.viewBox.y," ").concat(t.viewBox.width," ").concat(t.viewBox.height,'"\nmarkerUnits="userSpaceOnUse" ').concat(t.fill?'style="stroke: '.concat(t.fill,";fill:").concat(t.fill,'"'):"",">#{shape}</marker>\n").trim()},Grid:function(t){return'\n<pattern id="GridPattern" width="'.concat(t,'" height="').concat(t,'" patternUnits="userSpaceOnUse">\n  <ellipse cx="0" cy="0" rx="1" ry="1" fill="#999999"/>\n  <ellipse cx="0" cy="').concat(t,'" rx="1" ry="1" fill="#999999"/>\n  <ellipse cx="').concat(t,'" cy="0" rx="1" ry="1" fill="#999999"/>\n  <ellipse cx="').concat(t,'" cy="').concat(t,'" rx="1" ry="1" fill="#999999"/>\n</pattern>').trim()},Label:h.a.template('\n<% var box = _.has(data, "dx") ? data : (data.getLabelBox ? data.getLabelBox() : null);\n   if (box) {%>\n  <g <% if (box.config && box.config.class) {%>class="<%=box.config.class%>"<%}%>    <% if (box.config && box.config.ns) {%>ns="<%=box.config.ns%>"<%}%>    <% if (box.config && box.config.inlineStyle) {%>      font-size="<%=box.config.fontSize%>"      font-family="<%=box.config.fontFamily%>"      font-weight="<% if (box.bold) {%>bold<%} else {%>normal<%}%>"      <% if (box.underline) {%>text-decoration="underline"<%}%>      <% if (box.italic) {%>font-style="italic"<%}%>    <%}%>    text-anchor="<%=box.anchor%>"    transform="translate(<%=box.bounds.x%>,<%=box.bounds.y%>)<% if (box.config && box.config.rotation) {%>rotate(<%=box.config.rotation%> <%=box.pivot[0]%> <%=box.pivot[1]%>)<%}%>">\n  <% if (box.config.backgroundStyle) {%>\n    <rect x="<%=-box.bounds.width/2%>" y="<%=-box.bounds.height/2%>" width="<%=box.bounds.width%>" height="<%=box.bounds.height%>" style="<%=box.config.backgroundStyle%>"/>\n  <% } if (_.isArray(box.label)) {\n    _.each(box.label, function(value, line) {%>\n      <text <% if (box.config && box.config.textStyle) {%>style="<%=box.config.textStyle%>"<%}%>        dx="<%=box.dx%>" dy="<%=box.dy + box.lineHeight * line%>"><%=value%></text>\n    <%});} else { %>\n      <text><%=box.label%></text>\n    <%}%>\n    <% if (box.config.title) {%>\n      <title><%=box.config.title%></title>\n    <%}%>\n  </g>\n<%}%>\n'.trim(),{variable:"data"})};var fe=ce;v.a.addShape("Rectangle",b.a),v.a.addShape("Ellipse",S),v.a.addShape("Rhombus",R);e.default={Base64:i,Cache:a,Utils:s.a,DomUtils:c,StringBuffer:p,Point:d.a,Line:y,Shape:v.a,Rectangle:b.a,Ellipse:S,Link:q,EventDispatcher:Q,Label:ot,Marker:Et,Graph:Mt,Cell:st,Node:dt,Edge:_t,Layout:Lt,FlowLayout:Ut,Renderer:re,SVGRenderer:fe,GraphBehavior:Gt}}])});
//# sourceMappingURL=qgraph.min.js.map