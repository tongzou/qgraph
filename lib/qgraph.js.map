{"version":3,"sources":["webpack://qgraph/webpack/universalModuleDefinition","webpack://qgraph/webpack/bootstrap","webpack://qgraph/./lib/bean.js","webpack://qgraph/./src/behavior/Behavior.js","webpack://qgraph/./src/behavior/GraphBehavior.js","webpack://qgraph/./src/behavior/SelectionBehavior.js","webpack://qgraph/./src/event/event-dispatcher.js","webpack://qgraph/./src/event/key-utils.js","webpack://qgraph/./src/geometry/Ellipse.js","webpack://qgraph/./src/geometry/Line.js","webpack://qgraph/./src/geometry/Link.js","webpack://qgraph/./src/geometry/Point.js","webpack://qgraph/./src/geometry/Rectangle.js","webpack://qgraph/./src/geometry/Rhombus.js","webpack://qgraph/./src/geometry/Shape.js","webpack://qgraph/./src/graph/Cell.js","webpack://qgraph/./src/graph/Edge.js","webpack://qgraph/./src/graph/Graph.js","webpack://qgraph/./src/graph/Node.js","webpack://qgraph/./src/index.js","webpack://qgraph/./src/layout/FlowLayout.js","webpack://qgraph/./src/layout/Layout.js","webpack://qgraph/./src/util/Cache.js","webpack://qgraph/./src/util/Utils.js","webpack://qgraph/./src/util/base64.js","webpack://qgraph/./src/util/dom-utils.js","webpack://qgraph/./src/util/string-buffer.js","webpack://qgraph/./src/view/Label.js","webpack://qgraph/./src/view/Marker.js","webpack://qgraph/./src/view/Renderer.js","webpack://qgraph/./src/view/SVGRenderer.js","webpack://qgraph/external {\"root\":\"_\",\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"lodash\"}"],"names":["name","context","definition","module","exports","define","win","window","old","namespaceRegex","nameRegex","addEvent","removeEvent","doc","document","nav","navigator","root","documentElement","W3C_MODEL","eventSupport","ONE","slice","Array","prototype","str2arr","s","d","split","isString","o","isFunction","standardNativeEvents","w3cNativeEvents","nativeEvents","hash","events","i","length","customEvents","isAncestor","element","container","compareDocumentPosition","nodeType","contains","parentNode","check","event","related","relatedTarget","prefix","test","toString","mouseenter","base","condition","mouseleave","mousewheel","userAgent","Event","commonProps","mouseProps","concat","mouseWheelProps","keyProps","textProps","touchProps","messageProps","stateProps","overOutRegex","typeFixers","reg","fix","newEvent","keyCode","which","type","rightClick","button","pos","x","y","pageX","pageY","clientX","clientY","body","scrollLeft","scrollTop","typeFixerMap","isNative","arguments","ownerDocument","parentWindow","originalEvent","isBean","target","srcElement","l","p","props","fixer","preventDefault","returnValue","stopPropagation","cancelBubble","stop","stopped","stopImmediatePropagation","isImmediatePropagationStopped","clone","currentTarget","ne","targetElement","RegEntry","wrappedHandler","fn","args","call","eargs","apply","findTarget","eventElement","__beanDel","ft","handler","original","namespaces","customType","once","removeListener","eventType","inNamespaces","checkNamespaces","j","c","matches","checkElement","checkOriginal","checkHandler","registry","map","forAll","pfx","t","charAt","substr","list","all","has","get","entries","entry","push","put","key","del","splice","removed","selectorEngine","setSelectorEngine","e","querySelectorAll","r","Error","rootListener","propertyName","listeners","listener","add","custom","attachEvent","detachEvent","rm","originalFn","orgType","replace","handlers","delegate","selector","array","match","fireListener","evt","createEvent","dispatchEvent","fireEvent","createEventObject","off","typeSpec","isTypeStr","k","indexOf","hasOwnProperty","on","types","first","undefined","delfn","one","fire","names","from","beanDel","bean","cleanup","CollectGarbage","Behavior","renderer","GraphBehavior","dispatcher","register","handleDrag","handleZoom","offset","ns","graph","transform","scale","pan","prop","ctrlKey","shiftKey","translate","SelectionBehavior","selectCell","unselectCell","handleMultiSelect","selectedNodes","selectedLinks","attachedLinks","classed","selectedVertices","getShapes","getAttachedEdges","selectedEdges","data","cell","Cell","toggle","isSelected","_firstSelection","d3","select","dataTarget","moveToFront","setSelection","util","getProperty","startPt","Point","rect","Rectangle","getBoundingRectangle","rubberband","appendNode","getCellLayer","template","_","cells","getCurrentRoot","children","filter","box","getBounds","remove","attr","width","height","DEFAULTS","addEventHandler","EventDispatcher","zoomScale","Infinity","config","rootNS","getAttribute","Object","assign","dragging","handleEvent","started","enterStack","Events","startKeys","stopKeys","Math","max","min","buf","StringBuffer","stack","isRoot","startsWith","substring","rootTarget","nsTarget","prepend","targetStack","DomUtils","eventFromInput","getPosition","info","isKeyEvent","KeyUtils","getEventInfo","pow","wheelDelta","dragObject","mouse","dragPos","mousemove","currentPos","dispatch","mouseup","simulateEnterLeave","last","clearEnterStack","pop","getNS","index","val","append","item","nsType","forEach","regexp","callback","isNaN","lastPosition","isArray","registerKey","ctrl","alt","shift","meta","code","unregisterKey","zIndex","RegExp","registeredType","changedTouches","svg","ownerSVGElement","createSVGPoint","point","matrixTransform","getScreenCTM","inverse","getBoundingClientRect","left","clientLeft","top","clientTop","KEY","ALT","BACK_SPACE","CAPS_LOCK","CONTROL","DELETE","DOWN","END","ENTER","ESCAPE","HOME","LEFT","META","NUM_LOCK","PAGE_DOWN","PAGE_UP","PAUSE","PRINTSCREEN","RIGHT","SCROLL_LOCK","SHIFT","SPACE","TAB","UP","getKeyEvent","getKeyData","altKey","metaKey","Ellipse","pt","orthogonal","a","b","cx","cy","px","py","dx","parseInt","dy","abs","h","f","g","det","sqrt","xout1","xout2","yout1","yout2","dist1","dist2","xout","yout","dir","getDirection","direction","Shape","Line","start","end","distance","cosa","dotProduct","x0","y0","x1","y1","x2","y2","x3","y3","denom","numeA","numeB","ua","ub","intersectionX","intersectionY","defaultConfig","showGauge","defaultGeometry","anchorX","anchorY","offsetX","offsetY","linkTypes","Link","terminalVisual","shapeConfig","startMarker","endMarker","startNormal","endNormal","view","renderLink","geometry","isNumber","defaults","points","getScaled","Utils","offsetPosition","defaultsDeep","LinkClass","console","log","DirectLink","BezierLink","pts","ctrlpts","controlPts","p1","p2","p3","p4","EntityRelations","source","Port","edge","isSourceLeft","right","isTargetLeft","result","getCenterY","xe","ye","seg","segment","dep","arr","midY","Manhattan","MIN_BUFFER","autoRoute","randomNoise","step","maxChannelWidth","boxes","startBox","endBox","side","side2","intersect","channel","channel2","startPadding","endPadding","_getChannel","horizontal","bottom","_getFirstIntersection","_getRouteTendency","_hasIntersection","_moveSegment","breakPt","_getRouteDirection","getCenter","box1","box2","getLeft","getRight","getBottom","getTop","getTranslated","route","_mergeSegments","node","getCommonAncestor","childNodes","getDescendants","excludeFromRouting","range","randomNumber","floor","random","noise","sign","_moveSegment2","buffer","startBuffer","endBuffer","startBufferNormal","endBufferNormal","middle","prunePts","detectIntersection","savedIndex","savedSide","pt1","pt2","S","N","E","W","SE","NE","SW","NW","h1","h2","equals","aPt","dist","angle","cos","PI","sin","rotate","vertical","el","w","contains1","contains2","outPt","alpha","atan2","pi","pi2","beta","tan","margin","rects","minx","miny","maxx","maxy","each","Rhombus","tx","ty","intersection","n","refPt","constructor","getPerimeter","getTemplate","id","uniqueId","decorators","createDecorators","views","viewProps","Type","namespace","value","isUndefined","shape","getShape","className","computedClassName","style","viewProp","Cache","ShapeClass","set","role","getView","render","currentRoot","getLabelBox","renderLabel","Label","destroyed","_computedClassName","getPrototypeOf","Edge","setSource","sourcePos","setTarget","targetPos","setTerminal","setEdgeAt","removeEdge","addOutEdge","addInEdge","label","getLabelBoxForLink","center","refPts","getReferencePoints","terminals","getBound","getPort","getLink","getTerminalVisual","nodeDefaults","draggable","selectable","editable","resizable","sourceable","targetable","visible","edgeDefaults","size","color","Graph","model","nodes","edges","selection","buildTypes","nodeTypes","edgeTypes","markers","marker","markerConfig","Marker","getMarker","initConfig","loadModel","parent","NodeClass","getJSClass","Node","addChild","to","EdgeClass","addNode","child","addEdge","defaultClass","jsClass","getConstructor","without","allowDanglingEdges","multiConnect","readOnly","viewOnly","inEdges","outEdges","ports","portName","endPt","typeName","addShape","Base64","Layout","FlowLayout","Renderer","SVGRenderer","bounds","items","owner","getLinkedNodes","hgap","vgap","_flPos","moveTo","trigger","orientation","toUpperCase","HORIZONTAL","VERTICAL","caches","getCache","clear","_debugging","_debugAll","typeRegistry","Map","createType","defaultType","extend","extends","protoProps","staticProps","Surrogate","superclass","obj","cArr","super","eval","debug","moduleName","message","getRelativePosition","unscale","_keyStr","encode","input","output","chr1","chr2","chr3","enc1","enc2","enc3","enc4","_utf8_encode","charCodeAt","decode","String","fromCharCode","_utf8_decode","string","utftext","c1","c2","c3","inBrowser","isIE","sAgent","Idx","isFireFox","InstallTrigger","isChrome","raw","isMac","platform","isWindows","appVersion","isLinux","createElement","tag","attribs","styles","html","setElement","innerHTML","createElementByString","str","temp","setAttribute","testElement","method","getAncestorBy","elRect","contextRect","getCenterPosition","move","getSize","offsetWidth","offsetHeight","resize","preloadImages","loaded","img","that","Image","onload","src","getImageInfo","downloadFile","mime","encoded","atob","decodeURI","GetBlob","msSaveBlob","link","href","download","display","appendChild","click","removeChild","contentType","sliceSize","byteArrays","byteNumbers","byteArray","Uint8Array","Blob","openImage","image","myWindow","open","myDocument","tagName","waitForElement","Promise","resolve","getElementById","interval","setInterval","clearInterval","stuff","sep","join","FONT_BOLD","FONT_ITALIC","FONT_UNDERLINE","FONT_SHADOW","fontSize","fontFamily","fontStyle","fontColor","padding","linePadding","align","rotation","stringMeasureEl","measureDiv","baselineDiv","getStringSize","memoize","bold","position","visibility","contentWindow","write","close","fontWeight","strut","firstChild","baselineHeight","offsetTop","baseline","wrap","maxWidth","spaceSize","space","lineHeight","lines","words","line","currentWidth","wordWidth","newLine","word","labelConfig","containerWidth","containerHeight","_getLabelBox","wrappedLabel","anchor","setAnchorX","pivot","maxBounds","_label","underline","italic","shadow","editor","refEl","textEl","singleLine","unselectable","overflow","border","focus","cancel","arrow","viewBox","ref","fill","triangle","oval","diamond","factory","tabindex","layout","LayoutClass","_translate","_scale","graphBehavior","selectionBehavior","nodeBehavior","edgeBehavior","connectionBehavior","scaled","viewport","isNull","vp","refresh","_graph","initializeBehaviors","renderMarkers","JsClass","_delayEdit","delay","preprocessor","TEMPLATES","parts","part","trim","camelCase","interpolate","gridSize","gBounds","vBounds","parseFloat","defaultClickMode","hideOutline","singleSelect","gridEnabled","guidesEnabled","maxZoom","minZoom","zoomFactor","maskOpacity","NS","SVGElement","createElementNS","defineProperties","enumerable","configurable","$node","$temp","cloneNode","outerHTML","ropen","nodeName","rclose","markup","lastChild","firstElementChild","toDataURL","options","_svg","msg","exportSVG","svgXml","svgDataurl","base64dataURLencode","b64","btoa","exportImage","canvas","ctx","getContext","svgImg","drawImage","imageDataurl","onerror","exportImageCanvg","canvg","jsCanvas","xcanvas","keepOutsideViewport","bbox","getBBox","compile","keepNonSafe","renderDefs","querySelector","str1","str2","renderShape","round","newPts","prev","next","d1","d2","corner","getPathData","content","m","$root","$edge","Triangle","Hexagon","Polygon","removeLast","Grid","variable"],"mappings":"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","file":"qgraph.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"qgraph\", [\"lodash\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"qgraph\"] = factory(require(\"lodash\"));\n\telse\n\t\troot[\"qgraph\"] = factory(root[\"_\"]);\n})((typeof window !== 'undefined' ? window : this), function(__WEBPACK_EXTERNAL_MODULE_lodash__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","/*!\r\n  * Bean - copyright (c) Jacob Thornton 2011-2012\r\n  * https://github.com/fat/bean\r\n  * MIT license\r\n  */\r\n(function (name, context, definition) {\r\n  if (typeof module != 'undefined' && module.exports) module.exports = definition()\r\n  else if (typeof define == 'function' && define.amd) define(definition)\r\n  else context[name] = definition()\r\n})('bean', this, function (name, context) {\r\n  name    = name    || 'bean'\r\n  context = context || this\r\n\r\n  var win            = typeof window !== 'undefined' ? window : this\r\n    , old            = context[name]\r\n    , namespaceRegex = /[^\\.]*(?=\\..*)\\.|.*/\r\n    , nameRegex      = /\\..*/\r\n    , addEvent       = 'addEventListener'\r\n    , removeEvent    = 'removeEventListener'\r\n    , doc            = typeof document !== 'undefined' ? document : {}\r\n    , nav            = typeof navigator !== 'undefined' ? navigator : {}\r\n    , root           = doc.documentElement || {}\r\n    , W3C_MODEL      = root[addEvent]\r\n    , eventSupport   = W3C_MODEL ? addEvent : 'attachEvent'\r\n    , ONE            = {} // singleton for quick matching making add() do one()\r\n\r\n    , slice          = Array.prototype.slice\r\n    , str2arr        = function (s, d) { return s.split(d || ' ') }\r\n    , isString       = function (o) { return typeof o == 'string' }\r\n    , isFunction     = function (o) { return typeof o == 'function' }\r\n\r\n      // events that we consider to be 'native', anything not in this list will\r\n      // be treated as a custom event\r\n    , standardNativeEvents =\r\n        'click dblclick mouseup mousedown contextmenu '                  + // mouse buttons\r\n        'mousewheel mousemultiwheel DOMMouseScroll '                     + // mouse wheel\r\n        'mouseover mouseout mousemove selectstart selectend '            + // mouse movement\r\n        'keydown keypress keyup '                                        + // keyboard\r\n        'orientationchange '                                             + // mobile\r\n        'focus blur change reset select submit '                         + // form elements\r\n        'load unload beforeunload resize move DOMContentLoaded '         + // window\r\n        'readystatechange message '                                      + // window\r\n        'error abort scroll '                                              // misc\r\n      // element.fireEvent('onXYZ'... is not forgiving if we try to fire an event\r\n      // that doesn't actually exist, so make sure we only do these on newer browsers\r\n    , w3cNativeEvents =\r\n        'show '                                                          + // mouse buttons\r\n        'input invalid '                                                 + // form elements\r\n        'touchstart touchmove touchend touchcancel '                     + // touch\r\n        'gesturestart gesturechange gestureend '                         + // gesture\r\n        'textinput '                                                     + // TextEvent\r\n        'readystatechange pageshow pagehide popstate '                   + // window\r\n        'hashchange offline online '                                     + // window\r\n        'afterprint beforeprint '                                        + // printing\r\n        'dragstart dragenter dragover dragleave drag drop dragend '      + // dnd\r\n        'loadstart progress suspend emptied stalled loadmetadata '       + // media\r\n        'loadeddata canplay canplaythrough playing waiting seeking '     + // media\r\n        'seeked ended durationchange timeupdate play pause ratechange '  + // media\r\n        'volumechange cuechange '                                        + // media\r\n        'checking noupdate downloading cached updateready obsolete '       // appcache\r\n\r\n      // convert to a hash for quick lookups\r\n    , nativeEvents = (function (hash, events, i) {\r\n        for (i = 0; i < events.length; i++) events[i] && (hash[events[i]] = 1)\r\n        return hash\r\n      }({}, str2arr(standardNativeEvents + (W3C_MODEL ? w3cNativeEvents : ''))))\r\n\r\n      // custom events are events that we *fake*, they are not provided natively but\r\n      // we can use native events to generate them\r\n    , customEvents = (function () {\r\n        var isAncestor = 'compareDocumentPosition' in root\r\n              ? function (element, container) {\r\n                  return container.compareDocumentPosition && (container.compareDocumentPosition(element) & 16) === 16\r\n                }\r\n              : 'contains' in root\r\n                ? function (element, container) {\r\n                    container = container.nodeType === 9 || container === window ? root : container\r\n                    return container !== element && container.contains(element)\r\n                  }\r\n                : function (element, container) {\r\n                    while (element = element.parentNode) if (element === container) return 1\r\n                    return 0\r\n                  }\r\n          , check = function (event) {\r\n              var related = event.relatedTarget\r\n              return !related\r\n                ? related == null\r\n                : (related !== this && related.prefix !== 'xul' && !/document/.test(this.toString())\r\n                    && !isAncestor(related, this))\r\n            }\r\n\r\n        return {\r\n            mouseenter: { base: 'mouseover', condition: check }\r\n          , mouseleave: { base: 'mouseout', condition: check }\r\n          , mousewheel: { base: /Firefox/.test(nav.userAgent) ? 'DOMMouseScroll' : 'mousewheel' }\r\n        }\r\n      }())\r\n\r\n      // we provide a consistent Event object across browsers by taking the actual DOM\r\n      // event object and generating a new one from its properties.\r\n    , Event = (function () {\r\n            // a whitelist of properties (for different event types) tells us what to check for and copy\r\n        var commonProps  = str2arr('altKey attrChange attrName bubbles cancelable ctrlKey currentTarget ' +\r\n              'detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey '  +\r\n              'srcElement target timeStamp type view which propertyName')\r\n          , mouseProps   = commonProps.concat(str2arr('button buttons clientX clientY dataTransfer '      +\r\n              'fromElement offsetX offsetY pageX pageY screenX screenY toElement'))\r\n          , mouseWheelProps = mouseProps.concat(str2arr('wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ ' +\r\n              'axis')) // 'axis' is FF specific\r\n          , keyProps     = commonProps.concat(str2arr('char charCode key keyCode keyIdentifier '          +\r\n              'keyLocation location'))\r\n          , textProps    = commonProps.concat(str2arr('data'))\r\n          , touchProps   = commonProps.concat(str2arr('touches targetTouches changedTouches scale rotation'))\r\n          , messageProps = commonProps.concat(str2arr('data origin source'))\r\n          , stateProps   = commonProps.concat(str2arr('state'))\r\n          , overOutRegex = /over|out/\r\n            // some event types need special handling and some need special properties, do that all here\r\n          , typeFixers   = [\r\n                { // key events\r\n                    reg: /key/i\r\n                  , fix: function (event, newEvent) {\r\n                      newEvent.keyCode = event.keyCode || event.which\r\n                      return keyProps\r\n                    }\r\n                }\r\n              , { // mouse events\r\n                    reg: /click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i\r\n                  , fix: function (event, newEvent, type) {\r\n                      newEvent.rightClick = event.which === 3 || event.button === 2\r\n                      newEvent.pos = { x: 0, y: 0 }\r\n                      if (event.pageX || event.pageY) {\r\n                        newEvent.clientX = event.pageX\r\n                        newEvent.clientY = event.pageY\r\n                      } else if (event.clientX || event.clientY) {\r\n                        newEvent.clientX = event.clientX + doc.body.scrollLeft + root.scrollLeft\r\n                        newEvent.clientY = event.clientY + doc.body.scrollTop + root.scrollTop\r\n                      }\r\n                      if (overOutRegex.test(type)) {\r\n                        newEvent.relatedTarget = event.relatedTarget\r\n                          || event[(type == 'mouseover' ? 'from' : 'to') + 'Element']\r\n                      }\r\n                      return mouseProps\r\n                    }\r\n                }\r\n              , { // mouse wheel events\r\n                    reg: /mouse.*(wheel|scroll)/i\r\n                  , fix: function () { return mouseWheelProps }\r\n                }\r\n              , { // TextEvent\r\n                    reg: /^text/i\r\n                  , fix: function () { return textProps }\r\n                }\r\n              , { // touch and gesture events\r\n                    reg: /^touch|^gesture/i\r\n                  , fix: function () { return touchProps }\r\n                }\r\n              , { // message events\r\n                    reg: /^message$/i\r\n                  , fix: function () { return messageProps }\r\n                }\r\n              , { // popstate events\r\n                    reg: /^popstate$/i\r\n                  , fix: function () { return stateProps }\r\n                }\r\n              , { // everything else\r\n                    reg: /.*/\r\n                  , fix: function () { return commonProps }\r\n                }\r\n            ]\r\n          , typeFixerMap = {} // used to map event types to fixer functions (above), a basic cache mechanism\r\n\r\n          , Event = function (event, element, isNative) {\r\n              if (!arguments.length) return\r\n              event = event || ((element.ownerDocument || element.document || element).parentWindow || win).event\r\n              this.originalEvent = event\r\n              this.isNative       = isNative\r\n              this.isBean         = true\r\n\r\n              if (!event) return\r\n\r\n              var type   = event.type\r\n                , target = event.target || event.srcElement\r\n                , i, l, p, props, fixer\r\n\r\n              this.target = target && target.nodeType === 3 ? target.parentNode : target\r\n\r\n              if (isNative) { // we only need basic augmentation on custom events, the rest expensive & pointless\r\n                fixer = typeFixerMap[type]\r\n                if (!fixer) { // haven't encountered this event type before, map a fixer function for it\r\n                  for (i = 0, l = typeFixers.length; i < l; i++) {\r\n                    if (typeFixers[i].reg.test(type)) { // guaranteed to match at least one, last is .*\r\n                      typeFixerMap[type] = fixer = typeFixers[i].fix\r\n                      break\r\n                    }\r\n                  }\r\n                }\r\n\r\n                props = fixer(event, this, type)\r\n                for (i = props.length; i--;) {\r\n                  if (!((p = props[i]) in this) && p in event) this[p] = event[p]\r\n                }\r\n              }\r\n            }\r\n\r\n        // preventDefault() and stopPropagation() are a consistent interface to those functions\r\n        // on the DOM, stop() is an alias for both of them together\r\n        Event.prototype.preventDefault = function () {\r\n          if (this.originalEvent.preventDefault) this.originalEvent.preventDefault()\r\n          else this.originalEvent.returnValue = false\r\n        }\r\n        Event.prototype.stopPropagation = function () {\r\n          if (this.originalEvent.stopPropagation) this.originalEvent.stopPropagation()\r\n          else this.originalEvent.cancelBubble = true\r\n        }\r\n        Event.prototype.stop = function () {\r\n          this.preventDefault()\r\n          this.stopPropagation()\r\n          this.stopped = true\r\n        }\r\n        // stopImmediatePropagation() has to be handled internally because we manage the event list for\r\n        // each element\r\n        // note that originalElement may be a Bean#Event object in some situations\r\n        Event.prototype.stopImmediatePropagation = function () {\r\n          if (this.originalEvent.stopImmediatePropagation) this.originalEvent.stopImmediatePropagation()\r\n          this.isImmediatePropagationStopped = function () { return true }\r\n        }\r\n        Event.prototype.isImmediatePropagationStopped = function () {\r\n          return this.originalEvent.isImmediatePropagationStopped && this.originalEvent.isImmediatePropagationStopped()\r\n        }\r\n        Event.prototype.clone = function (currentTarget) {\r\n          //TODO: this is ripe for optimisation, new events are *expensive*\r\n          // improving this will speed up delegated events\r\n          var ne = new Event(this, this.element, this.isNative)\r\n          ne.currentTarget = currentTarget\r\n          return ne\r\n        }\r\n\r\n        return Event\r\n      }())\r\n\r\n      // if we're in old IE we can't do onpropertychange on doc or win so we use doc.documentElement for both\r\n    , targetElement = function (element, isNative) {\r\n        return !W3C_MODEL && !isNative && (element === doc || element === win) ? root : element\r\n      }\r\n\r\n      /**\r\n        * Bean maintains an internal registry for event listeners. We don't touch elements, objects\r\n        * or functions to identify them, instead we store everything in the registry.\r\n        * Each event listener has a RegEntry object, we have one 'registry' for the whole instance.\r\n        */\r\n    , RegEntry = (function () {\r\n        // each handler is wrapped so we can handle delegation and custom events\r\n        var wrappedHandler = function (element, fn, condition, args) {\r\n            var call = function (event, eargs) {\r\n                  return fn.apply(element, args ? slice.call(eargs, event ? 0 : 1).concat(args) : eargs)\r\n                }\r\n              , findTarget = function (event, eventElement) {\r\n                  return fn.__beanDel ? fn.__beanDel.ft(event.target, element) : eventElement\r\n                }\r\n              , handler = condition\r\n                  ? function (event) {\r\n                      var target = findTarget(event, this) // deleated event\r\n                      if (condition.apply(target, arguments)) {\r\n                        if (event) event.currentTarget = target\r\n                        return call(event, arguments)\r\n                      }\r\n                    }\r\n                  : function (event) {\r\n                      if (fn.__beanDel) event = event.clone(findTarget(event)) // delegated event, fix the fix\r\n                      return call(event, arguments)\r\n                    }\r\n            handler.__beanDel = fn.__beanDel\r\n            return handler\r\n          }\r\n\r\n        , RegEntry = function (element, type, handler, original, namespaces, args, root) {\r\n            var customType     = customEvents[type]\r\n              , isNative\r\n\r\n            if (type == 'unload') {\r\n              // self clean-up\r\n              handler = once(removeListener, element, type, handler, original)\r\n            }\r\n\r\n            if (customType) {\r\n              if (customType.condition) {\r\n                handler = wrappedHandler(element, handler, customType.condition, args)\r\n              }\r\n              type = customType.base || type\r\n            }\r\n\r\n            this.isNative      = isNative = nativeEvents[type] && !!element[eventSupport]\r\n            this.customType    = !W3C_MODEL && !isNative && type\r\n            this.element       = element\r\n            this.type          = type\r\n            this.original      = original\r\n            this.namespaces    = namespaces\r\n            this.eventType     = W3C_MODEL || isNative ? type : 'propertychange'\r\n            this.target        = targetElement(element, isNative)\r\n            this[eventSupport] = !!this.target[eventSupport]\r\n            this.root          = root\r\n            this.handler       = wrappedHandler(element, handler, null, args)\r\n          }\r\n\r\n        // given a list of namespaces, is our entry in any of them?\r\n        RegEntry.prototype.inNamespaces = function (checkNamespaces) {\r\n          var i, j, c = 0\r\n          if (!checkNamespaces) return true\r\n          if (!this.namespaces) return false\r\n          for (i = checkNamespaces.length; i--;) {\r\n            for (j = this.namespaces.length; j--;) {\r\n              if (checkNamespaces[i] == this.namespaces[j]) c++\r\n            }\r\n          }\r\n          return checkNamespaces.length === c\r\n        }\r\n\r\n        // match by element, original fn (opt), handler fn (opt)\r\n        RegEntry.prototype.matches = function (checkElement, checkOriginal, checkHandler) {\r\n          return this.element === checkElement &&\r\n            (!checkOriginal || this.original === checkOriginal) &&\r\n            (!checkHandler || this.handler === checkHandler)\r\n        }\r\n\r\n        return RegEntry\r\n      }())\r\n\r\n    , registry = (function () {\r\n        // our map stores arrays by event type, just because it's better than storing\r\n        // everything in a single array.\r\n        // uses '$' as a prefix for the keys for safety and 'r' as a special prefix for\r\n        // rootListeners so we can look them up fast\r\n        var map = {}\r\n\r\n          // generic functional search of our registry for matching listeners,\r\n          // `fn` returns false to break out of the loop\r\n          , forAll = function (element, type, original, handler, root, fn) {\r\n              var pfx = root ? 'r' : '$'\r\n              if (!type || type == '*') {\r\n                // search the whole registry\r\n                for (var t in map) {\r\n                  if (t.charAt(0) == pfx) {\r\n                    forAll(element, t.substr(1), original, handler, root, fn)\r\n                  }\r\n                }\r\n              } else {\r\n                var i = 0, l, list = map[pfx + type], all = element == '*'\r\n                if (!list) return\r\n                for (l = list.length; i < l; i++) {\r\n                  if ((all || list[i].matches(element, original, handler)) && !fn(list[i], list, i, type)) return\r\n                }\r\n              }\r\n            }\r\n\r\n          , has = function (element, type, original, root) {\r\n              // we're not using forAll here simply because it's a bit slower and this\r\n              // needs to be fast\r\n              var i, list = map[(root ? 'r' : '$') + type]\r\n              if (list) {\r\n                for (i = list.length; i--;) {\r\n                  if (!list[i].root && list[i].matches(element, original, null)) return true\r\n                }\r\n              }\r\n              return false\r\n            }\r\n\r\n          , get = function (element, type, original, root) {\r\n              var entries = []\r\n              forAll(element, type, original, null, root, function (entry) {\r\n                return entries.push(entry)\r\n              })\r\n              return entries\r\n            }\r\n\r\n          , put = function (entry) {\r\n              var has = !entry.root && !this.has(entry.element, entry.type, null, false)\r\n                , key = (entry.root ? 'r' : '$') + entry.type\r\n              ;(map[key] || (map[key] = [])).push(entry)\r\n              return has\r\n            }\r\n\r\n          , del = function (entry) {\r\n              forAll(entry.element, entry.type, null, entry.handler, entry.root, function (entry, list, i) {\r\n                list.splice(i, 1)\r\n                entry.removed = true\r\n                if (list.length === 0) delete map[(entry.root ? 'r' : '$') + entry.type]\r\n                return false\r\n              })\r\n            }\r\n\r\n            // dump all entries, used for onunload\r\n          , entries = function () {\r\n              var t, entries = []\r\n              for (t in map) {\r\n                if (t.charAt(0) == '$') entries = entries.concat(map[t])\r\n              }\r\n              return entries\r\n            }\r\n\r\n        return { has: has, get: get, put: put, del: del, entries: entries }\r\n      }())\r\n\r\n      // we need a selector engine for delegated events, use querySelectorAll if it exists\r\n      // but for older browsers we need Qwery, Sizzle or similar\r\n    , selectorEngine\r\n    , setSelectorEngine = function (e) {\r\n        if (!arguments.length) {\r\n          selectorEngine = doc.querySelectorAll\r\n            ? function (s, r) {\r\n                return r.querySelectorAll(s)\r\n              }\r\n            : function () {\r\n                throw new Error('Bean: No selector engine installed') // eeek\r\n              }\r\n        } else {\r\n          selectorEngine = e\r\n        }\r\n      }\r\n\r\n      // we attach this listener to each DOM event that we need to listen to, only once\r\n      // per event type per DOM element\r\n    , rootListener = function (event, type) {\r\n        if (!W3C_MODEL && type && event && event.propertyName != '_on' + type) return\r\n\r\n        var listeners = registry.get(this, type || event.type, null, false)\r\n          , l = listeners.length\r\n          , i = 0\r\n\r\n        event = new Event(event, this, true)\r\n        if (type) event.type = type\r\n\r\n        // iterate through all handlers registered for this type, calling them unless they have\r\n        // been removed by a previous handler or stopImmediatePropagation() has been called\r\n        for (; i < l && !event.isImmediatePropagationStopped(); i++) {\r\n          if (!listeners[i].removed) listeners[i].handler.call(this, event)\r\n        }\r\n      }\r\n\r\n      // add and remove listeners to DOM elements\r\n    , listener = W3C_MODEL\r\n        ? function (element, type, add) {\r\n            // new browsers\r\n            element[add ? addEvent : removeEvent](type, rootListener, false)\r\n          }\r\n        : function (element, type, add, custom) {\r\n            // IE8 and below, use attachEvent/detachEvent and we have to piggy-back propertychange events\r\n            // to simulate event bubbling etc.\r\n            var entry\r\n            if (add) {\r\n              registry.put(entry = new RegEntry(\r\n                  element\r\n                , custom || type\r\n                , function (event) { // handler\r\n                    rootListener.call(element, event, custom)\r\n                  }\r\n                , rootListener\r\n                , null\r\n                , null\r\n                , true // is root\r\n              ))\r\n              if (custom && element['_on' + custom] == null) element['_on' + custom] = 0\r\n              entry.target.attachEvent('on' + entry.eventType, entry.handler)\r\n            } else {\r\n              entry = registry.get(element, custom || type, rootListener, true)[0]\r\n              if (entry) {\r\n                entry.target.detachEvent('on' + entry.eventType, entry.handler)\r\n                registry.del(entry)\r\n              }\r\n            }\r\n          }\r\n\r\n    , once = function (rm, element, type, fn, originalFn) {\r\n        // wrap the handler in a handler that does a remove as well\r\n        return function () {\r\n          fn.apply(this, arguments)\r\n          rm(element, type, originalFn)\r\n        }\r\n      }\r\n\r\n    , removeListener = function (element, orgType, handler, namespaces) {\r\n        var type     = orgType && orgType.replace(nameRegex, '')\r\n          , handlers = registry.get(element, type, null, false)\r\n          , removed  = {}\r\n          , i, l\r\n\r\n        for (i = 0, l = handlers.length; i < l; i++) {\r\n          if ((!handler || handlers[i].original === handler) && handlers[i].inNamespaces(namespaces)) {\r\n            // TODO: this is problematic, we have a registry.get() and registry.del() that\r\n            // both do registry searches so we waste cycles doing this. Needs to be rolled into\r\n            // a single registry.forAll(fn) that removes while finding, but the catch is that\r\n            // we'll be splicing the arrays that we're iterating over. Needs extra tests to\r\n            // make sure we don't screw it up. @rvagg\r\n            registry.del(handlers[i])\r\n            if (!removed[handlers[i].eventType] && handlers[i][eventSupport])\r\n              removed[handlers[i].eventType] = { t: handlers[i].eventType, c: handlers[i].type }\r\n          }\r\n        }\r\n        // check each type/element for removed listeners and remove the rootListener where it's no longer needed\r\n        for (i in removed) {\r\n          if (!registry.has(element, removed[i].t, null, false)) {\r\n            // last listener of this type, remove the rootListener\r\n            listener(element, removed[i].t, false, removed[i].c)\r\n          }\r\n        }\r\n      }\r\n\r\n      // set up a delegate helper using the given selector, wrap the handler function\r\n    , delegate = function (selector, fn) {\r\n        //TODO: findTarget (therefore $) is called twice, once for match and once for\r\n        // setting e.currentTarget, fix this so it's only needed once\r\n        var findTarget = function (target, root) {\r\n              var i, array = isString(selector) ? selectorEngine(selector, root) : selector\r\n              for (; target && target !== root; target = target.parentNode) {\r\n                for (i = array.length; i--;) {\r\n                  if (array[i] === target) return target\r\n                }\r\n              }\r\n            }\r\n          , handler = function (e) {\r\n              var match = findTarget(e.target, this)\r\n              if (match) fn.apply(match, arguments)\r\n            }\r\n\r\n        // __beanDel isn't pleasant but it's a private function, not exposed outside of Bean\r\n        handler.__beanDel = {\r\n            ft       : findTarget // attach it here for customEvents to use too\r\n          , selector : selector\r\n        }\r\n        return handler\r\n      }\r\n\r\n    , fireListener = W3C_MODEL ? function (isNative, type, element) {\r\n        // modern browsers, do a proper dispatchEvent()\r\n        var evt = doc.createEvent(isNative ? 'HTMLEvents' : 'UIEvents')\r\n        evt[isNative ? 'initEvent' : 'initUIEvent'](type, true, true, win, 1)\r\n        element.dispatchEvent(evt)\r\n      } : function (isNative, type, element) {\r\n        // old browser use onpropertychange, just increment a custom property to trigger the event\r\n        element = targetElement(element, isNative)\r\n        isNative ? element.fireEvent('on' + type, doc.createEventObject()) : element['_on' + type]++\r\n      }\r\n\r\n      /**\r\n        * Public API: off(), on(), add(), (remove()), one(), fire(), clone()\r\n        */\r\n\r\n      /**\r\n        * off(element[, eventType(s)[, handler ]])\r\n        */\r\n    , off = function (element, typeSpec, fn) {\r\n        var isTypeStr = isString(typeSpec)\r\n          , k, type, namespaces, i\r\n\r\n        if (isTypeStr && typeSpec.indexOf(' ') > 0) {\r\n          // off(el, 't1 t2 t3', fn) or off(el, 't1 t2 t3')\r\n          typeSpec = str2arr(typeSpec)\r\n          for (i = typeSpec.length; i--;)\r\n            off(element, typeSpec[i], fn)\r\n          return element\r\n        }\r\n\r\n        type = isTypeStr && typeSpec.replace(nameRegex, '')\r\n        if (type && customEvents[type]) type = customEvents[type].base\r\n\r\n        if (!typeSpec || isTypeStr) {\r\n          // off(el) or off(el, t1.ns) or off(el, .ns) or off(el, .ns1.ns2.ns3)\r\n          if (namespaces = isTypeStr && typeSpec.replace(namespaceRegex, '')) namespaces = str2arr(namespaces, '.')\r\n          removeListener(element, type, fn, namespaces)\r\n        } else if (isFunction(typeSpec)) {\r\n          // off(el, fn)\r\n          removeListener(element, null, typeSpec)\r\n        } else {\r\n          // off(el, { t1: fn1, t2, fn2 })\r\n          for (k in typeSpec) {\r\n            if (typeSpec.hasOwnProperty(k)) off(element, k, typeSpec[k])\r\n          }\r\n        }\r\n\r\n        return element\r\n      }\r\n\r\n      /**\r\n        * on(element, eventType(s)[, selector], handler[, args ])\r\n        */\r\n    , on = function(element, events, selector, fn) {\r\n        var originalFn, type, types, i, args, entry, first\r\n\r\n        //TODO: the undefined check means you can't pass an 'args' argument, fix this perhaps?\r\n        if (selector === undefined && typeof events == 'object') {\r\n          //TODO: this can't handle delegated events\r\n          for (type in events) {\r\n            if (events.hasOwnProperty(type)) {\r\n              on.call(this, element, type, events[type])\r\n            }\r\n          }\r\n          return\r\n        }\r\n\r\n        if (!isFunction(selector)) {\r\n          // delegated event\r\n          originalFn = fn\r\n          args       = slice.call(arguments, 4)\r\n          fn         = delegate(selector, originalFn, selectorEngine)\r\n        } else {\r\n          args       = slice.call(arguments, 3)\r\n          fn         = originalFn = selector\r\n        }\r\n\r\n        types = str2arr(events)\r\n\r\n        // special case for one(), wrap in a self-removing handler\r\n        if (this === ONE) {\r\n          fn = once(off, element, events, fn, originalFn)\r\n        }\r\n\r\n        for (i = types.length; i--;) {\r\n          // add new handler to the registry and check if it's the first for this element/type\r\n          first = registry.put(entry = new RegEntry(\r\n              element\r\n            , types[i].replace(nameRegex, '') // event type\r\n            , fn\r\n            , originalFn\r\n            , str2arr(types[i].replace(namespaceRegex, ''), '.') // namespaces\r\n            , args\r\n            , false // not root\r\n          ))\r\n          if (entry[eventSupport] && first) {\r\n            // first event of this type on this element, add root listener\r\n            listener(element, entry.eventType, true, entry.customType)\r\n          }\r\n        }\r\n\r\n        return element\r\n      }\r\n\r\n      /**\r\n        * add(element[, selector], eventType(s), handler[, args ])\r\n        *\r\n        * Deprecated: kept (for now) for backward-compatibility\r\n        */\r\n    , add = function (element, events, fn, delfn) {\r\n        return on.apply(\r\n            null\r\n          , !isString(fn)\r\n              ? slice.call(arguments)\r\n              : [ element, fn, events, delfn ].concat(arguments.length > 3 ? slice.call(arguments, 5) : [])\r\n        )\r\n      }\r\n\r\n      /**\r\n        * one(element, eventType(s)[, selector], handler[, args ])\r\n        */\r\n    , one = function () {\r\n        return on.apply(ONE, arguments)\r\n      }\r\n\r\n      /**\r\n        * fire(element, eventType(s)[, args ])\r\n        *\r\n        * The optional 'args' argument must be an array, if no 'args' argument is provided\r\n        * then we can use the browser's DOM event system, otherwise we trigger handlers manually\r\n        */\r\n    , fire = function (element, type, args) {\r\n        var types = str2arr(type)\r\n          , i, j, l, names, handlers\r\n\r\n        for (i = types.length; i--;) {\r\n          type = types[i].replace(nameRegex, '')\r\n          if (names = types[i].replace(namespaceRegex, '')) names = str2arr(names, '.')\r\n          if (!names && !args && element[eventSupport]) {\r\n            fireListener(nativeEvents[type], type, element)\r\n          } else {\r\n            // non-native event, either because of a namespace, arguments or a non DOM element\r\n            // iterate over all listeners and manually 'fire'\r\n            handlers = registry.get(element, type, null, false)\r\n            args = [false].concat(args)\r\n            for (j = 0, l = handlers.length; j < l; j++) {\r\n              if (handlers[j].inNamespaces(names)) {\r\n                handlers[j].handler.apply(element, args)\r\n              }\r\n            }\r\n          }\r\n        }\r\n        return element\r\n      }\r\n\r\n      /**\r\n        * clone(dstElement, srcElement[, eventType ])\r\n        *\r\n        * TODO: perhaps for consistency we should allow the same flexibility in type specifiers?\r\n        */\r\n    , clone = function (element, from, type) {\r\n        var handlers = registry.get(from, type, null, false)\r\n          , l = handlers.length\r\n          , i = 0\r\n          , args, beanDel\r\n\r\n        for (; i < l; i++) {\r\n          if (handlers[i].original) {\r\n            args = [ element, handlers[i].type ]\r\n            if (beanDel = handlers[i].handler.__beanDel) args.push(beanDel.selector)\r\n            args.push(handlers[i].original)\r\n            on.apply(null, args)\r\n          }\r\n        }\r\n        return element\r\n      }\r\n\r\n    , bean = {\r\n          'on'                : on\r\n        , 'add'               : add\r\n        , 'one'               : one\r\n        , 'off'               : off\r\n        , 'remove'            : off\r\n        , 'clone'             : clone\r\n        , 'fire'              : fire\r\n        , 'Event'             : Event\r\n        , 'setSelectorEngine' : setSelectorEngine\r\n        , 'noConflict'        : function () {\r\n            context[name] = old\r\n            return this\r\n          }\r\n      }\r\n\r\n  // for IE, clean up on unload to avoid leaks\r\n  if (win.attachEvent) {\r\n    var cleanup = function () {\r\n      var i, entries = registry.entries()\r\n      for (i in entries) {\r\n        if (entries[i].type && entries[i].type !== 'unload') off(entries[i].element, entries[i].type)\r\n      }\r\n      win.detachEvent('onunload', cleanup)\r\n      win.CollectGarbage && win.CollectGarbage()\r\n    }\r\n    win.attachEvent('onunload', cleanup)\r\n  }\r\n\r\n  // initialize selector engine to internal default (qSA or throw Error)\r\n  setSelectorEngine()\r\n\r\n  return bean\r\n});\r\n","export default class Behavior {\r\n  constructor (renderer) {\r\n    this.renderer = renderer\r\n  }\r\n\r\n  destroy () {\r\n    delete this.renderer\r\n  }\r\n}\r\n","/**\r\n * Created by tong on 6/28/2016.\r\n */\r\nimport Behavior from './Behavior'\r\n\r\n/**\r\n * Graph handler handles Panning and Zoom and rubber band selection\r\n */\r\nclass GraphBehavior extends Behavior {\r\n  constructor (renderer) {\r\n    super(renderer)\r\n    let dispatcher = renderer.dispatcher\r\n    // TODO:\r\n    // let f = function(type, ns, graph, pos, event) {\r\n    // \t//Cursor.updateCursor(type, ns, graph, event);\r\n    // };\r\n    dispatcher.register(/^drag.*\\.graph$/, this.handleDrag, this)\r\n    dispatcher.register(/^zoom/, this.handleZoom, this)\r\n    // dispatcher.register(['mousedown.graph', 'mouseenter.graph', 'mouseleave.graph'], f);\r\n    this.offset = null\r\n  }\r\n\r\n  handleZoom (type, ns, graph, pos, event) {\r\n    this.renderer.transform(null, null, event.scale)\r\n  }\r\n\r\n  handleDrag (type, ns, graph, pos, event) {\r\n    if (type == 'dragstart') {\r\n      let pan = (this.renderer.prop('defaultClickMode') == 'pan') ^ (event.ctrlKey || event.shiftKey)\r\n      if (!pan) return\r\n      let t = this.renderer.translate\r\n      this.offset = [t[0] - pos[0], t[1] - pos[1]]\r\n      return\r\n    }\r\n    if (!this.offset) return\r\n    this.renderer.transform(pos[0] + this.offset[0], pos[1] + this.offset[1])\r\n    if (type == 'dragend') {\r\n      // Cursor.updateCursor('mouseup', ns, graph, event);\r\n      delete this.offset\r\n    }\r\n  }\r\n}\r\n\r\nexport default GraphBehavior\r\n","import Rectangle from '../geometry/Rectangle'\r\nimport Cell from '../graph/Cell'\r\nimport Behavior from './Behavior'\r\n\r\nclass SelectionBehavior extends Behavior {\r\n  constructor (renderer) {\r\n    super(renderer)\r\n    let dispatcher = renderer.dispatcher\r\n    dispatcher.register('mousedown.*', this.selectCell, this)\r\n    dispatcher.register('mouseup.*', this.unselectCell, this)\r\n    dispatcher.register('drag*.graph', this.handleMultiSelect, this)\r\n    // graph.on(Graph.EVENT_TYPES.SELECTION_CHANGE, this.updateSelections, this)\r\n    this.selectedNodes = null\r\n    this.selectedLinks = null\r\n    this.attachedLinks = null\r\n  }\r\n\r\n  updateSelections () {\r\n    if (this.selectedNodes) {\r\n      this.selectedNodes.classed('selected', false)\r\n    }\r\n    if (this.selectedLinks) {\r\n      this.selectedLinks.classed('selected', false)\r\n    }\r\n\r\n    this.selectedNodes = null\r\n    this.selectedLinks = null\r\n    this.attachedLinks = null\r\n\r\n    if (this.graph.selectedVertices && this.graph.selectedVertices.length > 0) {\r\n      this.selectedNodes = this.graph.renderer.getShapes(this.graph.selectedVertices)\r\n      this.attachedLinks = this.graph.renderer.getShapes(this.graph.getAttachedEdges())\r\n      this.selectedNodes.classed('selected', true)\r\n    }\r\n\r\n    if (this.graph.selectedEdges && this.graph.selectedEdges.length > 0) {\r\n      this.selectedLinks = this.graph.renderer.getShapes(this.graph.selectedEdges)\r\n      this.selectedLinks.classed('selected', true)\r\n    }\r\n  }\r\n\r\n  selectCell (type, ns, data, pos, event) {\r\n    var cell = data === this.graph ? null : data\r\n    if (cell && !(cell instanceof Cell)) return\r\n    var toggle = event.ctrlKey || event.shiftKey\r\n    if (cell && (cell instanceof Cell)) {\r\n      if (!this.graph.isSelected(cell)) {\r\n        delete cell._firstSelection\r\n      } else {\r\n        cell._firstSelection = true\r\n      }\r\n\r\n      d3.select(event.dataTarget).moveToFront()\r\n      this.graph.setSelection(cell, toggle)\r\n    }\r\n  }\r\n\r\n  unselectCell (type, ns, data, pos, event) {\r\n    var cell = data === this.graph ? null : data\r\n    if (cell && !(cell instanceof Cell)) return\r\n    var ctrlKey = event.ctrlKey || event.shiftKey\r\n    if (!cell) {\r\n      this.graph.setSelection(cell, ctrlKey)\r\n    }\r\n  }\r\n\r\n  handleMultiSelect (type, ns, data, pos, event) {\r\n    pos = util.scale(this.graph, pos)\r\n\r\n    if (type === 'dragstart') {\r\n      var select = (this.graph.getProperty('defaultClickMode') == 'select') ^ (event.ctrlKey || event.shiftKey)\r\n      if (!select) return\r\n      this.startPt = new Point(pos[0], pos[1])\r\n      return\r\n    }\r\n    if (!this.startPt) return\r\n    var rect = Rectangle.getBoundingRectangle([new Point(pos[0], pos[1]), this.startPt])\r\n    var renderer = this.graph.renderer\r\n    if (!this.rubberband) {\r\n      this.rubberband = d3.select(renderer.appendNode(renderer.getCellLayer(), {\r\n        template: _.template('<g><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" stroke=\"#000000\" fill=\"none\" stroke-dasharray=\"3 3\"/></g>')\r\n      }, false))\r\n    }\r\n    if (type == 'dragend') {\r\n      var cells = this.graph.getCurrentRoot().children\r\n      // TODO: Define if we want to select vertexes / edges or both\r\n      cells = _.filter(cells, function (cell) {\r\n        var box = cell.getBounds()\r\n        if (rect.contains(box)) {\r\n          return true\r\n        }\r\n        return false\r\n      })\r\n      // TODO: Set selection\r\n      this.graph.setSelection(cells, event.ctrlKey)\r\n\r\n      this.rubberband.remove()\r\n      delete this.startPt\r\n      delete this.rubberband\r\n      return\r\n    }\r\n    this.rubberband.select('rect').attr({ x: rect.x, y: rect.y, width: rect.width, height: rect.height })\r\n  }\r\n\r\n  destroy () {\r\n    super.destroy()\r\n    delete this.selectedNodes\r\n    delete this.selectedLinks\r\n    delete this.attachedLinks\r\n  }\r\n}\r\n\r\nexport default SelectionBehavior\r\n","import _ from 'lodash'\r\nimport Events from '../../lib/bean'\r\nimport * as KeyUtils from './key-utils'\r\nimport DomUtils from '../util/dom-utils'\r\nimport StringBuffer from '../util/string-buffer'\r\n// import Utils from '../util/Utils'\r\n\r\nconst DEFAULTS = {\r\n  stopPropagation: false\r\n}\r\n\r\nconst win = typeof window !== 'undefined' ? window : { addEventHandler: function () {} }\r\nconst doc = typeof document !== 'undefined' ? document : {}\r\n\r\n/**\r\n * The EventDispatcher is the central event management. It will monitor all events and translate it into the a higher\r\n * level events for consumption.\r\n */\r\nexport default class EventDispatcher {\r\n  /**\r\n   * Constructor\r\n   * @param root the root element that the manager will listen to.\r\n   * @param zoomScale\r\n   * @param config the configuraton for the event dispatcher.\r\n   */\r\n  constructor (root, zoomScale = [0, Infinity], config = {}) {\r\n    this.root = root\r\n    this.rootNS = root.getAttribute('ns') || 'root'\r\n    this.zoomScale = zoomScale\r\n    Object.assign(this, DEFAULTS, config)\r\n    this.scale = 1.0\r\n    this.listeners = {}\r\n    this.dragging = false\r\n    this.handler = (event) => { this.handleEvent(event) }\r\n    this.started = false\r\n\r\n    // Simulate mouseenter/mouseleave events\r\n    this.enterStack = []\r\n  }\r\n\r\n  /**\r\n   * Start listening for events.\r\n   */\r\n  start () {\r\n    if (this.started) return\r\n    Events.on(this.root, 'mousedown mouseover mouseout mouseenter mouseleave dblclick click contextmenu mousewheel', this.handler)\r\n    this.startKeys()\r\n    this.started = true\r\n  }\r\n\r\n  /**\r\n   * Stop listening for events.\r\n   */\r\n  stop () {\r\n    if (!this.started) return\r\n    Events.off(this.root, 'mousedown mouseover mouseout mouseenter mouseleave dblclick click contextmenu mousewheel', this.handler)\r\n    this.stopKeys()\r\n    this.started = false\r\n  }\r\n\r\n  startKeys () {\r\n    Events.on(doc, 'keydown keyup', this.handler)\r\n  }\r\n\r\n  stopKeys () {\r\n    Events.off(doc, 'keydown keyup', this.handler)\r\n  }\r\n\r\n  zoomIn () {\r\n    this.scale *= 1.25\r\n    this.scale = Math.max(Math.min(this.zoomScale[1], this.scale), this.zoomScale[0])\r\n    return this.scale\r\n  }\r\n\r\n  zoomOut () {\r\n    this.scale *= 0.8\r\n    this.scale = Math.max(Math.min(this.zoomScale[1], this.scale), this.zoomScale[0])\r\n    return this.scale\r\n  }\r\n\r\n  getEventInfo (event) {\r\n    let target = event.target\r\n    const buf = new StringBuffer()\r\n    let ns\r\n    const stack = []\r\n    let isRoot = false\r\n    while (!isRoot && target && target !== doc) {\r\n      ns = target.getAttribute('ns')\r\n      if (ns) {\r\n        isRoot = ns.startsWith('root.')\r\n        if (isRoot) {\r\n          ns = ns.substring(5)\r\n          event.rootTarget = target\r\n        }\r\n        if (!event.nsTarget) event.nsTarget = target\r\n        stack.splice(0, 0, target)\r\n        buf.prepend(ns)\r\n      }\r\n      target = target.parentNode\r\n    }\r\n    if (!isRoot) {\r\n      event.rootTarget = event.nsTarget\r\n    }\r\n\r\n    // target stack is a stack of all the ns targets up to the one with the data binding.\r\n    event.targetStack = stack\r\n    ns = buf.toString('.')\r\n    if (ns === '') ns = this.rootNS\r\n    return { data: event.rootTarget, ns: ns }\r\n  }\r\n\r\n  /**\r\n   * The main event handler method, it processes event and generate relevant events to dispatch.\r\n   */\r\n  handleEvent (event) {\r\n    let type = event.type\r\n\r\n    // Do not dispatch other events if we are dragging.\r\n    if (this.dragging || DomUtils.eventFromInput(event)) return\r\n\r\n    let data\r\n    let ns\r\n    const pos = this.getPosition(event)\r\n    let info\r\n    const isKeyEvent = (type === 'keydown' || type === 'keyup')\r\n    if (isKeyEvent) {\r\n      data = this.root\r\n      ns = KeyUtils.getKeyEvent(event)\r\n    } else {\r\n      info = this.getEventInfo(event)\r\n      if (!info) return\r\n      data = info.data\r\n      ns = info.ns\r\n    }\r\n\r\n    // Utils.log('EventDispatcher', \"handleEvent - \" + type + ';ns=' + ns)\r\n\r\n    if (type === 'mousewheel') {\r\n      this.scale *= Math.pow(2, event.wheelDelta * 0.002)\r\n      this.scale = Math.max(Math.min(this.zoomScale[1], this.scale), this.zoomScale[0])\r\n      event.scale = this.scale\r\n      type = 'zoom'\r\n    }\r\n\r\n    // See if we should create drag events\r\n    if (type === 'mousedown' && event.button === 0 /* only drag on left click */) {\r\n      // Create drag object.\r\n      const dragObject = { data: data, pos: ns === 'root' ? EventDispatcher.mouse(this.root, event) : pos }\r\n      this.dragging = false\r\n      // Start listening for mouse move.\r\n      let dragPos\r\n\r\n      const mousemove = (event) => {\r\n        let currentPos = this.getPosition(event)\r\n        if (!this.dragging) {\r\n          // check if the mouse has moved. IE always fire mousemove after mousedown even if the mouse hasn't moved yet.\r\n          if (dragObject.pos[0] === currentPos[0] && dragObject.pos[1] === currentPos[1]) return\r\n\r\n          // start dragging\r\n          this.dragging = true\r\n          event.rootTarget = dragObject.data\r\n          this.dispatch(event, 'dragstart', ns, dragObject.data, dragObject.pos)\r\n        }\r\n        if (ns === 'root') {\r\n          dragPos = EventDispatcher.mouse(this.root, event)\r\n        } else {\r\n          dragPos = currentPos\r\n        }\r\n        this.getEventInfo(event)\r\n        this.dispatch(event, 'drag', ns, dragObject.data, dragPos)\r\n      }\r\n      const mouseup = (event) => {\r\n        if (ns === 'root') {\r\n          dragPos = EventDispatcher.mouse(this.root, event)\r\n        } else {\r\n          dragPos = this.getPosition(event)\r\n        }\r\n\r\n        let info = this.getEventInfo(event)\r\n        if (this.dragging) {\r\n          this.dragging = false\r\n          this.dispatch(event, 'dragend', ns, dragObject.data, dragPos)\r\n        } else {\r\n          this.dispatch(event, 'mouseup', ns, info.data, dragPos)\r\n        }\r\n\r\n        Events.off(win, 'mousemove', mousemove)\r\n        Events.off(win, 'mouseup', mouseup)\r\n      }\r\n      event.preventDefault()\r\n      Events.on(win, 'mousemove', mousemove)\r\n      Events.on(win, 'mouseup', mouseup)\r\n    }\r\n\r\n    if (!isKeyEvent) {\r\n      this.simulateEnterLeave(event, type, ns, data, pos)\r\n    }\r\n    this.dispatch(event, type, ns, data, pos)\r\n\r\n    // disable the default context menu\r\n    // if (type == 'contextmenu')\r\n    // event.preventDefault()\r\n  }\r\n\r\n  /**\r\n   * try to simulate mouseenter/mouseleave events.\r\n   */\r\n  simulateEnterLeave (event, type, ns, data, pos) {\r\n    let last, stack\r\n    const clearEnterStack = (k) => {\r\n      k = k || 0\r\n      // Clear off the enter stack.\r\n      while (this.enterStack.length >= k + 1) {\r\n        last = this.enterStack.pop()\r\n        this.dispatch(event, 'mouseleave', last.ns, last.data, pos)\r\n      }\r\n    }\r\n    const getNS = function (index) {\r\n      let buf = new StringBuffer()\r\n      for (let i = 0; i <= index; i++) {\r\n        let val = stack[i].getAttribute('ns')\r\n        if (val.startsWith('root.')) {\r\n          val = val.substring(5)\r\n        }\r\n        buf.append(val)\r\n      }\r\n      return buf.toString('.')\r\n    }\r\n\r\n    if (ns && ns !== this.rootNS) {\r\n      if (type === 'mouseover') {\r\n        stack = event.targetStack\r\n        let item\r\n        for (let i = 0; i < stack.length; i++) {\r\n          if (i < this.enterStack.length) {\r\n            if (this.enterStack[i].target !== stack[i]) {\r\n              clearEnterStack(i)\r\n            } else {\r\n              continue\r\n            }\r\n          }\r\n          item = { data: data, ns: getNS(i), target: stack[i] }\r\n          this.enterStack.push(item)\r\n          this.dispatch(event, 'mouseenter', item.ns, data, pos)\r\n        }\r\n        if (stack.length < this.enterStack.length) {\r\n          clearEnterStack(stack.length)\r\n        }\r\n      }\r\n    }\r\n    if (ns === this.rootNS && this.enterStack.length > 0) {\r\n      clearEnterStack()\r\n    }\r\n  }\r\n\r\n  dispatch (event, type, ns, data, pos) {\r\n    // if (type !== 'mouseover' && type !== 'mouseout') {\r\n    //   console.log('EventDispatcher', 'dispatch - ' + type + '.' + ns + ';' + pos + ';rootTarget=' + event.rootTarget + ';data=' + data)\r\n    // }\r\n    if (!this.started) return\r\n    const nsType = ns ? type + '.' + ns : type\r\n    _.forEach(this.listeners, (listeners, key) => {\r\n      if (EventDispatcher.match(nsType, listeners.regexp ? listeners.regexp : key)) {\r\n        _.forEach(listeners, (listener) => {\r\n          if (!listener.context) {\r\n            listener.callback.apply(window, [type, ns, data, pos, event])\r\n          } else {\r\n            listener.callback.apply(listener.context, [type, ns, data, pos, event])\r\n          }\r\n        })\r\n      }\r\n    })\r\n\r\n    // after dispatching, do not propagate.\r\n    if (this.stopPropagation && event.stopPropagation) {\r\n      event.stopPropagation()\r\n    }\r\n  }\r\n\r\n  getPosition (event) {\r\n    const pos = EventDispatcher.mouse(this.root, event)\r\n    if (!_.isNaN(pos[0]) && !_.isNaN(pos[1])) {\r\n      this.lastPosition = pos\r\n    }\r\n    return this.lastPosition\r\n  }\r\n\r\n  /**\r\n   * Registers a key event handler\r\n   * // Key is object {ctrl, alt, shift, meta, code}\r\n   */\r\n  registerKey (type, key, callback, context) {\r\n    if (Array.isArray(key)) {\r\n      key.forEach(k => {\r\n        this.registerKey(type, k, callback, context)\r\n      })\r\n      return\r\n    }\r\n    key = KeyUtils.getKeyData(key.ctrl, key.alt, key.shift, key.meta, key.code)\r\n    if (!key.length) return\r\n    key = new StringBuffer(type).append(key).toString('.')\r\n    const listener = { callback, context }\r\n    this.listeners[key] || (this.listeners[key] = [])\r\n    this.listeners[key].push(listener)\r\n  }\r\n\r\n  unregisterKey (type, key, callback, context) {\r\n    if (Array.isArray(key)) {\r\n      key.forEach(k => {\r\n        this.unregisterKey(type, k, callback, context)\r\n      })\r\n      return\r\n    }\r\n    key = KeyUtils.getKeyData(key.ctrl, key.alt, key.shift, key.meta, key.code)\r\n    if (!key.length) return\r\n    key = new StringBuffer(type).append(key).toString('.')\r\n\r\n    let listeners = this.listeners[key]; let listener\r\n    if (!listeners) return\r\n    for (let i = 0; i < listeners.length; i++) {\r\n      listener = listeners[i]\r\n      if (listener.callback === callback && (!context || context === listener.context)) {\r\n        listeners.splice(i, 1)\r\n        return\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Registers an event handler\r\n   */\r\n  register (type, callback, context, zIndex) {\r\n    if (Array.isArray(type)) {\r\n      type.forEach(t => {\r\n        this.register(t, callback, context, zIndex)\r\n      })\r\n      return\r\n    }\r\n    const listener = { callback: callback, context: context, zIndex: zIndex }\r\n    let regexp = null\r\n    if (type instanceof RegExp) {\r\n      regexp = type\r\n      type = type + ''\r\n    }\r\n    this.listeners[type] || (this.listeners[type] = [])\r\n    if (regexp && !this.listeners[type].regexp) {\r\n      this.listeners[type].regexp = regexp\r\n    }\r\n    this.listeners[type].push(listener)\r\n  }\r\n\r\n  unregister (type, callback, context) {\r\n    if (type instanceof RegExp) {\r\n      type = type + ''\r\n    }\r\n    let listeners = this.listeners[type]; let listener\r\n    if (!listeners) return\r\n    for (let i = 0; i < listeners.length; i++) {\r\n      listener = listeners[i]\r\n      if (listener.callback === callback && (!context || context === listener.context)) {\r\n        listeners.splice(i, 1)\r\n        return\r\n      }\r\n    }\r\n  }\r\n\r\n  destroy () {\r\n    this.stop()\r\n    delete this.root\r\n    delete this.listeners\r\n    delete this.enterStack\r\n  }\r\n\r\n  /**\r\n   * Check if the registered event type matches the real event type. \"*\" is allowed as a wild card.\r\n   */\r\n  static match (nsType, registeredType) {\r\n    if (registeredType instanceof RegExp) {\r\n      return nsType.match(registeredType)\r\n    }\r\n\r\n    return nsType === registeredType\r\n    /* const arr = registeredType.split('*');\r\n    if (arr.length == 1)\r\n      return nsType == registeredType;\r\n\r\n    let substr, index = 0;\r\n    for (let i = 0; i < arr.length; i++) {\r\n      if (arr[i].length == 0) continue;\r\n      substr = nsType.slice(index);\r\n      index = substr.indexOf(arr[i]);\r\n      if (index < 0)\r\n        return false;\r\n      index += arr[i].length;\r\n    }\r\n    return true; */\r\n  }\r\n\r\n  static mouse (container, e) {\r\n    if (e.changedTouches) e = e.changedTouches[0]\r\n    let svg = container.ownerSVGElement || container\r\n    if (svg.createSVGPoint) {\r\n      let point = svg.createSVGPoint()\r\n      point.x = e.clientX; point.y = e.clientY\r\n      point = point.matrixTransform(container.getScreenCTM().inverse())\r\n      return [point.x, point.y]\r\n    }\r\n    let rect = container.getBoundingClientRect()\r\n    return [e.clientX - rect.left - container.clientLeft, e.clientY - rect.top - container.clientTop]\r\n  }\r\n}\r\n","\r\n// The Key Utility CLass for the Event Dispatcher\r\nimport StringBuffer from '../util/string-buffer'\r\n\r\n/**\r\n * KEY constant\r\n */\r\nexport const KEY = {\r\n  ALT: 18,\r\n  BACK_SPACE: 8,\r\n  CAPS_LOCK: 20,\r\n  CONTROL: 17,\r\n  DELETE: 46,\r\n  DOWN: 40,\r\n  END: 35,\r\n  ENTER: 13,\r\n  ESCAPE: 220,\r\n  HOME: 36,\r\n  LEFT: 37,\r\n  META: 224,\r\n  NUM_LOCK: 144,\r\n  PAGE_DOWN: 34,\r\n  PAGE_UP: 33,\r\n  PAUSE: 19,\r\n  PRINTSCREEN: 44,\r\n  RIGHT: 39,\r\n  SCROLL_LOCK: 145,\r\n  SHIFT: 16,\r\n  SPACE: 32,\r\n  TAB: 9,\r\n  UP: 38\r\n  // ADD          : DomUtils.isFireFox ? 61  : 187,\r\n  // SUBTRACT     : DomUtils.isFireFox ? 173 : 189\r\n}\r\n\r\nexport function getKeyEvent (event) {\r\n  if (!event) {\r\n    return null\r\n  }\r\n\r\n  let key = event.keyCode || event.which\r\n\r\n  // Need to find a way to avoid this\r\n  if (key >= 16 && key <= 18) {\r\n    key = null\r\n  }\r\n\r\n  return getKeyData(event.ctrlKey, event.altKey, event.shiftKey, event.metaKey, key)\r\n}\r\n\r\nexport function getKeyData (ctrl, alt, shift, meta, key) {\r\n  var buf = new StringBuffer()\r\n\r\n  if (ctrl) buf.append('CTRL')\r\n  if (alt) buf.append('ALT')\r\n  if (shift) buf.append('SHIFT')\r\n  if (meta) buf.append('META')\r\n  if (key) buf.append(key)\r\n\r\n  return buf.toString('.')\r\n}\r\n","import Shape from './Shape'\r\nimport Point from './Point'\r\nimport Rectangle from './Rectangle'\r\n\r\nexport default class Ellipse extends Shape {\r\n  toString () {\r\n    return 'Ellipse:{x=' + this.x + ';y=' + this.y + ';width=' + this.width + ';height=' + this.height + '}'\r\n  }\r\n\r\n  static getPerimeter (rect, pt, orthogonal = false) {\r\n    let a = rect.width / 2\r\n    let b = rect.height / 2\r\n    let cx = rect.x\r\n    let cy = rect.y\r\n    let px = pt.x\r\n    let py = pt.y\r\n\r\n    // Calculates straight line equation through\r\n    // point and ellipse center y = d * x + h\r\n    let dx = parseInt(px - cx)\r\n    let dy = parseInt(py - cy)\r\n\r\n    if (dx === 0 && dy !== 0) {\r\n      return new Point(cx, cy + b * dy / Math.abs(dy))\r\n    } else if (dx === 0 && dy === 0) {\r\n      return new Point(px, py)\r\n    }\r\n\r\n    // Calculates intersection\r\n    let d = dy / dx\r\n    let h = cy - d * cx\r\n    let e = a * a * d * d + b * b\r\n    let f = -2 * cx * e\r\n    let g = a * a * d * d * cx * cx + b * b * cx * cx - a * a * b * b\r\n    let det = Math.sqrt(f * f - 4 * e * g)\r\n\r\n    // Two solutions (perimeter points)\r\n    let xout1 = (-f + det) / (2 * e)\r\n    let xout2 = (-f - det) / (2 * e)\r\n    let yout1 = d * xout1 + h\r\n    let yout2 = d * xout2 + h\r\n    let dist1 = Math.sqrt(Math.pow((xout1 - px), 2) + Math.pow((yout1 - py), 2))\r\n    let dist2 = Math.sqrt(Math.pow((xout2 - px), 2) + Math.pow((yout2 - py), 2))\r\n\r\n    // Correct solution\r\n    let xout = 0\r\n    let yout = 0\r\n\r\n    if (dist1 < dist2) {\r\n      xout = xout1\r\n      yout = yout1\r\n    } else {\r\n      xout = xout2\r\n      yout = yout2\r\n    }\r\n\r\n    let p = new Point(xout, yout)\r\n    let dir = Rectangle.getDirection(rect, p, orthogonal)\r\n    if (orthogonal) {\r\n      if (dir.x === -1) {\r\n        return { point: new Point(cx - a, cy), direction: dir }\r\n      }\r\n      if (dir.x === 1) {\r\n        return { point: new Point(cx + a, cy), direction: dir }\r\n      }\r\n      if (dir.y === -1) {\r\n        return { point: new Point(cx, cy - b), direction: dir }\r\n      }\r\n      if (dir.y === 1) {\r\n        return { point: new Point(cx, cy + b), direction: dir }\r\n      }\r\n    }\r\n    return { point: p, direction: dir }\r\n  }\r\n}\r\n","import Point from './Point'\r\n\r\nexport default class Line {\r\n  constructor (start, end) {\r\n    this.start = start\r\n    this.end = end\r\n  }\r\n\r\n  /**\r\n   * Calculate the length of this line\r\n   */\r\n  length () {\r\n    return this.start.distance(this.end)\r\n  }\r\n\r\n  /**\r\n   * Calculate the distance of this line to the point.\r\n   */\r\n  distance (pt) {\r\n    const x = this.start.distance(pt)\r\n    if (x === 0) return 0\r\n\r\n    const l = this.length()\r\n    const cosa = new Point((this.end.x - this.start.x) / l, (this.end.y - this.start.y) / l).dotProduct(\r\n      new Point(pt.x / x, pt.y / x))\r\n\r\n    return x * Math.sqrt(1 - cosa * cosa)\r\n  }\r\n\r\n  /**\r\n   * Function: intersection\r\n   *\r\n   * Returns the intersection of two lines as an <mxPoint>.\r\n   *\r\n   * Parameters:\r\n   *\r\n   * x0 - X-coordinate of the first line's startpoint.\r\n   * y0 - X-coordinate of the first line's startpoint.\r\n   * x1 - X-coordinate of the first line's endpoint.\r\n   * y1 - Y-coordinate of the first line's endpoint.\r\n   * x2 - X-coordinate of the second line's startpoint.\r\n   * y2 - Y-coordinate of the second line's startpoint.\r\n   * x3 - X-coordinate of the second line's endpoint.\r\n   * y3 - Y-coordinate of the second line's endpoint.\r\n   */\r\n  static intersection (x0, y0, x1, y1, x2, y2, x3, y3) {\r\n    const denom = ((y3 - y2) * (x1 - x0)) - ((x3 - x2) * (y1 - y0))\r\n    const numeA = ((x3 - x2) * (y0 - y2)) - ((y3 - y2) * (x0 - x2))\r\n    const numeB = ((x1 - x0) * (y0 - y2)) - ((y1 - y0) * (x0 - x2))\r\n\r\n    const ua = numeA / denom\r\n    const ub = numeB / denom\r\n\r\n    if (ua >= 0.0 && ua <= 1.0 && ub >= 0.0 && ub <= 1.0) {\r\n      // Get the intersection point\r\n      var intersectionX = x0 + ua * (x1 - x0)\r\n      var intersectionY = y0 + ua * (y1 - y0)\r\n\r\n      return new Point(intersectionX, intersectionY)\r\n    }\r\n\r\n    // No intersection\r\n    return null\r\n  }\r\n\r\n  toString () {\r\n    return 'Line:{start=' + this.start + ';end=' + this.end + '}'\r\n  }\r\n}\r\n","import _ from 'lodash'\r\nimport Point from './Point'\r\nimport Utils from '../util/Utils'\r\n\r\nlet defaultConfig = {\r\n  type: 'direct',\r\n  showGauge: true,\r\n  orthogonal: false\r\n}\r\n\r\nlet defaultGeometry = {\r\n  width: 0,\r\n  height: 0,\r\n  anchorX: 0,\r\n  anchorY: 0,\r\n  offsetX: 0,\r\n  offsetY: 0\r\n}\r\n\r\nlet linkTypes = {}\r\n\r\nclass Link {\r\n  constructor (terminalVisual, shapeConfig = {}, startMarker = null, endMarker = null) {\r\n    this.start = terminalVisual[0].point\r\n    this.end = terminalVisual[1].point\r\n    this.startNormal = terminalVisual[0].direction\r\n    this.endNormal = terminalVisual[1].direction\r\n    this.startMarker = startMarker\r\n    this.endMarker = endMarker\r\n    Object.assign(this, shapeConfig)\r\n  }\r\n\r\n  render (view) {\r\n    return view.renderLink(this)\r\n  }\r\n\r\n  get points () { return null }\r\n  get controlPts () { return null }\r\n  get length () {\r\n    let points = this.points\r\n    let i\r\n    let l = 0\r\n    for (i = 0; i < points.length - 1; i++) {\r\n      l += points[i].distance(points[i + 1])\r\n    }\r\n    return l\r\n  }\r\n\r\n  /**\r\n   * Calculate the position where to put decorators or label..\r\n   *\r\n   * @param geometry: defines how far along the edge should the point be placed.\r\n   * @return *[] the relative position.\r\n   */\r\n  getRelativePosition (geometry) {\r\n    if (_.isNumber(geometry)) {\r\n      geometry = { x: geometry }\r\n    }\r\n    geometry = _.defaults(geometry, defaultGeometry)\r\n    let p = geometry.x\r\n    let l = this.length\r\n    if (Math.abs(p) <= 1) p *= l\r\n    if (p < 0) p = l + p\r\n    if (p > l) p = l\r\n\r\n    let points = this.points\r\n    let d\r\n    let point\r\n    let dir\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n      d = points[i].distance(points[i + 1])\r\n      if (p <= d) {\r\n        // we've located the line segment.\r\n        point = points[i].clone()\r\n        dir = point.getDirection(points[i + 1])\r\n        point.translate(dir.getScaled(p))\r\n        break\r\n      }\r\n      p -= d\r\n    }\r\n\r\n    // return the last point.\r\n    if (!point) {\r\n      point = points[points.length - 1]\r\n    }\r\n    return Utils.offsetPosition([point.x, point.y], geometry)\r\n  }\r\n\r\n  toString () {\r\n    return 'Link'\r\n  }\r\n\r\n  static getLink (terminalVisual, shapeConfig = {}, startMarker = null, endMarker = null) {\r\n    shapeConfig = _.defaultsDeep(shapeConfig, defaultConfig)\r\n    let LinkClass = linkTypes[shapeConfig.type]\r\n    if (LinkClass) {\r\n      return new LinkClass(terminalVisual, shapeConfig, startMarker, endMarker)\r\n    }\r\n    console.log('link type not supported: ' + shapeConfig.type)\r\n    return null\r\n  }\r\n}\r\n\r\nclass DirectLink extends Link {\r\n  get points () {\r\n    return [this.start, this.end]\r\n  }\r\n}\r\n\r\nclass BezierLink extends Link {\r\n  get points () {\r\n    return [this.start, this.end]\r\n  }\r\n\r\n  get controlPts () {\r\n    let s = this.points[0]; let e = this.points[1]\r\n    let pts = []\r\n    pts[0] = null\r\n    pts[1] = []\r\n    if (this.startNormal.x === 0) {\r\n      pts[1][0] = new Point(s.x, (s.y + e.y) / 2)\r\n    } else {\r\n      pts[1][0] = new Point((s.x + e.x) / 2, s.y)\r\n    }\r\n    if (this.endNormal.x === 0) {\r\n      pts[1][1] = new Point(e.x, (s.y + e.y) / 2)\r\n    } else {\r\n      pts[1][1] = new Point((s.x + e.x) / 2, e.y)\r\n    }\r\n    return pts\r\n  }\r\n\r\n  getRelativePosition (geometry) {\r\n    if (_.isNumber(geometry)) {\r\n      geometry = { x: geometry }\r\n    }\r\n    geometry = _.defaults(geometry, defaultGeometry)\r\n    let p = geometry.x\r\n    let l = this.length\r\n    if (Math.abs(p) > 1) p /= l\r\n    if (p < 0) p++\r\n    if (p > 1) p--\r\n\r\n    let pts = this.points\r\n    let ctrlpts = this.controlPts\r\n    let p1 = pts[0]\r\n    let p2 = ctrlpts[1][0]\r\n    let p3 = ctrlpts[1][1]\r\n    let p4 = pts[1]\r\n\r\n    let point = [(1 - p) * (1 - p) * (1 - p) * p1.x + 3 * p * (1 - p) * (1 - p) * p2.x + 3 * p * p * (1 - p) * p3.x + p * p * p * p4.x, (1 - p) * (1 - p) * (1 - p) * p1.y + 3 * p * (1 - p) * (1 - p) * p2.y + 3 * p * p * (1 - p) * p3.y + p * p * p * p4.y]\r\n    return Utils.offsetPosition([point.x, point.y], geometry)\r\n  }\r\n}\r\n\r\nclass EntityRelations extends Link {\r\n  get points () {\r\n    let source = Port.getBounds(edge, true)\r\n    let target = Port.getBounds(edge, false)\r\n    let isSourceLeft = target.right() < source.x\r\n    let isTargetLeft = source.right() < target.x\r\n    let result = []\r\n\r\n    let x0 = (isSourceLeft) ? source.x : source.x + source.width\r\n    let y0 = source.getCenterY()\r\n    result.push(new Point(x0, y0))\r\n\r\n    let xe = (isTargetLeft) ? target.x : target.x + target.width\r\n    let ye = target.getCenterY()\r\n\r\n    let seg = this.segment\r\n\r\n    let dx = (isSourceLeft) ? -seg : seg\r\n    let dep = new Point(x0 + dx, y0)\r\n\r\n    dx = (isTargetLeft) ? -seg : seg\r\n    let arr = new Point(xe + dx, ye)\r\n\r\n    // Adds intermediate points if both go out on same side\r\n    if (isSourceLeft === isTargetLeft) {\r\n      let x = (isSourceLeft) ? Math.min(x0, xe) - seg : Math.max(x0, xe) + seg\r\n\r\n      result.push(new Point(x, y0))\r\n      result.push(new Point(x, ye))\r\n    } else if ((dep.x < arr.x) === isSourceLeft) {\r\n      let midY = y0 + (ye - y0) / 2\r\n\r\n      result.push(dep)\r\n      result.push(new Point(dep.x, midY))\r\n      result.push(new Point(arr.x, midY))\r\n      result.push(arr)\r\n    } else {\r\n      result.push(dep)\r\n      result.push(arr)\r\n    }\r\n\r\n    result.push(new Point(xe, ye))\r\n    return result\r\n  }\r\n}\r\n\r\nclass Manhattan extends Link {\r\n  constructor (terminalVisual, shapeConfig, startMarker, endMarker) {\r\n    shapeConfig = _.defaults(shapeConfig, {\r\n      MIN_BUFFER: 10,\r\n      autoRoute: false,\r\n      randomNoise: 0,\r\n      step: 1,\r\n      maxChannelWidth: 100\r\n    })\r\n    super(terminalVisual, shapeConfig, startMarker, endMarker)\r\n  }\r\n\r\n  get points () {\r\n    let pos = Manhattan.route(this.start, this.end, this.startNormal, this.endNormal, this.MIN_BUFFER)\r\n    if (this.autoRoute) {\r\n      this._mergeSegments(pos)\r\n      let boxes = []\r\n      let node\r\n      let startBox\r\n      let endBox\r\n      let container = edge.source.getCommonAncestor(edge.target)\r\n      let childNodes = container.getDescendants()\r\n      let index = 0\r\n      for (let i = 0; i < childNodes.length; i++) {\r\n        node = childNodes[i]\r\n        // Do not include source or target ancestors in routing.\r\n        if (node.excludeFromRouting(edge) || node.isAncestor(edge.source) || node.isAncestor(edge.target)) continue\r\n        if (node === edge.source) {\r\n          startBox = index\r\n        }\r\n        if (node === edge.target) {\r\n          endBox = index\r\n        }\r\n        boxes.push(node.getBounds(document))\r\n        index++\r\n      }\r\n      if (boxes.length > 1) {\r\n        this.autoRoute(pos, container.getBounds(document), boxes, startBox, endBox)\r\n      }\r\n    }\r\n\r\n    Manhattan._mergeSegments(pos)\r\n    if (this.randomNoise && pos.length > 3) {\r\n      for (let j = 1; j < 2; j++) {\r\n        let range = this.randomNoise / this.step\r\n        let randomNumber = Math.floor(Math.random() * range * 2 - range + 1) * this.step\r\n\r\n        let noise\r\n        if (this.randomNoise && pos.length == 4) {\r\n          if (this.startNormal.x != 0 && this.startNormal.x != this.endNormal.x) {\r\n            if (this.randomNoise <= Math.abs(pos[1].x - pos[0].x - this.startNormal.x * this.MIN_BUFFER)) {\r\n              noise = this.randomNoise\r\n            } else {\r\n              noise = Math.abs(pos[1].x - pos[0].x - this.startNormal.x * this.MIN_BUFFER)\r\n            }\r\n          } else if (this.startNormal.y != 0 && this.startNormal.y != this.endNormal.y) {\r\n            if (this.randomNoise <= Math.abs(pos[1].y - pos[0].y - this.startNormal.y * this.MIN_BUFFER)) {\r\n              noise = this.randomNoise\r\n            } else {\r\n              noise = Math.abs(pos[1].y - pos[0].y - this.startNormal.y * this.MIN_BUFFER)\r\n            }\r\n          } else {\r\n            noise = this.randomNoise\r\n          }\r\n          let range = noise / this.step\r\n          let randomNumber\r\n          if (this.startNormal.x !== this.endNormal.x || this.startNormal.y !== this.endNormal.y) {\r\n            randomNumber = Math.floor(Math.random() * range * 2 - range + 1) * this.step\r\n          } else {\r\n            randomNumber = Math.sign(this.startNormal.x !== 0 ? this.startNormal.x : this.startNormal.y) * Math.floor(Math.random() * range + 1) * this.step\r\n          }\r\n          this._moveSegment2(pos, 1, randomNumber, 1, 1)\r\n        }\r\n        if (this.randomNoise && pos.length > 4) {\r\n          for (let i = 1; i < pos.length - 2; i++) {\r\n            range = this.randomNoise / this.step\r\n            if (i == 1) {\r\n              randomNumber = Math.sign(this.startNormal.x !== 0 ? this.startNormal.x : this.startNormal.y) * Math.floor(Math.random() * range + 1) * this.step\r\n            } else if (i == pos.length - 3) {\r\n              randomNumber = Math.sign(this.endNormal.x !== 0 ? this.endNormal.x : this.endNormal.y) * Math.floor(Math.random() * range + 1) * this.step\r\n            } else {\r\n              randomNumber = Math.floor(Math.random() * range * 2 - range + 1) * this.step\r\n            }\r\n            this._moveSegment2(pos, i, randomNumber, 1, 1)\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return pos\r\n  }\r\n\r\n  // New function for finding route\r\n  static route (start, end, startNormal, endNormal, buffer) {\r\n    let startBuffer = new Point(start.x + startNormal.x * buffer, start.y + startNormal.y * buffer)\r\n    let endBuffer = new Point(end.x + endNormal.x * buffer, end.y + endNormal.y * buffer)\r\n    let startBufferNormal, endBufferNormal\r\n    let pts\r\n    if (startNormal.x !== 0) {\r\n      if ((endBuffer.x - startBuffer.x) / startNormal.x > 0) {\r\n        startBufferNormal = startNormal\r\n      } else {\r\n        startBufferNormal = new Point(0, (endBuffer.y >= startBuffer.y) ? 1 : -1)\r\n      }\r\n    } else {\r\n      if ((endBuffer.y - startBuffer.y) / startNormal.y > 0) {\r\n        startBufferNormal = startNormal\r\n      } else {\r\n        startBufferNormal = new Point((endBuffer.x >= startBuffer.x) ? 1 : -1, 0)\r\n      }\r\n    }\r\n    if (endNormal.x !== 0) {\r\n      if ((startBuffer.x - endBuffer.x) / endNormal.x > 0) {\r\n        endBufferNormal = endNormal\r\n      } else {\r\n        endBufferNormal = new Point(0, (startBuffer.y >= endBuffer.y) ? 1 : -1)\r\n      }\r\n    } else {\r\n      if ((startBuffer.y - endBuffer.y) / endNormal.y > 0) {\r\n        endBufferNormal = endNormal\r\n      } else {\r\n        endBufferNormal = new Point((startBuffer.x >= endBuffer.x) ? 1 : -1, 0)\r\n      }\r\n    }\r\n\r\n    if (startBufferNormal.dotProduct(endBufferNormal) === 0) {\r\n      let middle = (startBufferNormal.x === 0) ? new Point(startBuffer.x, endBuffer.y) : new Point(endBuffer.x, startBuffer.y)\r\n      pts = [start, startBuffer, middle, endBuffer, end]\r\n    } else if (startBufferNormal.dotProduct(endBufferNormal) < 0) {\r\n      if (startBufferNormal.x === 0) {\r\n        pts = [start, startBuffer, new Point(startBuffer.x, (start.y + end.y) / 2), new Point(endBuffer.x, (start.y + end.y) / 2), endBuffer, end]\r\n      } else {\r\n        pts = [start, startBuffer, new Point((start.x + end.x) / 2, startBuffer.y), new Point((start.x + end.x) / 2, endBuffer.y), endBuffer, end]\r\n      }\r\n    } else {\r\n      pts = [start, startBuffer, new Point(startBuffer.x + startBufferNormal.x * buffer, startBuffer.y + startBufferNormal.y * buffer), new Point(endBuffer.x + endBufferNormal.x * buffer, endBuffer.y + endBufferNormal.y * buffer), endBuffer, end]\r\n    }\r\n\r\n    let prunePts = []\r\n    prunePts[0] = pts[0]\r\n    for (let i = 1; i < pts.length - 1; i++) {\r\n      if ((pts[i].x === pts[i - 1].x && pts[i].x === pts[i + 1].x) || (pts[i].y === pts[i - 1].y && pts[i].y === pts[i + 1].y)) {\r\n        continue\r\n      }\r\n      prunePts.push(pts[i])\r\n    }\r\n    prunePts.push(pts[pts.length - 1])\r\n    return prunePts\r\n  }\r\n\r\n  /**\r\n  * Automatically route the connection to avoid intersections with other vertices.\r\n  */\r\n  autoRoute (pts, container, boxes, startBox, endBox) {\r\n    let side, side2, d, box, intersect, j\r\n    let channel, channel2, pt, dir\r\n\r\n    let startPadding = 0; let endPadding\r\n    // first get the start and end channel\r\n    box = boxes[endBox]\r\n    pt = pts[pts.length - 2]\r\n    if (pt.y < box.y) {\r\n      side = 1\r\n    } else if (pt.y > box.y + box.height) {\r\n      side = 3\r\n    } else if (pt.x < box.x) {\r\n      side = 0\r\n    } else {\r\n      side = 2\r\n    }\r\n    channel = _getChannel(container, endBox, boxes, side)\r\n    endPadding = channel.horizontal ? (channel.right - channel.left) / 2 : (channel.bottom - channel.top) / 2\r\n\r\n    for (let i = 0; i < pts.length - 1; i++) {\r\n      if (pts[i + 1].x === pts[i].x && pts[i + 1].y === pts[i].y) continue\r\n      intersect = _getFirstIntersection(pts, i, boxes, startBox, endBox)\r\n      if (!intersect) continue\r\n      j = intersect[0]\r\n      side = intersect[1]\r\n      box = boxes[j]\r\n      channel = _getChannel(container, j, boxes, side)\r\n      switch (side) {\r\n        case 0:\r\n        case 2:\r\n          pt = new Point((channel.right + channel.left) / 2, pts[i].y)\r\n          dir = _getRouteTendency(pts, i, pt, box, side)\r\n          side2 = dir < 0 ? 1 : 3\r\n          channel2 = _getChannel(container, j, boxes, side2)\r\n          // if the previous point is in the channel2, use that point instead of center of the channel.\r\n          if (i > 1 && (pts[i - 2].y === pts[i - 1].y) && (pts[i - 1].y > channel2.top && pts[i - 1].y < channel2.bottom)) {\r\n            d = pts[i - 1].y - pt.y\r\n          } else if (i < pts.length - 3 && (pts[i + 2].y === pts[i + 3].y) && (pts[i + 2].y > channel2.top && pts[i + 2].y < channel2.bottom)) {\r\n            d = pts[i + 2].y - pt.y\r\n          } else {\r\n            d = (channel2.bottom + channel2.top) / 2 - pt.y\r\n          }\r\n          // check if we need this pt.\r\n          if ((side === 0 && pt.x <= pts[i].x) || (side === 2 && pt.x >= pts[i].x)) {\r\n            pt = null\r\n          } else if (i > 0) {\r\n            // see if we can push the line out to where we started.\r\n            if (!_hasIntersection([new Point(pts[i].x, pts[i].y), new Point(pts[i].x, pts[i].y + d), new Point(pt.x, pt.y + d)], boxes)) {\r\n              pt = null\r\n            }\r\n          }\r\n          break\r\n        case 1:\r\n        case 3:\r\n          pt = new Point(pts[i].x, (channel.bottom + channel.top) / 2)\r\n          dir = _getRouteTendency(pts, i, pt, box, side)\r\n          side2 = dir < 0 ? 0 : 2\r\n          channel2 = _getChannel(container, j, boxes, side2)\r\n          // if the previous point is in the channel2, use that point instead of center of the channel.\r\n          if (i > 1 && (pts[i - 2].x === pts[i - 1].x) && (pts[i - 1].x > channel2.left && pts[i - 1].x < channel2.right)) {\r\n            d = pts[i - 1].x - pt.x\r\n          } else if (i < pts.length - 3 && (pts[i + 2].x === pts[i + 3].x) && (pts[i + 2].x > channel2.left && pts[i + 2].x < channel2.right)) {\r\n            d = pts[i + 2].x - pt.x\r\n          } else {\r\n            d = (channel2.right + channel2.left) / 2 - pt.x\r\n          }\r\n          // check if we need this pt.\r\n          if ((side === 1 && pt.y <= pts[i].y) || (side === 3 && pt.y >= pts[i].y)) {\r\n            pt = null\r\n          } else if (i > 0) {\r\n            // see if we can push the line out to where we started.\r\n            if (!_hasIntersection([new Point(pts[i].x, pts[i].y), new Point(pts[i].x + d, pts[i].y), new Point(pt.x + d, pt.y)], boxes)) {\r\n              pt = null\r\n            }\r\n          }\r\n          break\r\n        case 4:\r\n          continue\r\n      }\r\n      // max points.\r\n      if (i > 20) return\r\n      if (pt && (pt.x !== pts[i].x || pt.y !== pts[i].y)) {\r\n        pts.splice(i + 1, 0, pt)\r\n        _moveSegment(pts, i + 1, d, startPadding, endPadding)\r\n        i++\r\n      } else {\r\n        _moveSegment(pts, i, d, startPadding, endPadding)\r\n      }\r\n    }\r\n  }\r\n\r\n  static _hasIntersection (pts, boxes) {\r\n    for (let i = 0; i < pts.length - 1; i++) {\r\n      for (let j = 0; j < boxes.length; j++) {\r\n        if (boxes[j].detectIntersection(pts[i], pts[i + 1]) >= 0) {\r\n          return true\r\n        }\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  static _getFirstIntersection (pts, i, boxes, startBox, endBox) {\r\n    let box\r\n    let side\r\n    let savedIndex = null\r\n    let savedSide = null\r\n    for (let j = 0; j < boxes.length; j++) {\r\n      if ((i === 0 && j === startBox) || (i === pts.length - 2 && j === endBox)) {\r\n        continue\r\n      }\r\n      box = boxes[j]\r\n      side = box.detectIntersection(pts[i], pts[i + 1])\r\n      if (side >= 0) {\r\n        if (savedIndex == null) {\r\n          savedIndex = j\r\n          savedSide = side\r\n        } else {\r\n          if (boxes[savedIndex].distance(pts[i]) > box.distance(pts[i])) {\r\n            savedIndex = j\r\n            savedSide = side\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (savedIndex != null) {\r\n      return [savedIndex, savedSide]\r\n    }\r\n    return null\r\n  }\r\n\r\n  _getRouteTendency (pts, i, breakPt, box, side) {\r\n    let dir\r\n    let p\r\n    switch (side) {\r\n      case 0:\r\n      case 2:\r\n        p = 'y'\r\n        break\r\n      case 1:\r\n      case 3:\r\n        p = 'x'\r\n        break\r\n    }\r\n    // first try the breakpt.\r\n    dir = _getRouteDirection(breakPt, pts[pts.length - 1])[p]\r\n    if (dir === 0) {\r\n      dir = -_getRouteDirection(pts[0], pts[pts.length - 1])[p]\r\n      if (dir === 0) {\r\n        if (breakPt[p] < box.getCenter()[p]) {\r\n          dir = -1\r\n        } else {\r\n          dir = 1\r\n        }\r\n      }\r\n    }\r\n    return dir\r\n  }\r\n\r\n  static _getRouteDirection (pt1, pt2) {\r\n    if (pt1.x === pt2.x) {\r\n      if (pt1.y < pt2.y) return Point.S\r\n      return Point.N\r\n    } else if (pt1.y === pt2.y) {\r\n      if (pt1.x < pt2.x) return Point.E\r\n      return Point.W\r\n    } else if (pt1.x < pt2.x) {\r\n      if (pt1.y < pt2.y) return Point.SE\r\n      return Point.NE\r\n    } else {\r\n      if (pt1.y < pt2.y) return Point.SW\r\n      return Point.NW\r\n    }\r\n  }\r\n\r\n  _getChannel (container, index, boxes, side) {\r\n    let maxChannelWidth = this.maxChannelWidth\r\n    let box1 = boxes[index]; let box2\r\n    let pt, i\r\n    let channel = {}; let l; let t; let b; let r\r\n    switch (side) {\r\n      case 0:\r\n        pt = box1.getLeft()\r\n        channel.right = pt.x\r\n        channel.horizontal = false\r\n        for (i = 0; i < boxes.length; i++) {\r\n          if (i === index) continue\r\n          r = boxes[i].getRight().x\r\n          if (r >= pt.x) continue\r\n          if (!channel.left || channel.left < r) {\r\n            channel.left = r\r\n          }\r\n        }\r\n        if (!channel.left) {\r\n          channel.left = container.getLeft().x\r\n          if (channel.right - channel.left > maxChannelWidth) {\r\n            channel.left = channel.right - maxChannelWidth\r\n          }\r\n        }\r\n        for (i = 0; i < boxes.length; i++) {\r\n          if (i === index) continue\r\n          box2 = boxes[i]\r\n          b = box2.getBottom().y\r\n          t = box2.getTop().y\r\n          if (b < pt.y && (box2.getRight() > channel.left && box2.getLeft() < channel.right)) {\r\n            if (!channel.top || channel.top < b) {\r\n              channel.top = b\r\n            }\r\n          }\r\n          if (t > pt.y && (box2.getRight() > channel.left && box2.getLeft() < channel.right)) {\r\n            if (!channel.bottom || channel.bottom > t) {\r\n              channel.bottom = t\r\n            }\r\n          }\r\n        }\r\n        if (!channel.top) channel.top = container.getTop().y\r\n        if (!channel.bottom) channel.bottom = container.getBottom().y\r\n        break\r\n      case 1:\r\n        pt = box1.getTop()\r\n        channel.horizontal = true\r\n        channel.bottom = pt.y\r\n        for (i = 0; i < boxes.length; i++) {\r\n          if (i === index) continue\r\n          b = boxes[i].getBottom().y\r\n          if (b >= pt.y) continue\r\n          if (!channel.top || channel.top < b) {\r\n            channel.top = b\r\n          }\r\n        }\r\n        if (!channel.top) {\r\n          channel.top = container.getTop().y\r\n          if (channel.bottom - channel.top > maxChannelWidth) {\r\n            channel.top = channel.bottom - maxChannelWidth\r\n          }\r\n        }\r\n        for (i = 0; i < boxes.length; i++) {\r\n          if (i === index) continue\r\n          box2 = boxes[i]\r\n          l = box2.getLeft().x\r\n          r = box2.getRight().x\r\n          if (r < pt.x && (box2.getBottom() > channel.top && box2.getTop() < channel.bottom)) {\r\n            if (!channel.left || channel.left < r) {\r\n              channel.left = r\r\n            }\r\n          }\r\n          if (l > pt.x && (box2.getBottom() > channel.top && box2.getTop() < channel.bottom)) {\r\n            if (!channel.right || channel.right > l) {\r\n              channel.right = l\r\n            }\r\n          }\r\n        }\r\n        if (!channel.left) channel.left = container.getLeft().x\r\n        if (!channel.right) channel.right = container.getRight().x\r\n\r\n        break\r\n      case 2:\r\n        pt = box1.getRight()\r\n        channel.horizontal = false\r\n        channel.left = pt.x\r\n        for (i = 0; i < boxes.length; i++) {\r\n          if (i === index) continue\r\n          l = boxes[i].getLeft().x\r\n          if (l <= pt.x) continue\r\n          if (!channel.right || channel.right > l) {\r\n            channel.right = l\r\n          }\r\n        }\r\n        if (!channel.right) {\r\n          channel.right = container.getRight().x\r\n          if (channel.right - channel.left > maxChannelWidth) {\r\n            channel.right = channel.left + maxChannelWidth\r\n          }\r\n        }\r\n        for (i = 0; i < boxes.length; i++) {\r\n          if (i === index) continue\r\n          box2 = boxes[i]\r\n          b = box2.getBottom().y\r\n          t = box2.getTop().y\r\n          if (b < pt.y && (box2.getRight() > channel.left && box2.getLeft() < channel.right)) {\r\n            if (!channel.top || channel.top < b) {\r\n              channel.top = b\r\n            }\r\n          }\r\n          if (t > pt.y && (box2.getRight() > channel.left && box2.getLeft() < channel.right)) {\r\n            if (!channel.bottom || channel.bottom > t) {\r\n              channel.bottom = t\r\n            }\r\n          }\r\n        }\r\n        if (!channel.top) channel.top = container.getTop().y\r\n        if (!channel.bottom) channel.bottom = container.getBottom().y\r\n        break\r\n      case 3:\r\n        pt = box1.getBottom()\r\n        channel.horizontal = true\r\n        channel.top = pt.y\r\n        for (i = 0; i < boxes.length; i++) {\r\n          if (i === index) continue\r\n          box2 = boxes[i]\r\n          if (box2.getTop().y <= pt.y) continue\r\n          if (!channel.bottom || channel.bottom > box2.getTop().y) {\r\n            channel.bottom = box2.getTop().y\r\n          }\r\n        }\r\n        if (!channel.bottom) {\r\n          channel.bottom = container.getBottom().y\r\n          if (channel.bottom - channel.top > maxChannelWidth) {\r\n            channel.bottom = channel.top + maxChannelWidth\r\n          }\r\n        }\r\n        for (i = 0; i < boxes.length; i++) {\r\n          if (i === index) continue\r\n          box2 = boxes[i]\r\n          l = box2.getLeft().x\r\n          r = box2.getRight().x\r\n          if (r < pt.x && (box2.getBottom() > channel.top && box2.getTop() < channel.bottom)) {\r\n            if (!channel.left || channel.left < r) {\r\n              channel.left = r\r\n            }\r\n          }\r\n          if (l > pt.x && (box2.getBottom() > channel.top && box2.getTop() < channel.bottom)) {\r\n            if (!channel.right || channel.right > l) {\r\n              channel.right = l\r\n            }\r\n          }\r\n        }\r\n        if (!channel.left) channel.left = container.getLeft().x\r\n        if (!channel.right) channel.right = container.getRight().x\r\n        break\r\n    }\r\n    return channel\r\n  }\r\n\r\n  /**\r\n  * Move a line segment by a specified distance.\r\n  *\r\n  * @param pts the list of points.\r\n  * @param i the index of the segment.\r\n  * @param d the distance to move.\r\n  * @param startPadding\r\n  * @param endPadding\r\n  */\r\n  _moveSegment (pts, i, d, startPadding, endPadding) {\r\n    // first check if we need to add new line segments.\r\n    let dir, l, pt\r\n    if (i === 0) {\r\n      // we need to break off the segment, since we can't change the starting point.\r\n      dir = pts[0].getDirection(pts[1])\r\n      if (!startPadding) {\r\n        startPadding = this.MIN_BUFFER\r\n      }\r\n      l = Math.min(startPadding, pts[0].distance(pts[1]) / 2)\r\n      pt = pts[0].getTranslated(dir.scale(l))\r\n      pts.splice(1, 0, pt)\r\n      this._moveSegment(pts, i + 1, d)\r\n      return\r\n    }\r\n    if (i === pts.length - 2) {\r\n      // we need to break off the segment, since we can't change the end point.\r\n      dir = pts[pts.length - 1].getDirection(pts[pts.length - 2])\r\n      if (!endPadding) {\r\n        endPadding = this.MIN_BUFFER\r\n      }\r\n      l = Math.min(endPadding, pts[pts.length - 1].distance(pts[pts.length - 2]) / 2)\r\n      pt = pts[pts.length - 1].getTranslated(dir.scale(l))\r\n      pts.splice(pts.length - 1, 0, pt)\r\n      this._moveSegment(pts, i, d)\r\n      return\r\n    }\r\n\r\n    if (pts[i].y === pts[i + 1].y) {\r\n      if (i > 0 && pts[i - 1].y === pts[i].y) {\r\n        pts.splice(i + 1, 0, pts[i].clone())\r\n        i++\r\n      }\r\n      if (i < pts.length - 2 && pts[i + 1].y === pts[i + 2].y) {\r\n        pts.splice(i + 1, 0, pts[i + 1].clone())\r\n      }\r\n      pts[i].y += d\r\n      pts[i + 1].y += d\r\n    } else {\r\n      if (i > 0 && pts[i - 1].x === pts[i].x) {\r\n        pts.splice(i + 1, 0, pts[i].clone())\r\n        i++\r\n      }\r\n      if (i < pts.length - 2 && pts[i + 1].x === pts[i + 2].x) {\r\n        pts.splice(i + 1, 0, pts[i + 1].clone())\r\n      }\r\n      pts[i].x += d\r\n      pts[i + 1].x += d\r\n    }\r\n  }\r\n\r\n  /**\r\n  * Move a line segment by a specified distance.\r\n  *\r\n  * @param pts the list of points.\r\n  * @param i the index of the segment.\r\n  * @param d the distance to move.\r\n  * @param startPadding\r\n  * @param endPadding\r\n  */\r\n  _moveSegment2 (pts, i, d, startPadding, endPadding) {\r\n    if (pts[i].y === pts[i + 1].y) {\r\n      if (i > 0 && pts[i - 1].y === pts[i].y) {\r\n        pts.splice(i + 1, 0, pts[i].clone())\r\n        i++\r\n      }\r\n      if (i < pts.length - 2 && pts[i + 1].y === pts[i + 2].y) {\r\n        pts.splice(i + 1, 0, pts[i + 1].clone())\r\n      }\r\n      if ((i > 0 && pts[i].y + d === pts[i - 1].y) || (i < pts.length - 2 && pts[i + 1].y + d === pts[i + 2].y)) {\r\n        d *= 0.75\r\n      }\r\n      pts[i].y += d\r\n      pts[i + 1].y += d\r\n    } else {\r\n      if (i > 0 && pts[i - 1].x === pts[i].x) {\r\n        pts.splice(i + 1, 0, pts[i].clone())\r\n        i++\r\n      }\r\n      if (i < pts.length - 2 && pts[i + 1].x === pts[i + 2].x) {\r\n        pts.splice(i + 1, 0, pts[i + 1].clone())\r\n      }\r\n      if ((i > 0 && pts[i].x + d === pts[i - 1].x) || (i < pts.length - 2 && pts[i + 1].x + d === pts[i + 2].x)) {\r\n        d *= 0.75\r\n      }\r\n      pts[i].x += d\r\n      pts[i + 1].x += d\r\n    }\r\n  }\r\n\r\n  /**\r\n  * This method will merge the redundant segments.\r\n  */\r\n  static _mergeSegments (pts) {\r\n    let h1 = pts[pts.length - 1].y === pts[pts.length - 2].y\r\n    let h2\r\n    for (let i = pts.length - 2; i >= 1; i--) {\r\n      h2 = pts[i].y === pts[i - 1].y\r\n      if (h2 === h1 || (pts[i].equals(pts[i - 1]))) {\r\n        pts.splice(i, 1)\r\n      } else {\r\n        h1 = !h1\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nlinkTypes['direct'] = DirectLink\r\nlinkTypes['bezier'] = BezierLink\r\nlinkTypes['entityRelations'] = EntityRelations\r\nlinkTypes['manhattan'] = Manhattan\r\n\r\nexport default Link\r\n","class Point {\r\n  constructor (x, y) {\r\n    this.x = x\r\n    this.y = y\r\n  }\r\n\r\n  /**\r\n   * Make a clone of this point\r\n   */\r\n  clone () {\r\n    return new Point(this.x, this.y)\r\n  }\r\n\r\n  /**\r\n   * Calculate the distance from this pt to the other pt.\r\n   * @param aPt\r\n   * @returns {number}\r\n   */\r\n  distance (aPt) {\r\n    return Math.sqrt((this.x - aPt.x) * (this.x - aPt.x) + (this.y - aPt.y) * (this.y - aPt.y))\r\n  }\r\n\r\n  /**\r\n   * Translate this point\r\n   */\r\n  translate (p2) {\r\n    this.x += p2.x\r\n    this.y += p2.y\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * Scale this vector\r\n   */\r\n  scale (scale) {\r\n    this.x *= scale\r\n    this.y *= scale\r\n    return this\r\n  }\r\n\r\n  getScaled (scale) {\r\n    return new Point(this.x * scale, this.y * scale)\r\n  }\r\n\r\n  getTranslated (p2) {\r\n    return new Point(this.x + p2.x, this.y + p2.y)\r\n  }\r\n\r\n  /**\r\n   * Get the direction vector from this point to p2.\r\n   * @param p2\r\n   * @returns {Point}\r\n   */\r\n  getDirection (p2) {\r\n    var dist = this.distance(p2)\r\n    return new Point((p2.x - this.x) / dist, (p2.y - this.y) / dist)\r\n  }\r\n\r\n  /**\r\n   * rotate the point about the origin. With the specified angle.\r\n   * @param angle the angle to rotate\r\n   */\r\n  rotate (angle) {\r\n    var cos = Math.cos(angle * Math.PI / 180)\r\n    var sin = Math.sin(angle * Math.PI / 180)\r\n    var x = this.x; var y = this.y\r\n    this.x = x * cos - y * sin\r\n    this.y = x * sin + y * cos\r\n    return this\r\n  }\r\n\r\n  getRotated (angle) {\r\n    return this.clone().rotate(angle)\r\n  }\r\n\r\n  /**\r\n   * Calculate the dot product, treating this and p2 as vectors.\r\n   */\r\n  dotProduct (p2) {\r\n    return this.x * p2.x + this.y * p2.y\r\n  }\r\n\r\n  /**\r\n   * Get the mid point between this and p2.\r\n   */\r\n  getMidPoint (p2) {\r\n    return new Point((this.x + p2.x) / 2, (this.y + p2.y) / 2)\r\n  }\r\n\r\n  reverse () {\r\n    this.x = -this.x\r\n    this.y = -this.y\r\n    return this\r\n  }\r\n\r\n  equals (p2) {\r\n    if (!p2 || !(p2 instanceof Point)) return false\r\n\r\n    return (this.x === p2.x && this.y === p2.y)\r\n  }\r\n\r\n  /**\r\n   * Reflect this point w.r.t. the rectangle.\r\n   * If vertical is true, it will reflect the point cross the vertical\r\n   * central line of the rectangle, otherwise reflect cross the horizontal\r\n   * central line.\r\n   *\r\n   * @param rect the rectangle\r\n   * @param vertical whether is vertical reflection or horizontal reflection.\r\n   */\r\n  reflect (rect, vertical) {\r\n    if (vertical) {\r\n      this.x = 2 * rect.x - this.x\r\n    } else {\r\n      this.y = 2 * rect.y - this.y\r\n    }\r\n    return this\r\n  }\r\n\r\n  toString () {\r\n    return this.x + ',' + this.y\r\n  }\r\n}\r\n\r\nPoint.W = new Point(-1, 0)\r\nPoint.N = new Point(0, -1)\r\nPoint.S = new Point(0, 1)\r\nPoint.E = new Point(1, 0)\r\nPoint.NE = new Point(1, -1)\r\nPoint.NW = new Point(-1, -1)\r\nPoint.SE = new Point(1, 1)\r\nPoint.SW = new Point(-1, 1)\r\n\r\nexport default Point\r\n","import _ from 'lodash'\r\nimport Point from './Point'\r\nimport Shape from './Shape'\r\n\r\nexport default class Rectangle extends Shape {\r\n  /**\r\n   * Checks whether this rectangle contains a given point of a given rectangle\r\n   */\r\n  contains (el) {\r\n    let w = el.width || 0\r\n    let h = el.height || 0\r\n    let left = el.x - w / 2\r\n    let right = el.x + w / 2\r\n    let top = el.y - h / 2\r\n    let bottom = el.y + h / 2\r\n    return (right <= this.right) && (left >= this.left) &&\r\n      (top >= this.top) && (bottom <= this.bottom)\r\n  }\r\n\r\n  /**\r\n   * Calcualte the distance to a point. 0 if this rectangle contains the point.\r\n   */\r\n  distance (pt) {\r\n    if (this.contains(pt)) return 0\r\n\r\n    if (pt.x < this.left) {\r\n      if (pt.y < this.top) {\r\n        return pt.distance(new Point(this.left, this.top))\r\n      }\r\n      if (pt.y <= this.bottom) return this.left - pt.x\r\n      return pt.distance(new Point(this.left, this.bottom))\r\n    }\r\n    if (pt.x <= this.right) {\r\n      if (pt.y <= this.top) return this.top - pt.y\r\n      return pt.y - this.bottom\r\n    }\r\n    if (pt.y < this.top) {\r\n      return pt.distance(new Point(this.right, this.top))\r\n    }\r\n    if (pt.y <= this.bottom) return pt.x - this.right\r\n    return pt.distance(new Point(this.right, this.bottom))\r\n  }\r\n\r\n  /**\r\n   * Given two points, we want to detect whether the line joining the pts intersect\r\n   * with the rectangle or not. We assume only horizontal or vertical line segments.\r\n   *\r\n   * @return int the side of the intersection: -1: no intersection, 0: left, 1: top, 2: right, 3: bottom, 4: containment.\r\n   */\r\n  detectIntersection (pt1, pt2) {\r\n    let horizontal = pt1.y === pt2.y\r\n    let contains1 = this.contains(pt1)\r\n    let contains2 = this.contains(pt2)\r\n    if (contains1 && contains2) return 4\r\n    if (!contains1 && !contains2) {\r\n      if (horizontal && (pt1.y >= this.top && pt1.y <= this.bottom)) {\r\n        if (pt1.x < this.left && pt2.x > this.right) return 0\r\n        if (pt1.x > this.right && pt2.x < this.left) return 2\r\n      }\r\n      if (!horizontal && (pt1.x >= this.left && pt1.x <= this.right)) {\r\n        if (pt1.y < this.top && pt2.y > this.bottom) return 1\r\n        if (pt1.y > this.bottom && pt2.y < this.top) return 3\r\n      }\r\n      return -1\r\n    }\r\n\r\n    let outPt = contains1 ? pt2 : pt1\r\n    if (horizontal) {\r\n      if (outPt.x > this.right) return 2\r\n      return 0\r\n    } else {\r\n      if (outPt.y < this.top) return 1\r\n      return 3\r\n    }\r\n  }\r\n\r\n  toString () {\r\n    return 'Rectangle:{x=' + this.x + ';y=' + this.y + ';width=' + this.width + ';height=' + this.height + '}'\r\n  }\r\n\r\n  static getPerimeter (rect, pt, orthogonal = false) {\r\n    let x = rect.x\r\n    let y = rect.y\r\n    let dx = pt.x - x\r\n    let dy = pt.y - y\r\n    let alpha = Math.atan2(dy, dx)\r\n    let p = new Point(0, 0)\r\n    let pi = Math.PI\r\n    let pi2 = Math.PI / 2\r\n    let beta = pi2 - alpha\r\n    let t = Math.atan2(rect.height, rect.width)\r\n\r\n    if (alpha < -pi + t || alpha > pi - t) {\r\n      // Left edge\r\n      p.x = rect.left\r\n      p.y = y - rect.width * Math.tan(alpha) / 2\r\n    } else if (alpha < -t) {\r\n      // Top Edge\r\n      p.y = rect.top\r\n      p.x = x - rect.height * Math.tan(beta) / 2\r\n    } else if (alpha < t) {\r\n      // Right Edge\r\n      p.x = rect.right\r\n      p.y = y + rect.width * Math.tan(alpha) / 2\r\n    } else {\r\n      // Bottom Edge\r\n      p.y = rect.bottom\r\n      p.x = x + rect.height * Math.tan(beta) / 2\r\n    }\r\n\r\n    if (orthogonal) {\r\n      if (alpha < -pi + t || alpha > pi - t) {\r\n        // Left edge\r\n        p.x = rect.left\r\n        p.y = y\r\n      } else if (alpha < -t) {\r\n        // Top Edge\r\n        p.y = rect.top\r\n        p.x = x\r\n      } else if (alpha < t) {\r\n        // Right Edge\r\n        p.x = rect.right\r\n        p.y = y\r\n      } else {\r\n        // Bottom Edge\r\n        p.y = rect.bottom\r\n        p.x = x\r\n      }\r\n    }\r\n\r\n    let dir = Rectangle.getDirection(rect, p, orthogonal)\r\n    return { point: p, direction: dir }\r\n  }\r\n\r\n  /**\r\n   * Return the bounding rectangle that contains p1 and p2\r\n   */\r\n  static getBoundingRectangle (pts, margin) {\r\n    if (!pts || pts.length === 0) return null\r\n    margin = margin || [0, 0, 0, 0]\r\n    if (!_.isArray(margin)) {\r\n      margin = [margin, margin, margin, margin]\r\n    }\r\n    let min = [pts[0].x, pts[0].y]\r\n    let max = [pts[0].x, pts[0].y]\r\n    for (let i = 1; i < pts.length; i++) {\r\n      let p = pts[i]\r\n      if (p.x < min[0]) {\r\n        min[0] = p.x\r\n      }\r\n      if (p.y < min[1]) {\r\n        min[1] = p.y\r\n      }\r\n      if (p.x > max[0]) {\r\n        max[0] = p.x\r\n      }\r\n      if (p.y > max[1]) {\r\n        max[1] = p.y\r\n      }\r\n    }\r\n    min[0] = min[0] - margin[0]\r\n    min[1] = min[1] - margin[1]\r\n    max[0] = max[0] + margin[2]\r\n    max[1] = max[1] + margin[3]\r\n    let w = Math.abs(max[0] - min[0])\r\n    let h = Math.abs(max[1] - min[1])\r\n    return new Rectangle(min[0] + w / 2, min[1] + h / 2, w, h)\r\n  }\r\n\r\n  /**\r\n   * Create a union of all the rectangles.\r\n   * @param rects\r\n   */\r\n  static union (rects) {\r\n    let minx = null; let miny = null; let maxx = -Infinity; let maxy = -Infinity\r\n    _.each(rects, function (rect) {\r\n      minx = minx || rect.x\r\n      miny = miny || rect.y\r\n      minx = Math.min(minx, rect.x)\r\n      miny = Math.min(miny, rect.y)\r\n      maxx = Math.max(maxx, rect.right())\r\n      maxy = Math.max(maxy, rect.bottom())\r\n    })\r\n    minx = minx || 0\r\n    miny = miny || 0\r\n    return new Rectangle(minx, miny, maxx - minx, maxy - miny)\r\n  }\r\n\r\n  /**\r\n   * Returns the direction the point <i>p</i> is in relation to the given rectangle.\r\n   * Possible values are WEST (-1,0), EAST (1,0), NORTH (0,-1) and SOUTH (0,1) if orthogonal is true, otherwise return\r\n   * the direction connection the center of r and p.\r\n   * @param r\r\n   * @param p\r\n   * @param orthogonal\r\n   * @returns {Point|*}\r\n   */\r\n  static getDirection (r, p, orthogonal = false) {\r\n    if (!orthogonal) {\r\n      return new Point(r.x, r.y).getDirection(new Point(p.x, p.y))\r\n    }\r\n\r\n    let i; let distance = Math.abs(r.left - p.x); let direction = Point.W\r\n\r\n    i = Math.abs(r.top - p.y)\r\n    if (i <= distance) {\r\n      distance = i\r\n      direction = Point.N\r\n    }\r\n\r\n    i = Math.abs(r.bottom - p.y)\r\n    if (i <= distance) {\r\n      distance = i\r\n      direction = Point.S\r\n    }\r\n\r\n    i = Math.abs(r.right - p.x)\r\n    if (i < distance) {\r\n      direction = Point.E\r\n    }\r\n\r\n    return direction\r\n  }\r\n}\r\n","import Shape from './Shape'\r\nimport Point from './Point'\r\nimport Line from './Line'\r\n\r\nexport default class Rhombus extends Shape {\r\n  toString () {\r\n    return 'Rhombus:{x=' + this.x + ';y=' + this.y + ';width=' + this.width + ';height=' + this.height + '}'\r\n  }\r\n\r\n  static getPerimeter (rect, pt, orthogonal = false) {\r\n    let w = rect.width\r\n    let h = rect.height\r\n    let cx = rect.x\r\n    let cy = rect.y\r\n    let x = cx - w / 2\r\n    let y = cy - h / 2\r\n\r\n    let px = pt.x\r\n    let py = pt.y\r\n\r\n    // Special case for intersecting the diamond's corners\r\n    if (cx === px) {\r\n      if (cy > py) {\r\n        return { point: new Point(cx, y), direction: Point.S }\r\n        // top\r\n      } else {\r\n        return { point: new Point(cx, y + h), direction: Point.N }\r\n        // bottom\r\n      }\r\n    } else if (cy === py) {\r\n      if (cx > px) {\r\n        return { point: new Point(x, cy), direction: Point.E }\r\n        // left\r\n      } else {\r\n        return { point: new Point(x + w, cy), direction: Point.W }\r\n        // right\r\n      }\r\n    }\r\n\r\n    let tx = cx\r\n    let ty = cy\r\n\r\n    if (orthogonal) {\r\n      if (px >= x && px <= x + w) {\r\n        tx = px\r\n      } else if (py >= y && py <= y + h) {\r\n        ty = py\r\n      }\r\n    }\r\n\r\n    let p, dir\r\n    // TODO direction calculation is not quite right.\r\n    // In which quadrant will the intersection be?\r\n    // set the slope and offset of the border line accordingly\r\n    if (px < cx) {\r\n      if (py < cy) {\r\n        p = Line.intersection(px, py, tx, ty, cx, y, x, cy)\r\n        dir = Point.S\r\n      } else {\r\n        p = Line.intersection(px, py, tx, ty, cx, y + h, x, cy)\r\n        dir = Point.N\r\n      }\r\n    } else if (py < cy) {\r\n      p = Line.intersection(px, py, tx, ty, cx, y, x + w, cy)\r\n      dir = Point.E\r\n    } else {\r\n      p = Line.intersection(px, py, tx, ty, cx, y + h, x + w, cy)\r\n      dir = Point.W\r\n    }\r\n    return { point: p, direction: dir }\r\n  }\r\n}\r\n","import _ from 'lodash'\r\nimport Point from './Point'\r\nimport Rectangle from './Rectangle'\r\n\r\nlet registry = {}\r\n\r\nclass Shape {\r\n  constructor (x, y, width, height, config) {\r\n    this.x = x\r\n    this.y = y\r\n    this.width = width\r\n    this.height = height\r\n    _.defaults(this, config, { x: 0, y: 0, width: 0, height: 0 })\r\n  }\r\n\r\n  /**\r\n   * Return the y-coord of the top side of this rectangle\r\n   */\r\n  get top () { return this.y - this.height / 2 }\r\n\r\n  /**\r\n   * Returns the y-coordinate of the bottom of this Rectangle.\r\n   */\r\n  get bottom () { return this.y + this.height / 2 }\r\n\r\n  /**\r\n   * Return the x-coord of left side of this rectangle\r\n   */\r\n  get left () { return this.x - this.width / 2 }\r\n\r\n  /**\r\n   * Returns the x-coordinate of the right side of this Rectangle.\r\n   */\r\n  get right () { return this.x + this.width / 2 }\r\n\r\n  get center () { return new Point(this.x, this.y) }\r\n\r\n  get bounds () { return new Rectangle(this.x, this.y, this.width, this.height) }\r\n\r\n  contains (el) { return false }\r\n\r\n  /**\r\n   * This will generate n ports on the shape.\r\n   */\r\n  getRegularPoints (n) {\r\n    return null\r\n  }\r\n\r\n  /**\r\n   * Get the intersection between boundary of this shape and the line connecting (x,y) with the refPt.\r\n   * @param refPt\r\n   * @param orthogonal\r\n   * @returns {*|{point, direction}}\r\n   */\r\n  getPerimeter (refPt, orthogonal = false) {\r\n    return this.constructor.getPerimeter(this, refPt, orthogonal)\r\n  }\r\n\r\n  render (view) {\r\n    let template = _.template(view.getTemplate(this.name, this))\r\n    return template(this)\r\n  }\r\n\r\n  static getShape (name) {\r\n    return registry[name]\r\n  }\r\n\r\n  static addShape (name, c) {\r\n    registry[name] = c\r\n  }\r\n\r\n  static removeShape (name) {\r\n    delete registry[name]\r\n  }\r\n}\r\n\r\nexport default Shape\r\n","import _ from 'lodash'\r\nimport Utils from '../util/Utils'\r\nimport Cache from '../util/Cache'\r\nimport StringBuffer from '../util/string-buffer'\r\nimport Shape from '../geometry/Shape'\r\nimport Label from '../view/Label'\r\n\r\n/**\r\n * The Cell is the common parent for Node and Edge.\r\n */\r\nexport default class Cell {\r\n  constructor (graph, config = { id: _.uniqueId() }) {\r\n    this.graph = graph\r\n    this.id = config.id\r\n    delete config.id\r\n\r\n    // Initialize decorators\r\n    if (config.decorators) {\r\n      this.createDecorators(config.decorators)\r\n      delete config.decorators\r\n    }\r\n\r\n    // Initialize View Properties\r\n    if (config.views) {\r\n      this.viewProps = config.views\r\n      delete config.views\r\n    }\r\n\r\n    // Initialize type\r\n    var Type = config.type || 'Default'\r\n    Type = Utils.type(this.constructor.namespace, Type)\r\n    if (!Type) { throw new Error('Type not found ' + config.type) }\r\n    delete config.type\r\n    this.props = new Type(config)\r\n  }\r\n\r\n  prop (name, value) {\r\n    if (_.isUndefined(value)) { return this.props[name] }\r\n    this.props[name] = value\r\n  }\r\n\r\n  /**\r\n   * Get/Set property stored by views.\r\n   * @param key\r\n   * @param name\r\n   * @param value\r\n   * @returns {*}\r\n   */\r\n  viewProp (key = 'default', name, value) {\r\n    if (_.isUndefined(value)) {\r\n      if (key === 'default') { return this.prop(name, value) }\r\n      return this.viewProps[key][name]\r\n    }\r\n    if (key === 'default') {\r\n      this.prop(name, value)\r\n    } else {\r\n      if (!this.viewProps[key]) { this.viewProps[key] = {} }\r\n      this.viewProps[key][name] = value\r\n    }\r\n  }\r\n\r\n  createDecorators (decorators) {}\r\n\r\n  /**\r\n   * Get properties needed for rendering this element\r\n   * @returns {{key: (string|*), className: *, namespace: *, bounds: *}}\r\n   */\r\n  getView (key) {\r\n    let shape = this.getShape(key)\r\n    return _.assign({\r\n      id: this.id,\r\n      key: key,\r\n      className: this.computedClassName,\r\n      style: this.viewProp(key, 'style'),\r\n      namespace: this.namespace\r\n    }, shape)\r\n  }\r\n\r\n  getShape (key) {\r\n    let shape = Cache.get(this.id + '.shape', key)\r\n    if (shape) return shape\r\n\r\n    let shapeConfig = this.viewProp(key, 'shape')\r\n    let ShapeClass = shapeConfig ? Shape.getShape(shapeConfig.name) : Shape.getShape('Rectangle')\r\n    let x = this.viewProp(key, 'x')\r\n    let y = this.viewProp(key, 'y')\r\n    let width = this.viewProp(key, 'width')\r\n    let height = this.viewProp(key, 'height')\r\n    shape = new ShapeClass(x, y, width, height, shapeConfig)\r\n    Cache.set(this.id + '.shape', shape, key)\r\n    return shape\r\n  }\r\n\r\n  render (view) {\r\n    let template = Cache.get(this.id + '.template', view.id)\r\n    if (!template) {\r\n      // create the template\r\n      let role = this.prop('role')\r\n      template = view.getTemplate('$' + role, null, this)\r\n      if (_.isString(template)) { template = _.template(template) }\r\n      Cache.set(this.id + '.template', template, view.id)\r\n    }\r\n    return template(this.getView(view.id))\r\n  }\r\n\r\n  renderShape (view) {\r\n    let shape = this.getShape(view.id)\r\n    if (shape) { return shape.render(view) }\r\n    return ''\r\n  }\r\n\r\n  renderLabel (view) {\r\n    if (this === this.graph.currentRoot) { return null }\r\n    let box = this.getLabelBox(view.id)\r\n    if (box) { return view.renderLabel(box) }\r\n    return ''\r\n  }\r\n\r\n  getLabelBox (key) {\r\n    let box = Cache.get(this.id + '.labelBox', key)\r\n    if (box) return box\r\n    let shape = this.getShape(key)\r\n    // Just get the config will have a positive performance boost for IE11 and IE10.\r\n    box = Label.getLabelBox(this.prop('label'), this.viewProp(key, 'labelConfig'), shape.width, shape.height)\r\n    Cache.set(this.id + '.labelBox', box, key)\r\n    return box\r\n  }\r\n\r\n  get computedClassName () {\r\n    if (!this._computedClassName) {\r\n      var buf = new StringBuffer(this.prop('role'))\r\n      let props = this.props\r\n      if (props.hasOwnProperty('className')) { buf.append(props['className']) }\r\n      props = props.constructor.prototype\r\n      while (props) {\r\n        if (props.hasOwnProperty('className')) { buf.append(props['className']) }\r\n        props = Object.getPrototypeOf(props)\r\n      }\r\n      this._computedClassName = buf.toString(' ')\r\n    }\r\n    return this._computedClassName\r\n  }\r\n\r\n  get namespace () {\r\n    if (this === this.graph.currentRoot) return ''\r\n    return 'root.' + this.prop('role')\r\n  }\r\n\r\n  destroy () {\r\n    delete this.graph\r\n    delete this.decorators\r\n    delete this.props\r\n    delete this.viewProps\r\n    this.destroyed = true\r\n  }\r\n}\r\n\r\n/*\r\n\r\nCell.prototype.move = function(x, y) {\r\n  this.setProperty(\"x\", Math.round(x));\r\n  this.setProperty(\"y\", Math.round(y));\r\n  delete this.bounds;\r\n};\r\n\r\nCell.prototype.resize = function(w, h) {\r\n  this.setProperty(\"width\", w);\r\n  this.setProperty(\"height\", h);\r\n  delete this.bounds;\r\n};\r\n\r\nCell.prototype.canEdit = function() {\r\n  return (this.graph ? this.graph.canEdit() : true) && this.getProperty(\"editable\");\r\n};\r\n\r\nCell.prototype.canSelect = function() {\r\n  return (this.graph ? this.graph.canSelect() : true) && this.getProperty(\"selectable\");\r\n};\r\n\r\nCell.prototype.canMove = function() {\r\n  return (this.graph ? this.graph.canEdit() : true) && this.getProperty(\"draggable\");\r\n};\r\n\r\nCell.prototype.canResize = function() {\r\n  return (this.graph ? this.graph.canEdit() : true) && this.getProperty(\"resizable\");\r\n};\r\n\r\nCell.prototype.getTypeFromString = function(typeStr) {\r\n  return this.graph.getType(typeStr);\r\n};\r\n\r\nCell.prototype.createModifiers = function(modifiers) {\r\n  this.modifiers = null;\r\n  var modifierSettings = this.getProperty(\"modifierSettings\");\r\n  if (modifierSettings) {\r\n    _.each(modifiers, function(config) {\r\n      config.type = this.graph.getModifierType(config.className);\r\n      config.setting = modifierSettings[config.className];\r\n      if (!config.type || !config.setting) return;\r\n\r\n      this.addModifier(config.className, new Modifier(this, config));\r\n    }, this);\r\n\r\n    // Check for showAlways settings\r\n    _.each(modifierSettings, function(setting, name) {\r\n      if (setting.showAlways && (!this.modifiers || !this.modifiers[name])) {\r\n        var config = {type: this.graph.getModifierType(name), setting: setting};\r\n        if (!config.type) return;\r\n        this.addModifier(name, new Modifier(this, config));\r\n      }\r\n    }, this);\r\n  }\r\n};\r\n\r\nCell.prototype.addModifier = function(name, modifier) {\r\n  if (!this.modifiers)\r\n    this.modifiers = {};\r\n\r\n  if (!modifier.hasOwnProperty(\"showHeader\"))\r\n    modifier.showHeader = true;\r\n\r\n  // @hack preferably set it in configurations.\r\n  if (modifier.name == \"HoverProcessModifier\" || modifier.name == \"HoverResults\")\r\n    modifier.showHeader = false;\r\n\r\n  this.modifiers[name] = modifier;\r\n};\r\n\r\nCell.prototype.getModifiers = function() {\r\n  if (_.isUndefined(this.modifiers))\r\n    this.createModifiers();\r\n  return this.modifiers;\r\n};\r\n\r\nCell.prototype.getModifier = function(name) {\r\n  var modifiers = this.getModifiers();\r\n  if (modifiers)\r\n    return modifiers[name];\r\n  return null;\r\n};\r\n\r\nCell.prototype.isVisible = function() {\r\n  return this.getProperty('visible');\r\n};\r\n\r\nCell.prototype.isContainer = function() {\r\n  return false;\r\n};\r\n*/\r\n","import _ from 'lodash'\r\nimport Cell from './Cell'\r\nimport Rectangle from '../geometry/Rectangle'\r\nimport Link from '../geometry/Link'\r\nimport Label from '../view/Label'\r\nimport Cache from '../util/Cache'\r\n\r\nclass Edge extends Cell {\r\n  constructor (graph, config = {}, source, target) {\r\n    if (!config.id) config.id = _.uniqueId('E')\r\n    super(graph, config)\r\n\r\n    this.source = this.target = null\r\n    this.setSource(source, config.sourcePos)\r\n    this.setTarget(target, config.targetPos)\r\n  }\r\n\r\n  setSource (node, pos) {\r\n    this.setTerminal(node, pos, 'source')\r\n  }\r\n\r\n  setTarget (node, pos) {\r\n    this.setTerminal(node, pos, 'target')\r\n  }\r\n\r\n  /**\r\n\t * Internal methods to set either the source or target\r\n\t */\r\n\t setTerminal (node, pos, dir) {\r\n    var end = dir == 'source' ? this.source : this.target\r\n    if (end == node) {\r\n      // simply change the position of the edge.\r\n      if (node) { node.setEdgeAt(this, pos) }\r\n    } else {\r\n      if (end) {\r\n        // first remove the edge from the current end\r\n        end.removeEdge(this)\r\n      }\r\n\r\n      if (node) {\r\n        if (dir == 'source') { node.addOutEdge(this, pos) } else { node.addInEdge(this, pos) }\r\n      }\r\n      if (dir == 'source') { this.source = node } else { this.target = node }\r\n      // this.clearPoints();\r\n    }\r\n  }\r\n\r\n  getLabelBox (key) {\r\n    var label = this.prop('label')\r\n    if (label) { return Label.getLabelBoxForLink(label, this.viewProp(key, 'labelConfig'), this.getShape(key)) }\r\n    return null\r\n  }\r\n\r\n  /**\r\n\t * Return a pair of points as reference to the calculation of start and end points.\r\n\t */\r\n  getReferencePoints (key) {\r\n    let pts = []\r\n    if (this.source) { pts.push(this.source.getShape(key).center) } else { pts.push(this.viewProp(key, 'start')) }\r\n\r\n    if (this.target) { pts.push(this.target.getShape(key).center) } else { pts.push(this.viewProp(key, 'end')) }\r\n\r\n    return pts\r\n  }\r\n\r\n  getTerminalVisual (key, orthogonal) {\r\n    let refPts = this.getReferencePoints(key)\r\n    let terminals = []\r\n\r\n    let getBound = function (pt) {\r\n      return new Rectangle(pt.x, pt.y, 3, 3)\r\n    }\r\n\r\n    if (this.source) {\r\n      terminals.push(this.source.getPort(key, this.prop('sourcePort'), refPts[1], orthogonal))\r\n    } else { terminals.push({ point: refPts[0], direction: Rectangle.getDirection(getBound(refPts[0]), refPts[1], true) }) }\r\n\r\n    if (this.target) {\r\n      terminals.push(this.target.getPort(key, this.prop('targetPort'), refPts[0], orthogonal))\r\n    } else { terminals.push({ point: refPts[1], direction: Rectangle.getDirection(getBound(refPts[1]), refPts[0], true) }) }\r\n    return terminals\r\n  }\r\n\r\n  getShape (key) {\r\n    let shape = Cache.get(this.id + '.shape', key)\r\n    if (shape) return shape\r\n\r\n    let config = this.viewProp(key, 'shape')\r\n    shape = Link.getLink(this.getTerminalVisual(key, config.orthogonal), config, this.prop('startMarker'), this.prop('endMarker'))\r\n    Cache.set(this.id + '.shape', shape, key)\r\n    return shape\r\n  }\r\n\r\n  toString () {\r\n    return 'Edge:{' + (!this.source ? 'null' : this.source.id) + '--' + (!this.target ? 'null' : this.target.id) + '}'\r\n  }\r\n\r\n  destroy () {\r\n    super.destroy()\r\n    this.setSource(null)\r\n    this.setTarget(null)\r\n  }\r\n}\r\nEdge.namespace = 'Edges'\r\n\r\nexport default Edge\r\n\r\n/*\r\n\r\nEdge.prototype.isVisible = function() {\r\n\tif (this.graph.getProperty(\"allowDanglingEdges\")) {\r\n\t\treturn (this.source ? this.source.isVisible() : true) && (this.target ? this.target.isVisible() : true) && this.getProperty(\"visible\");\r\n\t} else\r\n\t\treturn this.source && this.target && this.getProperty('visible') && this.source.isVisible() && this.target.isVisible();\r\n};\r\n\r\n*/\r\n","import _ from 'lodash'\r\nimport Utils from '../util/Utils'\r\nimport Node from './Node'\r\nimport Edge from './Edge'\r\nimport Marker from '../view/Marker'\r\n\r\nconst nodeDefaults = {\r\n  name: 'Default',\r\n  role: 'node',\r\n  draggable: true,\r\n  selectable: true,\r\n  editable: true,\r\n  resizable: false,\r\n  sourceable: true,\r\n  targetable: true,\r\n  visible: true\r\n}\r\n\r\nconst edgeDefaults = {\r\n  name: 'Default',\r\n  role: 'edge',\r\n  selectable: true,\r\n  visible: true,\r\n  startMarker: null,\r\n  endMarker: {\r\n    id: 'Default_EndMarker',\r\n    type: 'arrow',\r\n    size: 10,\r\n    color: '#0ea117'\r\n  },\r\n  /* start and end is only used if the edge is not connected to a node */\r\n  start: [0, 0],\r\n  end: [400, 200]\r\n}\r\n\r\nclass Graph {\r\n  constructor (id = _.uniqueId('G'), config = {}, model) {\r\n    this.id = id\r\n\r\n    this.nodes = {}\r\n    this.edges = {}\r\n\r\n    this.selection = null\r\n    this.destroyed = false\r\n\r\n    Utils.buildTypes(config.nodeTypes, 'Nodes', nodeDefaults)\r\n    Utils.buildTypes(config.edgeTypes, 'Edges', edgeDefaults)\r\n    // check for markers.\r\n    this.markers = []\r\n    let edgeTypes = Utils.type(Edge.namespace); let marker; let markerConfig\r\n    edgeTypes.forEach(function (type) {\r\n      markerConfig = type.prototype.startMarker\r\n      if (markerConfig) {\r\n        marker = Marker.getMarker(markerConfig, true)\r\n        this.markers.push(marker)\r\n      }\r\n      markerConfig = type.prototype.endMarker\r\n      if (markerConfig) {\r\n        marker = Marker.getMarker(markerConfig, false)\r\n        this.markers.push(marker)\r\n      }\r\n    }, this)\r\n\r\n    delete config.nodeTypes\r\n    delete config.edgeTypes\r\n    Utils.initConfig(this, config)\r\n    this.root = null\r\n    if (model) { this.loadModel(model) }\r\n  }\r\n\r\n  static getJSClass (config, defaultClass) {\r\n    let jsClass = null\r\n    if (config && config.type) {\r\n      // See if we can get the js class from config.\r\n      let type = Utils.type(defaultClass.namespace, config.type)\r\n      if (type) { jsClass = type.jsClass }\r\n    }\r\n\r\n    return Utils.getConstructor(jsClass, defaultClass)\r\n  }\r\n\r\n  /**\r\n\t * Create a new Node\r\n\t * @param config\r\n\t * @param parent\r\n\t * @param pos\r\n\t * @returns {*}\r\n\t */\r\n  addNode (config, parent = this.currentRoot, pos) {\r\n    let NodeClass = Graph.getJSClass(config, Node)\r\n    let node = new NodeClass(this, config)\r\n\r\n    if (parent) { Graph.addChild(parent, node, pos) } else {\r\n      this.root = node\r\n      this.root.prop('role', 'root')\r\n    }\r\n\r\n    this.nodes[node.id] = node\r\n    return node\r\n  }\r\n\r\n  /**\r\n\t * Create a new Edge\r\n\t * @param config\r\n\t * @param parent\r\n\t * @param from\r\n\t * @param to\r\n\t * @returns {*}\r\n\t */\r\n  addEdge (config, parent = this.currentRoot, from, to) {\r\n    let EdgeClass = Graph.getJSClass(config, Edge)\r\n    let edge = new EdgeClass(this, config, from, to)\r\n\r\n    Graph.addChild(parent, edge)\r\n    this.edges[edge.id] = edge\r\n    return edge\r\n  }\r\n\r\n  /**\r\n\t * Added a new child to the parent. The parent has to be a node.\r\n\t * @param parent\r\n\t * @param child\r\n\t */\r\n  static addChild (parent, child) {\r\n    if (!parent.children) { parent.children = [] }\r\n\r\n    if (child.parent != parent) {\r\n      parent.children.push(child)\r\n\r\n      if (child.parent && child.parent.children) { child.parent.children = _.without(child.parent.children, child) }\r\n    }\r\n    child.parent = parent\r\n  }\r\n\r\n  loadModel (model, parent = this.currentRoot) {\r\n    let nodes = model.nodes\r\n    let edges = model.edges\r\n    delete model.nodes\r\n    delete model.edges\r\n\r\n    let node = this.addNode(model, parent)\r\n    if (nodes) {\r\n      _.forEach(nodes, (child) => {\r\n        this.loadModel(child, node)\r\n      })\r\n    }\r\n    if (edges) {\r\n      _.forEach(edges, (edge) => {\r\n        let from, to\r\n        if (edge.from) { from = this.nodes[edge.from] }\r\n        if (edge.to) { to = this.nodes[edge.to] }\r\n        this.addEdge(edge, node, from, to)\r\n      })\r\n    }\r\n  }\r\n\r\n  get currentRoot () {\r\n    return this.root\r\n  }\r\n\r\n  reset () {}\r\n  destroy () {}\r\n}\r\n\r\nGraph.DEFAULTS = {\r\n  allowDanglingEdges: true,\r\n  multiConnect: false,\r\n  readOnly: false,\r\n  viewOnly: false\r\n}\r\n\r\nexport default Graph\r\n","import _ from 'lodash'\r\nimport StringBuffer from '../util/string-buffer'\r\nimport Cell from './Cell'\r\n\r\n/**\r\n * A Node represents vertex of the graph.\r\n */\r\nclass Node extends Cell {\r\n  constructor (graph, config = {}) {\r\n    if (!config.id) config.id = _.uniqueId('N')\r\n    super(graph, config)\r\n\r\n    this.inEdges = []\r\n    this.outEdges = []\r\n    this.ports = null\r\n    this.parent = null\r\n  }\r\n\r\n  isAncestor (n) {\r\n    // TODO: should we move this to graph class ?\r\n    let node = n.parent\r\n    while (node) {\r\n      if (this === node) { return true }\r\n      node = node.parent\r\n    }\r\n    return false\r\n  }\r\n\r\n  removeEdge (edge) {\r\n    let edges = edge.source === this ? this.outEdges : this.inEdges\r\n    for (let i = 0; i < edges.length; i++) {\r\n      if (edge === edges[i]) {\r\n        edges.splice(i, 1)\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  // Add a new incoming edge\r\n  addInEdge (edge, pos) {\r\n    if (pos == null || pos === undefined) {\r\n      this.inEdges.push(edge)\r\n    } else {\r\n      this.inEdges.splice(pos, 0, edge)\r\n    }\r\n  }\r\n\r\n  // Add a new outgoing edge\r\n  addOutEdge (edge, pos) {\r\n    if (pos == null || pos === undefined || pos > edge.length - 1) {\r\n      this.outEdges.push(edge)\r\n    } else {\r\n      this.outEdges.splice(pos, 0, edge)\r\n    }\r\n  }\r\n\r\n  renderChildren (view) {\r\n    if (this.children) {\r\n      let buf = new StringBuffer()\r\n      _.forEach(this.children, (child) => {\r\n        buf.append(child.render(view))\r\n      })\r\n      return buf.toString()\r\n    }\r\n    return ''\r\n  }\r\n\r\n  getPort (key, portName = 'auto', endPt, orthogonal) {\r\n    let shape = this.getShape(key)\r\n    if (portName === 'auto') {\r\n      return shape.getPerimeter(endPt, orthogonal)\r\n    }\r\n    return null\r\n  }\r\n\r\n  toString () {\r\n    let label = this.prop('label') ? this.prop('label') : 'undefined'\r\n    if (_.isArray(label)) {\r\n      label = label[0]\r\n    }\r\n    return 'Node:{id:' + this.id + ';label:' + label + ';type:' + this.props.constructor.typeName + '}'\r\n  }\r\n}\r\nNode.namespace = 'Nodes'\r\n\r\nexport default Node\r\n\r\n/*\r\n\r\n/**\r\n * The DrillDownParent is the parent that displays the vertex when drilled down.\r\n *\r\nVertex.prototype.getDrillDownParent = function() {\r\n  return this.parent;\r\n};\r\n\r\nVertex.prototype.isLocked = function() {\r\n  let mode = this.getProperty(\"mode\") || 3;\r\n  return !(mode & Graph.ALLOW_INTERACTIONS);\r\n};\r\n\r\nVertex.prototype.getCrumbText = function() {\r\n  if (this.isLocked())\r\n    return '<span><img src=\"webwb/pzreadonly.png\" /></span><span>&nbsp;' + this.getProperty(\"label\") + '</span>';\r\n  return this.getProperty(\"label\");\r\n};\r\n\r\nVertex.prototype.canEdit = function() {\r\n  return (!this.parent || !this.parent.isLocked()) && Vertex.superclass.canEdit.call(this);\r\n};\r\n\r\nVertex.prototype.isContainer = function() {\r\n  return this.getProperty(\"container\");\r\n};\r\n\r\n*/\r\n","import Base64 from './util/base64'\r\nimport Cache from './util/Cache'\r\nimport Utils from './util/Utils'\r\nimport DomUtils from './util/dom-utils'\r\nimport StringBuffer from './util/string-buffer'\r\nimport Point from './geometry/Point'\r\nimport Line from './geometry/Line'\r\nimport Shape from './geometry/Shape'\r\nimport Rectangle from './geometry/Rectangle'\r\nimport Ellipse from './geometry/Ellipse'\r\nimport Rhombus from './geometry/Rhombus'\r\nimport Link from './geometry/Link'\r\nimport Events from '../lib/bean'\r\nimport EventDispatcher from './event/event-dispatcher'\r\nimport Graph from './graph/Graph'\r\nimport Cell from './graph/Cell'\r\nimport Node from './graph/Node'\r\nimport Edge from './graph/Edge'\r\nimport Layout from './layout/Layout'\r\nimport FlowLayout from './layout/FlowLayout'\r\nimport Label from './view/Label'\r\nimport Marker from './view/Marker'\r\nimport Renderer from './view/Renderer'\r\nimport SVGRenderer from './view/SVGRenderer'\r\nimport GraphBehavior from './behavior/GraphBehavior'\r\n// import SelectionBehavior from './behavior/SelectionBehavior'\r\n\r\nShape.addShape('Rectangle', Rectangle)\r\nShape.addShape('Ellipse', Ellipse)\r\nShape.addShape('Rhombus', Rhombus)\r\n\r\nexport default {\r\n  Base64,\r\n  Cache,\r\n  Utils,\r\n  DomUtils,\r\n  StringBuffer,\r\n  Point,\r\n  Line,\r\n  Shape,\r\n  Rectangle,\r\n  Ellipse,\r\n  Link,\r\n  Events,\r\n  EventDispatcher,\r\n  Label,\r\n  Marker,\r\n  Graph,\r\n  Cell,\r\n  Node,\r\n  Edge,\r\n  Layout,\r\n  FlowLayout,\r\n  Renderer,\r\n  SVGRenderer,\r\n  GraphBehavior\r\n  // SelectionBehavior\r\n}\r\n","import Layout from './Layout'\r\n\r\nclass FlowLayout extends Layout {\r\n  layout (root, bounds) {\r\n    var items\r\n    if (!root) { items = this.owner.childNodes } else if (_.isArray(root)) { items = root } else { items = root.getLinkedNodes('target') }\r\n    if (!items || items.length == 0) return\r\n\r\n    var x = 0; var y = 0; var h = 0; var node\r\n    var p1 = 0; var p2 = 0\r\n    for (var i = 0; i < items.length; i++) {\r\n      node = items[i]\r\n      if (x > 0 && x + this.hgap + node.getProperty('width') > bounds.width) {\r\n        // create new line\r\n        y += h + this.vgap\r\n        x = 0; h = 0; p1 = 0; p2++\r\n      }\r\n      node._flPos = [p1, p2]\r\n      node.moveTo([bounds.x + x, bounds.y + y])\r\n      x += this.hgap + node.getProperty('width')\r\n      p1++\r\n      h = h < node.getProperty('height') ? node.getProperty('height') : h\r\n    }\r\n    this.trigger(new Rectangle(bounds.x, bounds.y, bounds.width, y + h))\r\n  }\r\n}\r\n\r\nFlowLayout.DEFAULTS = {\r\n  hgap: 10,\r\n  vgap: 10\r\n}\r\n\r\nexport default FlowLayout\r\n","import _ from 'lodash'\r\nimport Utils from '../util/Utils'\r\n\r\nclass Layout {\r\n  constructor (config = {}) {\r\n    if (config.hasOwnProperty('orientation') && _.isString(config.orientation)) {\r\n      if (config.orientation.toUpperCase() == 'HORIZONTAL') { config.orientation = Layout.HORIZONTAL } else { delete config.orientation }\r\n    }\r\n    Utils.initConfig(this, config)\r\n  }\r\n\r\n  layout (root, bounds) {}\r\n  reset () {}\r\n  destroy () {}\r\n}\r\nLayout.VERTICAL = 0\r\nLayout.HORIZONTAL = 1\r\n\r\nLayout.DEFAULTS = {\r\n  orientation: Layout.VERTICAL\r\n}\r\n\r\nexport default Layout\r\n","/**\r\n * Created by tong on 6/7/2016.\r\n */\r\n\r\nlet caches = {}\r\n\r\nlet Cache = {\r\n  get: function (key, namespace) {\r\n    return this.getCache(namespace)[key]\r\n  },\r\n\r\n  set: function (key, value, namespace) {\r\n    this.getCache(namespace)[key] = value\r\n  },\r\n\r\n  contains: function (key, namespace) {\r\n    return key in this.getCache(namespace)\r\n  },\r\n\r\n  remove: function (key, namespace) {\r\n    delete this.getCache(namespace)[key]\r\n  },\r\n\r\n  clear: function (namespace) {\r\n    if (!namespace) { caches = {} } else if (caches[namespace]) { caches[namespace] = {} }\r\n  },\r\n\r\n  getCache: function (namespace = 'default') {\r\n    if (!caches[namespace]) { caches[namespace] = {} }\r\n    return caches[namespace]\r\n  }\r\n}\r\n\r\nexport default Cache\r\n","import _ from 'lodash'\r\nimport Point from '../geometry/Point'\r\nimport Rectangle from '../geometry/Rectangle'\r\n\r\n// util variables\r\nlet _debugging = []; let _debugAll = false; let typeRegistry = {}; let splice = Array.splice\r\n\r\n/**\r\n * Utility functions\r\n */\r\nexport default {\r\n  type: function (namespace, name, type) {\r\n    if (!typeRegistry[namespace]) { typeRegistry[namespace] = new Map() }\r\n    if (!name) { return typeRegistry[namespace] }\r\n    if (!type) { return typeRegistry[namespace].get(name) }\r\n    typeRegistry[namespace].set(name, type)\r\n  },\r\n\r\n  createType: function (namespace, props, defaultType) {\r\n    let name = props.name\r\n\r\n    // first check if type exists\r\n    let type = this.type(namespace, name)\r\n    if (!type) {\r\n      let extend = props.extends ? this.type(namespace, props.extends) : null\r\n      if (!extend && defaultType) { extend = defaultType }\r\n      if (extend) {\r\n        type = class extends extend {\r\n        }\r\n      } else {\r\n        type = class {\r\n          constructor (config) {\r\n            _.assign(this, config)\r\n          }\r\n        }\r\n      }\r\n      delete props.name\r\n      delete props.extends\r\n      _.assign(type.prototype, props)\r\n      type.typeName = name\r\n      this.type(namespace, name, type)\r\n      this.log('Utils', 'Utils.createType - ' + namespace + '.' + name)\r\n    }\r\n    return type\r\n  },\r\n\r\n  buildTypes: function (types, namespace, defaultType) {\r\n    this.log('Utils', 'Utils.buildTypes - ' + namespace)\r\n\r\n    if (!types && defaultType) {\r\n      this.createType(namespace, defaultType)\r\n      this.log('Utils', 'Utils.buildTypes end')\r\n      return\r\n    }\r\n    if (defaultType) {\r\n      let type = _.remove(types, { name: defaultType.name })\r\n      type = type.length > 0 ? type[0] : null\r\n      if (type) { defaultType = this.createType(namespace, _.defaultsDeep(type, defaultType)) } else { defaultType = this.createType(namespace, defaultType) }\r\n    }\r\n\r\n    _.forEach(types, (type) => {\r\n      this.createType(namespace, type, defaultType)\r\n    })\r\n    this.log('Utils', 'Utils.buildTypes end')\r\n  },\r\n\r\n  // Helper function to correctly set up the prototype chain, for subclasses.\r\n  // Similar to `goog.inherits`, but uses a hash of prototype properties and\r\n  // class properties to be extended.\r\n  extend: function (child, parent, protoProps, staticProps) {\r\n    // Add static properties to the constructor function, if supplied.\r\n    _.extend(child, parent, staticProps)\r\n\r\n    // Set the prototype chain to inherit from `parent`, without calling\r\n    // `parent`'s constructor function.\r\n    var Surrogate = function () {\r\n      this.constructor = child\r\n    }\r\n    Surrogate.prototype = parent.prototype\r\n    child.prototype = new Surrogate()\r\n\r\n    // Add prototype properties (instance properties) to the subclass,\r\n    // if supplied.\r\n    if (protoProps) _.extend(child.prototype, protoProps)\r\n\r\n    // Set a convenience property in case the parent's prototype is needed later.\r\n    child.superclass = parent.prototype\r\n\r\n    return child\r\n  },\r\n\r\n  initConfig: function (obj, config) {\r\n    let props = {}; let c = obj.constructor; let cArr = [c]\r\n    while (c) {\r\n      if (c.super) {\r\n        c = c.super.constructor\r\n        splice.apply(cArr, [0, 0, c])\r\n      } else { c = null }\r\n    }\r\n\r\n    for (let i = 0; i < cArr.length; i++) {\r\n      c = cArr[i]\r\n      if (c.DEFAULTS) { _.assign(props, c.DEFAULTS) }\r\n    }\r\n    obj.props = _.assign(props, config)\r\n    c.prototype.prop = function (name, value) {\r\n      if (!value) { return this.props[name] }\r\n      this.props[name] = value\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Gets the JS class constructor.\r\n   * @param {Object} jsClass\r\n   * @param {Object} defaultClass\r\n   */\r\n  getConstructor: function (jsClass, defaultClass) {\r\n    if (!jsClass) { jsClass = defaultClass }\r\n\r\n    if (_.isString(jsClass)) {\r\n      jsClass = eval(jsClass) // eslint-disable-line no-eval\r\n    }\r\n    return jsClass\r\n  },\r\n\r\n  debug: function (moduleName) {\r\n    if (moduleName) {\r\n      _debugging.push(moduleName)\r\n    } else {\r\n      _debugAll = true\r\n    }\r\n  },\r\n\r\n  log: function (name, message) {\r\n    var debug = _debugAll\r\n    if (!_debugAll) {\r\n      debug = false\r\n      for (var i = 0; i < _debugging.length; i++) {\r\n        if (_debugging[i] === name) debug = true\r\n      }\r\n    }\r\n    if (!debug) {\r\n      return\r\n    }\r\n    while (name.length < 10) {\r\n      name = name + ' '\r\n    }\r\n    name = name.substring(0, 10) + ' - '\r\n    console.info(name, message)\r\n  },\r\n\r\n  /**\r\n   * Get the relative position of sub shapes within a parent share.\r\n   * @param bounds\r\n   * @param geometry The geometry information, the format of Geometry is:\r\n   * {\r\n   *      x: \"x coordinate of ref point, if less than 1, will be treated as the percentage of the parent width.\",\r\n   *      y: \"y coordinate of ref point.\",\r\n   *      anchorX: \"x pos of child relative to the ref point\",\r\n   *      anchorY: \"y pos of child relative to the ref point\",\r\n   *      offsetX: \"the offset in the x direction.\",\r\n   *      offsetY: \"the offset in the y direction.\",\r\n   *      width: \"the width of the child element\",\r\n   *      height: \"the height of the child element\"\r\n   * }\r\n   * @returns {*[]}\r\n   */\r\n  getRelativePosition: function (bounds, geometry) {\r\n    let x = Math.abs(geometry.x) <= 1 ? bounds.width * geometry.x : geometry.x\r\n    let y = Math.abs(geometry.y) <= 1 ? bounds.height * geometry.y : geometry.y\r\n    return this.offsetPosition([x, y], geometry)\r\n  },\r\n\r\n  offsetPosition: function (pos, geometry) {\r\n    return [pos[0] + geometry.width * geometry.anchorX + geometry.offsetX, pos[1] + geometry.height * geometry.anchorY + geometry.offsetY]\r\n  },\r\n\r\n  /**\r\n   * Get the position relative to the graph that's unscaled, i.e., absolute position without considering translation and scale.\r\n   * @param t the current translate\r\n   * @param scale the current scale\r\n   * @param o can be either a Point or a Rectangle or a Point array.\r\n   */\r\n  unscale: function (t, scale, o) {\r\n    if (o instanceof Rectangle) { return new Rectangle(o.x * scale + t[0], o.y * scale + t[1], o.width * scale, o.height * scale) } else if (o instanceof Point) { return new Point(o.x * scale + t[0], o.y * scale + t[1]) } else { return [o[0] * scale + t[0], o[1] * scale + t[1]] }\r\n  },\r\n\r\n  /**\r\n   * Get the position relative to the graph that's scaled, i.e., relative position considering translation and scale.\r\n   * @param t the current translation\r\n   * @param scale the current scale\r\n   * @param o can be either a Point or a Rectangle or a Point array.\r\n   */\r\n  scale: function (t, scale, o) {\r\n    if (o instanceof Rectangle) { return new Rectangle((o.x - t[0]) / scale, (o.y - t[1]) / scale, o.width / scale, o.height / scale) } else if (o instanceof Point) { return new Point((o.x - t[0]) / scale, (o.y - t[1]) / scale) } else { return [(o[0] - t[0]) / scale, (o[1] - t[1]) / scale] }\r\n  },\r\n\r\n  /**\r\n   * Convenience method.\r\n   */\r\n  getProperty: function (obj, prop) {\r\n    if (!obj) { return null }\r\n    if (_.has(obj, prop)) { return obj[prop] }\r\n    if (obj.prop && _.isFunction(obj.prop)) { return obj.prop(prop) }\r\n    return null\r\n  }\r\n}\r\n","// http://www.webtoolkit.info/javascript-base64.html\r\n\r\nvar Base64 = {\r\n\r\n  // private property\r\n  _keyStr: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',\r\n\r\n  // public method for encoding\r\n  encode: function (input) {\r\n    var output = ''\r\n    var chr1, chr2, chr3, enc1, enc2, enc3, enc4\r\n    var i = 0\r\n\r\n    input = Base64._utf8_encode(input)\r\n\r\n    while (i < input.length) {\r\n      chr1 = input.charCodeAt(i++)\r\n      chr2 = input.charCodeAt(i++)\r\n      chr3 = input.charCodeAt(i++)\r\n\r\n      enc1 = chr1 >> 2\r\n      enc2 = ((chr1 & 3) << 4) | (chr2 >> 4)\r\n      enc3 = ((chr2 & 15) << 2) | (chr3 >> 6)\r\n      enc4 = chr3 & 63\r\n\r\n      if (isNaN(chr2)) {\r\n        enc3 = enc4 = 64\r\n      } else if (isNaN(chr3)) {\r\n        enc4 = 64\r\n      }\r\n\r\n      output = output +\r\n\t\t\tthis._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) +\r\n\t\t\tthis._keyStr.charAt(enc3) + this._keyStr.charAt(enc4)\r\n    }\r\n\r\n    return output\r\n  },\r\n\r\n  // public method for decoding\r\n  decode: function (input) {\r\n    var output = ''\r\n    var chr1, chr2, chr3\r\n    var enc1, enc2, enc3, enc4\r\n    var i = 0\r\n\r\n    input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, '')\r\n\r\n    while (i < input.length) {\r\n      enc1 = this._keyStr.indexOf(input.charAt(i++))\r\n      enc2 = this._keyStr.indexOf(input.charAt(i++))\r\n      enc3 = this._keyStr.indexOf(input.charAt(i++))\r\n      enc4 = this._keyStr.indexOf(input.charAt(i++))\r\n\r\n      chr1 = (enc1 << 2) | (enc2 >> 4)\r\n      chr2 = ((enc2 & 15) << 4) | (enc3 >> 2)\r\n      chr3 = ((enc3 & 3) << 6) | enc4\r\n\r\n      output = output + String.fromCharCode(chr1)\r\n\r\n      if (enc3 != 64) {\r\n        output = output + String.fromCharCode(chr2)\r\n      }\r\n      if (enc4 != 64) {\r\n        output = output + String.fromCharCode(chr3)\r\n      }\r\n    }\r\n\r\n    output = Base64._utf8_decode(output)\r\n\r\n    return output\r\n  },\r\n\r\n  // private method for UTF-8 encoding\r\n  _utf8_encode: function (string) {\r\n    string = string.replace(/\\r\\n/g, '\\n')\r\n    var utftext = ''\r\n\r\n    for (var n = 0; n < string.length; n++) {\r\n      var c = string.charCodeAt(n)\r\n\r\n      if (c < 128) {\r\n        utftext += String.fromCharCode(c)\r\n      } else if ((c > 127) && (c < 2048)) {\r\n        utftext += String.fromCharCode((c >> 6) | 192)\r\n        utftext += String.fromCharCode((c & 63) | 128)\r\n      } else {\r\n        utftext += String.fromCharCode((c >> 12) | 224)\r\n        utftext += String.fromCharCode(((c >> 6) & 63) | 128)\r\n        utftext += String.fromCharCode((c & 63) | 128)\r\n      }\r\n    }\r\n\r\n    return utftext\r\n  },\r\n\r\n  // private method for UTF-8 decoding\r\n  _utf8_decode: function (utftext) {\r\n    var string = ''\r\n    var i = 0\r\n    var c = c1 = c2 = 0\r\n\r\n    while (i < utftext.length) {\r\n      c = utftext.charCodeAt(i)\r\n\r\n      if (c < 128) {\r\n        string += String.fromCharCode(c)\r\n        i++\r\n      } else if ((c > 191) && (c < 224)) {\r\n        c2 = utftext.charCodeAt(i + 1)\r\n        string += String.fromCharCode(((c & 31) << 6) | (c2 & 63))\r\n        i += 2\r\n      } else {\r\n        c2 = utftext.charCodeAt(i + 1)\r\n        c3 = utftext.charCodeAt(i + 2)\r\n        string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63))\r\n        i += 3\r\n      }\r\n    }\r\n\r\n    return string\r\n  }\r\n\r\n}\r\n\r\nexport default Base64\r\n","import _ from 'lodash'\r\n\r\nconst inBrowser = () => {\r\n  return typeof window !== 'undefined' && window.navigator && typeof navigator !== 'undefined'\r\n}\r\n\r\n/**\r\n * dom Utility functions\r\n */\r\nexport default {\r\n  isIE: (function () {\r\n    if (!inBrowser()) return false\r\n    var sAgent = window.navigator.userAgent\r\n    var Idx = sAgent.indexOf('MSIE')\r\n\r\n    if (Idx > 0) {\r\n      // If IE, return version number.\r\n      return parseInt(sAgent.substring(Idx + 5, sAgent.indexOf('.', Idx)))\r\n    } else if (navigator.userAgent.match(/Trident\\/7\\./)) { // If IE 11 then look for Updated user agent string.\r\n      return 11\r\n    } else if (navigator.userAgent.match(/Edge\\//)) {\r\n      return 'Edge'\r\n    } else {\r\n      return false\r\n    }\r\n  })(),\r\n\r\n  isFireFox: (function () {\r\n    // InstallTrigger: Firefox's API to install add-ons\r\n    return typeof InstallTrigger !== 'undefined'\r\n  })(),\r\n\r\n  isChrome: (function () {\r\n    if (!inBrowser() || navigator.userAgent.indexOf('Edge') >= 0) return false\r\n    var raw = navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./)\r\n    return raw ? parseInt(raw[2], 10) : false\r\n  })(),\r\n\r\n  isMac: (function () {\r\n    if (!inBrowser()) return false\r\n    return navigator.platform.toUpperCase().indexOf('MAC') >= 0\r\n  })(),\r\n\r\n  isWindows: (function () {\r\n    if (!inBrowser()) return false\r\n    return navigator.appVersion.indexOf('Windows') >= 0\r\n  })(),\r\n\r\n  isLinux: (function () {\r\n    if (!inBrowser()) return false\r\n    return navigator.appVersion.indexOf('Linux') >= 0\r\n  })(),\r\n\r\n  createElement: function (tag, attribs, styles, html) {\r\n    let el = document.createElement(tag)\r\n    this.setElement(el, attribs, styles)\r\n    if (html) { el.innerHTML = html }\r\n    return el\r\n  },\r\n\r\n  createElementByString: function (str) {\r\n    let temp = this.createElement('div', null, null, str)\r\n    return temp.childNodes\r\n  },\r\n\r\n  setElement: function (el, attribs, styles) {\r\n    if (attribs) {\r\n      _.forEach(attribs, function (value, key) {\r\n        el.setAttribute(key, value)\r\n      })\r\n    }\r\n    if (styles) {\r\n      _.forEach(styles, function (value, key) {\r\n        el.style[key] = value\r\n      })\r\n    }\r\n  },\r\n\r\n  testElement: function (node, method) {\r\n    return node && node.nodeType === 1 && (!method || method(node))\r\n  },\r\n\r\n  getAncestorBy: function (node, method) {\r\n    while ((node = node.parentNode) !== null) {\r\n      if (this.testElement(node, method)) { return node }\r\n    }\r\n\r\n    return null\r\n  },\r\n\r\n  /**\r\n   * Get the position of element relative to the context.\r\n   * @param el the element\r\n   * @param context\r\n   * @returns {*[]}\r\n   */\r\n  getPosition (el, context) {\r\n    if (!context) context = document.body\r\n    let elRect = el.getBoundingClientRect()\r\n    let contextRect = context.getBoundingClientRect()\r\n\r\n    return [elRect.left - contextRect.left, elRect.top - contextRect.top]\r\n  },\r\n\r\n  getCenterPosition (el, context) {\r\n    if (!context) context = document.body\r\n    let elRect = el.getBoundingClientRect()\r\n    let contextRect = context.getBoundingClientRect()\r\n    let w = elRect.right - elRect.left\r\n    let h = elRect.bottom - elRect.top\r\n\r\n    return [elRect.left - contextRect.left + w / 2, elRect.top - contextRect.top + h / 2]\r\n  },\r\n\r\n  move: function (el, x, y) {\r\n    if (x) el.style.left = x + 'px'\r\n    if (y) el.style.top = y + 'px'\r\n  },\r\n\r\n  getSize: function (el) {\r\n    var w = parseInt(el.style.offsetWidth, 10)\r\n    var h = parseInt(el.style.offsetHeight, 10)\r\n    return [w, h]\r\n  },\r\n\r\n  resize: function (el, w, h) {\r\n    if (w) el.style.width = w + 'px'\r\n    if (h) el.style.height = h + 'px'\r\n  },\r\n\r\n  preloadImages: function (array) {\r\n    if (!this.preloadImages.list) this.preloadImages.list = []\r\n    if (!this.preloadImages.loaded) this.preloadImages.loaded = {}\r\n\r\n    var list = this.preloadImages.list\r\n    var img; var that = this\r\n    for (var i = 0; i < array.length; i++) {\r\n      img = new Image()\r\n      img.onload = function () {\r\n        var index = list.indexOf(this)\r\n        if (index !== -1) {\r\n          that.preloadImages.loaded[this.name] = { width: this.width, height: this.height }\r\n          // remove image from the array once it's loaded\r\n          // for memory consumption reasons\r\n          list.splice(index, 1)\r\n        }\r\n      }\r\n      list.push(img)\r\n      img.src = array[i]\r\n      img.name = array[i]\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get's the image's information given the url. Must be preloaded by calling the preloadImage function.\r\n   * @param src\r\n   */\r\n  getImageInfo: function (src) {\r\n    if (this.preloadImages.loaded) {\r\n      return this.preloadImages.loaded[src]\r\n    }\r\n    return null\r\n  },\r\n\r\n  downloadFile: function (name, data) {\r\n    if (!data) return\r\n    let mime = data.match(/^data:([^;,]*)/)[1]\r\n    if (name.indexOf('.') < 0) {\r\n      if (!mime) mime = 'text/plain'\r\n      if (mime === 'text/plain') { name = name + '.txt' } else {\r\n        let type = mime.split('/')[1]\r\n        if (type.indexOf('+') > 0) type = type.split('+')[0]\r\n        name = name + '.' + type\r\n      }\r\n    }\r\n    if (this.isIE) {\r\n      let encoded = data.indexOf(';base64') >= 0\r\n      if (encoded) { data = atob(data.replace('data:' + mime + ';base64,', '')) } else { data = decodeURI(data.replace('data:' + mime + ',', '')) }\r\n      data = this.GetBlob(data, mime)\r\n      navigator.msSaveBlob(data, name)\r\n    } else {\r\n      let link = this.createElement('a', { href: data, download: name }, { display: 'none' })\r\n      document.body.appendChild(link)\r\n      link.click()\r\n      link.parentNode.removeChild(link)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Convert b54 to blob. IE only\r\n   */\r\n  GetBlob: function (data, contentType, sliceSize) {\r\n    contentType = contentType || ''\r\n    sliceSize = sliceSize || 512\r\n\r\n    var byteArrays = []\r\n\r\n    for (var offset = 0; offset < data.length; offset += sliceSize) {\r\n      var slice = data.slice(offset, offset + sliceSize)\r\n\r\n      var byteNumbers = new Array(slice.length)\r\n      for (var i = 0; i < slice.length; i++) {\r\n        byteNumbers[i] = slice.charCodeAt(i)\r\n      }\r\n      var byteArray = new Uint8Array(byteNumbers)\r\n      byteArrays.push(byteArray)\r\n    }\r\n    return new Blob(byteArrays, { type: contentType })\r\n  },\r\n\r\n  openImage: function (name, image) {\r\n    if (!inBrowser()) return\r\n    var myWindow = window.open('', '_blank', 'toolbar=yes, scrollbars=yes, resizable=yes, width=500, height=500')\r\n    var myDocument = myWindow.document\r\n    var img = myDocument.createElement('img')\r\n    this.setElement(img, { src: image, name: name })\r\n    myDocument.body.appendChild(img)\r\n  },\r\n\r\n  /**\r\n   * Check whether the key event is from input, textarea or select.\r\n   * @param e  input event\r\n   */\r\n  eventFromInput: function (e) {\r\n    var tagName = e.target.tagName\r\n    return (tagName === 'INPUT' || tagName === 'TEXTAREA' || tagName === 'SELECT')\r\n  },\r\n\r\n  /**\r\n   * Wait for the element with the specified id to come into existence. Returns a promise\r\n   * @param {*} id The id of the element to wait for\r\n   */\r\n  waitForElement (id) {\r\n    return new Promise(resolve => {\r\n      const el = document.getElementById(id)\r\n      if (!el) {\r\n        const interval = setInterval(() => {\r\n          const el = document.getElementById(id)\r\n          if (el) {\r\n            clearInterval(interval)\r\n            return resolve(el)\r\n          }\r\n        }, 200)\r\n      } else {\r\n        return resolve(el)\r\n      }\r\n    })\r\n  }\r\n}\r\n","import _ from 'lodash'\r\n\r\n/**\r\n * A string buffer for fast string manipulation\r\n */\r\nexport default class StringBuffer {\r\n  constructor (str) {\r\n    this.buffer = []\r\n    if (str) { this.buffer.push(str) }\r\n  }\r\n\r\n  append (stuff) {\r\n    if (_.isString(stuff)) { this.buffer.push(stuff) } else if (_.isArray(stuff)) { this.buffer = this.buffer.concat(stuff) } else { this.buffer.push('' + stuff) }\r\n    return this\r\n  }\r\n\r\n  prepend (stuff) {\r\n    if (_.isString(stuff)) { this.buffer.splice(0, 0, stuff) } else if (_.isArray(stuff)) { this.buffer = stuff.concat(this.buffer) } else { this.buffer.splice(0, 0, '' + stuff) }\r\n    return this\r\n  }\r\n\r\n  clear () {\r\n    this.buffer = []\r\n  }\r\n\r\n  removeLast () {\r\n    this.buffer.pop()\r\n    return this\r\n  }\r\n\r\n  toString (sep) {\r\n    if (!sep) sep = ''\r\n    return this.buffer.join(sep)\r\n  }\r\n}\r\n","import _ from 'lodash'\r\nimport Events from '../../lib/bean'\r\nimport Utils from '../util/Utils'\r\nimport DomUtils from '../util/dom-utils'\r\nimport StringBuffer from '../util/string-buffer'\r\nimport Rectangle from '../geometry/Rectangle'\r\n\r\nconst FONT_BOLD = 1; const FONT_ITALIC = 2; const FONT_UNDERLINE = 4; const FONT_SHADOW = 8\r\n\r\nlet defaultConfig = {\r\n  fontSize: 11,\r\n  fontFamily: 'Arial',\r\n  fontStyle: 0,\r\n  fontColor: 'black',\r\n  padding: 0,\r\n  linePadding: 0,\r\n  align: 'left',\r\n  width: 0,\r\n  height: 0,\r\n  rotation: null,\r\n  geometry: { x: 0, y: 0, anchorY: 0, offsetX: 0, offsetY: 0 }\r\n}\r\n\r\n/**\r\n * The label object handles label sizing/positioning\r\n */\r\nexport default (function () {\r\n  let stringMeasureEl = null; let measureDiv; let baselineDiv\r\n\r\n  /**\r\n   * Calculate the size of the string.\r\n   */\r\n  let getStringSize = _.memoize(function (str, fontSize, fontFamily, bold) {\r\n    fontSize = fontSize || 11\r\n    fontFamily = fontFamily || 'Arial,Helvetica'\r\n    bold = !_.isUndefined(bold) ? bold : false\r\n\r\n    // first check if there is a string-measuring div available, if not, create now.\r\n    if (!stringMeasureEl) {\r\n      stringMeasureEl = DomUtils.createElement('iframe', { id: '_ComputeStylesIframe' }, { position: 'absolute', visibility: 'hidden', width: 'auto' })\r\n      document.body.appendChild(stringMeasureEl)\r\n      let doc = stringMeasureEl.contentWindow.document\r\n      doc.open()\r\n      doc.write(\r\n        `<html><body>\r\n        <div id=\"baselineDiv\" style=\"height:100px;\"><span style=\"line-height:0\">T</span><span style=\"height:100%;display:inline-block;\"></span></div>\r\n        <div id=\"measureDiv\" style=\"position:absolute;width:auto;height:auto;padding:0;white-space:nowrap;display:inline-block;\"></div>\r\n        </body></html>`)\r\n      doc.close()\r\n      measureDiv = doc.getElementById('measureDiv')\r\n      baselineDiv = doc.getElementById('baselineDiv')\r\n    }\r\n    baselineDiv.style.fontSize = measureDiv.style.fontSize = fontSize\r\n    baselineDiv.style.fontFamily = measureDiv.style.fontFamily = fontFamily\r\n    baselineDiv.style.fontWeight = measureDiv.style.fontWeight = bold ? 'bold' : 'normal'\r\n    measureDiv.innerHTML = str\r\n\r\n    let strut = baselineDiv.firstChild\r\n    let baselineHeight = strut.offsetTop + strut.offsetHeight - baselineDiv.offsetHeight - baselineDiv.offsetTop\r\n\r\n    return { width: measureDiv.offsetWidth, height: measureDiv.offsetHeight, baseline: baselineHeight }\r\n  }, function (str, fontSize, fontFamily, bold) { return str + ';' + fontSize + ';' + fontFamily + ';' + bold })\r\n\r\n  /**\r\n   * Create a wrapped text.\r\n   * @param {String} string the string to wrap.\r\n   * @param {maxWidth} the maximum width this string can take.\r\n   * @param {fontSize}\r\n   * @param {fontFamily}\r\n   * @param {bold}\r\n   */\r\n  let wrap = _.memoize(function (string, maxWidth, fontSize, fontFamily, bold) {\r\n    maxWidth = maxWidth || 0\r\n    fontSize = fontSize || 11\r\n    fontFamily = fontFamily || 'Arial,Helvetica'\r\n    bold = !_.isUndefined(bold) ? bold : false\r\n\r\n    let arr = []\r\n    let spaceSize = getStringSize('&nbsp;', fontSize, fontFamily, bold); let space = spaceSize.width\r\n    arr.lineHeight = spaceSize.height\r\n    arr.baseline = spaceSize.baseline\r\n\r\n    if (!maxWidth || !string || string === '') {\r\n      arr.push(string)\r\n      arr.width = (!string || string === '') ? space : getStringSize(string, fontSize, fontFamily, bold).width\r\n      arr.height = arr.lineHeight\r\n      return arr\r\n    }\r\n\r\n    let width = 0\r\n    // split the text by lines\r\n    let lines = string.split('\\n')\r\n\r\n    let buf = new StringBuffer()\r\n\r\n    for (let j = 0; j < lines.length; j++) {\r\n      // split each line by word\r\n      let words = lines[j].split(/\\s/)\r\n      let line = ''; let currentWidth = 0; let wordWidth = 0; let newLine = true; let word\r\n\r\n      for (let i = 0; i < words.length; i++) {\r\n        word = words[i]\r\n        wordWidth = getStringSize(word, fontSize, fontFamily, bold).width\r\n\r\n        if ((newLine ? wordWidth : currentWidth + space + wordWidth) > maxWidth) {\r\n          if (newLine) {\r\n            buf.append(word)\r\n            width = Math.max(width, wordWidth)\r\n            if (i < words.length - 1) {\r\n              arr.push(buf.toString())\r\n              buf.clear()\r\n            }\r\n          } else {\r\n            arr.push(buf.append(line).toString())\r\n            width = Math.max(width, currentWidth + space + wordWidth)\r\n            buf.clear()\r\n          }\r\n          line = ''\r\n          currentWidth = 0\r\n          if (!newLine) { i-- } // move back one word.\r\n          newLine = true\r\n        } else {\r\n          line = newLine ? word : line + ' ' + word\r\n          currentWidth = newLine ? wordWidth : currentWidth + space + wordWidth\r\n          width = Math.max(width, currentWidth)\r\n          newLine = false\r\n        }\r\n      }\r\n      if (line !== '') { buf.append(line) }\r\n      if (j < lines.length - 1) {\r\n        arr.push(buf.toString())\r\n        buf.clear()\r\n      }\r\n    }\r\n\r\n    arr.push(buf.toString())\r\n    arr.width = width\r\n    arr.height = arr.lineHeight * arr.length\r\n    return arr\r\n  }, function (str, maxWidth, fontSize, fontFamily, bold) { return str + ';' + maxWidth + ';' + fontSize + ';' + fontFamily + ';' + bold })\r\n\r\n  /**\r\n   *  Get the view information for how to display the label.\r\n   * @param label The string that needs to be displayed\r\n   * @param containerWidth The width of the parent container.\r\n   * @param containerHeight The height of the parent container.\r\n   * @param labelConfig The configuration on how to display label. It should be an object with the following parameters:\r\n   * {\r\n   *      fontSize, fontFamily, fontStyle, padding,\r\n   *      align: can be either \"left\", \"center\" or \"right\",\r\n   *      width: the maximum width of the label. if less than 1, then is treated as percentage. If 0, no wrapping will occur,\r\n   *      height,\r\n   *      geometry\r\n   * }\r\n   * @returns {*}\r\n   */\r\n  function getLabelBox (label, labelConfig, containerWidth, containerHeight) {\r\n    return _getLabelBox.call(this, label, labelConfig, { width: containerWidth, height: containerHeight })\r\n  }\r\n\r\n  function getLabelBoxForLink (label, labelConfig, link) {\r\n    return _getLabelBox.call(this, label, labelConfig, link)\r\n  }\r\n\r\n  function _getLabelBox (label, labelConfig = {}, context) {\r\n    labelConfig = _.defaultsDeep(labelConfig, defaultConfig)\r\n    let fontSize = labelConfig.fontSize\r\n    let fontFamily = labelConfig.fontFamily\r\n    let fontStyle = labelConfig.fontStyle\r\n    let bold = (fontStyle & FONT_BOLD) === FONT_BOLD\r\n    let padding = labelConfig.padding\r\n    let linePadding = labelConfig.linePadding\r\n    let align = labelConfig.align\r\n\r\n    let w = labelConfig.width; let h = labelConfig.height\r\n    if (context.width) {\r\n      w = w <= 5 ? context.width * w : w\r\n      h = h <= 5 ? context.height * h : h\r\n    }\r\n    w -= 2 * padding\r\n    h -= 2 * padding\r\n    w = Math.max(0, w)\r\n    h = Math.max(0, h)\r\n\r\n    let geometry = _.clone(labelConfig.geometry)\r\n    let wrappedLabel = this.wrap(label, w, fontSize, fontFamily, bold)\r\n    geometry.width = wrappedLabel.width + 2 * padding\r\n    geometry.height = wrappedLabel.height + 2 * padding + (wrappedLabel.length - 1) * linePadding\r\n    let anchor = 'start'; let dx = 0; let setAnchorX = !_.has(geometry, 'anchorX')\r\n    switch (align) {\r\n      case 'center':\r\n        anchor = 'middle'\r\n        if (setAnchorX) geometry.anchorX = 0\r\n        break\r\n      case 'right':\r\n        anchor = 'end'\r\n        dx = wrappedLabel.width / 2\r\n        if (setAnchorX) geometry.anchorX = -0.5\r\n        break\r\n      case 'left':\r\n        dx = -wrappedLabel.width / 2\r\n        if (setAnchorX) geometry.anchorX = 0.5\r\n        break\r\n    }\r\n    let pos\r\n    if (context.getRelativePosition) { pos = context.getRelativePosition(geometry) } else { pos = Utils.getRelativePosition({ width: context.width, height: context.height }, geometry) }\r\n\r\n    let bounds = new Rectangle(pos[0], pos[1], geometry.width, geometry.height)\r\n    // the pivot is the center of rotation when the label has a rotation specified.\r\n    let pivot = align === 'center' ? [0, 0] : (align === 'left' ? [-wrappedLabel.width / 2, 0] : [wrappedLabel.width / 2, 0])\r\n\r\n    // the maximum bounds for the label, used to position inline editor\r\n    geometry.width = Math.max(w + 2 * padding, geometry.width)\r\n    geometry.height = Math.max(h + 2 * padding, geometry.height)\r\n\r\n    if (context.getRelativePosition) { pos = context.getRelativePosition(geometry) } else { pos = Utils.getRelativePosition({ width: context.width, height: context.height }, geometry) }\r\n\r\n    let maxBounds = new Rectangle(pos[0], pos[1], geometry.width, geometry.height)\r\n    return {\r\n      config: labelConfig,\r\n      label: wrappedLabel,\r\n      _label: label,\r\n      bold,\r\n      underline: fontStyle & FONT_UNDERLINE,\r\n      italic: fontStyle & FONT_ITALIC,\r\n      shadow: fontStyle & FONT_SHADOW,\r\n      dx,\r\n      dy: -geometry.height / 2 + padding + wrappedLabel.lineHeight - wrappedLabel.baseline,\r\n      anchor,\r\n      lineHeight: wrappedLabel.lineHeight + linePadding,\r\n      pivot,\r\n      bounds,\r\n      maxBounds\r\n    }\r\n  }\r\n\r\n  function render (view, box) {\r\n    return view.renderLabel(box)\r\n  }\r\n\r\n  // This is the inline editor for editing label text in place.\r\n  let editor = {\r\n    start: function (key, container, box, refEl, textEl, scale = 1.0, singleLine = true) {\r\n      if (this.input) {\r\n        if (this.key !== key) {\r\n          // need to close the existing editor first\r\n          this.stop()\r\n        } else { return }\r\n      }\r\n      let tag = singleLine ? 'input' : 'textarea'\r\n      this.input = DomUtils.createElement(tag, { id: 'inlineEditor', unselectable: 'off' }, { position: 'absolute', overflow: 'hidden', padding: '0px', margin: '0px', border: 'transparent' })\r\n      if (singleLine) {\r\n        Events.on(this.input, 'keydown keyup', (event) => {\r\n          if (event.keyCode === 13) {\r\n            Events.off(this.input, 'keydown keyup')\r\n            this.stop()\r\n          }\r\n        })\r\n      }\r\n      container.appendChild(this.input)\r\n\r\n      this.key = key\r\n      this.box = box\r\n      this.refEl = refEl\r\n      this.textEl = textEl\r\n\r\n      let labelConfig = box.config\r\n      let maxBounds = new Rectangle(box.maxBounds.x, box.maxBounds.y, box.maxBounds.width * scale, box.maxBounds.height * scale)\r\n      let pos = DomUtils.getCenterPosition(refEl, container)\r\n      pos = [pos[0] + maxBounds.left, pos[1] + maxBounds.top]\r\n\r\n      if (textEl) { textEl.style.visibility = 'hidden' }\r\n\r\n      DomUtils.setElement(this.input, null, {\r\n        visibility: 'visible',\r\n        left: pos[0] + 'px',\r\n        top: pos[1] + 'px',\r\n        width: maxBounds.width + 'px',\r\n        height: maxBounds.height + 'px',\r\n        'font-family': labelConfig.fontFamily,\r\n        'font-size': (labelConfig.fontSize * scale) + 'px',\r\n        'font-weight': (labelConfig.fontStyle & FONT_BOLD) === FONT_BOLD ? 'bold' : 'normal'\r\n        /* \"color\": labelConfig.fontColor */\r\n      })\r\n\r\n      this.input.value = box._label\r\n      this.input.focus()\r\n      this.input.select()\r\n      Events.fire(this, 'editor.start', [this.key])\r\n    },\r\n\r\n    stop: function (cancel) {\r\n      if (!this.input) return\r\n\r\n      cancel = cancel || false\r\n      if (this.textEl) { this.textEl.style.visibility = null }\r\n\r\n      // remove the input\r\n      this.input.parentNode.removeChild(this.input)\r\n\r\n      if (!cancel) { Events.fire(this, 'editor.update', [this.key, this.input.value]) }\r\n\r\n      Events.fire(this, 'editor.stop', [this.key])\r\n\r\n      delete this.input\r\n      delete this.key\r\n      delete this.box\r\n      delete this.refEl\r\n      delete this.textEl\r\n    }\r\n  }\r\n\r\n  return {\r\n    FONT_BOLD,\r\n    FONT_ITALIC,\r\n    FONT_UNDERLINE,\r\n    FONT_SHADOW,\r\n    getStringSize,\r\n    wrap,\r\n    getLabelBox,\r\n    getLabelBoxForLink,\r\n    render,\r\n    editor\r\n  }\r\n})()\r\n","import Rectangle from '../geometry/Rectangle'\r\n\r\nlet registry = {}\r\n\r\nlet Marker = (function () {\r\n  /** Begin Standard Marker Type **/\r\n  function arrow (size, source, styles) {\r\n    let sign = source ? -1 : 1\r\n    let marker = {\r\n      viewBox: new Rectangle(-5, -5, 10, 10),\r\n      size: size,\r\n      ref: [4 * sign, 0],\r\n      fill: styles.color\r\n    }\r\n    marker.shape = {\r\n      name: 'Polygon',\r\n      points: [[-2 * sign, 0], [-4 * sign, 4], [4 * sign, 0], [-4 * sign, -4]]\r\n    }\r\n    return marker\r\n  }\r\n\r\n  function triangle (size, source, styles) {\r\n    let sign = source ? -1 : 1\r\n    let marker = {\r\n      viewBox: new Rectangle(-5, -5, 10, 10),\r\n      size: size,\r\n      ref: [4 * sign, 0],\r\n      fill: styles.color\r\n    }\r\n    marker.shape = {\r\n      name: 'Polygon',\r\n      points: [[-5 * sign, -5], [-5 * sign, 5], [4 * sign, 0]]\r\n    }\r\n    return marker\r\n  }\r\n\r\n  function oval (size, source, styles) {\r\n    let r = size / 2\r\n    let marker = {\r\n      viewBox: new Rectangle(-r, -r, size, size),\r\n      size: size,\r\n      ref: [0, 0],\r\n      fill: styles.color\r\n    }\r\n    marker.shape = '<ellipse cx=\"0\" cy=\"0\" rx=\"' + r + '\" ry=\"' + r + '\"></ellipse>'\r\n    return marker\r\n  }\r\n\r\n  function diamond (size, source, styles) {\r\n    let sign = source ? -1 : 1\r\n    let marker = {\r\n      viewBox: new Rectangle(-5, -5, 10, 10),\r\n      size: size,\r\n      ref: [4 * sign, 0],\r\n      fill: styles.color\r\n    }\r\n    marker.shape = {\r\n      name: 'Polygon',\r\n      points: [[-4, 0], [0, 4], [4, 0], [0, -4]]\r\n    }\r\n    return marker\r\n  }\r\n  /** End Standard Marker Type **/\r\n  function getMarker (config, source) {\r\n    let factory = registry[config.type]\r\n    let marker = factory(config.size, source, config)\r\n    marker.id = config.id\r\n    return marker\r\n  }\r\n\r\n  registry['arrow'] = arrow\r\n  registry['triangle'] = triangle\r\n  registry['oval'] = oval\r\n  registry['diamond'] = diamond\r\n\r\n  return {\r\n    registry: registry,\r\n    getMarker: getMarker\r\n  }\r\n})()\r\n\r\nexport default Marker\r\n","import _ from 'lodash'\r\nimport Events from '../../lib/bean'\r\nimport Utils from '../util/Utils'\r\nimport DomUtils from '../util/dom-utils'\r\nimport Layout from '../layout/Layout'\r\nimport Rectangle from '../geometry/Rectangle'\r\nimport EventDispatcher from '../event/event-dispatcher'\r\nimport GraphBehavior from '../behavior/GraphBehavior'\r\nimport SelectionBehavior from '../behavior/SelectionBehavior'\r\nimport Label from './Label'\r\n\r\nclass Renderer {\r\n  constructor (id, container, config = {}, graph = null) {\r\n    this.id = id\r\n    this.box = DomUtils.createElement('div', { id: this.id, tabindex: 0, ns: 'graph' }, { overflow: 'hidden', width: '100%', height: '100%', position: 'relative' })\r\n    container.appendChild(this.box)\r\n    if (config.layout) {\r\n      let LayoutClass = Utils.getConstructor(config.layout.jsClass, Layout)\r\n      this.layout = new LayoutClass(config.layout.config)\r\n      delete config.layout\r\n    }\r\n    this.clear = true\r\n    this._translate = [0, 0]\r\n    this._scale = 1.0\r\n    this.graph = graph\r\n    this.dispatcher = null\r\n    this.graphBehavior = null\r\n    this.selectionBehavior = null\r\n    this.nodeBehavior = null\r\n    this.edgeBehavior = null\r\n    this.connectionBehavior = null\r\n    Utils.initConfig(this, config)\r\n\r\n    Events.on(Label.editor, 'editor.update.*', (key, value) => {\r\n      // this.graph.nodes[key].prop('label', value);\r\n      // this.render();\r\n      console.log(key + '=' + value)\r\n    })\r\n  }\r\n\r\n  get graph () {\r\n    return this._graph\r\n  }\r\n\r\n  set graph (graph) {\r\n    this._graph = graph\r\n    let root = graph.currentRoot\r\n    if (root) {\r\n      this._translate = [root.viewProp(this.id, 'x') || 0, root.viewProp(this.id, 'y') || 0]\r\n      this._scale = root.viewProp(this.id, 'scale') || 1.0\r\n    }\r\n  }\r\n\r\n  viewport (scaled, viewport) {\r\n    if (_.isUndefined(scaled) || _.isNull(scaled)) scaled = false\r\n    if (!viewport) {\r\n      let vp = new Rectangle(0, 0, this.box.offsetWidth, this.box.offsetHeight)\r\n      if (scaled) { return Utils.scale(this.translate, this.scale, vp) }\r\n      return vp\r\n    }\r\n    if (!scaled) viewport = Utils.scale(this.translate, this.scale, viewport)\r\n    let w = this.box.offsetWidth\r\n    let scale = w / viewport.width\r\n    this.transform(-viewport.x * scale, -viewport.y * scale, scale)\r\n  }\r\n\r\n  get translate () { return this._translate }\r\n  set translate (t) { this.transform(t[0], t[1]) }\r\n  get scale () { return this._scale }\r\n  set scale (k) {\r\n    switch (k) {\r\n      case 'in':\r\n        k = this.scale * this.prop('zoomFactor')\r\n        break\r\n      case 'out':\r\n        k = this.scale / this.prop('zoomFactor')\r\n        break\r\n      case 'actual':\r\n        k = 1.0\r\n        break\r\n      case 'fit':\r\n        let gridSize = this.prop('gridSize') * 2\r\n\r\n        let gBounds = this.getBounds()\r\n        let vBounds = this.viewport()\r\n\r\n        vBounds.width -= gridSize\r\n        vBounds.height -= gridSize\r\n\r\n        /* Do not zoom more than actual if graph already fits into the bounds */\r\n        k = Math.min((vBounds.width / gBounds.width), (vBounds.height / gBounds.height), 1.0)\r\n\r\n        // TODO: Add centering code here or trigger an event for that\r\n        break\r\n      default:\r\n        if (_.isString(k)) k = parseFloat(k)\r\n        break\r\n    }\r\n    this.transform(null, null, k)\r\n  }\r\n\r\n  transform (x = null, y = null, scale = null) {\r\n    let graph = this.graph\r\n    let root = graph ? graph.currentRoot : null\r\n    if (!_.isNull(x)) {\r\n      this._translate[0] = x\r\n      if (root) { root.viewProp(this.id, 'x', x) }\r\n    }\r\n    if (!_.isNull(y)) {\r\n      this._translate[1] = y\r\n      if (root) { root.viewProp(this.id, 'y', y) }\r\n    }\r\n    if (!_.isNull(scale)) {\r\n      this._scale = scale\r\n      if (root) { root.viewProp(this.id, 'scale', scale) }\r\n      // sync the scale between the dispatcher and the graph\r\n      let s = this.dispatcher.scale\r\n      if (s !== scale) { this.dispatcher.scale = scale }\r\n    }\r\n    this.refresh()\r\n  }\r\n\r\n  render () {\r\n    if (!this._graph) return false\r\n    if (this.layout) { this.layout.layout(this._graph.currentRoot, this.viewport()) }\r\n\r\n    this.initializeBehaviors()\r\n    return true\r\n  }\r\n\r\n  renderLabel (box) {\r\n    return this.constructor.renderLabel(box)\r\n  }\r\n\r\n  renderLink (shape) {\r\n    return this.constructor.renderLink(shape)\r\n  }\r\n\r\n  renderMarkers (markers) {\r\n    return this.constructor.renderMarkers(markers)\r\n  }\r\n\r\n  initializeBehaviors () {\r\n    // create the event dispatcher if necessary.\r\n    if (!this.dispatcher) {\r\n      this.dispatcher = new EventDispatcher(this.box, [this.prop('minZoom'), this.prop('maxZoom')])\r\n      let JsClass\r\n      if (this.prop('graphBehavior')) {\r\n        JsClass = Utils.getConstructor(this.prop('graphBehavior'))\r\n        this.graphBehavior = new JsClass(this)\r\n      }\r\n      if (this.prop('selectionBehavior')) {\r\n        JsClass = Utils.getConstructor(this.prop('selectionBehavior'))\r\n        this.selectionBehavior = new JsClass(this)\r\n      }\r\n      this.dispatcher.register('mouseup.node.label', function (type, ns, target, pos, event) {\r\n        let node = this._graph.nodes[target.getAttribute('id')]\r\n        if (!this.dispatcher.dragging && !node._firstSelection) {\r\n          Label._delayEdit = _.delay(() => {\r\n            if (Label._delayEdit) {\r\n              delete Label._delayEdit\r\n              Label.editor.start(node.id, this.box, node.getLabelBox(this.id), target, event.nsTarget, this.scale)\r\n            }\r\n          }, 250)\r\n        }\r\n      }, this)\r\n      this.dispatcher.register([/^mousedown/, /^zoom/], function (type, ns, target, pos, event) {\r\n        if (!DomUtils.eventFromInput(event)) {\r\n          Label.editor.stop()\r\n        }\r\n      }, this)\r\n    }\r\n    this.dispatcher.start()\r\n  }\r\n\r\n  refresh () {}\r\n\r\n  /**\r\n   * Get the template for the specified key.\r\n   * @param key\r\n   * @param config if the template is a function, this config will be passed as the argument.\r\n   * @param preprocessor if the template contains preprossing elements, such as #{shape}, the preprocessor will be\r\n   * used to render them.\r\n   * @returns {*}\r\n   */\r\n  getTemplate (key, config, preprocessor) {\r\n    let t = this.constructor.TEMPLATES[key]\r\n    if (t && _.isFunction(t)) {\r\n      t = t(config)\r\n    }\r\n    // check if there are any preprocessing tags.\r\n    if (preprocessor) {\r\n      let parts = t.match(/(#{[^#]*})/g)\r\n      let obj = {}\r\n      for (let part in parts) {\r\n        part = parts[part]\r\n        part = part.substring(2, part.length - 1).trim()\r\n        obj[part] = preprocessor[_.camelCase('render ' + part)](this)\r\n      }\r\n      t = _.template(t, { interpolate: /#{([\\s\\S]+?)}/g })(obj)\r\n    }\r\n    return t\r\n  }\r\n\r\n  reset () {}\r\n\r\n  destroy () {\r\n    delete this._graph\r\n    delete this.layout\r\n    if (this.dispatcher) {\r\n      this.dispatcher.stop()\r\n      delete this.dispatcher\r\n    }\r\n    this.box.innerHTML = ''\r\n  }\r\n}\r\nRenderer.DEFAULTS = {\r\n  defaultClickMode: 'pan',\r\n  hideOutline: false,\r\n  singleSelect: true,\r\n  draggable: true,\r\n  gridEnabled: false,\r\n  guidesEnabled: true,\r\n  gridSize: 30,\r\n  maxZoom: 4.0,\r\n  minZoom: 0.2,\r\n  zoomFactor: 1.2,\r\n  maskOpacity: 0.5,\r\n  graphBehavior: GraphBehavior,\r\n  selectionBehavior: SelectionBehavior\r\n}\r\n\r\nexport default Renderer\r\n","import _ from 'lodash'\r\nimport Base64 from '../util/base64'\r\nimport DomUtils from '../util/dom-utils'\r\nimport Renderer from './Renderer'\r\nimport StringBuffer from '../util/string-buffer'\r\n\r\nconst NS = 'http://www.w3.org/2000/svg'\r\nif (typeof (SVGElement) !== 'undefined') {\r\n  var svg = document.createElementNS(NS, 'svg')\r\n  svg.innerHTML = '<circle/>'\r\n  if (svg.firstChild !== '[object SVGCircleElement]') {\r\n    Object.defineProperties(SVGElement.prototype, {\r\n      'outerHTML': {\r\n        enumerable: false,\r\n        configurable: true,\r\n        get: function () {\r\n          var $node, $temp\r\n          $temp = document.createElement('div')\r\n          $node = this.cloneNode(true)\r\n          $temp.appendChild($node)\r\n          return $temp.innerHTML\r\n        }\r\n      },\r\n      'innerHTML': {\r\n        enumerable: false,\r\n        configurable: true,\r\n        get: function () {\r\n          var s = this.outerHTML\r\n          var ropen = new RegExp('<' + this.nodeName + '\\\\b(?:([\"\\'])[^\"]*?(\\\\1)|[^>])*>', 'i')\r\n          var rclose = new RegExp('</' + this.nodeName + '>$', 'i')\r\n          return s.replace(ropen, '').replace(rclose, '')\r\n        },\r\n        set: function (markup) {\r\n          // empty el first.\r\n          let child\r\n          while ((child = this.lastChild) !== null) { this.removeChild(child) }\r\n          let buf = new StringBuffer()\r\n          buf.append('<svg>').append(markup).append('</svg')\r\n          let $temp = DomUtils.createElement('div', null, null, buf.toString()).firstElementChild\r\n          while ($temp.firstChild) { this.appendChild($temp.firstChild) }\r\n        }\r\n      }\r\n    })\r\n  }\r\n  // Define the toDataURL for SVG\r\n  SVGElement.prototype.toDataURL = function (type, options = {}) {\r\n    let _svg = this\r\n\r\n    let debug = function (msg) {}\r\n\r\n    if (options['debug'] === true && typeof (console) !== 'undefined') { debug = function (msg) { console.log('SVG.toDataURL:', msg) } }\r\n\r\n    function exportSVG () {\r\n      var svgXml = _svg.outerHTML\r\n      var svgDataurl = base64dataURLencode(svgXml)\r\n      debug(type + ' length: ' + svgDataurl.length)\r\n\r\n      // NOTE double data carrier\r\n      if (options.callback) options.callback(svgDataurl)\r\n      return svgDataurl\r\n    }\r\n\r\n    function base64dataURLencode (s) {\r\n      var b64 = 'data:image/svg+xml;base64,'\r\n\r\n      // https://developer.mozilla.org/en/DOM/window.btoa\r\n      if (window && window.btoa) {\r\n        debug('using window.btoa for base64 encoding')\r\n        b64 += btoa(s)\r\n      } else {\r\n        debug('using custom base64 encoder')\r\n        b64 += Base64.encode(s)\r\n      }\r\n\r\n      return b64\r\n    }\r\n\r\n    // Native export doesn't work very well. should use canvg instead.\r\n    function exportImage (type) {\r\n      var canvas = document.createElement('canvas')\r\n      var ctx = canvas.getContext('2d')\r\n\r\n      // TODO: if (options.keepOutsideViewport), do some translation magic?\r\n\r\n      var svgImg = new Image()\r\n      var svgXml = _svg.outerHTML\r\n      svgImg.src = base64dataURLencode(svgXml)\r\n\r\n      svgImg.onload = function () {\r\n        debug('exported image size: ' + [svgImg.width, svgImg.height])\r\n        canvas.width = svgImg.width\r\n        canvas.height = svgImg.height\r\n        ctx.drawImage(svgImg, 0, 0)\r\n\r\n        // SECURITY_ERR WILL HAPPEN NOW\r\n        var imageDataurl = canvas.toDataURL(type)\r\n        debug(type + ' length: ' + imageDataurl.length)\r\n\r\n        if (options.callback) options.callback(imageDataurl)\r\n        else debug('WARNING: no callback set, so nothing happens.')\r\n      }\r\n\r\n      svgImg.onerror = function () {\r\n        debug(\r\n          \"Can't export! Maybe your browser doesn't support \" +\r\n          'SVG in img element or SVG input for Canvas drawImage?\\n' +\r\n          'http://en.wikipedia.org/wiki/SVG#Native_support'\r\n        )\r\n      }\r\n\r\n      // NOTE: will not return anything\r\n    }\r\n\r\n    function exportImageCanvg (type) {\r\n      if (typeof canvg === 'undefined') return null\r\n      let canvas = DomUtils.createElement('canvas', null, { display: 'none' })\r\n      document.body.appendChild(canvas)\r\n      if (type === 'javascript' && typeof jsCanvas !== 'undefined') {\r\n        var xcanvas = new jsCanvas('jscanvastest') // eslint-disable-line new-cap\r\n        xcanvas.canvas.style.display = 'none'\r\n        // xcanvas.canvas = canvas;\r\n      }\r\n\r\n      if (!options.keepOutsideViewport) {\r\n        canvg(canvas, _svg.outerHTML)\r\n      } else {\r\n        let padding = options.padding || 0\r\n        let scale = 1.0\r\n        let translate = [0, 0]\r\n        let bbox = _svg.getBBox()\r\n        debug('detected svg dimensions ' + [bbox.x, bbox.y, bbox.width, bbox.height])\r\n        let transform = _svg.firstElementChild.getAttribute('transform')\r\n        if (transform) {\r\n          debug('detected svg transform ' + transform)\r\n          transform = SVGRenderer.transform(transform)\r\n          translate = transform.translate\r\n          scale = transform.scale\r\n        }\r\n        let buf = new StringBuffer()\r\n        buf.append('<svg width=\"').append(bbox.width + 2 * padding).append('px\" height=\"').append(bbox.height + 2 * padding).append('px\"><g transform=\"translate(')\r\n          .append(-bbox.x + translate[0] + padding).append(',').append(-bbox.y + translate[1] + padding).append(')scale(').append(scale).append(')\">')\r\n          .append(_svg.firstElementChild.innerHTML).append('</g></svg>')\r\n        if (type === 'javascript') {\r\n          xcanvas.compile(buf.toString(), function () {\r\n            if (options.callback) options.callback(xcanvas.toString())\r\n          })\r\n          return\r\n        } else { canvg(canvas, buf.toString()) }\r\n      }\r\n      var imageDataurl = canvas.toDataURL(type)\r\n      if (options.callback) options.callback(imageDataurl)\r\n      canvas.parentNode.removeChild(canvas)\r\n      return imageDataurl\r\n    }\r\n\r\n    if (!type) type = 'image/svg+xml'\r\n\r\n    if (options.keepNonSafe) debug('NOTE: keepNonSafe is NOT supported and will be ignored!')\r\n    if (options.keepOutsideViewport) debug('NOTE: keepOutsideViewport is only supported with canvg exporter.')\r\n\r\n    switch (type) {\r\n      case 'image/svg+xml':\r\n        return exportSVG()\r\n      case 'image/png':\r\n      case 'image/jpeg':\r\n      case 'javascript':\r\n        if (!options.renderer) {\r\n          if (window && window.canvg) options.renderer = 'canvg'\r\n          else options.renderer = 'native'\r\n        }\r\n        switch (options.renderer) {\r\n          case 'canvg':\r\n            debug('using canvg renderer for ' + type + ' image export')\r\n            return exportImageCanvg(type)\r\n          case 'native':\r\n            debug('using native renderer for ' + type + ' export. THIS MIGHT FAIL.')\r\n            return exportImage(type)\r\n          default:\r\n            debug('unknown image renderer given, doing noting (' + options.renderer + ')')\r\n        }\r\n        break\r\n      default:\r\n        debug(\"Sorry! Exporting as '\" + type + \"' is not supported!\")\r\n    }\r\n    return null\r\n  }\r\n}\r\n\r\nclass SVGRenderer extends Renderer {\r\n  render () {\r\n    let result = super.render()\r\n    if (result) {\r\n      let root = this.graph.currentRoot\r\n      let buf = new StringBuffer('<svg width=\"100%\" height=\"100%\" xmlns=\"http://www.w3.org/2000/svg\">')\r\n      let t = this.translate\r\n      buf.append('<g transform=\"translate(').append(t[0]).append(',').append(t[1]).append(')scale(').append(this.scale).append(')\">')\r\n      buf.append(this.renderDefs())\r\n      buf.append(root.render(this))\r\n      buf.append('</g></svg>')\r\n      this.box.innerHTML = buf.toString()\r\n      this.svg = this.box.firstElementChild\r\n    }\r\n  }\r\n\r\n  renderDefs () {\r\n    let buf = new StringBuffer('<defs>')\r\n    buf.append(this.getTemplate('Grid', this.prop('gridSize')))\r\n    let markers = this.graph.markers\r\n    if (markers.length > 0) { buf.append(SVGRenderer.renderMarkers(markers)) }\r\n    buf.append('</defs>')\r\n    return buf.toString()\r\n  }\r\n\r\n  refresh () {\r\n    if (!this.svg) return\r\n    let g = this.svg.querySelector('g')\r\n    let t = this.translate\r\n    g.setAttribute('transform', 'translate(' + t[0] + ',' + t[1] + ')scale(' + this.scale + ')')\r\n  }\r\n\r\n  static renderMarkers (markers) {\r\n    let buf = new StringBuffer(); let str1; let str2\r\n    markers.forEach(function (marker) {\r\n      str1 = this.TEMPLATES['Marker'](marker)\r\n      str2 = marker.shape\r\n      if (!_.isString(str2)) { str2 = this.renderShape(str2) }\r\n      str1 = str1.replace(/#\\{shape\\}/, str2)\r\n      buf.append(str1)\r\n    }, this)\r\n    return buf.toString()\r\n  }\r\n\r\n  static renderLabel (box) {\r\n    return this.TEMPLATES['Label'](box)\r\n  }\r\n\r\n  static renderShape (shape) {\r\n    let template = this.TEMPLATES[shape.name]\r\n    if (_.isString(template)) { template = _.template(template) }\r\n    return template(shape)\r\n  }\r\n\r\n  static getPathData (shape) {\r\n    let points = shape.points\r\n    let controlPts = shape.controlPts\r\n    if (!points || points.length === 0) return ''\r\n\r\n    if (!controlPts && shape.round) {\r\n      // render rounded line joins.\r\n      let newPts = []\r\n      controlPts = []\r\n      let prev = points[0]; let next; let d1; let d2; let corner\r\n      newPts.push(prev)\r\n      for (let i = 1; i < points.length - 1; i++) {\r\n        next = points[i]\r\n        // set the control point first.\r\n        controlPts[2 * i] = [next, next]\r\n        // check the size of the corner.\r\n        d1 = prev.distance(next)\r\n        d2 = next.distance(points[i + 1])\r\n        corner = Math.min(shape.round, d1 / 2, d2 / 2)\r\n        // split the point into two.\r\n        newPts.push(next.getDirection(prev).scale(corner).translate(next))\r\n        newPts.push(next.getDirection(points[i + 1]).scale(corner).translate(next))\r\n        prev = next\r\n      }\r\n      newPts.push(points[points.length - 1])\r\n      points = newPts\r\n    }\r\n    let buf = new StringBuffer('M'); let point\r\n    for (let i = 0; i < points.length; i++) {\r\n      point = points[i]\r\n      if (i === 0) { buf.append(point) } else {\r\n        if (controlPts && controlPts[i]) {\r\n          buf.append(' C ')\r\n          for (let j = 0; j < controlPts[i].length; j++) { buf.append(controlPts[i][j]).append(' ') }\r\n          buf.append(point)\r\n        } else { buf.append(' L ').append(point) }\r\n      }\r\n    }\r\n    return buf.toString()\r\n  }\r\n\r\n  static renderLink (shape) {\r\n    let buf = new StringBuffer()\r\n    let d = SVGRenderer.getPathData(shape)\r\n    if (shape.showGauge) {\r\n      buf.append('<path style=\"stroke: white; stroke-width: 9; visibility: hidden; pointer-events: stroke;\" d=\"')\r\n        .append(d).append('\"/>')\r\n    }\r\n    buf.append('<path d=\"').append(d).append('\"')\r\n    if (shape.startMarker || shape.endMarker) {\r\n      buf.append(' style=\"')\r\n      if (shape.startMarker) { buf.append('marker-start: url(#').append(_.isString(shape.startMarker) ? shape.startMarker : shape.startMarker.id).append(');') }\r\n      if (shape.endMarker) { buf.append('marker-end: url(#').append(_.isString(shape.endMarker) ? shape.endMarker : shape.endMarker.id).append(');') }\r\n      buf.append('\"')\r\n    }\r\n    buf.append('/>')\r\n    return buf.toString()\r\n  }\r\n\r\n  static appendContent (el, content) {\r\n    let buf = new StringBuffer()\r\n    buf.append('<svg>').append(content).append('</svg')\r\n    let temp = DomUtils.createElement('div', null, null, buf.toString()).firstElementChild\r\n\r\n    while (temp.firstChild) { el.appendChild(temp.firstChild) }\r\n    return el\r\n  }\r\n\r\n  static transform (transform) {\r\n    let translate = [0, 0]; let scale = 1.0\r\n    //\r\n    let parts = transform.match(/translate\\(\\s*([^)]+)/)\r\n    if (parts) {\r\n      let m = parts[1].trim().match(/([\\d.-]+)[ ,]([\\d.-]+)/)\r\n      if (m) {\r\n        translate[0] = parseFloat(m[1]) || 0\r\n        translate[1] = parseFloat(m[2]) || 0\r\n      } else { translate[0] = translate[1] = parseFloat(parts[1]) }\r\n    }\r\n    parts = transform.match(/scale\\(\\s*([^)]+)/)\r\n    if (parts) { scale = parseFloat(parts[1]) || 1.0 }\r\n\r\n    return { translate, scale }\r\n  }\r\n}\r\n/* eslint-disable no-template-curly-in-string */\r\nSVGRenderer.TEMPLATES = {\r\n  $root: '<g id=\"${id}\" class=\"${className}\">#{children}</g>',\r\n  $node: '<g id=\"${id}\" class=\"${className}\" style=\"${style}\" ns=\"${namespace}\" transform=\"translate(${x},${y})\">#{shape}#{label}</g>',\r\n  $edge: '<g id=\"${id}\" class=\"${className}\" style=\"${style}\" ns=\"${namespace}\">#{shape}#{label}</g>',\r\n  Ellipse: '<ellipse cx=\"0\" cy=\"0\" rx=\"${width/2}\" ry=\"${height/2}\"/>',\r\n  Rectangle: '<rect x=\"${-width/2}\" y=\"${-height/2}\" width=\"${width}\" height=\"${height}\" rx=\"9\" ry=\"9\"/>',\r\n  Triangle: '<polygon points=\"${-width/2},${-height/2} ${width/2},${-height/2} 0,${height/2}\"/>',\r\n  Rhombus: '<polygon points=\"0,${-height/2} ${width/2},0 0,${height/2} ${-width/2},0\"/>',\r\n  Hexagon: function (config) {\r\n    var vertical = config.direction === 'north' || config.direction === 'south'\r\n    if (vertical) { return '<polygon points=\"0,${-height/2} ${width/2},${-height/4} ${width/2},${height/4} 0,${height/2} ${-width/2},${height/4} ${-width/2},${-height/4}\"/>' } else { return '<polygon points=\"${-width/2},0 ${width/4},${-height/2} ${width/4},${-height/2} ${width/2},0 ${width/4},${height/2} ${-width/4},${height/2}\"/>' }\r\n  },\r\n  Polygon: function (shape) {\r\n    let buf = new StringBuffer('<polygon points=\"')\r\n    shape.points.forEach(function (pt) {\r\n      buf.append(pt[0]).append(',').append(pt[1]).append(' ')\r\n    })\r\n    buf.removeLast()\r\n    buf.append('\"/>')\r\n    return buf.toString()\r\n  },\r\n  Image: function (config) {\r\n    return '<image x=\"${-width/2}\" y=\"${-height/2}\" width=\"${width}\" height=\"${height}\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"' + config.image + '\"/>'\r\n  },\r\n  Marker: function (marker) {\r\n    return `\r\n<marker id=\"${marker.id}\" markerWidth=\"${marker.size}\" markerHeight=\"${marker.size}\" refx=\"${marker.ref[0]}\"\r\nrefy=\"${marker.ref[1]}\" orient=\"auto\" viewbox=\"${marker.viewBox.x} ${marker.viewBox.y} ${marker.viewBox.width} ${marker.viewBox.height}\"\r\nmarkerUnits=\"userSpaceOnUse\" ${marker.fill ? `style=\"stroke: ${marker.fill};fill:${marker.fill}\"` : ''}>#{shape}</marker>\r\n`.trim()\r\n  },\r\n  Grid: function (size) {\r\n    return `\r\n<pattern id=\"GridPattern\" width=\"${size}\" height=\"${size}\" patternUnits=\"userSpaceOnUse\">\r\n  <ellipse cx=\"0\" cy=\"0\" rx=\"1\" ry=\"1\" fill=\"#999999\"/>\r\n  <ellipse cx=\"0\" cy=\"${size}\" rx=\"1\" ry=\"1\" fill=\"#999999\"/>\r\n  <ellipse cx=\"${size}\" cy=\"0\" rx=\"1\" ry=\"1\" fill=\"#999999\"/>\r\n  <ellipse cx=\"${size}\" cy=\"${size}\" rx=\"1\" ry=\"1\" fill=\"#999999\"/>\r\n</pattern>`.trim()\r\n  },\r\n  Label: _.template(`\r\n<% var box = _.has(data, \"dx\") ? data : (data.getLabelBox ? data.getLabelBox() : null);\r\n   if (box) {%>\r\n  <g <% if (box.config && box.config.class) {%>class=\"<%=box.config.class%>\"<%}%>\\\r\n    <% if (box.config && box.config.ns) {%>ns=\"<%=box.config.ns%>\"<%}%>\\\r\n    <% if (box.config && box.config.inlineStyle) {%>\\\r\n      font-size=\"<%=box.config.fontSize%>\"\\\r\n      font-family=\"<%=box.config.fontFamily%>\"\\\r\n      font-weight=\"<% if (box.bold) {%>bold<%} else {%>normal<%}%>\"\\\r\n      <% if (box.underline) {%>text-decoration=\"underline\"<%}%>\\\r\n      <% if (box.italic) {%>font-style=\"italic\"<%}%>\\\r\n    <%}%>\\\r\n    text-anchor=\"<%=box.anchor%>\"\\\r\n    transform=\"translate(<%=box.bounds.x%>,<%=box.bounds.y%>)<% if (box.config && box.config.rotation) {%>rotate(<%=box.config.rotation%> <%=box.pivot[0]%> <%=box.pivot[1]%>)<%}%>\">\r\n  <% if (box.config.backgroundStyle) {%>\r\n    <rect x=\"<%=-box.bounds.width/2%>\" y=\"<%=-box.bounds.height/2%>\" width=\"<%=box.bounds.width%>\" height=\"<%=box.bounds.height%>\" style=\"<%=box.config.backgroundStyle%>\"/>\r\n  <% } if (_.isArray(box.label)) {\r\n    _.each(box.label, function(value, line) {%>\r\n      <text <% if (box.config && box.config.textStyle) {%>style=\"<%=box.config.textStyle%>\"<%}%>\\\r\n        dx=\"<%=box.dx%>\" dy=\"<%=box.dy + box.lineHeight * line%>\"><%=value%></text>\r\n    <%});} else { %>\r\n      <text><%=box.label%></text>\r\n    <%}%>\r\n    <% if (box.config.title) {%>\r\n      <title><%=box.config.title%></title>\r\n    <%}%>\r\n  </g>\r\n<%}%>\r\n`.trim(), { variable: 'data' }) // TODO add more inline text styles.\r\n}\r\n\r\nexport default SVGRenderer\r\n","module.exports = __WEBPACK_EXTERNAL_MODULE_lodash__;"],"sourceRoot":""}