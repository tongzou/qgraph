{"version":3,"sources":["webpack://qgraph/webpack/universalModuleDefinition","webpack://qgraph/webpack/bootstrap","webpack://qgraph/./src/behavior/Behavior.js","webpack://qgraph/./src/behavior/GraphBehavior.js","webpack://qgraph/./src/behavior/SelectionBehavior.js","webpack://qgraph/./src/event/event-dispatcher.js","webpack://qgraph/./src/event/events.js","webpack://qgraph/./src/event/key-utils.js","webpack://qgraph/./src/geometry/Ellipse.js","webpack://qgraph/./src/geometry/Line.js","webpack://qgraph/./src/geometry/Link.js","webpack://qgraph/./src/geometry/Point.js","webpack://qgraph/./src/geometry/Rectangle.js","webpack://qgraph/./src/geometry/Rhombus.js","webpack://qgraph/./src/geometry/Shape.js","webpack://qgraph/./src/graph/Cell.js","webpack://qgraph/./src/graph/Edge.js","webpack://qgraph/./src/graph/Graph.js","webpack://qgraph/./src/graph/Node.js","webpack://qgraph/./src/index.js","webpack://qgraph/./src/layout/FlowLayout.js","webpack://qgraph/./src/layout/Layout.js","webpack://qgraph/./src/util/Cache.js","webpack://qgraph/./src/util/Utils.js","webpack://qgraph/./src/util/base64.js","webpack://qgraph/./src/util/dom-utils.js","webpack://qgraph/./src/util/string-buffer.js","webpack://qgraph/./src/view/Label.js","webpack://qgraph/./src/view/Marker.js","webpack://qgraph/./src/view/Renderer.js","webpack://qgraph/./src/view/SVGRenderer.js","webpack://qgraph/external {\"root\":\"_\",\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"lodash\"}"],"names":["Behavior","renderer","GraphBehavior","dispatcher","register","handleDrag","handleZoom","offset","type","ns","graph","pos","event","transform","scale","pan","prop","ctrlKey","shiftKey","t","translate","SelectionBehavior","selectCell","unselectCell","handleMultiSelect","selectedNodes","selectedLinks","attachedLinks","classed","selectedVertices","length","getShapes","getAttachedEdges","selectedEdges","data","cell","toggle","isSelected","_firstSelection","d3","select","dataTarget","moveToFront","setSelection","util","getProperty","startPt","Point","rect","getBoundingRectangle","rubberband","appendNode","getCellLayer","template","_","cells","getCurrentRoot","children","filter","box","getBounds","contains","remove","attr","x","y","width","height","DEFAULTS","stopPropagation","EventDispatcher","root","zoomScale","Infinity","config","rootNS","getAttribute","assign","listeners","dragging","handler","bind","handleEvent","started","enterStack","Events","on","startKeys","off","stopKeys","document","Math","max","min","target","buf","stack","isRoot","startsWith","substring","rootTarget","nsTarget","splice","prepend","parentNode","targetStack","toString","eventFromInput","getPosition","info","isKeyEvent","getEventInfo","pow","wheelDelta","button","dragObject","mouse","dragPos","mousemove","currentPos","dispatch","mouseup","preventDefault","simulateEnterLeave","last","clearEnterStack","k","pop","getNS","index","i","val","append","item","push","nsType","forEach","key","match","regexp","listener","context","callback","apply","window","isNaN","lastPosition","isArray","registerKey","ctrl","alt","shift","meta","code","unregisterKey","zIndex","RegExp","stop","registeredType","container","e","changedTouches","svg","ownerSVGElement","createSVGPoint","point","clientX","clientY","matrixTransform","getScreenCTM","inverse","getBoundingClientRect","left","clientLeft","top","clientTop","el","events","indexOf","split","eventName","addEventListener","attachEvent","removeEventListener","detachEvent","fire","name","args","KEY","ALT","BACK_SPACE","CAPS_LOCK","CONTROL","DELETE","DOWN","END","ENTER","ESCAPE","HOME","LEFT","META","NUM_LOCK","PAGE_DOWN","PAGE_UP","PAUSE","PRINTSCREEN","RIGHT","SCROLL_LOCK","SHIFT","SPACE","TAB","UP","getKeyEvent","KeyboardEvent","keyCode","which","getKeyData","altKey","metaKey","Ellipse","pt","orthogonal","a","b","cx","cy","px","py","dx","parseInt","dy","abs","d","h","f","g","det","sqrt","xout1","xout2","yout1","yout2","dist1","dist2","xout","yout","p","dir","getDirection","direction","Line","start","end","distance","l","cosa","dotProduct","x0","y0","x1","y1","x2","y2","x3","y3","denom","numeA","numeB","ua","ub","intersectionX","intersectionY","defaultConfig","showGauge","defaultGeometry","anchorX","anchorY","offsetX","offsetY","linkTypes","Link","terminalVisual","shapeConfig","startMarker","endMarker","startNormal","endNormal","view","renderLink","geometry","isNumber","defaults","points","clone","getScaled","offsetPosition","defaultsDeep","LinkClass","console","log","DirectLink","BezierLink","pts","ctrlpts","controlPts","p1","p2","p3","p4","s","EntityRelations","source","Port","edge","isSourceLeft","right","isTargetLeft","result","getCenterY","xe","ye","seg","segment","dep","arr","midY","Manhattan","MIN_BUFFER","autoRoute","randomNoise","step","maxChannelWidth","boxes","startBox","endBox","side","side2","intersect","j","channel","channel2","startPadding","endPadding","_getChannel","horizontal","bottom","_getFirstIntersection","_getRouteTendency","_hasIntersection","_moveSegment","breakPt","_getRouteDirection","getCenter","box1","box2","r","getLeft","getRight","getBottom","getTop","getTranslated","route","_mergeSegments","node","getCommonAncestor","childNodes","getDescendants","excludeFromRouting","isAncestor","range","randomNumber","floor","random","noise","sign","buffer","startBuffer","endBuffer","startBufferNormal","endBufferNormal","middle","prunePts","detectIntersection","savedIndex","savedSide","pt1","pt2","S","N","E","W","SE","NE","SW","NW","h1","h2","equals","aPt","dist","angle","cos","PI","sin","rotate","vertical","Rectangle","w","contains1","contains2","outPt","alpha","atan2","pi","pi2","beta","tan","margin","rects","minx","miny","maxx","maxy","each","Rhombus","tx","ty","intersection","registry","Shape","n","refPt","constructor","getPerimeter","getTemplate","c","Cell","id","uniqueId","decorators","createDecorators","views","viewProps","Type","namespace","Error","props","value","isUndefined","shape","getShape","className","computedClassName","style","viewProp","get","ShapeClass","Cache","set","role","isString","getView","render","currentRoot","getLabelBox","renderLabel","destroyed","_computedClassName","hasOwnProperty","prototype","Object","getPrototypeOf","Edge","setSource","sourcePos","setTarget","targetPos","setTerminal","setEdgeAt","removeEdge","addOutEdge","addInEdge","label","getLabelBoxForLink","center","refPts","getReferencePoints","terminals","getBound","getPort","getLink","getTerminalVisual","nodeDefaults","draggable","selectable","editable","resizable","sourceable","targetable","visible","edgeDefaults","size","color","Graph","model","nodes","edges","selection","Utils","buildTypes","nodeTypes","edgeTypes","markers","marker","markerConfig","getMarker","initConfig","loadModel","parent","NodeClass","getJSClass","addChild","from","to","EdgeClass","addNode","child","addEdge","defaultClass","jsClass","getConstructor","without","allowDanglingEdges","multiConnect","readOnly","viewOnly","Node","inEdges","outEdges","ports","undefined","portName","endPt","typeName","addShape","Base64","DomUtils","StringBuffer","Label","Marker","Layout","FlowLayout","Renderer","SVGRenderer","bounds","items","owner","getLinkedNodes","hgap","vgap","_flPos","moveTo","trigger","orientation","toUpperCase","HORIZONTAL","VERTICAL","caches","getCache","clear","_debugging","_debugAll","typeRegistry","Array","Map","createType","defaultType","extend","extends","types","protoProps","staticProps","Surrogate","superclass","obj","cArr","super","eval","debug","moduleName","message","getRelativePosition","unscale","o","has","isFunction","_keyStr","encode","input","output","chr1","chr2","chr3","enc1","enc2","enc3","enc4","_utf8_encode","charCodeAt","charAt","decode","replace","String","fromCharCode","_utf8_decode","string","utftext","c1","c2","c3","inBrowser","navigator","isIE","sAgent","userAgent","Idx","isFireFox","InstallTrigger","isChrome","raw","isMac","platform","isWindows","appVersion","isLinux","createElement","tag","attribs","styles","html","setElement","innerHTML","createElementByString","str","temp","setAttribute","testElement","method","nodeType","getAncestorBy","body","elRect","contextRect","getCenterPosition","move","getSize","offsetWidth","offsetHeight","resize","preloadImages","array","list","loaded","img","that","Image","onload","src","getImageInfo","downloadFile","mime","encoded","atob","decodeURI","GetBlob","msSaveBlob","link","href","download","display","appendChild","click","removeChild","contentType","sliceSize","byteArrays","slice","byteNumbers","byteArray","Uint8Array","Blob","openImage","image","myWindow","open","myDocument","tagName","stuff","concat","sep","join","FONT_BOLD","FONT_ITALIC","FONT_UNDERLINE","FONT_SHADOW","fontSize","fontFamily","fontStyle","fontColor","padding","linePadding","align","rotation","stringMeasureEl","measureDiv","baselineDiv","getStringSize","memoize","bold","position","visibility","doc","contentWindow","write","close","getElementById","fontWeight","strut","firstChild","baselineHeight","offsetTop","baseline","wrap","maxWidth","spaceSize","space","lineHeight","lines","words","line","currentWidth","wordWidth","newLine","word","labelConfig","containerWidth","containerHeight","_getLabelBox","call","wrappedLabel","anchor","setAnchorX","pivot","maxBounds","_label","underline","italic","shadow","editor","refEl","textEl","singleLine","unselectable","overflow","border","focus","cancel","arrow","viewBox","ref","fill","triangle","oval","diamond","factory","tabindex","layout","LayoutClass","_translate","_scale","graphBehavior","selectionBehavior","nodeBehavior","edgeBehavior","connectionBehavior","scaled","viewport","isNull","vp","refresh","_graph","initializeBehaviors","renderMarkers","JsClass","_delayEdit","delay","preprocessor","TEMPLATES","parts","part","trim","camelCase","interpolate","gridSize","gBounds","vBounds","parseFloat","defaultClickMode","hideOutline","singleSelect","gridEnabled","guidesEnabled","maxZoom","minZoom","zoomFactor","maskOpacity","NS","SVGElement","createElementNS","defineProperties","enumerable","configurable","$node","$temp","cloneNode","outerHTML","ropen","nodeName","rclose","markup","lastChild","firstElementChild","toDataURL","options","_svg","msg","exportSVG","svgXml","svgDataurl","base64dataURLencode","b64","btoa","exportImage","canvas","ctx","getContext","svgImg","drawImage","imageDataurl","onerror","exportImageCanvg","canvg","jsCanvas","xcanvas","keepOutsideViewport","bbox","getBBox","compile","keepNonSafe","renderDefs","querySelector","str1","str2","renderShape","round","newPts","prev","next","d1","d2","corner","getPathData","content","m","$root","$edge","Triangle","Hexagon","Polygon","removeLast","Grid","variable"],"mappings":"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","file":"qgraph.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"qgraph\", [\"lodash\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"qgraph\"] = factory(require(\"lodash\"));\n\telse\n\t\troot[\"qgraph\"] = factory(root[\"_\"]);\n})((typeof window !== 'undefined' ? window : this), function(__WEBPACK_EXTERNAL_MODULE_lodash__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","export default class Behavior {\n  constructor (renderer) {\n    this.renderer = renderer\n  }\n\n  destroy () {\n    delete this.renderer\n  }\n}\n","/**\n * Created by tong on 6/28/2016.\n */\nimport Behavior from './Behavior'\n\n/**\n * Graph handler handles Panning and Zoom and rubber band selection\n */\nclass GraphBehavior extends Behavior {\n  constructor (renderer) {\n    super(renderer)\n    let dispatcher = renderer.dispatcher\n    // TODO:\n    // let f = function(type, ns, graph, pos, event) {\n    // \t//Cursor.updateCursor(type, ns, graph, event);\n    // };\n    dispatcher.register(/^drag.*\\.graph$/, this.handleDrag, this)\n    dispatcher.register(/^zoom/, this.handleZoom, this)\n    // dispatcher.register(['mousedown.graph', 'mouseenter.graph', 'mouseleave.graph'], f);\n    this.offset = null\n  }\n\n  handleZoom (type, ns, graph, pos, event) {\n    this.renderer.transform(null, null, event.scale)\n  }\n\n  handleDrag (type, ns, graph, pos, event) {\n    if (type == 'dragstart') {\n      let pan = (this.renderer.prop('defaultClickMode') == 'pan') ^ (event.ctrlKey || event.shiftKey)\n      if (!pan) return\n      let t = this.renderer.translate\n      this.offset = [t[0] - pos[0], t[1] - pos[1]]\n      return\n    }\n    if (!this.offset) return\n    this.renderer.transform(pos[0] + this.offset[0], pos[1] + this.offset[1])\n    if (type == 'dragend') {\n      // Cursor.updateCursor('mouseup', ns, graph, event);\n      delete this.offset\n    }\n  }\n}\n\nexport default GraphBehavior\n","import Rectangle from '../geometry/Rectangle'\nimport Cell from '../graph/Cell'\nimport Behavior from './Behavior'\n\nclass SelectionBehavior extends Behavior {\n  constructor (renderer) {\n    super(renderer)\n    let dispatcher = renderer.dispatcher\n    dispatcher.register('mousedown.*', this.selectCell, this)\n    dispatcher.register('mouseup.*', this.unselectCell, this)\n    dispatcher.register('drag*.graph', this.handleMultiSelect, this)\n    // graph.on(Graph.EVENT_TYPES.SELECTION_CHANGE, this.updateSelections, this)\n    this.selectedNodes = null\n    this.selectedLinks = null\n    this.attachedLinks = null\n  }\n\n  updateSelections () {\n    if (this.selectedNodes) {\n      this.selectedNodes.classed('selected', false)\n    }\n    if (this.selectedLinks) {\n      this.selectedLinks.classed('selected', false)\n    }\n\n    this.selectedNodes = null\n    this.selectedLinks = null\n    this.attachedLinks = null\n\n    if (this.graph.selectedVertices && this.graph.selectedVertices.length > 0) {\n      this.selectedNodes = this.graph.renderer.getShapes(this.graph.selectedVertices)\n      this.attachedLinks = this.graph.renderer.getShapes(this.graph.getAttachedEdges())\n      this.selectedNodes.classed('selected', true)\n    }\n\n    if (this.graph.selectedEdges && this.graph.selectedEdges.length > 0) {\n      this.selectedLinks = this.graph.renderer.getShapes(this.graph.selectedEdges)\n      this.selectedLinks.classed('selected', true)\n    }\n  }\n\n  selectCell (type, ns, data, pos, event) {\n    var cell = data === this.graph ? null : data\n    if (cell && !(cell instanceof Cell)) return\n    var toggle = event.ctrlKey || event.shiftKey\n    if (cell && (cell instanceof Cell)) {\n      if (!this.graph.isSelected(cell)) {\n        delete cell._firstSelection\n      } else {\n        cell._firstSelection = true\n      }\n\n      d3.select(event.dataTarget).moveToFront()\n      this.graph.setSelection(cell, toggle)\n    }\n  }\n\n  unselectCell (type, ns, data, pos, event) {\n    var cell = data === this.graph ? null : data\n    if (cell && !(cell instanceof Cell)) return\n    var ctrlKey = event.ctrlKey || event.shiftKey\n    if (!cell) {\n      this.graph.setSelection(cell, ctrlKey)\n    }\n  }\n\n  handleMultiSelect (type, ns, data, pos, event) {\n    pos = util.scale(this.graph, pos)\n\n    if (type === 'dragstart') {\n      var select = (this.graph.getProperty('defaultClickMode') == 'select') ^ (event.ctrlKey || event.shiftKey)\n      if (!select) return\n      this.startPt = new Point(pos[0], pos[1])\n      return\n    }\n    if (!this.startPt) return\n    var rect = Rectangle.getBoundingRectangle([new Point(pos[0], pos[1]), this.startPt])\n    var renderer = this.graph.renderer\n    if (!this.rubberband) {\n      this.rubberband = d3.select(renderer.appendNode(renderer.getCellLayer(), {\n        template: _.template('<g><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" stroke=\"#000000\" fill=\"none\" stroke-dasharray=\"3 3\"/></g>')\n      }, false))\n    }\n    if (type == 'dragend') {\n      var cells = this.graph.getCurrentRoot().children\n      // TODO: Define if we want to select vertexes / edges or both\n      cells = _.filter(cells, function (cell) {\n        var box = cell.getBounds()\n        if (rect.contains(box)) {\n          return true\n        }\n        return false\n      })\n      // TODO: Set selection\n      this.graph.setSelection(cells, event.ctrlKey)\n\n      this.rubberband.remove()\n      delete this.startPt\n      delete this.rubberband\n      return\n    }\n    this.rubberband.select('rect').attr({ x: rect.x, y: rect.y, width: rect.width, height: rect.height })\n  }\n\n  destroy () {\n    super.destroy()\n    delete this.selectedNodes\n    delete this.selectedLinks\n    delete this.attachedLinks\n  }\n}\n\nexport default SelectionBehavior\n","import _ from 'lodash'\nimport Events from './events'\nimport * as KeyUtils from './key-utils'\nimport DomUtils from '../util/dom-utils'\nimport StringBuffer from '../util/string-buffer'\n\nconst DEFAULTS = {\n  stopPropagation: false\n}\n\n/**\n * The EventDispatcher is the central event management. It will monitor all events and translate it into the a higher\n * level events for consumption.\n */\nexport default class EventDispatcher {\n  /**\n   * Constructor\n   * @param root the root element that the manager will listen to.\n   * @param zoomScale\n   * @param config the configuraton for the event dispatcher.\n   */\n  constructor (root, zoomScale = [0, Infinity], config = {}) {\n    this.root = root\n    this.rootNS = root.getAttribute('ns') || 'root'\n    this.zoomScale = zoomScale\n    _.assign(this, DEFAULTS, config)\n    this.scale = 1.0\n    this.listeners = {}\n    this.dragging = false\n    this.handler = _.bind(this.handleEvent, this)\n    this.started = false\n\n    // Simulate mouseenter/mouseleave events\n    this.enterStack = []\n  }\n\n  /**\n   * Start listening for events.\n   */\n  start () {\n    if (this.started) return\n    Events.on(this.root, 'mousedown mouseover mouseout mouseenter mouseleave dblclick click contextmenu mousewheel', this.handler)\n    this.startKeys()\n    this.started = true\n  }\n\n  /**\n   * Stop listening for events.\n   */\n  stop () {\n    if (!this.started) return\n    Events.off(this.root, 'mousedown mouseover mouseout mouseenter mouseleave dblclick click contextmenu mousewheel', this.handler)\n    this.stopKeys()\n    this.started = false\n  }\n\n  startKeys () {\n    Events.on(document, 'keydown keyup', this.handler)\n  }\n\n  stopKeys () {\n    Events.off(document, 'keydown keyup', this.handler)\n  }\n\n  zoomIn () {\n    this.scale *= 1.25\n    this.scale = Math.max(Math.min(this.zoomScale[1], this.scale), this.zoomScale[0])\n    return this.scale\n  }\n\n  zoomOut () {\n    this.scale *= 0.8\n    this.scale = Math.max(Math.min(this.zoomScale[1], this.scale), this.zoomScale[0])\n    return this.scale\n  }\n\n  getEventInfo (event) {\n    let target = event.target\n    const buf = new StringBuffer()\n    let ns\n    const stack = []\n    let isRoot = false\n    while (!isRoot && target && target !== document) {\n      ns = target.getAttribute('ns')\n      if (ns) {\n        isRoot = _.startsWith(ns, 'root.')\n        if (isRoot) {\n          ns = ns.substring(5)\n          event.rootTarget = target\n        }\n        if (!event.nsTarget) event.nsTarget = target\n        stack.splice(0, 0, target)\n        buf.prepend(ns)\n      }\n      target = target.parentNode\n    }\n    if (!isRoot) {\n      event.rootTarget = event.nsTarget\n    }\n\n    // target stack is a stack of all the ns targets up to the one with the data binding.\n    event.targetStack = stack\n    ns = buf.toString('.')\n    if (ns === '') ns = this.rootNS\n    return { data: event.rootTarget, ns: ns }\n  }\n\n  /**\n   * The main event handler method, it processes event and generate relevant events to dispatch.\n   */\n  handleEvent (event) {\n    let type = event.type\n\n    // Do not dispatch other events if we are dragging.\n    if (this.dragging || DomUtils.eventFromInput(event)) return\n\n    let data\n    let ns\n    const pos = this.getPosition(event)\n    let info\n    const isKeyEvent = (type === 'keydown' || type === 'keyup')\n    if (isKeyEvent) {\n      data = this.root\n      ns = KeyUtils.getKeyEvent(event)\n    } else {\n      info = this.getEventInfo(event)\n      if (!info) return\n      data = info.data\n      ns = info.ns\n    }\n\n    // Utils.log('EventDispatcher', \"handleEvent - \" + type + ';ns=' + ns)\n\n    if (type === 'mousewheel') {\n      this.scale *= Math.pow(2, event.wheelDelta * 0.002)\n      this.scale = Math.max(Math.min(this.zoomScale[1], this.scale), this.zoomScale[0])\n      event.scale = this.scale\n      type = 'zoom'\n    }\n\n    // See if we should create drag events\n    if (type === 'mousedown' && event.button === 0 /* only drag on left click */) {\n      // Create drag object.\n      const dragObject = { data: data, pos: ns === 'root' ? EventDispatcher.mouse(this.root, event) : pos }\n      this.dragging = false\n      // Start listening for mouse move.\n      let dragPos\n\n      const mousemove = (event) => {\n        let currentPos = this.getPosition(event)\n        if (!this.dragging) {\n          // check if the mouse has moved. IE always fire mousemove after mousedown even if the mouse hasn't moved yet.\n          if (dragObject.pos[0] === currentPos[0] && dragObject.pos[1] === currentPos[1]) return\n\n          // start dragging\n          this.dragging = true\n          event.rootTarget = dragObject.data\n          this.dispatch(event, 'dragstart', ns, dragObject.data, dragObject.pos)\n        }\n        if (ns === 'root') {\n          dragPos = EventDispatcher.mouse(this.root, event)\n        } else {\n          dragPos = currentPos\n        }\n        this.getEventInfo(event)\n        this.dispatch(event, 'drag', ns, dragObject.data, dragPos)\n      }\n      const mouseup = (event) => {\n        if (ns === 'root') {\n          dragPos = EventDispatcher.mouse(this.root, event)\n        } else {\n          dragPos = this.getPosition(event)\n        }\n\n        let info = this.getEventInfo(event)\n        if (this.dragging) {\n          this.dragging = false\n          this.dispatch(event, 'dragend', ns, dragObject.data, dragPos)\n        } else {\n          this.dispatch(event, 'mouseup', ns, info.data, dragPos)\n        }\n\n        Events.off(null, 'mousemove', mousemove)\n        Events.off(null, 'mouseup', mouseup)\n      }\n      event.preventDefault()\n      Events.on(null, 'mousemove', mousemove)\n      Events.on(null, 'mouseup', mouseup)\n    }\n\n    if (!isKeyEvent) {\n      this.simulateEnterLeave(event, type, ns, data, pos)\n    }\n    this.dispatch(event, type, ns, data, pos)\n\n    // disable the default context menu\n    // if (type == 'contextmenu')\n    // event.preventDefault()\n  }\n\n  /**\n   * try to simulate mouseenter/mouseleave events.\n   */\n  simulateEnterLeave (event, type, ns, data, pos) {\n    let last, stack\n    const clearEnterStack = (k) => {\n      k = k || 0\n      // Clear off the enter stack.\n      while (this.enterStack.length >= k + 1) {\n        last = this.enterStack.pop()\n        this.dispatch(event, 'mouseleave', last.ns, last.data, pos)\n      }\n    }\n    const getNS = function (index) {\n      let buf = new StringBuffer()\n      for (let i = 0; i <= index; i++) {\n        let val = stack[i].getAttribute('ns')\n        if (_.startsWith(val, 'root.')) {\n          val = val.substring(5)\n        }\n        buf.append(val)\n      }\n      return buf.toString('.')\n    }\n\n    if (ns && ns !== this.rootNS) {\n      if (type === 'mouseover') {\n        stack = event.targetStack\n        let item\n        for (let i = 0; i < stack.length; i++) {\n          if (i < this.enterStack.length) {\n            if (this.enterStack[i].target !== stack[i]) {\n              clearEnterStack(i)\n            } else {\n              continue\n            }\n          }\n          item = { data: data, ns: getNS(i), target: stack[i] }\n          this.enterStack.push(item)\n          this.dispatch(event, 'mouseenter', item.ns, data, pos)\n        }\n        if (stack.length < this.enterStack.length) {\n          clearEnterStack(stack.length)\n        }\n      }\n    }\n    if (ns === this.rootNS && this.enterStack.length > 0) {\n      clearEnterStack()\n    }\n  }\n\n  dispatch (event, type, ns, data, pos) {\n    // if (type != 'mouseover' && type != 'mouseout')\n    // Utils.log('EventDispatcher', \"dispatch - \" + type + '.' + ns + ';' + pos + ';rootTarget=' + event.rootTarget + ';data=' + data);\n    if (!this.started) return\n    const nsType = ns ? type + '.' + ns : type\n    _.forEach(this.listeners, (listeners, key) => {\n      if (EventDispatcher.match(nsType, listeners.regexp ? listeners.regexp : key)) {\n        _.forEach(listeners, (listener) => {\n          if (!listener.context) {\n            listener.callback.apply(window, [type, ns, data, pos, event])\n          } else {\n            listener.callback.apply(listener.context, [type, ns, data, pos, event])\n          }\n        })\n      }\n    })\n\n    // after dispatching, do not propagate.\n    if (this.stopPropagation && event.stopPropagation) {\n      event.stopPropagation()\n    }\n  }\n\n  getPosition (event) {\n    const pos = EventDispatcher.mouse(this.root, event)\n    if (!_.isNaN(pos[0]) && !_.isNaN(pos[1])) {\n      this.lastPosition = pos\n    }\n    return this.lastPosition\n  }\n\n  /**\n   * Registers a key event handler\n   * // Key is object {ctrl, alt, shift, meta, code}\n   */\n  registerKey (type, key, callback, context) {\n    if (_.isArray(key)) {\n      _.forEach(key, (k) => {\n        this.registerKey(type, k, callback, context)\n      })\n      return\n    }\n    key = KeyUtils.getKeyData(key.ctrl, key.alt, key.shift, key.meta, key.code)\n    if (!key.length) return\n    key = new StringBuffer(type).append(key).toString('.')\n\n    const listener = { callback: callback, context: context }\n    this.listeners[key] || (this.listeners[key] = [])\n    this.listeners[key].push(listener)\n  }\n\n  unregisterKey (type, key, callback, context) {\n    if (_.isArray(key)) {\n      _.forEach(key, (k) => {\n        this.unregisterKey(type, k, callback, context)\n      })\n      return\n    }\n    key = KeyUtils.getKeyData(key.ctrl, key.alt, key.shift, key.meta, key.code)\n    if (!key.length) return\n    key = new StringBuffer(type).append(key).toString('.')\n\n    let listeners = this.listeners[key]; let listener\n    if (!listeners) return\n    for (let i = 0; i < listeners.length; i++) {\n      listener = listeners[i]\n      if (listener.callback === callback && (!context || context === listener.context)) {\n        listeners.splice(i, 1)\n        return\n      }\n    }\n  }\n\n  /**\n   * Registers an event handler\n   */\n  register (type, callback, context, zIndex) {\n    if (_.isArray(type)) {\n      _.forEach(type, (t) => {\n        this.register(t, callback, context, zIndex)\n      })\n      return\n    }\n    const listener = { callback: callback, context: context, zIndex: zIndex }\n    let regexp = null\n    if (type instanceof RegExp) {\n      regexp = type\n      type = type + ''\n    }\n    this.listeners[type] || (this.listeners[type] = [])\n    if (regexp && !this.listeners[type].regexp) {\n      this.listeners[type].regexp = regexp\n    }\n    this.listeners[type].push(listener)\n  }\n\n  unregister (type, callback, context) {\n    if (type instanceof RegExp) {\n      type = type + ''\n    }\n    let listeners = this.listeners[type]; let listener\n    if (!listeners) return\n    for (let i = 0; i < listeners.length; i++) {\n      listener = listeners[i]\n      if (listener.callback === callback && (!context || context === listener.context)) {\n        listeners.splice(i, 1)\n        return\n      }\n    }\n  }\n\n  destroy () {\n    this.stop()\n    delete this.root\n    delete this.listeners\n    delete this.enterStack\n  }\n\n  /**\n   * Check if the registered event type matches the real event type. \"*\" is allowed as a wild card.\n   */\n  static match (nsType, registeredType) {\n    if (registeredType instanceof RegExp) {\n      return nsType.match(registeredType)\n    }\n\n    return nsType === registeredType\n    /* const arr = registeredType.split('*');\n    if (arr.length == 1)\n      return nsType == registeredType;\n\n    let substr, index = 0;\n    for (let i = 0; i < arr.length; i++) {\n      if (arr[i].length == 0) continue;\n      substr = nsType.slice(index);\n      index = substr.indexOf(arr[i]);\n      if (index < 0)\n        return false;\n      index += arr[i].length;\n    }\n    return true; */\n  }\n\n  static mouse (container, e) {\n    if (e.changedTouches) e = e.changedTouches[0]\n    let svg = container.ownerSVGElement || container\n    if (svg.createSVGPoint) {\n      let point = svg.createSVGPoint()\n      point.x = e.clientX; point.y = e.clientY\n      point = point.matrixTransform(container.getScreenCTM().inverse())\n      return [point.x, point.y]\n    }\n    let rect = container.getBoundingClientRect()\n    return [e.clientX - rect.left - container.clientLeft, e.clientY - rect.top - container.clientTop]\n  }\n}\n","export default {\n  on (el = (typeof window !== 'undefined' ? window : null), events, callback) {\n    if (!el) return\n    if (events.indexOf(' ') > 0) {\n      events = events.split(' ')\n    } else {\n      events = [events]\n    }\n    events.forEach(eventName => {\n      if (el.addEventListener) {\n        el.addEventListener(eventName, callback, false)\n      } else if (el.attachEvent) {\n        el.attachEvent(eventName, callback)\n      }\n    })\n  },\n\n  off (el = (typeof window !== 'undefined' ? window : null), events, callback) {\n    if (!el) return\n    if (events.indexOf(' ') > 0) {\n      events = events.split(' ')\n    } else {\n      events = [events]\n    }\n    events.forEach(eventName => {\n      if (el.removeEventListener) {\n        el.removeEventListener(eventName, callback, false)\n      } else if (el.detachEvent) {\n        el.detachEvent(eventName, callback)\n      }\n    })\n  },\n\n  fire (target, name, args) {\n  }\n}\n","\n// The Key Utility CLass for the Event Dispatcher\nimport StringBuffer from '../util/string-buffer'\n\n/**\n * KEY constant\n */\nexport const KEY = {\n  ALT: 18,\n  BACK_SPACE: 8,\n  CAPS_LOCK: 20,\n  CONTROL: 17,\n  DELETE: 46,\n  DOWN: 40,\n  END: 35,\n  ENTER: 13,\n  ESCAPE: 220,\n  HOME: 36,\n  LEFT: 37,\n  META: 224,\n  NUM_LOCK: 144,\n  PAGE_DOWN: 34,\n  PAGE_UP: 33,\n  PAUSE: 19,\n  PRINTSCREEN: 44,\n  RIGHT: 39,\n  SCROLL_LOCK: 145,\n  SHIFT: 16,\n  SPACE: 32,\n  TAB: 9,\n  UP: 38\n  // ADD          : DomUtils.isFireFox ? 61  : 187,\n  // SUBTRACT     : DomUtils.isFireFox ? 173 : 189\n}\n\nexport function getKeyEvent (event) {\n  if (!event || !(event instanceof KeyboardEvent)) {\n    return null\n  }\n\n  var key = event.keyCode || event.which\n\n  // Need to find a way to avoid this\n  if (key >= 16 && key <= 18) {\n    key = null\n  }\n\n  return getKeyData(event.ctrlKey, event.altKey, event.shiftKey, event.metaKey, key)\n}\n\nexport function getKeyData (ctrl, alt, shift, meta, key) {\n  var buf = new StringBuffer()\n\n  if (ctrl) buf.append('CTRL')\n  if (alt) buf.append('ALT')\n  if (shift) buf.append('SHIFT')\n  if (meta) buf.append('META')\n  if (key) buf.append(key)\n\n  return buf.toString('.')\n}\n","import Shape from './Shape'\nimport Point from './Point'\nimport Rectangle from './Rectangle'\n\nexport default class Ellipse extends Shape {\n  toString () {\n    return 'Ellipse:{x=' + this.x + ';y=' + this.y + ';width=' + this.width + ';height=' + this.height + '}'\n  }\n\n  static getPerimeter (rect, pt, orthogonal = false) {\n    let a = rect.width / 2\n    let b = rect.height / 2\n    let cx = rect.x\n    let cy = rect.y\n    let px = pt.x\n    let py = pt.y\n\n    // Calculates straight line equation through\n    // point and ellipse center y = d * x + h\n    let dx = parseInt(px - cx)\n    let dy = parseInt(py - cy)\n\n    if (dx === 0 && dy !== 0) {\n      return new Point(cx, cy + b * dy / Math.abs(dy))\n    } else if (dx === 0 && dy === 0) {\n      return new Point(px, py)\n    }\n\n    // Calculates intersection\n    let d = dy / dx\n    let h = cy - d * cx\n    let e = a * a * d * d + b * b\n    let f = -2 * cx * e\n    let g = a * a * d * d * cx * cx + b * b * cx * cx - a * a * b * b\n    let det = Math.sqrt(f * f - 4 * e * g)\n\n    // Two solutions (perimeter points)\n    let xout1 = (-f + det) / (2 * e)\n    let xout2 = (-f - det) / (2 * e)\n    let yout1 = d * xout1 + h\n    let yout2 = d * xout2 + h\n    let dist1 = Math.sqrt(Math.pow((xout1 - px), 2) + Math.pow((yout1 - py), 2))\n    let dist2 = Math.sqrt(Math.pow((xout2 - px), 2) + Math.pow((yout2 - py), 2))\n\n    // Correct solution\n    let xout = 0\n    let yout = 0\n\n    if (dist1 < dist2) {\n      xout = xout1\n      yout = yout1\n    } else {\n      xout = xout2\n      yout = yout2\n    }\n\n    let p = new Point(xout, yout)\n    let dir = Rectangle.getDirection(rect, p, orthogonal)\n    if (orthogonal) {\n      if (dir.x === -1) {\n        return { point: new Point(cx - a, cy), direction: dir }\n      }\n      if (dir.x === 1) {\n        return { point: new Point(cx + a, cy), direction: dir }\n      }\n      if (dir.y === -1) {\n        return { point: new Point(cx, cy - b), direction: dir }\n      }\n      if (dir.y === 1) {\n        return { point: new Point(cx, cy + b), direction: dir }\n      }\n    }\n    return { point: p, direction: dir }\n  }\n}\n","import Point from './Point'\n\nexport default class Line {\n  constructor (start, end) {\n    this.start = start\n    this.end = end\n  }\n\n  /**\n   * Calculate the length of this line\n   */\n  length () {\n    return this.start.distance(this.end)\n  }\n\n  /**\n   * Calculate the distance of this line to the point.\n   */\n  distance (pt) {\n    const x = this.start.distance(pt)\n    if (x === 0) return 0\n\n    const l = this.length()\n    const cosa = new Point((this.end.x - this.start.x) / l, (this.end.y - this.start.y) / l).dotProduct(\n      new Point(pt.x / x, pt.y / x))\n\n    return x * Math.sqrt(1 - cosa * cosa)\n  }\n\n  /**\n   * Function: intersection\n   *\n   * Returns the intersection of two lines as an <mxPoint>.\n   *\n   * Parameters:\n   *\n   * x0 - X-coordinate of the first line's startpoint.\n   * y0 - X-coordinate of the first line's startpoint.\n   * x1 - X-coordinate of the first line's endpoint.\n   * y1 - Y-coordinate of the first line's endpoint.\n   * x2 - X-coordinate of the second line's startpoint.\n   * y2 - Y-coordinate of the second line's startpoint.\n   * x3 - X-coordinate of the second line's endpoint.\n   * y3 - Y-coordinate of the second line's endpoint.\n   */\n  static intersection (x0, y0, x1, y1, x2, y2, x3, y3) {\n    const denom = ((y3 - y2) * (x1 - x0)) - ((x3 - x2) * (y1 - y0))\n    const numeA = ((x3 - x2) * (y0 - y2)) - ((y3 - y2) * (x0 - x2))\n    const numeB = ((x1 - x0) * (y0 - y2)) - ((y1 - y0) * (x0 - x2))\n\n    const ua = numeA / denom\n    const ub = numeB / denom\n\n    if (ua >= 0.0 && ua <= 1.0 && ub >= 0.0 && ub <= 1.0) {\n      // Get the intersection point\n      var intersectionX = x0 + ua * (x1 - x0)\n      var intersectionY = y0 + ua * (y1 - y0)\n\n      return new Point(intersectionX, intersectionY)\n    }\n\n    // No intersection\n    return null\n  }\n\n  toString () {\n    return 'Line:{start=' + this.start + ';end=' + this.end + '}'\n  }\n}\n","import _ from 'lodash'\nimport Point from './Point'\nimport Utils from '../util/Utils'\n\nlet defaultConfig = {\n  type: 'direct',\n  showGauge: true,\n  orthogonal: false\n}\n\nlet defaultGeometry = {\n  width: 0,\n  height: 0,\n  anchorX: 0,\n  anchorY: 0,\n  offsetX: 0,\n  offsetY: 0\n}\n\nlet linkTypes = {}\n\nclass Link {\n  constructor (terminalVisual, shapeConfig = {}, startMarker = null, endMarker = null) {\n    this.start = terminalVisual[0].point\n    this.end = terminalVisual[1].point\n    this.startNormal = terminalVisual[0].direction\n    this.endNormal = terminalVisual[1].direction\n    this.startMarker = startMarker\n    this.endMarker = endMarker\n    _.assign(this, shapeConfig)\n  }\n\n  render (view) {\n    return view.renderLink(this)\n  }\n\n  get points () { return null }\n  get controlPts () { return null }\n  get length () {\n    let points = this.points\n    let i\n    let l = 0\n    for (i = 0; i < points.length - 1; i++) {\n      l += points[i].distance(points[i + 1])\n    }\n    return l\n  }\n\n  /**\n   * Calculate the position where to put decorators or label..\n   *\n   * @param geometry: defines how far along the edge should the point be placed.\n   * @return *[] the relative position.\n   */\n  getRelativePosition (geometry) {\n    if (_.isNumber(geometry)) {\n      geometry = { x: geometry }\n    }\n    geometry = _.defaults(geometry, defaultGeometry)\n    let p = geometry.x\n    let l = this.length\n    if (Math.abs(p) <= 1) p *= l\n    if (p < 0) p = l + p\n    if (p > l) p = l\n\n    let points = this.points\n    let d\n    let point\n    let dir\n    for (let i = 0; i < points.length - 1; i++) {\n      d = points[i].distance(points[i + 1])\n      if (p <= d) {\n        // we've located the line segment.\n        point = points[i].clone()\n        dir = point.getDirection(points[i + 1])\n        point.translate(dir.getScaled(p))\n        break\n      }\n      p -= d\n    }\n\n    // return the last point.\n    if (!point) {\n      point = points[points.length - 1]\n    }\n    return Utils.offsetPosition([point.x, point.y], geometry)\n  }\n\n  toString () {\n    return 'Link'\n  }\n\n  static getLink (terminalVisual, shapeConfig = {}, startMarker = null, endMarker = null) {\n    shapeConfig = _.defaultsDeep(shapeConfig, defaultConfig)\n    let LinkClass = linkTypes[shapeConfig.type]\n    if (LinkClass) {\n      return new LinkClass(terminalVisual, shapeConfig, startMarker, endMarker)\n    }\n    console.log('link type not supported: ' + shapeConfig.type)\n    return null\n  }\n}\n\nclass DirectLink extends Link {\n  get points () {\n    return [this.start, this.end]\n  }\n}\n\nclass BezierLink extends Link {\n  get points () {\n    return [this.start, this.end]\n  }\n\n  get controlPts () {\n    let s = this.points[0]; let e = this.points[1]\n    let pts = []\n    pts[0] = null\n    pts[1] = []\n    if (this.startNormal.x === 0) {\n      pts[1][0] = new Point(s.x, (s.y + e.y) / 2)\n    } else {\n      pts[1][0] = new Point((s.x + e.x) / 2, s.y)\n    }\n    if (this.endNormal.x === 0) {\n      pts[1][1] = new Point(e.x, (s.y + e.y) / 2)\n    } else {\n      pts[1][1] = new Point((s.x + e.x) / 2, e.y)\n    }\n    return pts\n  }\n\n  getRelativePosition (geometry) {\n    if (_.isNumber(geometry)) {\n      geometry = { x: geometry }\n    }\n    geometry = _.defaults(geometry, defaultGeometry)\n    let p = geometry.x\n    let l = this.length\n    if (Math.abs(p) > 1) p /= l\n    if (p < 0) p++\n    if (p > 1) p--\n\n    let pts = this.points\n    let ctrlpts = this.controlPts\n    let p1 = pts[0]\n    let p2 = ctrlpts[1][0]\n    let p3 = ctrlpts[1][1]\n    let p4 = pts[1]\n\n    let point = [(1 - p) * (1 - p) * (1 - p) * p1.x + 3 * p * (1 - p) * (1 - p) * p2.x + 3 * p * p * (1 - p) * p3.x + p * p * p * p4.x, (1 - p) * (1 - p) * (1 - p) * p1.y + 3 * p * (1 - p) * (1 - p) * p2.y + 3 * p * p * (1 - p) * p3.y + p * p * p * p4.y]\n    return Utils.offsetPosition([point.x, point.y], geometry)\n  }\n}\n\nclass EntityRelations extends Link {\n  get points () {\n    let source = Port.getBounds(edge, true)\n    let target = Port.getBounds(edge, false)\n    let isSourceLeft = target.right() < source.x\n    let isTargetLeft = source.right() < target.x\n    let result = []\n\n    let x0 = (isSourceLeft) ? source.x : source.x + source.width\n    let y0 = source.getCenterY()\n    result.push(new Point(x0, y0))\n\n    let xe = (isTargetLeft) ? target.x : target.x + target.width\n    let ye = target.getCenterY()\n\n    let seg = this.segment\n\n    let dx = (isSourceLeft) ? -seg : seg\n    let dep = new Point(x0 + dx, y0)\n\n    dx = (isTargetLeft) ? -seg : seg\n    let arr = new Point(xe + dx, ye)\n\n    // Adds intermediate points if both go out on same side\n    if (isSourceLeft === isTargetLeft) {\n      let x = (isSourceLeft) ? Math.min(x0, xe) - seg : Math.max(x0, xe) + seg\n\n      result.push(new Point(x, y0))\n      result.push(new Point(x, ye))\n    } else if ((dep.x < arr.x) === isSourceLeft) {\n      let midY = y0 + (ye - y0) / 2\n\n      result.push(dep)\n      result.push(new Point(dep.x, midY))\n      result.push(new Point(arr.x, midY))\n      result.push(arr)\n    } else {\n      result.push(dep)\n      result.push(arr)\n    }\n\n    result.push(new Point(xe, ye))\n    return result\n  }\n}\n\nclass Manhattan extends Link {\n  constructor (terminalVisual, shapeConfig, startMarker, endMarker) {\n    shapeConfig = _.defaults(shapeConfig, {\n      MIN_BUFFER: 10,\n      autoRoute: false,\n      randomNoise: 0,\n      step: 1,\n      maxChannelWidth: 100\n    })\n    super(terminalVisual, shapeConfig, startMarker, endMarker)\n  }\n\n  get points () {\n    let pos = Manhattan.route(this.start, this.end, this.startNormal, this.endNormal, this.MIN_BUFFER)\n    if (this.autoRoute) {\n      this._mergeSegments(pos)\n      let boxes = []\n      let node\n      let startBox\n      let endBox\n      let container = edge.source.getCommonAncestor(edge.target)\n      let childNodes = container.getDescendants()\n      let index = 0\n      for (let i = 0; i < childNodes.length; i++) {\n        node = childNodes[i]\n        // Do not include source or target ancestors in routing.\n        if (node.excludeFromRouting(edge) || node.isAncestor(edge.source) || node.isAncestor(edge.target)) continue\n        if (node === edge.source) {\n          startBox = index\n        }\n        if (node === edge.target) {\n          endBox = index\n        }\n        boxes.push(node.getBounds(document))\n        index++\n      }\n      if (boxes.length > 1) {\n        this.autoRoute(pos, container.getBounds(document), boxes, startBox, endBox)\n      }\n    }\n\n    Manhattan._mergeSegments(pos)\n    if (this.randomNoise && pos.length > 3) {\n      for (let i = 1; i < pos.length - 2; i++) {\n        let range = this.randomNoise / this.step\n        let randomNumber = Math.floor(Math.random() * range * 2 - range + 1) * this.step\n\n        let noise\n        if (this.randomNoise && pos.length == 4) {\n          if (this.startNormal.x != 0 && this.startNormal.x != this.endNormal.x) {\n            if (this.randomNoise <= Math.abs(pos[1].x - pos[0].x - this.startNormal.x * this.MIN_BUFFER)) {\n              noise = this.randomNoise\n            } else {\n              noise = Math.abs(pos[1].x - pos[0].x - this.startNormal.x * this.MIN_BUFFER)\n            }\n          } else if (this.startNormal.y != 0 && this.startNormal.y != this.endNormal.y) {\n            if (this.randomNoise <= Math.abs(pos[1].y - pos[0].y - this.startNormal.y * this.MIN_BUFFER)) {\n              noise = this.randomNoise\n            } else {\n              noise = Math.abs(pos[1].y - pos[0].y - this.startNormal.y * this.MIN_BUFFER)\n            }\n          } else {\n            noise = this.randomNoise\n          }\n          let range = noise / this.step\n          let randomNumber\n          if (this.startNormal.x !== this.endNormal.x || this.startNormal.y !== this.endNormal.y) {\n            randomNumber = Math.floor(Math.random() * range * 2 - range + 1) * this.step\n          } else {\n            randomNumber = Math.sign(this.startNormal.x !== 0 ? this.startNormal.x : this.startNormal.y) * Math.floor(Math.random() * range + 1) * this.step\n          }\n          this._moveSegment(pos, 1, randomNumber, 1, 1)\n        }\n        if (this.randomNoise && pos.length > 4) {\n          for (let i = 1; i < pos.length - 2; i++) {\n            range = this.randomNoise / this.step\n            if (i == 1) {\n              randomNumber = Math.sign(this.startNormal.x !== 0 ? this.startNormal.x : this.startNormal.y) * Math.floor(Math.random() * range + 1) * this.step\n            } else if (i == pos.length - 3) {\n              randomNumber = Math.sign(this.endNormal.x !== 0 ? this.endNormal.x : this.endNormal.y) * Math.floor(Math.random() * range + 1) * this.step\n            } else {\n              randomNumber = Math.floor(Math.random() * range * 2 - range + 1) * this.step\n            }\n            this._moveSegment(pos, i, randomNumber, 1, 1)\n          }\n        }\n      }\n    }\n    return pos\n  }\n\n  // New function for finding route\n  static route (start, end, startNormal, endNormal, buffer) {\n    let startBuffer = new Point(start.x + startNormal.x * buffer, start.y + startNormal.y * buffer)\n    let endBuffer = new Point(end.x + endNormal.x * buffer, end.y + endNormal.y * buffer)\n    let startBufferNormal, endBufferNormal\n    let pts\n    if (startNormal.x !== 0) {\n      if ((endBuffer.x - startBuffer.x) / startNormal.x > 0) {\n        startBufferNormal = startNormal\n      } else {\n        startBufferNormal = new Point(0, (endBuffer.y >= startBuffer.y) ? 1 : -1)\n      }\n    } else {\n      if ((endBuffer.y - startBuffer.y) / startNormal.y > 0) {\n        startBufferNormal = startNormal\n      } else {\n        startBufferNormal = new Point((endBuffer.x >= startBuffer.x) ? 1 : -1, 0)\n      }\n    }\n    if (endNormal.x !== 0) {\n      if ((startBuffer.x - endBuffer.x) / endNormal.x > 0) {\n        endBufferNormal = endNormal\n      } else {\n        endBufferNormal = new Point(0, (startBuffer.y >= endBuffer.y) ? 1 : -1)\n      }\n    } else {\n      if ((startBuffer.y - endBuffer.y) / endNormal.y > 0) {\n        endBufferNormal = endNormal\n      } else {\n        endBufferNormal = new Point((startBuffer.x >= endBuffer.x) ? 1 : -1, 0)\n      }\n    }\n\n    if (startBufferNormal.dotProduct(endBufferNormal) === 0) {\n      let middle = (startBufferNormal.x === 0) ? new Point(startBuffer.x, endBuffer.y) : new Point(endBuffer.x, startBuffer.y)\n      pts = [start, startBuffer, middle, endBuffer, end]\n    } else if (startBufferNormal.dotProduct(endBufferNormal) < 0) {\n      if (startBufferNormal.x === 0) {\n        pts = [start, startBuffer, new Point(startBuffer.x, (start.y + end.y) / 2), new Point(endBuffer.x, (start.y + end.y) / 2), endBuffer, end]\n      } else {\n        pts = [start, startBuffer, new Point((start.x + end.x) / 2, startBuffer.y), new Point((start.x + end.x) / 2, endBuffer.y), endBuffer, end]\n      }\n    } else {\n      pts = [start, startBuffer, new Point(startBuffer.x + startBufferNormal.x * buffer, startBuffer.y + startBufferNormal.y * buffer), new Point(endBuffer.x + endBufferNormal.x * buffer, endBuffer.y + endBufferNormal.y * buffer), endBuffer, end]\n    }\n\n    let prunePts = []\n    prunePts[0] = pts[0]\n    for (let i = 1; i < pts.length - 1; i++) {\n      if ((pts[i].x === pts[i - 1].x && pts[i].x === pts[i + 1].x) || (pts[i].y === pts[i - 1].y && pts[i].y === pts[i + 1].y)) {\n        continue\n      }\n      prunePts.push(pts[i])\n    }\n    prunePts.push(pts[pts.length - 1])\n    return prunePts\n  }\n\n  /**\n  * Automatically route the connection to avoid intersections with other vertices.\n  */\n  autoRoute (pts, container, boxes, startBox, endBox) {\n    let side, side2, d, box, intersect, j\n    let channel, channel2, pt, dir\n\n    let startPadding = 0; let endPadding\n    // first get the start and end channel\n    box = boxes[endBox]\n    pt = pts[pts.length - 2]\n    if (pt.y < box.y) {\n      side = 1\n    } else if (pt.y > box.y + box.height) {\n      side = 3\n    } else if (pt.x < box.x) {\n      side = 0\n    } else {\n      side = 2\n    }\n    channel = _getChannel(container, endBox, boxes, side)\n    endPadding = channel.horizontal ? (channel.right - channel.left) / 2 : (channel.bottom - channel.top) / 2\n\n    for (let i = 0; i < pts.length - 1; i++) {\n      if (pts[i + 1].x === pts[i].x && pts[i + 1].y === pts[i].y) continue\n      intersect = _getFirstIntersection(pts, i, boxes, startBox, endBox)\n      if (!intersect) continue\n      j = intersect[0]\n      side = intersect[1]\n      box = boxes[j]\n      channel = _getChannel(container, j, boxes, side)\n      switch (side) {\n        case 0:\n        case 2:\n          pt = new Point((channel.right + channel.left) / 2, pts[i].y)\n          dir = _getRouteTendency(pts, i, pt, box, side)\n          side2 = dir < 0 ? 1 : 3\n          channel2 = _getChannel(container, j, boxes, side2)\n          // if the previous point is in the channel2, use that point instead of center of the channel.\n          if (i > 1 && (pts[i - 2].y === pts[i - 1].y) && (pts[i - 1].y > channel2.top && pts[i - 1].y < channel2.bottom)) {\n            d = pts[i - 1].y - pt.y\n          } else if (i < pts.length - 3 && (pts[i + 2].y === pts[i + 3].y) && (pts[i + 2].y > channel2.top && pts[i + 2].y < channel2.bottom)) {\n            d = pts[i + 2].y - pt.y\n          } else {\n            d = (channel2.bottom + channel2.top) / 2 - pt.y\n          }\n          // check if we need this pt.\n          if ((side === 0 && pt.x <= pts[i].x) || (side === 2 && pt.x >= pts[i].x)) {\n            pt = null\n          } else if (i > 0) {\n            // see if we can push the line out to where we started.\n            if (!_hasIntersection([new Point(pts[i].x, pts[i].y), new Point(pts[i].x, pts[i].y + d), new Point(pt.x, pt.y + d)], boxes)) {\n              pt = null\n            }\n          }\n          break\n        case 1:\n        case 3:\n          pt = new Point(pts[i].x, (channel.bottom + channel.top) / 2)\n          dir = _getRouteTendency(pts, i, pt, box, side)\n          side2 = dir < 0 ? 0 : 2\n          channel2 = _getChannel(container, j, boxes, side2)\n          // if the previous point is in the channel2, use that point instead of center of the channel.\n          if (i > 1 && (pts[i - 2].x === pts[i - 1].x) && (pts[i - 1].x > channel2.left && pts[i - 1].x < channel2.right)) {\n            d = pts[i - 1].x - pt.x\n          } else if (i < pts.length - 3 && (pts[i + 2].x === pts[i + 3].x) && (pts[i + 2].x > channel2.left && pts[i + 2].x < channel2.right)) {\n            d = pts[i + 2].x - pt.x\n          } else {\n            d = (channel2.right + channel2.left) / 2 - pt.x\n          }\n          // check if we need this pt.\n          if ((side === 1 && pt.y <= pts[i].y) || (side === 3 && pt.y >= pts[i].y)) {\n            pt = null\n          } else if (i > 0) {\n            // see if we can push the line out to where we started.\n            if (!_hasIntersection([new Point(pts[i].x, pts[i].y), new Point(pts[i].x + d, pts[i].y), new Point(pt.x + d, pt.y)], boxes)) {\n              pt = null\n            }\n          }\n          break\n        case 4:\n          continue\n      }\n      // max points.\n      if (i > 20) return\n      if (pt && (pt.x !== pts[i].x || pt.y !== pts[i].y)) {\n        pts.splice(i + 1, 0, pt)\n        _moveSegment(pts, i + 1, d, startPadding, endPadding)\n        i++\n      } else {\n        _moveSegment(pts, i, d, startPadding, endPadding)\n      }\n    }\n  }\n\n  static _hasIntersection (pts, boxes) {\n    for (let i = 0; i < pts.length - 1; i++) {\n      for (let j = 0; j < boxes.length; j++) {\n        if (boxes[j].detectIntersection(pts[i], pts[i + 1]) >= 0) {\n          return true\n        }\n      }\n    }\n    return false\n  }\n\n  static _getFirstIntersection (pts, i, boxes, startBox, endBox) {\n    let box\n    let side\n    let savedIndex = null\n    let savedSide = null\n    for (let j = 0; j < boxes.length; j++) {\n      if ((i === 0 && j === startBox) || (i === pts.length - 2 && j === endBox)) {\n        continue\n      }\n      box = boxes[j]\n      side = box.detectIntersection(pts[i], pts[i + 1])\n      if (side >= 0) {\n        if (savedIndex == null) {\n          savedIndex = j\n          savedSide = side\n        } else {\n          if (boxes[savedIndex].distance(pts[i]) > box.distance(pts[i])) {\n            savedIndex = j\n            savedSide = side\n          }\n        }\n      }\n    }\n    if (savedIndex != null) {\n      return [savedIndex, savedSide]\n    }\n    return null\n  }\n\n  _getRouteTendency (pts, i, breakPt, box, side) {\n    let dir\n    let p\n    switch (side) {\n      case 0:\n      case 2:\n        p = 'y'\n        break\n      case 1:\n      case 3:\n        p = 'x'\n        break\n    }\n    // first try the breakpt.\n    dir = _getRouteDirection(breakPt, pts[pts.length - 1])[p]\n    if (dir === 0) {\n      dir = -_getRouteDirection(pts[0], pts[pts.length - 1])[p]\n      if (dir === 0) {\n        if (breakPt[p] < box.getCenter()[p]) {\n          dir = -1\n        } else {\n          dir = 1\n        }\n      }\n    }\n    return dir\n  }\n\n  static _getRouteDirection (pt1, pt2) {\n    if (pt1.x === pt2.x) {\n      if (pt1.y < pt2.y) return Point.S\n      return Point.N\n    } else if (pt1.y === pt2.y) {\n      if (pt1.x < pt2.x) return Point.E\n      return Point.W\n    } else if (pt1.x < pt2.x) {\n      if (pt1.y < pt2.y) return Point.SE\n      return Point.NE\n    } else {\n      if (pt1.y < pt2.y) return Point.SW\n      return Point.NW\n    }\n  }\n\n  _getChannel (container, index, boxes, side) {\n    let maxChannelWidth = this.maxChannelWidth\n    let box1 = boxes[index]; let box2\n    let pt, i\n    let channel = {}; let l; let t; let b; let r\n    switch (side) {\n      case 0:\n        pt = box1.getLeft()\n        channel.right = pt.x\n        channel.horizontal = false\n        for (i = 0; i < boxes.length; i++) {\n          if (i === index) continue\n          r = boxes[i].getRight().x\n          if (r >= pt.x) continue\n          if (!channel.left || channel.left < r) {\n            channel.left = r\n          }\n        }\n        if (!channel.left) {\n          channel.left = container.getLeft().x\n          if (channel.right - channel.left > maxChannelWidth) {\n            channel.left = channel.right - maxChannelWidth\n          }\n        }\n        for (i = 0; i < boxes.length; i++) {\n          if (i === index) continue\n          box2 = boxes[i]\n          b = box2.getBottom().y\n          t = box2.getTop().y\n          if (b < pt.y && (box2.getRight() > channel.left && box2.getLeft() < channel.right)) {\n            if (!channel.top || channel.top < b) {\n              channel.top = b\n            }\n          }\n          if (t > pt.y && (box2.getRight() > channel.left && box2.getLeft() < channel.right)) {\n            if (!channel.bottom || channel.bottom > t) {\n              channel.bottom = t\n            }\n          }\n        }\n        if (!channel.top) channel.top = container.getTop().y\n        if (!channel.bottom) channel.bottom = container.getBottom().y\n        break\n      case 1:\n        pt = box1.getTop()\n        channel.horizontal = true\n        channel.bottom = pt.y\n        for (i = 0; i < boxes.length; i++) {\n          if (i === index) continue\n          b = boxes[i].getBottom().y\n          if (b >= pt.y) continue\n          if (!channel.top || channel.top < b) {\n            channel.top = b\n          }\n        }\n        if (!channel.top) {\n          channel.top = container.getTop().y\n          if (channel.bottom - channel.top > maxChannelWidth) {\n            channel.top = channel.bottom - maxChannelWidth\n          }\n        }\n        for (i = 0; i < boxes.length; i++) {\n          if (i === index) continue\n          box2 = boxes[i]\n          l = box2.getLeft().x\n          r = box2.getRight().x\n          if (r < pt.x && (box2.getBottom() > channel.top && box2.getTop() < channel.bottom)) {\n            if (!channel.left || channel.left < r) {\n              channel.left = r\n            }\n          }\n          if (l > pt.x && (box2.getBottom() > channel.top && box2.getTop() < channel.bottom)) {\n            if (!channel.right || channel.right > l) {\n              channel.right = l\n            }\n          }\n        }\n        if (!channel.left) channel.left = container.getLeft().x\n        if (!channel.right) channel.right = container.getRight().x\n\n        break\n      case 2:\n        pt = box1.getRight()\n        channel.horizontal = false\n        channel.left = pt.x\n        for (i = 0; i < boxes.length; i++) {\n          if (i === index) continue\n          l = boxes[i].getLeft().x\n          if (l <= pt.x) continue\n          if (!channel.right || channel.right > l) {\n            channel.right = l\n          }\n        }\n        if (!channel.right) {\n          channel.right = container.getRight().x\n          if (channel.right - channel.left > maxChannelWidth) {\n            channel.right = channel.left + maxChannelWidth\n          }\n        }\n        for (i = 0; i < boxes.length; i++) {\n          if (i === index) continue\n          box2 = boxes[i]\n          b = box2.getBottom().y\n          t = box2.getTop().y\n          if (b < pt.y && (box2.getRight() > channel.left && box2.getLeft() < channel.right)) {\n            if (!channel.top || channel.top < b) {\n              channel.top = b\n            }\n          }\n          if (t > pt.y && (box2.getRight() > channel.left && box2.getLeft() < channel.right)) {\n            if (!channel.bottom || channel.bottom > t) {\n              channel.bottom = t\n            }\n          }\n        }\n        if (!channel.top) channel.top = container.getTop().y\n        if (!channel.bottom) channel.bottom = container.getBottom().y\n        break\n      case 3:\n        pt = box1.getBottom()\n        channel.horizontal = true\n        channel.top = pt.y\n        for (i = 0; i < boxes.length; i++) {\n          if (i === index) continue\n          box2 = boxes[i]\n          if (box2.getTop().y <= pt.y) continue\n          if (!channel.bottom || channel.bottom > box2.getTop().y) {\n            channel.bottom = box2.getTop().y\n          }\n        }\n        if (!channel.bottom) {\n          channel.bottom = container.getBottom().y\n          if (channel.bottom - channel.top > maxChannelWidth) {\n            channel.bottom = channel.top + maxChannelWidth\n          }\n        }\n        for (i = 0; i < boxes.length; i++) {\n          if (i === index) continue\n          box2 = boxes[i]\n          l = box2.getLeft().x\n          r = box2.getRight().x\n          if (r < pt.x && (box2.getBottom() > channel.top && box2.getTop() < channel.bottom)) {\n            if (!channel.left || channel.left < r) {\n              channel.left = r\n            }\n          }\n          if (l > pt.x && (box2.getBottom() > channel.top && box2.getTop() < channel.bottom)) {\n            if (!channel.right || channel.right > l) {\n              channel.right = l\n            }\n          }\n        }\n        if (!channel.left) channel.left = container.getLeft().x\n        if (!channel.right) channel.right = container.getRight().x\n        break\n    }\n    return channel\n  }\n\n  /**\n  * Move a line segment by a specified distance.\n  *\n  * @param pts the list of points.\n  * @param i the index of the segment.\n  * @param d the distance to move.\n  * @param startPadding\n  * @param endPadding\n  */\n  _moveSegment (pts, i, d, startPadding, endPadding) {\n    // first check if we need to add new line segments.\n    let dir, l, pt\n    if (i === 0) {\n      // we need to break off the segment, since we can't change the starting point.\n      dir = pts[0].getDirection(pts[1])\n      if (!startPadding) {\n        startPadding = this.MIN_BUFFER\n      }\n      l = Math.min(startPadding, pts[0].distance(pts[1]) / 2)\n      pt = pts[0].getTranslated(dir.scale(l))\n      pts.splice(1, 0, pt)\n      this._moveSegment(pts, i + 1, d)\n      return\n    }\n    if (i === pts.length - 2) {\n      // we need to break off the segment, since we can't change the end point.\n      dir = pts[pts.length - 1].getDirection(pts[pts.length - 2])\n      if (!endPadding) {\n        endPadding = this.MIN_BUFFER\n      }\n      l = Math.min(endPadding, pts[pts.length - 1].distance(pts[pts.length - 2]) / 2)\n      pt = pts[pts.length - 1].getTranslated(dir.scale(l))\n      pts.splice(pts.length - 1, 0, pt)\n      this._moveSegment(pts, i, d)\n      return\n    }\n\n    if (pts[i].y === pts[i + 1].y) {\n      if (i > 0 && pts[i - 1].y === pts[i].y) {\n        pts.splice(i + 1, 0, pts[i].clone())\n        i++\n      }\n      if (i < pts.length - 2 && pts[i + 1].y === pts[i + 2].y) {\n        pts.splice(i + 1, 0, pts[i + 1].clone())\n      }\n      pts[i].y += d\n      pts[i + 1].y += d\n    } else {\n      if (i > 0 && pts[i - 1].x === pts[i].x) {\n        pts.splice(i + 1, 0, pts[i].clone())\n        i++\n      }\n      if (i < pts.length - 2 && pts[i + 1].x === pts[i + 2].x) {\n        pts.splice(i + 1, 0, pts[i + 1].clone())\n      }\n      pts[i].x += d\n      pts[i + 1].x += d\n    }\n  }\n\n  /**\n  * This method will merge the redundant segments.\n  */\n  static _mergeSegments (pts) {\n    let h1 = pts[pts.length - 1].y === pts[pts.length - 2].y\n    let h2\n    for (let i = pts.length - 2; i >= 1; i--) {\n      h2 = pts[i].y === pts[i - 1].y\n      if (h2 === h1 || (pts[i].equals(pts[i - 1]))) {\n        pts.splice(i, 1)\n      } else {\n        h1 = !h1\n      }\n    }\n  }\n}\n\nlinkTypes['direct'] = DirectLink\nlinkTypes['bezier'] = BezierLink\nlinkTypes['entityRelations'] = EntityRelations\nlinkTypes['manhattan'] = Manhattan\n\nexport default Link\n","class Point {\n  constructor (x, y) {\n    this.x = x\n    this.y = y\n  }\n\n  /**\n   * Make a clone of this point\n   */\n  clone () {\n    return new Point(this.x, this.y)\n  }\n\n  /**\n   * Calculate the distance from this pt to the other pt.\n   * @param aPt\n   * @returns {number}\n   */\n  distance (aPt) {\n    return Math.sqrt((this.x - aPt.x) * (this.x - aPt.x) + (this.y - aPt.y) * (this.y - aPt.y))\n  }\n\n  /**\n   * Translate this point\n   */\n  translate (p2) {\n    this.x += p2.x\n    this.y += p2.y\n    return this\n  }\n\n  /**\n   * Scale this vector\n   */\n  scale (scale) {\n    this.x *= scale\n    this.y *= scale\n    return this\n  }\n\n  getScaled (scale) {\n    return new Point(this.x * scale, this.y * scale)\n  }\n\n  getTranslated (p2) {\n    return new Point(this.x + p2.x, this.y + p2.y)\n  }\n\n  /**\n   * Get the direction vector from this point to p2.\n   * @param p2\n   * @returns {Point}\n   */\n  getDirection (p2) {\n    var dist = this.distance(p2)\n    return new Point((p2.x - this.x) / dist, (p2.y - this.y) / dist)\n  }\n\n  /**\n   * rotate the point about the origin. With the specified angle.\n   * @param angle the angle to rotate\n   */\n  rotate (angle) {\n    var cos = Math.cos(angle * Math.PI / 180)\n    var sin = Math.sin(angle * Math.PI / 180)\n    var x = this.x; var y = this.y\n    this.x = x * cos - y * sin\n    this.y = x * sin + y * cos\n    return this\n  }\n\n  getRotated (angle) {\n    return this.clone().rotate(angle)\n  }\n\n  /**\n   * Calculate the dot product, treating this and p2 as vectors.\n   */\n  dotProduct (p2) {\n    return this.x * p2.x + this.y * p2.y\n  }\n\n  /**\n   * Get the mid point between this and p2.\n   */\n  getMidPoint (p2) {\n    return new Point((this.x + p2.x) / 2, (this.y + p2.y) / 2)\n  }\n\n  reverse () {\n    this.x = -this.x\n    this.y = -this.y\n    return this\n  }\n\n  equals (p2) {\n    if (!p2 || !(p2 instanceof Point)) return false\n\n    return (this.x === p2.x && this.y === p2.y)\n  }\n\n  /**\n   * Reflect this point w.r.t. the rectangle.\n   * If vertical is true, it will reflect the point cross the vertical\n   * central line of the rectangle, otherwise reflect cross the horizontal\n   * central line.\n   *\n   * @param rect the rectangle\n   * @param vertical whether is vertical reflection or horizontal reflection.\n   */\n  reflect (rect, vertical) {\n    if (vertical) {\n      this.x = 2 * rect.x - this.x\n    } else {\n      this.y = 2 * rect.y - this.y\n    }\n    return this\n  }\n\n  toString () {\n    return this.x + ',' + this.y\n  }\n}\n\nPoint.W = new Point(-1, 0)\nPoint.N = new Point(0, -1)\nPoint.S = new Point(0, 1)\nPoint.E = new Point(1, 0)\nPoint.NE = new Point(1, -1)\nPoint.NW = new Point(-1, -1)\nPoint.SE = new Point(1, 1)\nPoint.SW = new Point(-1, 1)\n\nexport default Point\n","import _ from 'lodash'\nimport Point from './Point'\nimport Shape from './Shape'\n\nexport default class Rectangle extends Shape {\n  /**\n   * Checks whether this rectangle contains a given point of a given rectangle\n   */\n  contains (el) {\n    let w = el.width || 0\n    let h = el.height || 0\n    let left = el.x - w / 2\n    let right = el.x + w / 2\n    let top = el.y - h / 2\n    let bottom = el.y + h / 2\n    return (right <= this.right) && (left >= this.left) &&\n      (top >= this.top) && (bottom <= this.bottom)\n  }\n\n  /**\n   * Calcualte the distance to a point. 0 if this rectangle contains the point.\n   */\n  distance (pt) {\n    if (this.contains(pt)) return 0\n\n    if (pt.x < this.left) {\n      if (pt.y < this.top) {\n        return pt.distance(new Point(this.left, this.top))\n      }\n      if (pt.y <= this.bottom) return this.left - pt.x\n      return pt.distance(new Point(this.left, this.bottom))\n    }\n    if (pt.x <= this.right) {\n      if (pt.y <= this.top) return this.top - pt.y\n      return pt.y - this.bottom\n    }\n    if (pt.y < this.top) {\n      return pt.distance(new Point(this.right, this.top))\n    }\n    if (pt.y <= this.bottom) return pt.x - this.right\n    return pt.distance(new Point(this.right, this.bottom))\n  }\n\n  /**\n   * Given two points, we want to detect whether the line joining the pts intersect\n   * with the rectangle or not. We assume only horizontal or vertical line segments.\n   *\n   * @return int the side of the intersection: -1: no intersection, 0: left, 1: top, 2: right, 3: bottom, 4: containment.\n   */\n  detectIntersection (pt1, pt2) {\n    let horizontal = pt1.y === pt2.y\n    let contains1 = this.contains(pt1)\n    let contains2 = this.contains(pt2)\n    if (contains1 && contains2) return 4\n    if (!contains1 && !contains2) {\n      if (horizontal && (pt1.y >= this.top && pt1.y <= this.bottom)) {\n        if (pt1.x < this.left && pt2.x > this.right) return 0\n        if (pt1.x > this.right && pt2.x < this.left) return 2\n      }\n      if (!horizontal && (pt1.x >= this.left && pt1.x <= this.right)) {\n        if (pt1.y < this.top && pt2.y > this.bottom) return 1\n        if (pt1.y > this.bottom && pt2.y < this.top) return 3\n      }\n      return -1\n    }\n\n    let outPt = contains1 ? pt2 : pt1\n    if (horizontal) {\n      if (outPt.x > this.right) return 2\n      return 0\n    } else {\n      if (outPt.y < this.top) return 1\n      return 3\n    }\n  }\n\n  toString () {\n    return 'Rectangle:{x=' + this.x + ';y=' + this.y + ';width=' + this.width + ';height=' + this.height + '}'\n  }\n\n  static getPerimeter (rect, pt, orthogonal = false) {\n    let x = rect.x\n    let y = rect.y\n    let dx = pt.x - x\n    let dy = pt.y - y\n    let alpha = Math.atan2(dy, dx)\n    let p = new Point(0, 0)\n    let pi = Math.PI\n    let pi2 = Math.PI / 2\n    let beta = pi2 - alpha\n    let t = Math.atan2(rect.height, rect.width)\n\n    if (alpha < -pi + t || alpha > pi - t) {\n      // Left edge\n      p.x = rect.left\n      p.y = y - rect.width * Math.tan(alpha) / 2\n    } else if (alpha < -t) {\n      // Top Edge\n      p.y = rect.top\n      p.x = x - rect.height * Math.tan(beta) / 2\n    } else if (alpha < t) {\n      // Right Edge\n      p.x = rect.right\n      p.y = y + rect.width * Math.tan(alpha) / 2\n    } else {\n      // Bottom Edge\n      p.y = rect.bottom\n      p.x = x + rect.height * Math.tan(beta) / 2\n    }\n\n    if (orthogonal) {\n      if (alpha < -pi + t || alpha > pi - t) {\n        // Left edge\n        p.x = rect.left\n        p.y = y\n      } else if (alpha < -t) {\n        // Top Edge\n        p.y = rect.top\n        p.x = x\n      } else if (alpha < t) {\n        // Right Edge\n        p.x = rect.right\n        p.y = y\n      } else {\n        // Bottom Edge\n        p.y = rect.bottom\n        p.x = x\n      }\n    }\n\n    let dir = Rectangle.getDirection(rect, p, orthogonal)\n    return { point: p, direction: dir }\n  }\n\n  /**\n   * Return the bounding rectangle that contains p1 and p2\n   */\n  static getBoundingRectangle (pts, margin) {\n    if (!pts || pts.length === 0) return null\n    margin = margin || [0, 0, 0, 0]\n    if (!_.isArray(margin)) {\n      margin = [margin, margin, margin, margin]\n    }\n    let min = [pts[0].x, pts[0].y]\n    let max = [pts[0].x, pts[0].y]\n    for (let i = 1; i < pts.length; i++) {\n      let p = pts[i]\n      if (p.x < min[0]) {\n        min[0] = p.x\n      }\n      if (p.y < min[1]) {\n        min[1] = p.y\n      }\n      if (p.x > max[0]) {\n        max[0] = p.x\n      }\n      if (p.y > max[1]) {\n        max[1] = p.y\n      }\n    }\n    min[0] = min[0] - margin[0]\n    min[1] = min[1] - margin[1]\n    max[0] = max[0] + margin[2]\n    max[1] = max[1] + margin[3]\n    let w = Math.abs(max[0] - min[0])\n    let h = Math.abs(max[1] - min[1])\n    return new Rectangle(min[0] + w / 2, min[1] + h / 2, w, h)\n  }\n\n  /**\n   * Create a union of all the rectangles.\n   * @param rects\n   */\n  static union (rects) {\n    let minx = null; let miny = null; let maxx = -Infinity; let maxy = -Infinity\n    _.each(rects, function (rect) {\n      minx = minx || rect.x\n      miny = miny || rect.y\n      minx = Math.min(minx, rect.x)\n      miny = Math.min(miny, rect.y)\n      maxx = Math.max(maxx, rect.right())\n      maxy = Math.max(maxy, rect.bottom())\n    })\n    minx = minx || 0\n    miny = miny || 0\n    return new Rectangle(minx, miny, maxx - minx, maxy - miny)\n  }\n\n  /**\n   * Returns the direction the point <i>p</i> is in relation to the given rectangle.\n   * Possible values are WEST (-1,0), EAST (1,0), NORTH (0,-1) and SOUTH (0,1) if orthogonal is true, otherwise return\n   * the direction connection the center of r and p.\n   * @param r\n   * @param p\n   * @param orthogonal\n   * @returns {Point|*}\n   */\n  static getDirection (r, p, orthogonal = false) {\n    if (!orthogonal) {\n      return new Point(r.x, r.y).getDirection(new Point(p.x, p.y))\n    }\n\n    let i; let distance = Math.abs(r.left - p.x); let direction = Point.W\n\n    i = Math.abs(r.top - p.y)\n    if (i <= distance) {\n      distance = i\n      direction = Point.N\n    }\n\n    i = Math.abs(r.bottom - p.y)\n    if (i <= distance) {\n      distance = i\n      direction = Point.S\n    }\n\n    i = Math.abs(r.right - p.x)\n    if (i < distance) {\n      direction = Point.E\n    }\n\n    return direction\n  }\n}\n","import Shape from './Shape'\nimport Point from './Point'\nimport Line from './Line'\n\nexport default class Rhombus extends Shape {\n  toString () {\n    return 'Rhombus:{x=' + this.x + ';y=' + this.y + ';width=' + this.width + ';height=' + this.height + '}'\n  }\n\n  static getPerimeter (rect, pt, orthogonal = false) {\n    let w = rect.width\n    let h = rect.height\n    let cx = rect.x\n    let cy = rect.y\n    let x = cx - w / 2\n    let y = cy - h / 2\n\n    let px = pt.x\n    let py = pt.y\n\n    // Special case for intersecting the diamond's corners\n    if (cx === px) {\n      if (cy > py) {\n        return { point: new Point(cx, y), direction: Point.S }\n        // top\n      } else {\n        return { point: new Point(cx, y + h), direction: Point.N }\n        // bottom\n      }\n    } else if (cy === py) {\n      if (cx > px) {\n        return { point: new Point(x, cy), direction: Point.E }\n        // left\n      } else {\n        return { point: new Point(x + w, cy), direction: Point.W }\n        // right\n      }\n    }\n\n    let tx = cx\n    let ty = cy\n\n    if (orthogonal) {\n      if (px >= x && px <= x + w) {\n        tx = px\n      } else if (py >= y && py <= y + h) {\n        ty = py\n      }\n    }\n\n    let p, dir\n    // TODO direction calculation is not quite right.\n    // In which quadrant will the intersection be?\n    // set the slope and offset of the border line accordingly\n    if (px < cx) {\n      if (py < cy) {\n        p = Line.intersection(px, py, tx, ty, cx, y, x, cy)\n        dir = Point.S\n      } else {\n        p = Line.intersection(px, py, tx, ty, cx, y + h, x, cy)\n        dir = Point.N\n      }\n    } else if (py < cy) {\n      p = Line.intersection(px, py, tx, ty, cx, y, x + w, cy)\n      dir = Point.E\n    } else {\n      p = Line.intersection(px, py, tx, ty, cx, y + h, x + w, cy)\n      dir = Point.W\n    }\n    return { point: p, direction: dir }\n  }\n}\n","import _ from 'lodash'\nimport Point from './Point'\nimport Rectangle from './Rectangle'\n\nlet registry = {}\n\nclass Shape {\n  constructor (x, y, width, height, config) {\n    this.x = x\n    this.y = y\n    this.width = width\n    this.height = height\n    _.defaults(this, config, { x: 0, y: 0, width: 0, height: 0 })\n  }\n\n  /**\n   * Return the y-coord of the top side of this rectangle\n   */\n  get top () { return this.y - this.height / 2 }\n\n  /**\n   * Returns the y-coordinate of the bottom of this Rectangle.\n   */\n  get bottom () { return this.y + this.height / 2 }\n\n  /**\n   * Return the x-coord of left side of this rectangle\n   */\n  get left () { return this.x - this.width / 2 }\n\n  /**\n   * Returns the x-coordinate of the right side of this Rectangle.\n   */\n  get right () { return this.x + this.width / 2 }\n\n  get center () { return new Point(this.x, this.y) }\n\n  get bounds () { return new Rectangle(this.x, this.y, this.width, this.height) }\n\n  contains (el) { return false }\n\n  /**\n   * This will generate n ports on the shape.\n   */\n  getRegularPoints (n) {\n    return null\n  }\n\n  /**\n   * Get the intersection between boundary of this shape and the line connecting (x,y) with the refPt.\n   * @param refPt\n   * @param orthogonal\n   * @returns {*|{point, direction}}\n   */\n  getPerimeter (refPt, orthogonal = false) {\n    return this.constructor.getPerimeter(this, refPt, orthogonal)\n  }\n\n  render (view) {\n    let template = _.template(view.getTemplate(this.name, this))\n    return template(this)\n  }\n\n  static getShape (name) {\n    return registry[name]\n  }\n\n  static addShape (name, c) {\n    registry[name] = c\n  }\n\n  static removeShape (name) {\n    delete registry[name]\n  }\n}\n\nexport default Shape\n","import _ from 'lodash'\nimport Utils from '../util/Utils'\nimport Cache from '../util/Cache'\nimport StringBuffer from '../util/string-buffer'\nimport Shape from '../geometry/Shape'\nimport Label from '../view/Label'\n\n/**\n * The Cell is the common parent for Node and Edge.\n */\nexport default class Cell {\n  constructor (graph, config = { id: _.uniqueId() }) {\n    this.graph = graph\n    this.id = config.id\n    delete config.id\n\n    // Initialize decorators\n    if (config.decorators) {\n      this.createDecorators(config.decorators)\n      delete config.decorators\n    }\n\n    // Initialize View Properties\n    if (config.views) {\n      this.viewProps = config.views\n      delete config.views\n    }\n\n    // Initialize type\n    var Type = config.type || 'Default'\n    Type = Utils.type(this.constructor.namespace, Type)\n    if (!Type) { throw new Error('Type not found ' + config.type) }\n    delete config.type\n    this.props = new Type(config)\n  }\n\n  prop (name, value) {\n    if (_.isUndefined(value)) { return this.props[name] }\n    this.props[name] = value\n  }\n\n  /**\n   * Get/Set property stored by views.\n   * @param key\n   * @param name\n   * @param value\n   * @returns {*}\n   */\n  viewProp (key = 'default', name, value) {\n    if (_.isUndefined(value)) {\n      if (key === 'default') { return this.prop(name, value) }\n      return this.viewProps[key][name]\n    }\n    if (key === 'default') {\n      this.prop(name, value)\n    } else {\n      if (!this.viewProps[key]) { this.viewProps[key] = {} }\n      this.viewProps[key][name] = value\n    }\n  }\n\n  createDecorators (decorators) {}\n\n  /**\n   * Get properties needed for rendering this element\n   * @returns {{key: (string|*), className: *, namespace: *, bounds: *}}\n   */\n  getView (key) {\n    let shape = this.getShape(key)\n    return _.assign({\n      id: this.id,\n      key: key,\n      className: this.computedClassName,\n      style: this.viewProp(key, 'style'),\n      namespace: this.namespace\n    }, shape)\n  }\n\n  getShape (key) {\n    let shape = Cache.get(this.id + '.shape', key)\n    if (shape) return shape\n\n    let shapeConfig = this.viewProp(key, 'shape')\n    let ShapeClass = shapeConfig ? Shape.getShape(shapeConfig.name) : Shape.getShape('Rectangle')\n    let x = this.viewProp(key, 'x')\n    let y = this.viewProp(key, 'y')\n    let width = this.viewProp(key, 'width')\n    let height = this.viewProp(key, 'height')\n    shape = new ShapeClass(x, y, width, height, shapeConfig)\n    Cache.set(this.id + '.shape', shape, key)\n    return shape\n  }\n\n  render (view) {\n    let template = Cache.get(this.id + '.template', view.id)\n    if (!template) {\n      // create the template\n      let role = this.prop('role')\n      template = view.getTemplate('$' + role, null, this)\n      if (_.isString(template)) { template = _.template(template) }\n      Cache.set(this.id + '.template', template, view.id)\n    }\n    return template(this.getView(view.id))\n  }\n\n  renderShape (view) {\n    let shape = this.getShape(view.id)\n    if (shape) { return shape.render(view) }\n    return ''\n  }\n\n  renderLabel (view) {\n    if (this === this.graph.currentRoot) { return null }\n    let box = this.getLabelBox(view.id)\n    if (box) { return view.renderLabel(box) }\n    return ''\n  }\n\n  getLabelBox (key) {\n    let box = Cache.get(this.id + '.labelBox', key)\n    if (box) return box\n    let shape = this.getShape(key)\n    // Just get the config will have a positive performance boost for IE11 and IE10.\n    box = Label.getLabelBox(this.prop('label'), this.viewProp(key, 'labelConfig'), shape.width, shape.height)\n    Cache.set(this.id + '.labelBox', box, key)\n    return box\n  }\n\n  get computedClassName () {\n    if (!this._computedClassName) {\n      var buf = new StringBuffer(this.prop('role'))\n      let props = this.props\n      if (props.hasOwnProperty('className')) { buf.append(props['className']) }\n      props = props.constructor.prototype\n      while (props) {\n        if (props.hasOwnProperty('className')) { buf.append(props['className']) }\n        props = Object.getPrototypeOf(props)\n      }\n      this._computedClassName = buf.toString(' ')\n    }\n    return this._computedClassName\n  }\n\n  get namespace () {\n    if (this === this.graph.currentRoot) return ''\n    return 'root.' + this.prop('role')\n  }\n\n  destroy () {\n    delete this.graph\n    delete this.decorators\n    delete this.props\n    delete this.viewProps\n    this.destroyed = true\n  }\n}\n\n/*\n\nCell.prototype.move = function(x, y) {\n  this.setProperty(\"x\", Math.round(x));\n  this.setProperty(\"y\", Math.round(y));\n  delete this.bounds;\n};\n\nCell.prototype.resize = function(w, h) {\n  this.setProperty(\"width\", w);\n  this.setProperty(\"height\", h);\n  delete this.bounds;\n};\n\nCell.prototype.canEdit = function() {\n  return (this.graph ? this.graph.canEdit() : true) && this.getProperty(\"editable\");\n};\n\nCell.prototype.canSelect = function() {\n  return (this.graph ? this.graph.canSelect() : true) && this.getProperty(\"selectable\");\n};\n\nCell.prototype.canMove = function() {\n  return (this.graph ? this.graph.canEdit() : true) && this.getProperty(\"draggable\");\n};\n\nCell.prototype.canResize = function() {\n  return (this.graph ? this.graph.canEdit() : true) && this.getProperty(\"resizable\");\n};\n\nCell.prototype.getTypeFromString = function(typeStr) {\n  return this.graph.getType(typeStr);\n};\n\nCell.prototype.createModifiers = function(modifiers) {\n  this.modifiers = null;\n  var modifierSettings = this.getProperty(\"modifierSettings\");\n  if (modifierSettings) {\n    _.each(modifiers, function(config) {\n      config.type = this.graph.getModifierType(config.className);\n      config.setting = modifierSettings[config.className];\n      if (!config.type || !config.setting) return;\n\n      this.addModifier(config.className, new Modifier(this, config));\n    }, this);\n\n    // Check for showAlways settings\n    _.each(modifierSettings, function(setting, name) {\n      if (setting.showAlways && (!this.modifiers || !this.modifiers[name])) {\n        var config = {type: this.graph.getModifierType(name), setting: setting};\n        if (!config.type) return;\n        this.addModifier(name, new Modifier(this, config));\n      }\n    }, this);\n  }\n};\n\nCell.prototype.addModifier = function(name, modifier) {\n  if (!this.modifiers)\n    this.modifiers = {};\n\n  if (!modifier.hasOwnProperty(\"showHeader\"))\n    modifier.showHeader = true;\n\n  // @hack preferably set it in configurations.\n  if (modifier.name == \"HoverProcessModifier\" || modifier.name == \"HoverResults\")\n    modifier.showHeader = false;\n\n  this.modifiers[name] = modifier;\n};\n\nCell.prototype.getModifiers = function() {\n  if (_.isUndefined(this.modifiers))\n    this.createModifiers();\n  return this.modifiers;\n};\n\nCell.prototype.getModifier = function(name) {\n  var modifiers = this.getModifiers();\n  if (modifiers)\n    return modifiers[name];\n  return null;\n};\n\nCell.prototype.isVisible = function() {\n  return this.getProperty('visible');\n};\n\nCell.prototype.isContainer = function() {\n  return false;\n};\n*/\n","import _ from 'lodash'\nimport Cell from './Cell'\nimport Rectangle from '../geometry/Rectangle'\nimport Link from '../geometry/Link'\nimport Label from '../view/Label'\nimport Cache from '../util/Cache'\n\nclass Edge extends Cell {\n  constructor (graph, config = {}, source, target) {\n    if (!config.id) config.id = _.uniqueId('E')\n    super(graph, config)\n\n    this.source = this.target = null\n    this.setSource(source, config.sourcePos)\n    this.setTarget(target, config.targetPos)\n  }\n\n  setSource (node, pos) {\n    this.setTerminal(node, pos, 'source')\n  }\n\n  setTarget (node, pos) {\n    this.setTerminal(node, pos, 'target')\n  }\n\n  /**\n\t * Internal methods to set either the source or target\n\t */\n\t setTerminal (node, pos, dir) {\n    var end = dir == 'source' ? this.source : this.target\n    if (end == node) {\n      // simply change the position of the edge.\n      if (node) { node.setEdgeAt(this, pos) }\n    } else {\n      if (end) {\n        // first remove the edge from the current end\n        end.removeEdge(this)\n      }\n\n      if (node) {\n        if (dir == 'source') { node.addOutEdge(this, pos) } else { node.addInEdge(this, pos) }\n      }\n      if (dir == 'source') { this.source = node } else { this.target = node }\n      // this.clearPoints();\n    }\n  }\n\n  getLabelBox (key) {\n    var label = this.prop('label')\n    if (label) { return Label.getLabelBoxForLink(label, this.viewProp(key, 'labelConfig'), this.getShape(key)) }\n    return null\n  }\n\n  /**\n\t * Return a pair of points as reference to the calculation of start and end points.\n\t */\n  getReferencePoints (key) {\n    let pts = []\n    if (this.source) { pts.push(this.source.getShape(key).center) } else { pts.push(this.viewProp(key, 'start')) }\n\n    if (this.target) { pts.push(this.target.getShape(key).center) } else { pts.push(this.viewProp(key, 'end')) }\n\n    return pts\n  }\n\n  getTerminalVisual (key, orthogonal) {\n    let refPts = this.getReferencePoints(key)\n    let terminals = []\n\n    let getBound = function (pt) {\n      return new Rectangle(pt.x, pt.y, 3, 3)\n    }\n\n    if (this.source) {\n      terminals.push(this.source.getPort(key, this.prop('sourcePort'), refPts[1], orthogonal))\n    } else { terminals.push({ point: refPts[0], direction: Rectangle.getDirection(getBound(refPts[0]), refPts[1], true) }) }\n\n    if (this.target) {\n      terminals.push(this.target.getPort(key, this.prop('targetPort'), refPts[0], orthogonal))\n    } else { terminals.push({ point: refPts[1], direction: Rectangle.getDirection(getBound(refPts[1]), refPts[0], true) }) }\n    return terminals\n  }\n\n  getShape (key) {\n    let shape = Cache.get(this.id + '.shape', key)\n    if (shape) return shape\n\n    let config = this.viewProp(key, 'shape')\n    shape = Link.getLink(this.getTerminalVisual(key, config.orthogonal), config, this.prop('startMarker'), this.prop('endMarker'))\n    Cache.set(this.id + '.shape', shape, key)\n    return shape\n  }\n\n  toString () {\n    return 'Edge:{' + (!this.source ? 'null' : this.source.id) + '--' + (!this.target ? 'null' : this.target.id) + '}'\n  }\n\n  destroy () {\n    super.destroy()\n    this.setSource(null)\n    this.setTarget(null)\n  }\n}\nEdge.namespace = 'Edges'\n\nexport default Edge\n\n/*\n\nEdge.prototype.isVisible = function() {\n\tif (this.graph.getProperty(\"allowDanglingEdges\")) {\n\t\treturn (this.source ? this.source.isVisible() : true) && (this.target ? this.target.isVisible() : true) && this.getProperty(\"visible\");\n\t} else\n\t\treturn this.source && this.target && this.getProperty('visible') && this.source.isVisible() && this.target.isVisible();\n};\n\n*/\n","import _ from 'lodash'\nimport Utils from '../util/Utils'\nimport Node from './Node'\nimport Edge from './Edge'\nimport Marker from '../view/Marker'\n\nconst nodeDefaults = {\n  name: 'Default',\n  role: 'node',\n  draggable: true,\n  selectable: true,\n  editable: true,\n  resizable: false,\n  sourceable: true,\n  targetable: true,\n  visible: true\n}\n\nconst edgeDefaults = {\n  name: 'Default',\n  role: 'edge',\n  selectable: true,\n  visible: true,\n  startMarker: null,\n  endMarker: {\n    id: 'Default_EndMarker',\n    type: 'arrow',\n    size: 10,\n    color: '#0ea117'\n  },\n  /* start and end is only used if the edge is not connected to a node */\n  start: [0, 0],\n  end: [400, 200]\n}\n\nclass Graph {\n  constructor (id = _.uniqueId('G'), config = {}, model) {\n    this.id = id\n\n    this.nodes = {}\n    this.edges = {}\n\n    this.selection = null\n    this.destroyed = false\n\n    Utils.buildTypes(config.nodeTypes, 'Nodes', nodeDefaults)\n    Utils.buildTypes(config.edgeTypes, 'Edges', edgeDefaults)\n    // check for markers.\n    this.markers = []\n    let edgeTypes = Utils.type(Edge.namespace); let marker; let markerConfig\n    edgeTypes.forEach(function (type) {\n      markerConfig = type.prototype.startMarker\n      if (markerConfig) {\n        marker = Marker.getMarker(markerConfig, true)\n        this.markers.push(marker)\n      }\n      markerConfig = type.prototype.endMarker\n      if (markerConfig) {\n        marker = Marker.getMarker(markerConfig, false)\n        this.markers.push(marker)\n      }\n    }, this)\n\n    delete config.nodeTypes\n    delete config.edgeTypes\n    Utils.initConfig(this, config)\n    this.root = null\n    if (model) { this.loadModel(model) }\n  }\n\n  static getJSClass (config, defaultClass) {\n    let jsClass = null\n    if (config && config.type) {\n      // See if we can get the js class from config.\n      let type = Utils.type(defaultClass.namespace, config.type)\n      if (type) { jsClass = type.jsClass }\n    }\n\n    return Utils.getConstructor(jsClass, defaultClass)\n  }\n\n  /**\n\t * Create a new Node\n\t * @param config\n\t * @param parent\n\t * @param pos\n\t * @returns {*}\n\t */\n  addNode (config, parent = this.currentRoot, pos) {\n    let NodeClass = Graph.getJSClass(config, Node)\n    let node = new NodeClass(this, config)\n\n    if (parent) { Graph.addChild(parent, node, pos) } else {\n      this.root = node\n      this.root.prop('role', 'root')\n    }\n\n    this.nodes[node.id] = node\n    return node\n  }\n\n  /**\n\t * Create a new Edge\n\t * @param config\n\t * @param parent\n\t * @param from\n\t * @param to\n\t * @returns {*}\n\t */\n  addEdge (config, parent = this.currentRoot, from, to) {\n    let EdgeClass = Graph.getJSClass(config, Edge)\n    let edge = new EdgeClass(this, config, from, to)\n\n    Graph.addChild(parent, edge)\n    this.edges[edge.id] = edge\n    return edge\n  }\n\n  /**\n\t * Added a new child to the parent. The parent has to be a node.\n\t * @param parent\n\t * @param child\n\t */\n  static addChild (parent, child) {\n    if (!parent.children) { parent.children = [] }\n\n    if (child.parent != parent) {\n      parent.children.push(child)\n\n      if (child.parent && child.parent.children) { child.parent.children = _.without(child.parent.children, child) }\n    }\n    child.parent = parent\n  }\n\n  loadModel (model, parent = this.currentRoot) {\n    let nodes = model.nodes\n    let edges = model.edges\n    delete model.nodes\n    delete model.edges\n\n    let node = this.addNode(model, parent)\n    if (nodes) {\n      _.forEach(nodes, (child) => {\n        this.loadModel(child, node)\n      })\n    }\n    if (edges) {\n      _.forEach(edges, (edge) => {\n        let from, to\n        if (edge.from) { from = this.nodes[edge.from] }\n        if (edge.to) { to = this.nodes[edge.to] }\n        this.addEdge(edge, node, from, to)\n      })\n    }\n  }\n\n  get currentRoot () {\n    return this.root\n  }\n\n  reset () {}\n  destroy () {}\n}\n\nGraph.DEFAULTS = {\n  allowDanglingEdges: true,\n  multiConnect: false,\n  readOnly: false,\n  viewOnly: false\n}\n\nexport default Graph\n","import _ from 'lodash'\nimport StringBuffer from '../util/string-buffer'\nimport Cell from './Cell'\n\n/**\n * A Node represents vertex of the graph.\n */\nclass Node extends Cell {\n  constructor (graph, config = {}) {\n    if (!config.id) config.id = _.uniqueId('N')\n    super(graph, config)\n\n    this.inEdges = []\n    this.outEdges = []\n    this.ports = null\n    this.parent = null\n  }\n\n  isAncestor (n) {\n    // TODO: should we move this to graph class ?\n    let node = n.parent\n    while (node) {\n      if (this === node) { return true }\n      node = node.parent\n    }\n    return false\n  }\n\n  removeEdge (edge) {\n    let edges = edge.source === this ? this.outEdges : this.inEdges\n    for (let i = 0; i < edges.length; i++) {\n      if (edge === edges[i]) {\n        edges.splice(i, 1)\n        break\n      }\n    }\n  }\n\n  // Add a new incoming edge\n  addInEdge (edge, pos) {\n    if (pos == null || pos === undefined) {\n      this.inEdges.push(edge)\n    } else {\n      this.inEdges.splice(pos, 0, edge)\n    }\n  }\n\n  // Add a new outgoing edge\n  addOutEdge (edge, pos) {\n    if (pos == null || pos === undefined || pos > edge.length - 1) {\n      this.outEdges.push(edge)\n    } else {\n      this.outEdges.splice(pos, 0, edge)\n    }\n  }\n\n  renderChildren (view) {\n    if (this.children) {\n      let buf = new StringBuffer()\n      _.forEach(this.children, (child) => {\n        buf.append(child.render(view))\n      })\n      return buf.toString()\n    }\n    return ''\n  }\n\n  getPort (key, portName = 'auto', endPt, orthogonal) {\n    let shape = this.getShape(key)\n    if (portName === 'auto') {\n      return shape.getPerimeter(endPt, orthogonal)\n    }\n    return null\n  }\n\n  toString () {\n    let label = this.prop('label') ? this.prop('label') : 'undefined'\n    if (_.isArray(label)) {\n      label = label[0]\n    }\n    return 'Node:{id:' + this.id + ';label:' + label + ';type:' + this.props.constructor.typeName + '}'\n  }\n}\nNode.namespace = 'Nodes'\n\nexport default Node\n\n/*\n\n/**\n * The DrillDownParent is the parent that displays the vertex when drilled down.\n *\nVertex.prototype.getDrillDownParent = function() {\n  return this.parent;\n};\n\nVertex.prototype.isLocked = function() {\n  let mode = this.getProperty(\"mode\") || 3;\n  return !(mode & Graph.ALLOW_INTERACTIONS);\n};\n\nVertex.prototype.getCrumbText = function() {\n  if (this.isLocked())\n    return '<span><img src=\"webwb/pzreadonly.png\" /></span><span>&nbsp;' + this.getProperty(\"label\") + '</span>';\n  return this.getProperty(\"label\");\n};\n\nVertex.prototype.canEdit = function() {\n  return (!this.parent || !this.parent.isLocked()) && Vertex.superclass.canEdit.call(this);\n};\n\nVertex.prototype.isContainer = function() {\n  return this.getProperty(\"container\");\n};\n\n*/\n","import Base64 from './util/base64'\nimport Cache from './util/Cache'\nimport Utils from './util/Utils'\nimport DomUtils from './util/dom-utils'\nimport StringBuffer from './util/string-buffer'\nimport Point from './geometry/Point'\nimport Line from './geometry/Line'\nimport Shape from './geometry/Shape'\nimport Rectangle from './geometry/Rectangle'\nimport Ellipse from './geometry/Ellipse'\nimport Rhombus from './geometry/Rhombus'\nimport Link from './geometry/Link'\nimport EventDispatcher from './event/event-dispatcher'\nimport Graph from './graph/Graph'\nimport Cell from './graph/Cell'\nimport Node from './graph/Node'\nimport Edge from './graph/Edge'\nimport Layout from './layout/Layout'\nimport FlowLayout from './layout/FlowLayout'\nimport Label from './view/Label'\nimport Marker from './view/Marker'\nimport Renderer from './view/Renderer'\nimport SVGRenderer from './view/SVGRenderer'\nimport GraphBehavior from './behavior/GraphBehavior'\n// import SelectionBehavior from './behavior/SelectionBehavior'\n\nShape.addShape('Rectangle', Rectangle)\nShape.addShape('Ellipse', Ellipse)\nShape.addShape('Rhombus', Rhombus)\n\nexport default {\n  Base64,\n  Cache,\n  Utils,\n  DomUtils,\n  StringBuffer,\n  Point,\n  Line,\n  Shape,\n  Rectangle,\n  Ellipse,\n  Link,\n  EventDispatcher,\n  Label,\n  Marker,\n  Graph,\n  Cell,\n  Node,\n  Edge,\n  Layout,\n  FlowLayout,\n  Renderer,\n  SVGRenderer,\n  GraphBehavior\n  // SelectionBehavior\n}\n","import Layout from './Layout'\n\nclass FlowLayout extends Layout {\n  layout (root, bounds) {\n    var items\n    if (!root) { items = this.owner.childNodes } else if (_.isArray(root)) { items = root } else { items = root.getLinkedNodes('target') }\n    if (!items || items.length == 0) return\n\n    var x = 0; var y = 0; var h = 0; var node\n    var p1 = 0; var p2 = 0\n    for (var i = 0; i < items.length; i++) {\n      node = items[i]\n      if (x > 0 && x + this.hgap + node.getProperty('width') > bounds.width) {\n        // create new line\n        y += h + this.vgap\n        x = 0; h = 0; p1 = 0; p2++\n      }\n      node._flPos = [p1, p2]\n      node.moveTo([bounds.x + x, bounds.y + y])\n      x += this.hgap + node.getProperty('width')\n      p1++\n      h = h < node.getProperty('height') ? node.getProperty('height') : h\n    }\n    this.trigger(new Rectangle(bounds.x, bounds.y, bounds.width, y + h))\n  }\n}\n\nFlowLayout.DEFAULTS = {\n  hgap: 10,\n  vgap: 10\n}\n\nexport default FlowLayout\n","import _ from 'lodash'\nimport Utils from '../util/Utils'\n\nclass Layout {\n  constructor (config = {}) {\n    if (config.hasOwnProperty('orientation') && _.isString(config.orientation)) {\n      if (config.orientation.toUpperCase() == 'HORIZONTAL') { config.orientation = Layout.HORIZONTAL } else { delete config.orientation }\n    }\n    Utils.initConfig(this, config)\n  }\n\n  layout (root, bounds) {}\n  reset () {}\n  destroy () {}\n}\nLayout.VERTICAL = 0\nLayout.HORIZONTAL = 1\n\nLayout.DEFAULTS = {\n  orientation: Layout.VERTICAL\n}\n\nexport default Layout\n","/**\n * Created by tong on 6/7/2016.\n */\n\nlet caches = {}\n\nlet Cache = {\n  get: function (key, namespace) {\n    return this.getCache(namespace)[key]\n  },\n\n  set: function (key, value, namespace) {\n    this.getCache(namespace)[key] = value\n  },\n\n  contains: function (key, namespace) {\n    return key in this.getCache(namespace)\n  },\n\n  remove: function (key, namespace) {\n    delete this.getCache(namespace)[key]\n  },\n\n  clear: function (namespace) {\n    if (!namespace) { caches = {} } else if (caches[namespace]) { caches[namespace] = {} }\n  },\n\n  getCache: function (namespace = 'default') {\n    if (!caches[namespace]) { caches[namespace] = {} }\n    return caches[namespace]\n  }\n}\n\nexport default Cache\n","import _ from 'lodash'\nimport Point from '../geometry/Point'\nimport Rectangle from '../geometry/Rectangle'\n\n// util variables\nlet _debugging = []; let _debugAll = false; let typeRegistry = {}; let splice = Array.splice\n\n/**\n * Utility functions\n */\nexport default {\n  type: function (namespace, name, type) {\n    if (!typeRegistry[namespace]) { typeRegistry[namespace] = new Map() }\n    if (!name) { return typeRegistry[namespace] }\n    if (!type) { return typeRegistry[namespace].get(name) }\n    typeRegistry[namespace].set(name, type)\n  },\n\n  createType: function (namespace, props, defaultType) {\n    let name = props.name\n\n    // first check if type exists\n    let type = this.type(namespace, name)\n    if (!type) {\n      let extend = props.extends ? this.type(namespace, props.extends) : null\n      if (!extend && defaultType) { extend = defaultType }\n      if (extend) {\n        type = class extends extend {\n        }\n      } else {\n        type = class {\n          constructor (config) {\n            _.assign(this, config)\n          }\n        }\n      }\n      delete props.name\n      delete props.extends\n      _.assign(type.prototype, props)\n      type.typeName = name\n      this.type(namespace, name, type)\n      this.log('Utils', 'Utils.createType - ' + namespace + '.' + name)\n    }\n    return type\n  },\n\n  buildTypes: function (types, namespace, defaultType) {\n    this.log('Utils', 'Utils.buildTypes - ' + namespace)\n\n    if (!types && defaultType) {\n      this.createType(namespace, defaultType)\n      this.log('Utils', 'Utils.buildTypes end')\n      return\n    }\n    if (defaultType) {\n      let type = _.remove(types, { name: defaultType.name })\n      type = type.length > 0 ? type[0] : null\n      if (type) { defaultType = this.createType(namespace, _.defaultsDeep(type, defaultType)) } else { defaultType = this.createType(namespace, defaultType) }\n    }\n\n    _.forEach(types, (type) => {\n      this.createType(namespace, type, defaultType)\n    })\n    this.log('Utils', 'Utils.buildTypes end')\n  },\n\n  // Helper function to correctly set up the prototype chain, for subclasses.\n  // Similar to `goog.inherits`, but uses a hash of prototype properties and\n  // class properties to be extended.\n  extend: function (child, parent, protoProps, staticProps) {\n    // Add static properties to the constructor function, if supplied.\n    _.extend(child, parent, staticProps)\n\n    // Set the prototype chain to inherit from `parent`, without calling\n    // `parent`'s constructor function.\n    var Surrogate = function () {\n      this.constructor = child\n    }\n    Surrogate.prototype = parent.prototype\n    child.prototype = new Surrogate()\n\n    // Add prototype properties (instance properties) to the subclass,\n    // if supplied.\n    if (protoProps) _.extend(child.prototype, protoProps)\n\n    // Set a convenience property in case the parent's prototype is needed later.\n    child.superclass = parent.prototype\n\n    return child\n  },\n\n  initConfig: function (obj, config) {\n    let props = {}; let c = obj.constructor; let cArr = [c]\n    while (c) {\n      if (c.super) {\n        c = c.super.constructor\n        splice.apply(cArr, [0, 0, c])\n      } else { c = null }\n    }\n\n    for (let i = 0; i < cArr.length; i++) {\n      c = cArr[i]\n      if (c.DEFAULTS) { _.assign(props, c.DEFAULTS) }\n    }\n    obj.props = _.assign(props, config)\n    c.prototype.prop = function (name, value) {\n      if (!value) { return this.props[name] }\n      this.props[name] = value\n    }\n  },\n\n  /**\n   * Gets the JS class constructor.\n   * @param {Object} jsClass\n   * @param {Object} defaultClass\n   */\n  getConstructor: function (jsClass, defaultClass) {\n    if (!jsClass) { jsClass = defaultClass }\n\n    if (_.isString(jsClass)) {\n      jsClass = eval(jsClass) // eslint-disable-line no-eval\n    }\n    return jsClass\n  },\n\n  debug: function (moduleName) {\n    if (moduleName) {\n      _debugging.push(moduleName)\n    } else {\n      _debugAll = true\n    }\n  },\n\n  log: function (name, message) {\n    var debug = _debugAll\n    if (!_debugAll) {\n      debug = false\n      for (var i = 0; i < _debugging.length; i++) {\n        if (_debugging[i] === name) debug = true\n      }\n    }\n    if (!debug) {\n      return\n    }\n    while (name.length < 10) {\n      name = name + ' '\n    }\n    name = name.substring(0, 10) + ' - '\n    console.info(name, message)\n  },\n\n  /**\n   * Get the relative position of sub shapes within a parent share.\n   * @param bounds\n   * @param geometry The geometry information, the format of Geometry is:\n   * {\n   *      x: \"x coordinate of ref point, if less than 1, will be treated as the percentage of the parent width.\",\n   *      y: \"y coordinate of ref point.\",\n   *      anchorX: \"x pos of child relative to the ref point\",\n   *      anchorY: \"y pos of child relative to the ref point\",\n   *      offsetX: \"the offset in the x direction.\",\n   *      offsetY: \"the offset in the y direction.\",\n   *      width: \"the width of the child element\",\n   *      height: \"the height of the child element\"\n   * }\n   * @returns {*[]}\n   */\n  getRelativePosition: function (bounds, geometry) {\n    let x = Math.abs(geometry.x) <= 1 ? bounds.width * geometry.x : geometry.x\n    let y = Math.abs(geometry.y) <= 1 ? bounds.height * geometry.y : geometry.y\n    return this.offsetPosition([x, y], geometry)\n  },\n\n  offsetPosition: function (pos, geometry) {\n    return [pos[0] + geometry.width * geometry.anchorX + geometry.offsetX, pos[1] + geometry.height * geometry.anchorY + geometry.offsetY]\n  },\n\n  /**\n   * Get the position relative to the graph that's unscaled, i.e., absolute position without considering translation and scale.\n   * @param t the current translate\n   * @param scale the current scale\n   * @param o can be either a Point or a Rectangle or a Point array.\n   */\n  unscale: function (t, scale, o) {\n    if (o instanceof Rectangle) { return new Rectangle(o.x * scale + t[0], o.y * scale + t[1], o.width * scale, o.height * scale) } else if (o instanceof Point) { return new Point(o.x * scale + t[0], o.y * scale + t[1]) } else { return [o[0] * scale + t[0], o[1] * scale + t[1]] }\n  },\n\n  /**\n   * Get the position relative to the graph that's scaled, i.e., relative position considering translation and scale.\n   * @param t the current translation\n   * @param scale the current scale\n   * @param o can be either a Point or a Rectangle or a Point array.\n   */\n  scale: function (t, scale, o) {\n    if (o instanceof Rectangle) { return new Rectangle((o.x - t[0]) / scale, (o.y - t[1]) / scale, o.width / scale, o.height / scale) } else if (o instanceof Point) { return new Point((o.x - t[0]) / scale, (o.y - t[1]) / scale) } else { return [(o[0] - t[0]) / scale, (o[1] - t[1]) / scale] }\n  },\n\n  /**\n   * Convenience method.\n   */\n  getProperty: function (obj, prop) {\n    if (!obj) { return null }\n    if (_.has(obj, prop)) { return obj[prop] }\n    if (obj.prop && _.isFunction(obj.prop)) { return obj.prop(prop) }\n    return null\n  }\n}\n","// http://www.webtoolkit.info/javascript-base64.html\n\nvar Base64 = {\n\n  // private property\n  _keyStr: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',\n\n  // public method for encoding\n  encode: function (input) {\n    var output = ''\n    var chr1, chr2, chr3, enc1, enc2, enc3, enc4\n    var i = 0\n\n    input = Base64._utf8_encode(input)\n\n    while (i < input.length) {\n      chr1 = input.charCodeAt(i++)\n      chr2 = input.charCodeAt(i++)\n      chr3 = input.charCodeAt(i++)\n\n      enc1 = chr1 >> 2\n      enc2 = ((chr1 & 3) << 4) | (chr2 >> 4)\n      enc3 = ((chr2 & 15) << 2) | (chr3 >> 6)\n      enc4 = chr3 & 63\n\n      if (isNaN(chr2)) {\n        enc3 = enc4 = 64\n      } else if (isNaN(chr3)) {\n        enc4 = 64\n      }\n\n      output = output +\n\t\t\tthis._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) +\n\t\t\tthis._keyStr.charAt(enc3) + this._keyStr.charAt(enc4)\n    }\n\n    return output\n  },\n\n  // public method for decoding\n  decode: function (input) {\n    var output = ''\n    var chr1, chr2, chr3\n    var enc1, enc2, enc3, enc4\n    var i = 0\n\n    input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, '')\n\n    while (i < input.length) {\n      enc1 = this._keyStr.indexOf(input.charAt(i++))\n      enc2 = this._keyStr.indexOf(input.charAt(i++))\n      enc3 = this._keyStr.indexOf(input.charAt(i++))\n      enc4 = this._keyStr.indexOf(input.charAt(i++))\n\n      chr1 = (enc1 << 2) | (enc2 >> 4)\n      chr2 = ((enc2 & 15) << 4) | (enc3 >> 2)\n      chr3 = ((enc3 & 3) << 6) | enc4\n\n      output = output + String.fromCharCode(chr1)\n\n      if (enc3 != 64) {\n        output = output + String.fromCharCode(chr2)\n      }\n      if (enc4 != 64) {\n        output = output + String.fromCharCode(chr3)\n      }\n    }\n\n    output = Base64._utf8_decode(output)\n\n    return output\n  },\n\n  // private method for UTF-8 encoding\n  _utf8_encode: function (string) {\n    string = string.replace(/\\r\\n/g, '\\n')\n    var utftext = ''\n\n    for (var n = 0; n < string.length; n++) {\n      var c = string.charCodeAt(n)\n\n      if (c < 128) {\n        utftext += String.fromCharCode(c)\n      } else if ((c > 127) && (c < 2048)) {\n        utftext += String.fromCharCode((c >> 6) | 192)\n        utftext += String.fromCharCode((c & 63) | 128)\n      } else {\n        utftext += String.fromCharCode((c >> 12) | 224)\n        utftext += String.fromCharCode(((c >> 6) & 63) | 128)\n        utftext += String.fromCharCode((c & 63) | 128)\n      }\n    }\n\n    return utftext\n  },\n\n  // private method for UTF-8 decoding\n  _utf8_decode: function (utftext) {\n    var string = ''\n    var i = 0\n    var c = c1 = c2 = 0\n\n    while (i < utftext.length) {\n      c = utftext.charCodeAt(i)\n\n      if (c < 128) {\n        string += String.fromCharCode(c)\n        i++\n      } else if ((c > 191) && (c < 224)) {\n        c2 = utftext.charCodeAt(i + 1)\n        string += String.fromCharCode(((c & 31) << 6) | (c2 & 63))\n        i += 2\n      } else {\n        c2 = utftext.charCodeAt(i + 1)\n        c3 = utftext.charCodeAt(i + 2)\n        string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63))\n        i += 3\n      }\n    }\n\n    return string\n  }\n\n}\n\nexport default Base64\n","import _ from 'lodash'\n\nconst inBrowser = () => {\n  return typeof window !== 'undefined' && window.navigator && typeof navigator !== 'undefined'\n}\n\n/**\n * dom Utility functions\n */\nexport default {\n  isIE: (function () {\n    if (!inBrowser()) return false\n    var sAgent = window.navigator.userAgent\n    var Idx = sAgent.indexOf('MSIE')\n\n    if (Idx > 0) {\n      // If IE, return version number.\n      return parseInt(sAgent.substring(Idx + 5, sAgent.indexOf('.', Idx)))\n    } else if (navigator.userAgent.match(/Trident\\/7\\./)) { // If IE 11 then look for Updated user agent string.\n      return 11\n    } else if (navigator.userAgent.match(/Edge\\//)) {\n      return 'Edge'\n    } else {\n      return false\n    }\n  })(),\n\n  isFireFox: (function () {\n    // InstallTrigger: Firefox's API to install add-ons\n    return typeof InstallTrigger !== 'undefined'\n  })(),\n\n  isChrome: (function () {\n    if (!inBrowser() || navigator.userAgent.indexOf('Edge') >= 0) return false\n    var raw = navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./)\n    return raw ? parseInt(raw[2], 10) : false\n  })(),\n\n  isMac: (function () {\n    if (!inBrowser()) return false\n    return navigator.platform.toUpperCase().indexOf('MAC') >= 0\n  })(),\n\n  isWindows: (function () {\n    if (!inBrowser()) return false\n    return navigator.appVersion.indexOf('Windows') >= 0\n  })(),\n\n  isLinux: (function () {\n    if (!inBrowser()) return false\n    return navigator.appVersion.indexOf('Linux') >= 0\n  })(),\n\n  createElement: function (tag, attribs, styles, html) {\n    let el = document.createElement(tag)\n    this.setElement(el, attribs, styles)\n    if (html) { el.innerHTML = html }\n    return el\n  },\n\n  createElementByString: function (str) {\n    let temp = this.createElement('div', null, null, str)\n    return temp.childNodes\n  },\n\n  setElement: function (el, attribs, styles) {\n    if (attribs) {\n      _.forEach(attribs, function (value, key) {\n        el.setAttribute(key, value)\n      })\n    }\n    if (styles) {\n      _.forEach(styles, function (value, key) {\n        el.style[key] = value\n      })\n    }\n  },\n\n  testElement: function (node, method) {\n    return node && node.nodeType === 1 && (!method || method(node))\n  },\n\n  getAncestorBy: function (node, method) {\n    while ((node = node.parentNode) !== null) {\n      if (this.testElement(node, method)) { return node }\n    }\n\n    return null\n  },\n\n  /**\n   * Get the position of element relative to the context.\n   * @param el the element\n   * @param context\n   * @returns {*[]}\n   */\n  getPosition (el, context) {\n    if (!context) context = document.body\n    let elRect = el.getBoundingClientRect()\n    let contextRect = context.getBoundingClientRect()\n\n    return [elRect.left - contextRect.left, elRect.top - contextRect.top]\n  },\n\n  getCenterPosition (el, context) {\n    if (!context) context = document.body\n    let elRect = el.getBoundingClientRect()\n    let contextRect = context.getBoundingClientRect()\n    let w = elRect.right - elRect.left\n    let h = elRect.bottom - elRect.top\n\n    return [elRect.left - contextRect.left + w / 2, elRect.top - contextRect.top + h / 2]\n  },\n\n  move: function (el, x, y) {\n    if (x) el.style.left = x + 'px'\n    if (y) el.style.top = y + 'px'\n  },\n\n  getSize: function (el) {\n    var w = parseInt(el.style.offsetWidth, 10)\n    var h = parseInt(el.style.offsetHeight, 10)\n    return [w, h]\n  },\n\n  resize: function (el, w, h) {\n    if (w) el.style.width = w + 'px'\n    if (h) el.style.height = h + 'px'\n  },\n\n  preloadImages: function (array) {\n    if (!this.preloadImages.list) this.preloadImages.list = []\n    if (!this.preloadImages.loaded) this.preloadImages.loaded = {}\n\n    var list = this.preloadImages.list\n    var img; var that = this\n    for (var i = 0; i < array.length; i++) {\n      img = new Image()\n      img.onload = function () {\n        var index = list.indexOf(this)\n        if (index !== -1) {\n          that.preloadImages.loaded[this.name] = { width: this.width, height: this.height }\n          // remove image from the array once it's loaded\n          // for memory consumption reasons\n          list.splice(index, 1)\n        }\n      }\n      list.push(img)\n      img.src = array[i]\n      img.name = array[i]\n    }\n  },\n\n  /**\n   * Get's the image's information given the url. Must be preloaded by calling the preloadImage function.\n   * @param src\n   */\n  getImageInfo: function (src) {\n    if (this.preloadImages.loaded) {\n      return this.preloadImages.loaded[src]\n    }\n    return null\n  },\n\n  downloadFile: function (name, data) {\n    if (!data) return\n    let mime = data.match(/^data:([^;,]*)/)[1]\n    if (name.indexOf('.') < 0) {\n      if (!mime) mime = 'text/plain'\n      if (mime === 'text/plain') { name = name + '.txt' } else {\n        let type = mime.split('/')[1]\n        if (type.indexOf('+') > 0) type = type.split('+')[0]\n        name = name + '.' + type\n      }\n    }\n    if (this.isIE) {\n      let encoded = data.indexOf(';base64') >= 0\n      if (encoded) { data = atob(data.replace('data:' + mime + ';base64,', '')) } else { data = decodeURI(data.replace('data:' + mime + ',', '')) }\n      data = this.GetBlob(data, mime)\n      navigator.msSaveBlob(data, name)\n    } else {\n      let link = this.createElement('a', { href: data, download: name }, { display: 'none' })\n      document.body.appendChild(link)\n      link.click()\n      link.parentNode.removeChild(link)\n    }\n  },\n\n  /**\n   * Convert b54 to blob. IE only\n   */\n  GetBlob: function (data, contentType, sliceSize) {\n    contentType = contentType || ''\n    sliceSize = sliceSize || 512\n\n    var byteArrays = []\n\n    for (var offset = 0; offset < data.length; offset += sliceSize) {\n      var slice = data.slice(offset, offset + sliceSize)\n\n      var byteNumbers = new Array(slice.length)\n      for (var i = 0; i < slice.length; i++) {\n        byteNumbers[i] = slice.charCodeAt(i)\n      }\n      var byteArray = new Uint8Array(byteNumbers)\n      byteArrays.push(byteArray)\n    }\n    return new Blob(byteArrays, { type: contentType })\n  },\n\n  openImage: function (name, image) {\n    if (!inBrowser()) return\n    var myWindow = window.open('', '_blank', 'toolbar=yes, scrollbars=yes, resizable=yes, width=500, height=500')\n    var myDocument = myWindow.document\n    var img = myDocument.createElement('img')\n    this.setElement(img, { src: image, name: name })\n    myDocument.body.appendChild(img)\n  },\n\n  /**\n   * Check whether the key event is from input, textarea or select.\n   * @param e  input event\n   */\n  eventFromInput: function (e) {\n    var tagName = e.target.tagName\n    return (tagName === 'INPUT' || tagName === 'TEXTAREA' || tagName === 'SELECT')\n  }\n}\n","import _ from 'lodash'\n\n/**\n * A string buffer for fast string manipulation\n */\nexport default class StringBuffer {\n  constructor (str) {\n    this.buffer = []\n    if (str) { this.buffer.push(str) }\n  }\n\n  append (stuff) {\n    if (_.isString(stuff)) { this.buffer.push(stuff) } else if (_.isArray(stuff)) { this.buffer = this.buffer.concat(stuff) } else { this.buffer.push('' + stuff) }\n    return this\n  }\n\n  prepend (stuff) {\n    if (_.isString(stuff)) { this.buffer.splice(0, 0, stuff) } else if (_.isArray(stuff)) { this.buffer = stuff.concat(this.buffer) } else { this.buffer.splice(0, 0, '' + stuff) }\n    return this\n  }\n\n  clear () {\n    this.buffer = []\n  }\n\n  removeLast () {\n    this.buffer.pop()\n    return this\n  }\n\n  toString (sep) {\n    if (!sep) sep = ''\n    return this.buffer.join(sep)\n  }\n}\n","import _ from 'lodash'\nimport Events from '../event/events'\nimport Utils from '../util/Utils'\nimport DomUtils from '../util/dom-utils'\nimport StringBuffer from '../util/string-buffer'\nimport Rectangle from '../geometry/Rectangle'\n\nconst FONT_BOLD = 1; const FONT_ITALIC = 2; const FONT_UNDERLINE = 4; const FONT_SHADOW = 8\n\nlet defaultConfig = {\n  fontSize: 11,\n  fontFamily: 'Arial',\n  fontStyle: 0,\n  fontColor: 'black',\n  padding: 0,\n  linePadding: 0,\n  align: 'left',\n  width: 0,\n  height: 0,\n  rotation: null,\n  geometry: { x: 0, y: 0, anchorY: 0, offsetX: 0, offsetY: 0 }\n}\n\n/**\n * The label object handles label sizing/positioning\n */\nexport default (function () {\n  let stringMeasureEl = null; let measureDiv; let baselineDiv\n\n  /**\n   * Calculate the size of the string.\n   */\n  let getStringSize = _.memoize(function (str, fontSize, fontFamily, bold) {\n    fontSize = fontSize || 11\n    fontFamily = fontFamily || 'Arial,Helvetica'\n    bold = !_.isUndefined(bold) ? bold : false\n\n    // first check if there is a string-measuring div available, if not, create now.\n    if (!stringMeasureEl) {\n      stringMeasureEl = DomUtils.createElement('iframe', { id: '_ComputeStylesIframe' }, { position: 'absolute', visibility: 'hidden', width: 'auto' })\n      document.body.appendChild(stringMeasureEl)\n      let doc = stringMeasureEl.contentWindow.document\n      doc.open()\n      doc.write(\n        `<html><body>\n        <div id=\"baselineDiv\" style=\"height:100px;\"><span style=\"line-height:0\">T</span><span style=\"height:100%;display:inline-block;\"></span></div>\n        <div id=\"measureDiv\" style=\"position:absolute;width:auto;height:auto;padding:0;white-space:nowrap;display:inline-block;\"></div>\n        </body></html>`)\n      doc.close()\n      measureDiv = doc.getElementById('measureDiv')\n      baselineDiv = doc.getElementById('baselineDiv')\n    }\n    baselineDiv.style.fontSize = measureDiv.style.fontSize = fontSize\n    baselineDiv.style.fontFamily = measureDiv.style.fontFamily = fontFamily\n    baselineDiv.style.fontWeight = measureDiv.style.fontWeight = bold ? 'bold' : 'normal'\n    measureDiv.innerHTML = str\n\n    let strut = baselineDiv.firstChild\n    let baselineHeight = strut.offsetTop + strut.offsetHeight - baselineDiv.offsetHeight - baselineDiv.offsetTop\n\n    return { width: measureDiv.offsetWidth, height: measureDiv.offsetHeight, baseline: baselineHeight }\n  }, function (str, fontSize, fontFamily, bold) { return str + ';' + fontSize + ';' + fontFamily + ';' + bold })\n\n  /**\n   * Create a wrapped text.\n   * @param {String} string the string to wrap.\n   * @param {maxWidth} the maximum width this string can take.\n   * @param {fontSize}\n   * @param {fontFamily}\n   * @param {bold}\n   */\n  let wrap = _.memoize(function (string, maxWidth, fontSize, fontFamily, bold) {\n    maxWidth = maxWidth || 0\n    fontSize = fontSize || 11\n    fontFamily = fontFamily || 'Arial,Helvetica'\n    bold = !_.isUndefined(bold) ? bold : false\n\n    let arr = []\n    let spaceSize = getStringSize('&nbsp;', fontSize, fontFamily, bold); let space = spaceSize.width\n    arr.lineHeight = spaceSize.height\n    arr.baseline = spaceSize.baseline\n\n    if (!maxWidth || !string || string === '') {\n      arr.push(string)\n      arr.width = (!string || string === '') ? space : getStringSize(string, fontSize, fontFamily, bold).width\n      arr.height = arr.lineHeight\n      return arr\n    }\n\n    let width = 0\n    // split the text by lines\n    let lines = string.split('\\n')\n\n    let buf = new StringBuffer()\n\n    for (let j = 0; j < lines.length; j++) {\n      // split each line by word\n      let words = lines[j].split(/\\s/)\n      let line = ''; let currentWidth = 0; let wordWidth = 0; let newLine = true; let word\n\n      for (let i = 0; i < words.length; i++) {\n        word = words[i]\n        wordWidth = getStringSize(word, fontSize, fontFamily, bold).width\n\n        if ((newLine ? wordWidth : currentWidth + space + wordWidth) > maxWidth) {\n          if (newLine) {\n            buf.append(word)\n            width = Math.max(width, wordWidth)\n            if (i < words.length - 1) {\n              arr.push(buf.toString())\n              buf.clear()\n            }\n          } else {\n            arr.push(buf.append(line).toString())\n            width = Math.max(width, currentWidth + space + wordWidth)\n            buf.clear()\n          }\n          line = ''\n          currentWidth = 0\n          if (!newLine) { i-- } // move back one word.\n          newLine = true\n        } else {\n          line = newLine ? word : line + ' ' + word\n          currentWidth = newLine ? wordWidth : currentWidth + space + wordWidth\n          width = Math.max(width, currentWidth)\n          newLine = false\n        }\n      }\n      if (line !== '') { buf.append(line) }\n      if (j < lines.length - 1) {\n        arr.push(buf.toString())\n        buf.clear()\n      }\n    }\n\n    arr.push(buf.toString())\n    arr.width = width\n    arr.height = arr.lineHeight * arr.length\n    return arr\n  }, function (str, maxWidth, fontSize, fontFamily, bold) { return str + ';' + maxWidth + ';' + fontSize + ';' + fontFamily + ';' + bold })\n\n  /**\n   *  Get the view information for how to display the label.\n   * @param label The string that needs to be displayed\n   * @param containerWidth The width of the parent container.\n   * @param containerHeight The height of the parent container.\n   * @param labelConfig The configuration on how to display label. It should be an object with the following parameters:\n   * {\n   *      fontSize, fontFamily, fontStyle, padding,\n   *      align: can be either \"left\", \"center\" or \"right\",\n   *      width: the maximum width of the label. if less than 1, then is treated as percentage. If 0, no wrapping will occur,\n   *      height,\n   *      geometry\n   * }\n   * @returns {*}\n   */\n  function getLabelBox (label, labelConfig, containerWidth, containerHeight) {\n    return _getLabelBox.call(this, label, labelConfig, { width: containerWidth, height: containerHeight })\n  }\n\n  function getLabelBoxForLink (label, labelConfig, link) {\n    return _getLabelBox.call(this, label, labelConfig, link)\n  }\n\n  function _getLabelBox (label, labelConfig = {}, context) {\n    labelConfig = _.defaultsDeep(labelConfig, defaultConfig)\n    let fontSize = labelConfig.fontSize\n    let fontFamily = labelConfig.fontFamily\n    let fontStyle = labelConfig.fontStyle\n    let bold = (fontStyle & FONT_BOLD) === FONT_BOLD\n    let padding = labelConfig.padding\n    let linePadding = labelConfig.linePadding\n    let align = labelConfig.align\n\n    let w = labelConfig.width; let h = labelConfig.height\n    if (context.width) {\n      w = w <= 5 ? context.width * w : w\n      h = h <= 5 ? context.height * h : h\n    }\n    w -= 2 * padding\n    h -= 2 * padding\n    w = Math.max(0, w)\n    h = Math.max(0, h)\n\n    let geometry = _.clone(labelConfig.geometry)\n    let wrappedLabel = this.wrap(label, w, fontSize, fontFamily, bold)\n    geometry.width = wrappedLabel.width + 2 * padding\n    geometry.height = wrappedLabel.height + 2 * padding + (wrappedLabel.length - 1) * linePadding\n    let anchor = 'start'; let dx = 0; let setAnchorX = !_.has(geometry, 'anchorX')\n    switch (align) {\n      case 'center':\n        anchor = 'middle'\n        if (setAnchorX) geometry.anchorX = 0\n        break\n      case 'right':\n        anchor = 'end'\n        dx = wrappedLabel.width / 2\n        if (setAnchorX) geometry.anchorX = -0.5\n        break\n      case 'left':\n        dx = -wrappedLabel.width / 2\n        if (setAnchorX) geometry.anchorX = 0.5\n        break\n    }\n    let pos\n    if (context.getRelativePosition) { pos = context.getRelativePosition(geometry) } else { pos = Utils.getRelativePosition({ width: context.width, height: context.height }, geometry) }\n\n    let bounds = new Rectangle(pos[0], pos[1], geometry.width, geometry.height)\n    // the pivot is the center of rotation when the label has a rotation specified.\n    let pivot = align === 'center' ? [0, 0] : (align === 'left' ? [-wrappedLabel.width / 2, 0] : [wrappedLabel.width / 2, 0])\n\n    // the maximum bounds for the label, used to position inline editor\n    geometry.width = Math.max(w + 2 * padding, geometry.width)\n    geometry.height = Math.max(h + 2 * padding, geometry.height)\n\n    if (context.getRelativePosition) { pos = context.getRelativePosition(geometry) } else { pos = Utils.getRelativePosition({ width: context.width, height: context.height }, geometry) }\n\n    let maxBounds = new Rectangle(pos[0], pos[1], geometry.width, geometry.height)\n    return {\n      config: labelConfig,\n      label: wrappedLabel,\n      _label: label,\n      bold,\n      underline: fontStyle & FONT_UNDERLINE,\n      italic: fontStyle & FONT_ITALIC,\n      shadow: fontStyle & FONT_SHADOW,\n      dx,\n      dy: -geometry.height / 2 + padding + wrappedLabel.lineHeight - wrappedLabel.baseline,\n      anchor,\n      lineHeight: wrappedLabel.lineHeight + linePadding,\n      pivot,\n      bounds,\n      maxBounds\n    }\n  }\n\n  function render (view, box) {\n    return view.renderLabel(box)\n  }\n\n  // This is the inline editor for editing label text in place.\n  let editor = {\n    start: function (key, container, box, refEl, textEl, scale = 1.0, singleLine = true) {\n      if (this.input) {\n        if (this.key !== key) {\n          // need to close the existing editor first\n          this.stop()\n        } else { return }\n      }\n      let tag = singleLine ? 'input' : 'textarea'\n      this.input = DomUtils.createElement(tag, { id: 'inlineEditor', unselectable: 'off' }, { position: 'absolute', overflow: 'hidden', padding: '0px', margin: '0px', border: 'transparent' })\n      if (singleLine) {\n        Events.on(this.input, 'keydown keyup', (event) => {\n          if (event.keyCode === 13) {\n            Events.off(this.input, 'keydown keyup')\n            this.stop()\n          }\n        })\n      }\n      container.appendChild(this.input)\n\n      this.key = key\n      this.box = box\n      this.refEl = refEl\n      this.textEl = textEl\n\n      let labelConfig = box.config\n      let maxBounds = new Rectangle(box.maxBounds.x, box.maxBounds.y, box.maxBounds.width * scale, box.maxBounds.height * scale)\n      let pos = DomUtils.getCenterPosition(refEl, container)\n      pos = [pos[0] + maxBounds.left, pos[1] + maxBounds.top]\n\n      if (textEl) { textEl.style.visibility = 'hidden' }\n\n      DomUtils.setElement(this.input, null, {\n        visibility: 'visible',\n        left: pos[0] + 'px',\n        top: pos[1] + 'px',\n        width: maxBounds.width + 'px',\n        height: maxBounds.height + 'px',\n        'font-family': labelConfig.fontFamily,\n        'font-size': (labelConfig.fontSize * scale) + 'px',\n        'font-weight': (labelConfig.fontStyle & FONT_BOLD) === FONT_BOLD ? 'bold' : 'normal'\n        /* \"color\": labelConfig.fontColor */\n      })\n\n      this.input.value = box._label\n      this.input.focus()\n      this.input.select()\n      Events.fire(this, 'editor.start', [this.key])\n    },\n\n    stop: function (cancel) {\n      if (!this.input) return\n\n      cancel = cancel || false\n      if (this.textEl) { this.textEl.style.visibility = null }\n\n      // remove the input\n      this.input.parentNode.removeChild(this.input)\n\n      if (!cancel) { Events.fire(this, 'editor.update', [this.key, this.input.value]) }\n\n      Events.fire(this, 'editor.stop', [this.key])\n\n      delete this.input\n      delete this.key\n      delete this.box\n      delete this.refEl\n      delete this.textEl\n    }\n  }\n\n  return {\n    FONT_BOLD,\n    FONT_ITALIC,\n    FONT_UNDERLINE,\n    FONT_SHADOW,\n    getStringSize,\n    wrap,\n    getLabelBox,\n    getLabelBoxForLink,\n    render,\n    editor\n  }\n})()\n","import Rectangle from '../geometry/Rectangle'\n\nlet registry = {}\n\nlet Marker = (function () {\n  /** Begin Standard Marker Type **/\n  function arrow (size, source, styles) {\n    let sign = source ? -1 : 1\n    let marker = {\n      viewBox: new Rectangle(-5, -5, 10, 10),\n      size: size,\n      ref: [4 * sign, 0],\n      fill: styles.color\n    }\n    marker.shape = {\n      name: 'Polygon',\n      points: [[-2 * sign, 0], [-4 * sign, 4], [4 * sign, 0], [-4 * sign, -4]]\n    }\n    return marker\n  }\n\n  function triangle (size, source, styles) {\n    let sign = source ? -1 : 1\n    let marker = {\n      viewBox: new Rectangle(-5, -5, 10, 10),\n      size: size,\n      ref: [4 * sign, 0],\n      fill: styles.color\n    }\n    marker.shape = {\n      name: 'Polygon',\n      points: [[-5 * sign, -5], [-5 * sign, 5], [4 * sign, 0]]\n    }\n    return marker\n  }\n\n  function oval (size, source, styles) {\n    let r = size / 2\n    let marker = {\n      viewBox: new Rectangle(-r, -r, size, size),\n      size: size,\n      ref: [0, 0],\n      fill: styles.color\n    }\n    marker.shape = '<ellipse cx=\"0\" cy=\"0\" rx=\"' + r + '\" ry=\"' + r + '\"></ellipse>'\n    return marker\n  }\n\n  function diamond (size, source, styles) {\n    let sign = source ? -1 : 1\n    let marker = {\n      viewBox: new Rectangle(-5, -5, 10, 10),\n      size: size,\n      ref: [4 * sign, 0],\n      fill: styles.color\n    }\n    marker.shape = {\n      name: 'Polygon',\n      points: [[-4, 0], [0, 4], [4, 0], [0, -4]]\n    }\n    return marker\n  }\n  /** End Standard Marker Type **/\n  function getMarker (config, source) {\n    let factory = registry[config.type]\n    let marker = factory(config.size, source, config)\n    marker.id = config.id\n    return marker\n  }\n\n  registry['arrow'] = arrow\n  registry['triangle'] = triangle\n  registry['oval'] = oval\n  registry['diamond'] = diamond\n\n  return {\n    registry: registry,\n    getMarker: getMarker\n  }\n})()\n\nexport default Marker\n","import _ from 'lodash'\nimport Events from '../event/events'\nimport Utils from '../util/Utils'\nimport DomUtils from '../util/dom-utils'\nimport Layout from '../layout/Layout'\nimport Rectangle from '../geometry/Rectangle'\nimport EventDispatcher from '../event/event-dispatcher'\nimport GraphBehavior from '../behavior/GraphBehavior'\nimport SelectionBehavior from '../behavior/SelectionBehavior'\nimport Label from './Label'\n\nclass Renderer {\n  constructor (id, container, config = {}, graph = null) {\n    this.id = id\n    this.box = DomUtils.createElement('div', { id: this.id, tabindex: 0, ns: 'graph' }, { overflow: 'hidden', width: '100%', height: '100%', position: 'relative' })\n    container.appendChild(this.box)\n    if (config.layout) {\n      let LayoutClass = Utils.getConstructor(config.layout.jsClass, Layout)\n      this.layout = new LayoutClass(config.layout.config)\n      delete config.layout\n    }\n    this.clear = true\n    this._translate = [0, 0]\n    this._scale = 1.0\n    this.graph = graph\n    this.dispatcher = null\n    this.graphBehavior = null\n    this.selectionBehavior = null\n    this.nodeBehavior = null\n    this.edgeBehavior = null\n    this.connectionBehavior = null\n    Utils.initConfig(this, config)\n\n    Events.on(Label.editor, 'editor.update.*', (key, value) => {\n      // this.graph.nodes[key].prop('label', value);\n      // this.render();\n      console.log(key + '=' + value)\n    })\n  }\n\n  get graph () {\n    return this._graph\n  }\n\n  set graph (graph) {\n    this._graph = graph\n    let root = graph.currentRoot\n    if (root) {\n      this._translate = [root.viewProp(this.id, 'x') || 0, root.viewProp(this.id, 'y') || 0]\n      this._scale = root.viewProp(this.id, 'scale') || 1.0\n    }\n  }\n\n  viewport (scaled, viewport) {\n    if (_.isUndefined(scaled) || _.isNull(scaled)) scaled = false\n    if (!viewport) {\n      let vp = new Rectangle(0, 0, this.box.offsetWidth, this.box.offsetHeight)\n      if (scaled) { return Utils.scale(this.translate, this.scale, vp) }\n      return vp\n    }\n    if (!scaled) viewport = Utils.scale(this.translate, this.scale, viewport)\n    let w = this.box.offsetWidth\n    let scale = w / viewport.width\n    this.transform(-viewport.x * scale, -viewport.y * scale, scale)\n  }\n\n  get translate () { return this._translate }\n  set translate (t) { this.transform(t[0], t[1]) }\n  get scale () { return this._scale }\n  set scale (k) {\n    switch (k) {\n      case 'in':\n        k = this.scale * this.prop('zoomFactor')\n        break\n      case 'out':\n        k = this.scale / this.prop('zoomFactor')\n        break\n      case 'actual':\n        k = 1.0\n        break\n      case 'fit':\n        let gridSize = this.prop('gridSize') * 2\n\n        let gBounds = this.getBounds()\n        let vBounds = this.viewport()\n\n        vBounds.width -= gridSize\n        vBounds.height -= gridSize\n\n        /* Do not zoom more than actual if graph already fits into the bounds */\n        k = Math.min((vBounds.width / gBounds.width), (vBounds.height / gBounds.height), 1.0)\n\n        // TODO: Add centering code here or trigger an event for that\n        break\n      default:\n        if (_.isString(k)) k = parseFloat(k)\n        break\n    }\n    this.transform(null, null, k)\n  }\n\n  transform (x = null, y = null, scale = null) {\n    let graph = this.graph\n    let root = graph ? graph.currentRoot : null\n    if (!_.isNull(x)) {\n      this._translate[0] = x\n      if (root) { root.viewProp(this.id, 'x', x) }\n    }\n    if (!_.isNull(y)) {\n      this._translate[1] = y\n      if (root) { root.viewProp(this.id, 'y', y) }\n    }\n    if (!_.isNull(scale)) {\n      this._scale = scale\n      if (root) { root.viewProp(this.id, 'scale', scale) }\n      // sync the scale between the dispatcher and the graph\n      let s = this.dispatcher.scale\n      if (s !== scale) { this.dispatcher.scale = scale }\n    }\n    this.refresh()\n  }\n\n  render () {\n    if (!this._graph) return false\n    if (this.layout) { this.layout.layout(this._graph.currentRoot, this.viewport()) }\n\n    this.initializeBehaviors()\n    return true\n  }\n\n  renderLabel (box) {\n    return this.constructor.renderLabel(box)\n  }\n\n  renderLink (shape) {\n    return this.constructor.renderLink(shape)\n  }\n\n  renderMarkers (markers) {\n    return this.constructor.renderMarkers(markers)\n  }\n\n  initializeBehaviors () {\n    // create the event dispatcher if necessary.\n    if (!this.dispatcher) {\n      this.dispatcher = new EventDispatcher(this.box, [this.prop('minZoom'), this.prop('maxZoom')])\n      let JsClass\n      if (this.prop('graphBehavior')) {\n        JsClass = Utils.getConstructor(this.prop('graphBehavior'))\n        this.graphBehavior = new JsClass(this)\n      }\n      if (this.prop('selectionBehavior')) {\n        JsClass = Utils.getConstructor(this.prop('selectionBehavior'))\n        this.selectionBehavior = new JsClass(this)\n      }\n      this.dispatcher.register('mouseup.node.label', function (type, ns, target, pos, event) {\n        let node = this._graph.nodes[target.getAttribute('id')]\n        if (!this.dispatcher.dragging && !node._firstSelection) {\n          Label._delayEdit = _.delay(() => {\n            if (Label._delayEdit) {\n              delete Label._delayEdit\n              Label.editor.start(node.id, this.box, node.getLabelBox(this.id), target, event.nsTarget, this.scale)\n            }\n          }, 250)\n        }\n      }, this)\n      this.dispatcher.register([/^mousedown/, /^zoom/], function (type, ns, target, pos, event) {\n        if (!DomUtils.eventFromInput(event)) {\n          Label.editor.stop()\n        }\n      }, this)\n    }\n    this.dispatcher.start()\n  }\n\n  refresh () {}\n\n  /**\n   * Get the template for the specified key.\n   * @param key\n   * @param config if the template is a function, this config will be passed as the argument.\n   * @param preprocessor if the template contains preprossing elements, such as #{shape}, the preprocessor will be\n   * used to render them.\n   * @returns {*}\n   */\n  getTemplate (key, config, preprocessor) {\n    let t = this.constructor.TEMPLATES[key]\n    if (t && _.isFunction(t)) {\n      t = t(config)\n    }\n    // check if there are any preprocessing tags.\n    if (preprocessor) {\n      let parts = t.match(/(#{[^#]*})/g)\n      let obj = {}\n      for (let part in parts) {\n        part = parts[part]\n        part = part.substring(2, part.length - 1).trim()\n        obj[part] = preprocessor[_.camelCase('render ' + part)](this)\n      }\n      t = _.template(t, { interpolate: /#{([\\s\\S]+?)}/g })(obj)\n    }\n    return t\n  }\n\n  reset () {}\n\n  destroy () {\n    delete this._graph\n    delete this.layout\n    if (this.dispatcher) {\n      this.dispatcher.stop()\n      delete this.dispatcher\n    }\n    this.box.innerHTML = ''\n  }\n}\nRenderer.DEFAULTS = {\n  defaultClickMode: 'pan',\n  hideOutline: false,\n  singleSelect: true,\n  draggable: true,\n  gridEnabled: false,\n  guidesEnabled: true,\n  gridSize: 30,\n  maxZoom: 4.0,\n  minZoom: 0.2,\n  zoomFactor: 1.2,\n  maskOpacity: 0.5,\n  graphBehavior: GraphBehavior,\n  selectionBehavior: SelectionBehavior\n}\n\nexport default Renderer\n","import _ from 'lodash'\nimport Base64 from '../util/base64'\nimport DomUtils from '../util/dom-utils'\nimport Renderer from './Renderer'\nimport StringBuffer from '../util/string-buffer'\n\nconst NS = 'http://www.w3.org/2000/svg'\nif (typeof (SVGElement) !== 'undefined') {\n  var svg = document.createElementNS(NS, 'svg')\n  svg.innerHTML = '<circle/>'\n  if (svg.firstChild !== '[object SVGCircleElement]') {\n    Object.defineProperties(SVGElement.prototype, {\n      'outerHTML': {\n        enumerable: false,\n        configurable: true,\n        get: function () {\n          var $node, $temp\n          $temp = document.createElement('div')\n          $node = this.cloneNode(true)\n          $temp.appendChild($node)\n          return $temp.innerHTML\n        }\n      },\n      'innerHTML': {\n        enumerable: false,\n        configurable: true,\n        get: function () {\n          var s = this.outerHTML\n          var ropen = new RegExp('<' + this.nodeName + '\\\\b(?:([\"\\'])[^\"]*?(\\\\1)|[^>])*>', 'i')\n          var rclose = new RegExp('</' + this.nodeName + '>$', 'i')\n          return s.replace(ropen, '').replace(rclose, '')\n        },\n        set: function (markup) {\n          // empty el first.\n          let child\n          while ((child = this.lastChild) !== null) { this.removeChild(child) }\n          let buf = new StringBuffer()\n          buf.append('<svg>').append(markup).append('</svg')\n          let $temp = DomUtils.createElement('div', null, null, buf.toString()).firstElementChild\n          while ($temp.firstChild) { this.appendChild($temp.firstChild) }\n        }\n      }\n    })\n  }\n  // Define the toDataURL for SVG\n  SVGElement.prototype.toDataURL = function (type, options = {}) {\n    let _svg = this\n\n    let debug = function (msg) {}\n\n    if (options['debug'] === true && typeof (console) !== 'undefined') { debug = function (msg) { console.log('SVG.toDataURL:', msg) } }\n\n    function exportSVG () {\n      var svgXml = _svg.outerHTML\n      var svgDataurl = base64dataURLencode(svgXml)\n      debug(type + ' length: ' + svgDataurl.length)\n\n      // NOTE double data carrier\n      if (options.callback) options.callback(svgDataurl)\n      return svgDataurl\n    }\n\n    function base64dataURLencode (s) {\n      var b64 = 'data:image/svg+xml;base64,'\n\n      // https://developer.mozilla.org/en/DOM/window.btoa\n      if (window && window.btoa) {\n        debug('using window.btoa for base64 encoding')\n        b64 += btoa(s)\n      } else {\n        debug('using custom base64 encoder')\n        b64 += Base64.encode(s)\n      }\n\n      return b64\n    }\n\n    // Native export doesn't work very well. should use canvg instead.\n    function exportImage (type) {\n      var canvas = document.createElement('canvas')\n      var ctx = canvas.getContext('2d')\n\n      // TODO: if (options.keepOutsideViewport), do some translation magic?\n\n      var svgImg = new Image()\n      var svgXml = _svg.outerHTML\n      svgImg.src = base64dataURLencode(svgXml)\n\n      svgImg.onload = function () {\n        debug('exported image size: ' + [svgImg.width, svgImg.height])\n        canvas.width = svgImg.width\n        canvas.height = svgImg.height\n        ctx.drawImage(svgImg, 0, 0)\n\n        // SECURITY_ERR WILL HAPPEN NOW\n        var imageDataurl = canvas.toDataURL(type)\n        debug(type + ' length: ' + imageDataurl.length)\n\n        if (options.callback) options.callback(imageDataurl)\n        else debug('WARNING: no callback set, so nothing happens.')\n      }\n\n      svgImg.onerror = function () {\n        debug(\n          \"Can't export! Maybe your browser doesn't support \" +\n          'SVG in img element or SVG input for Canvas drawImage?\\n' +\n          'http://en.wikipedia.org/wiki/SVG#Native_support'\n        )\n      }\n\n      // NOTE: will not return anything\n    }\n\n    function exportImageCanvg (type) {\n      if (typeof canvg === 'undefined') return null\n      let canvas = DomUtils.createElement('canvas', null, { display: 'none' })\n      document.body.appendChild(canvas)\n      if (type === 'javascript' && typeof jsCanvas !== 'undefined') {\n        var xcanvas = new jsCanvas('jscanvastest') // eslint-disable-line new-cap\n        xcanvas.canvas.style.display = 'none'\n        // xcanvas.canvas = canvas;\n      }\n\n      if (!options.keepOutsideViewport) {\n        canvg(canvas, _svg.outerHTML)\n      } else {\n        let padding = options.padding || 0\n        let scale = 1.0\n        let translate = [0, 0]\n        let bbox = _svg.getBBox()\n        debug('detected svg dimensions ' + [bbox.x, bbox.y, bbox.width, bbox.height])\n        let transform = _svg.firstElementChild.getAttribute('transform')\n        if (transform) {\n          debug('detected svg transform ' + transform)\n          transform = SVGRenderer.transform(transform)\n          translate = transform.translate\n          scale = transform.scale\n        }\n        let buf = new StringBuffer()\n        buf.append('<svg width=\"').append(bbox.width + 2 * padding).append('px\" height=\"').append(bbox.height + 2 * padding).append('px\"><g transform=\"translate(')\n          .append(-bbox.x + translate[0] + padding).append(',').append(-bbox.y + translate[1] + padding).append(')scale(').append(scale).append(')\">')\n          .append(_svg.firstElementChild.innerHTML).append('</g></svg>')\n        if (type === 'javascript') {\n          xcanvas.compile(buf.toString(), function () {\n            if (options.callback) options.callback(xcanvas.toString())\n          })\n          return\n        } else { canvg(canvas, buf.toString()) }\n      }\n      var imageDataurl = canvas.toDataURL(type)\n      if (options.callback) options.callback(imageDataurl)\n      canvas.parentNode.removeChild(canvas)\n      return imageDataurl\n    }\n\n    if (!type) type = 'image/svg+xml'\n\n    if (options.keepNonSafe) debug('NOTE: keepNonSafe is NOT supported and will be ignored!')\n    if (options.keepOutsideViewport) debug('NOTE: keepOutsideViewport is only supported with canvg exporter.')\n\n    switch (type) {\n      case 'image/svg+xml':\n        return exportSVG()\n      case 'image/png':\n      case 'image/jpeg':\n      case 'javascript':\n        if (!options.renderer) {\n          if (window && window.canvg) options.renderer = 'canvg'\n          else options.renderer = 'native'\n        }\n        switch (options.renderer) {\n          case 'canvg':\n            debug('using canvg renderer for ' + type + ' image export')\n            return exportImageCanvg(type)\n          case 'native':\n            debug('using native renderer for ' + type + ' export. THIS MIGHT FAIL.')\n            return exportImage(type)\n          default:\n            debug('unknown image renderer given, doing noting (' + options.renderer + ')')\n        }\n        break\n      default:\n        debug(\"Sorry! Exporting as '\" + type + \"' is not supported!\")\n    }\n    return null\n  }\n}\n\nclass SVGRenderer extends Renderer {\n  render () {\n    let result = super.render()\n    if (result) {\n      let root = this.graph.currentRoot\n      let buf = new StringBuffer('<svg width=\"100%\" height=\"100%\" xmlns=\"http://www.w3.org/2000/svg\">')\n      let t = this.translate\n      buf.append('<g transform=\"translate(').append(t[0]).append(',').append(t[1]).append(')scale(').append(this.scale).append(')\">')\n      buf.append(this.renderDefs())\n      buf.append(root.render(this))\n      buf.append('</g></svg>')\n      this.box.innerHTML = buf.toString()\n      this.svg = this.box.firstElementChild\n    }\n  }\n\n  renderDefs () {\n    let buf = new StringBuffer('<defs>')\n    buf.append(this.getTemplate('Grid', this.prop('gridSize')))\n    let markers = this.graph.markers\n    if (markers.length > 0) { buf.append(SVGRenderer.renderMarkers(markers)) }\n    buf.append('</defs>')\n    return buf.toString()\n  }\n\n  refresh () {\n    if (!this.svg) return\n    let g = this.svg.querySelector('g')\n    let t = this.translate\n    g.setAttribute('transform', 'translate(' + t[0] + ',' + t[1] + ')scale(' + this.scale + ')')\n  }\n\n  static renderMarkers (markers) {\n    let buf = new StringBuffer(); let str1; let str2\n    markers.forEach(function (marker) {\n      str1 = this.TEMPLATES['Marker'](marker)\n      str2 = marker.shape\n      if (!_.isString(str2)) { str2 = this.renderShape(str2) }\n      str1 = str1.replace(/#\\{shape\\}/, str2)\n      buf.append(str1)\n    }, this)\n    return buf.toString()\n  }\n\n  static renderLabel (box) {\n    return this.TEMPLATES['Label'](box)\n  }\n\n  static renderShape (shape) {\n    let template = this.TEMPLATES[shape.name]\n    if (_.isString(template)) { template = _.template(template) }\n    return template(shape)\n  }\n\n  static getPathData (shape) {\n    let points = shape.points\n    let controlPts = shape.controlPts\n    if (!points || points.length === 0) return ''\n\n    if (!controlPts && shape.round) {\n      // render rounded line joins.\n      let newPts = []\n      controlPts = []\n      let prev = points[0]; let next; let d1; let d2; let corner\n      newPts.push(prev)\n      for (let i = 1; i < points.length - 1; i++) {\n        next = points[i]\n        // set the control point first.\n        controlPts[2 * i] = [next, next]\n        // check the size of the corner.\n        d1 = prev.distance(next)\n        d2 = next.distance(points[i + 1])\n        corner = Math.min(shape.round, d1 / 2, d2 / 2)\n        // split the point into two.\n        newPts.push(next.getDirection(prev).scale(corner).translate(next))\n        newPts.push(next.getDirection(points[i + 1]).scale(corner).translate(next))\n        prev = next\n      }\n      newPts.push(points[points.length - 1])\n      points = newPts\n    }\n    let buf = new StringBuffer('M'); let point\n    for (let i = 0; i < points.length; i++) {\n      point = points[i]\n      if (i === 0) { buf.append(point) } else {\n        if (controlPts && controlPts[i]) {\n          buf.append(' C ')\n          for (let j = 0; j < controlPts[i].length; j++) { buf.append(controlPts[i][j]).append(' ') }\n          buf.append(point)\n        } else { buf.append(' L ').append(point) }\n      }\n    }\n    return buf.toString()\n  }\n\n  static renderLink (shape) {\n    let buf = new StringBuffer()\n    let d = SVGRenderer.getPathData(shape)\n    if (shape.showGauge) {\n      buf.append('<path style=\"stroke: white; stroke-width: 9; visibility: hidden; pointer-events: stroke;\" d=\"')\n        .append(d).append('\"/>')\n    }\n    buf.append('<path d=\"').append(d).append('\"')\n    if (shape.startMarker || shape.endMarker) {\n      buf.append(' style=\"')\n      if (shape.startMarker) { buf.append('marker-start: url(#').append(_.isString(shape.startMarker) ? shape.startMarker : shape.startMarker.id).append(');') }\n      if (shape.endMarker) { buf.append('marker-end: url(#').append(_.isString(shape.endMarker) ? shape.endMarker : shape.endMarker.id).append(');') }\n      buf.append('\"')\n    }\n    buf.append('/>')\n    return buf.toString()\n  }\n\n  static appendContent (el, content) {\n    let buf = new StringBuffer()\n    buf.append('<svg>').append(content).append('</svg')\n    let temp = DomUtils.createElement('div', null, null, buf.toString()).firstElementChild\n\n    while (temp.firstChild) { el.appendChild(temp.firstChild) }\n    return el\n  }\n\n  static transform (transform) {\n    let translate = [0, 0]; let scale = 1.0\n    //\n    let parts = transform.match(/translate\\(\\s*([^)]+)/)\n    if (parts) {\n      let m = parts[1].trim().match(/([\\d.-]+)[ ,]([\\d.-]+)/)\n      if (m) {\n        translate[0] = parseFloat(m[1]) || 0\n        translate[1] = parseFloat(m[2]) || 0\n      } else { translate[0] = translate[1] = parseFloat(parts[1]) }\n    }\n    parts = transform.match(/scale\\(\\s*([^)]+)/)\n    if (parts) { scale = parseFloat(parts[1]) || 1.0 }\n\n    return { translate, scale }\n  }\n}\n/* eslint-disable no-template-curly-in-string */\nSVGRenderer.TEMPLATES = {\n  $root: '<g id=\"${id}\" class=\"${className}\">#{children}</g>',\n  $node: '<g id=\"${id}\" class=\"${className}\" style=\"${style}\" ns=\"${namespace}\" transform=\"translate(${x},${y})\">#{shape}#{label}</g>',\n  $edge: '<g id=\"${id}\" class=\"${className}\" style=\"${style}\" ns=\"${namespace}\">#{shape}#{label}</g>',\n  Ellipse: '<ellipse cx=\"0\" cy=\"0\" rx=\"${width/2}\" ry=\"${height/2}\"/>',\n  Rectangle: '<rect x=\"${-width/2}\" y=\"${-height/2}\" width=\"${width}\" height=\"${height}\" rx=\"9\" ry=\"9\"/>',\n  Triangle: '<polygon points=\"${-width/2},${-height/2} ${width/2},${-height/2} 0,${height/2}\"/>',\n  Rhombus: '<polygon points=\"0,${-height/2} ${width/2},0 0,${height/2} ${-width/2},0\"/>',\n  Hexagon: function (config) {\n    var vertical = config.direction === 'north' || config.direction === 'south'\n    if (vertical) { return '<polygon points=\"0,${-height/2} ${width/2},${-height/4} ${width/2},${height/4} 0,${height/2} ${-width/2},${height/4} ${-width/2},${-height/4}\"/>' } else { return '<polygon points=\"${-width/2},0 ${width/4},${-height/2} ${width/4},${-height/2} ${width/2},0 ${width/4},${height/2} ${-width/4},${height/2}\"/>' }\n  },\n  Polygon: function (shape) {\n    let buf = new StringBuffer('<polygon points=\"')\n    shape.points.forEach(function (pt) {\n      buf.append(pt[0]).append(',').append(pt[1]).append(' ')\n    })\n    buf.removeLast()\n    buf.append('\"/>')\n    return buf.toString()\n  },\n  Image: function (config) {\n    return '<image x=\"${-width/2}\" y=\"${-height/2}\" width=\"${width}\" height=\"${height}\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"' + config.image + '\"/>'\n  },\n  Marker: function (marker) {\n    return `\n<marker id=\"${marker.id}\" markerWidth=\"${marker.size}\" markerHeight=\"${marker.size}\" refx=\"${marker.ref[0]}\"\nrefy=\"${marker.ref[1]}\" orient=\"auto\" viewbox=\"${marker.viewBox.x} ${marker.viewBox.y} ${marker.viewBox.width} ${marker.viewBox.height}\"\nmarkerUnits=\"userSpaceOnUse\" ${marker.fill ? `style=\"stroke: ${marker.fill};fill:${marker.fill}\"` : ''}>#{shape}</marker>\n`.trim()\n  },\n  Grid: function (size) {\n    return `\n<pattern id=\"GridPattern\" width=\"${size}\" height=\"${size}\" patternUnits=\"userSpaceOnUse\">\n  <ellipse cx=\"0\" cy=\"0\" rx=\"1\" ry=\"1\" fill=\"#999999\"/>\n  <ellipse cx=\"0\" cy=\"${size}\" rx=\"1\" ry=\"1\" fill=\"#999999\"/>\n  <ellipse cx=\"${size}\" cy=\"0\" rx=\"1\" ry=\"1\" fill=\"#999999\"/>\n  <ellipse cx=\"${size}\" cy=\"${size}\" rx=\"1\" ry=\"1\" fill=\"#999999\"/>\n</pattern>`.trim()\n  },\n  Label: _.template(`\n<% var box = _.has(data, \"dx\") ? data : (data.getLabelBox ? data.getLabelBox() : null);\n   if (box) {%>\n  <g <% if (box.config && box.config.class) {%>class=\"<%=box.config.class%>\"<%}%>\\\n    <% if (box.config && box.config.ns) {%>ns=\"<%=box.config.ns%>\"<%}%>\\\n    <% if (box.config && box.config.inlineStyle) {%>\\\n      font-size=\"<%=box.config.fontSize%>\"\\\n      font-family=\"<%=box.config.fontFamily%>\"\\\n      font-weight=\"<% if (box.bold) {%>bold<%} else {%>normal<%}%>\"\\\n      <% if (box.underline) {%>text-decoration=\"underline\"<%}%>\\\n      <% if (box.italic) {%>font-style=\"italic\"<%}%>\\\n    <%}%>\\\n    text-anchor=\"<%=box.anchor%>\"\\\n    transform=\"translate(<%=box.bounds.x%>,<%=box.bounds.y%>)<% if (box.config && box.config.rotation) {%>rotate(<%=box.config.rotation%> <%=box.pivot[0]%> <%=box.pivot[1]%>)<%}%>\">\n  <% if (box.config.backgroundStyle) {%>\n    <rect x=\"<%=-box.bounds.width/2%>\" y=\"<%=-box.bounds.height/2%>\" width=\"<%=box.bounds.width%>\" height=\"<%=box.bounds.height%>\" style=\"<%=box.config.backgroundStyle%>\"/>\n  <% } if (_.isArray(box.label)) {\n    _.each(box.label, function(value, line) {%>\n      <text <% if (box.config && box.config.textStyle) {%>style=\"<%=box.config.textStyle%>\"<%}%>\\\n        dx=\"<%=box.dx%>\" dy=\"<%=box.dy + box.lineHeight * line%>\"><%=value%></text>\n    <%});} else { %>\n      <text><%=box.label%></text>\n    <%}%>\n    <% if (box.config.title) {%>\n      <title><%=box.config.title%></title>\n    <%}%>\n  </g>\n<%}%>\n`.trim(), { variable: 'data' }) // TODO add more inline text styles.\n}\n\nexport default SVGRenderer\n","module.exports = __WEBPACK_EXTERNAL_MODULE_lodash__;"],"sourceRoot":""}